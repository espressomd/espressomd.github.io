<!DOCTYPE html>

<html lang="en" data-content_root="./">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>2. Installation &#8212; ESPResSo 5.0.0 documentation</title>
    <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="_static/alabaster.css?v=97504538" />
    <link rel="stylesheet" type="text/css" href="_static/blockquotes.css?v=270de11a" />
    <link rel="stylesheet" type="text/css" href="_static/custom.css?v=539bf778" />
    <script src="_static/documentation_options.js?v=ce74c6a2"></script>
    <script src="_static/doctools.js?v=888ff710"></script>
    <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="_static/toggleprompt.js?v=5801b3bb"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="3. Running a simulation" href="running.html" />
    <link rel="prev" title="1. Introduction" href="introduction.html" />
   
  <link rel="stylesheet" href="_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="installation">
<span id="id1"></span><h1><span class="section-number">2. </span>Installation<a class="headerlink" href="#installation" title="Link to this heading">¶</a></h1>
<p>This chapter will describe how to get, compile and run the software.</p>
<p>ESPResSo releases are available as source code packages from the homepage <a class="footnote-reference brackets" href="#id42" id="id2" role="doc-noteref"><span class="fn-bracket">[</span>1<span class="fn-bracket">]</span></a>.
This is where new users should get the code. The code within release packages
is tested and known to run on a number of platforms.
Alternatively, people who want to use the newest features of ESPResSo or
start contributing to the software can instead obtain the
current development code via the version control system software  <a class="footnote-reference brackets" href="#id43" id="id3" role="doc-noteref"><span class="fn-bracket">[</span>2<span class="fn-bracket">]</span></a>
from ESPResSo’s project page at GitHub  <a class="footnote-reference brackets" href="#id44" id="id4" role="doc-noteref"><span class="fn-bracket">[</span>3<span class="fn-bracket">]</span></a>. This code might be not as well
tested and documented as the release code; it is recommended to use this
code only if you have already gained some experience in using ESPResSo.</p>
<p>Unlike most other software, no binary distributions of ESPResSo are available,
and the software is usually not installed globally for all users.
Instead, users should compile the software themselves. The reason for
this is that it is possible to activate and deactivate various features
before compiling the code. Some of these features are not compatible
with each other, and some of the features have a profound impact on the
performance of the code. Therefore it is not possible to build a single
binary that can satisfy all needs. For performance reasons a user
should always activate only those features that are actually needed.
This means, however, that learning how to compile is a necessary evil.
The build system of ESPResSo uses CMake to compile
software easily on a wide range of platforms.</p>
<p>Users who only need a “default” installation of ESPResSo and have an account
on the <a class="reference external" href="https://gitpod.io">Gitpod</a> platform can build the software
automatically in the cloud and skip this chapter. For more details on
running ESPResSo in Gitpod, go to section <a class="reference internal" href="running.html#running-in-the-cloud"><span class="std std-ref">Running in the cloud</span></a>.</p>
<section id="quickstart">
<h2><span class="section-number">2.1. </span>Quickstart<a class="headerlink" href="#quickstart" title="Link to this heading">¶</a></h2>
<p>Installing ESPResSo usually involves the following steps:</p>
<ol class="arabic simple">
<li><p>downloading the source code: one of the
<a class="reference external" href="https://github.com/espressomd/espresso/releases">stable releases</a>
(.zip files, or .tar.gz files before 2025) or the development version
(<code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">clone</span> <span class="pre">-b</span> <span class="pre">python</span> <span class="pre">https://github.com/espressomd/espresso.git</span></code>)</p></li>
<li><p>installing dependencies on
<a class="reference internal" href="#installing-requirements-on-ubuntu"><span class="std std-ref">Ubuntu</span></a>,
<a class="reference internal" href="#installing-requirements-on-macos"><span class="std std-ref">macOS</span></a>,
<a class="reference internal" href="#installing-requirements-on-windows-via-wsl"><span class="std std-ref">Windows</span></a>,
or <a class="reference internal" href="#installing-requirements-on-other-linux-distributions"><span class="std std-ref">other Linux distributions</span></a></p></li>
<li><p>building the application: default build (<a class="reference internal" href="#quick-installation"><span class="std std-ref">Quick installation</span></a>)
or custom build (requires <a class="reference internal" href="#configuring"><span class="std std-ref">Configuring</span></a>)</p></li>
</ol>
<p>A troubleshooting guide is available on the project
<a class="reference external" href="https://github.com/espressomd/espresso/wiki/Installation-FAQ">GitHub wiki</a>,
featuring contributed patches for compiler-related and library-related issues.</p>
</section>
<section id="requirements">
<span id="id5"></span><h2><span class="section-number">2.2. </span>Requirements<a class="headerlink" href="#requirements" title="Link to this heading">¶</a></h2>
<p>The following tools and libraries, including their header files,
are required to be able to compile and use ESPResSo:</p>
<dl class="glossary">
<dt id="term-CMake">CMake<a class="headerlink" href="#term-CMake" title="Link to this term">¶</a></dt><dd><p>The build system is based on CMake version 3 or later <a class="footnote-reference brackets" href="#id45" id="id6" role="doc-noteref"><span class="fn-bracket">[</span>4<span class="fn-bracket">]</span></a>.</p>
</dd>
<dt id="term-C-compiler">C++ compiler<a class="headerlink" href="#term-C-compiler" title="Link to this term">¶</a></dt><dd><p>The C++ core of ESPResSo needs to be built by a C++20-capable compiler.</p>
</dd>
<dt id="term-Boost">Boost<a class="headerlink" href="#term-Boost" title="Link to this term">¶</a></dt><dd><p>A number of advanced C++ features used by ESPResSo are provided by Boost.</p>
</dd>
<dt id="term-FFTW">FFTW<a class="headerlink" href="#term-FFTW" title="Link to this term">¶</a></dt><dd><p>For some algorithms like P<sup>3</sup>M, ESPResSo needs the FFTW library
version 3 or later <a class="footnote-reference brackets" href="#id46" id="id7" role="doc-noteref"><span class="fn-bracket">[</span>5<span class="fn-bracket">]</span></a> for Fourier transforms, including header files.
ESPResSo leverages heFFTe <span id="id8">[<a class="reference internal" href="bibliography.html#id14" title="Alan Ayala, Stanimire Tomov, Azzam Haidar, and Jack Dongarra. \textit heFFTe: highly efficient FFT for exascale. In Valeria V. Krzhizhanovskaya, Gábor Závodszky, Michael H. Lees, Jack J. Dongarra, Peter M. A. Sloot, Sérgio Brissos, and João Teixeira, editors, Computational Science – ICCS 2020, volume 12137 of Lecture Notes in Computer Science, 262–275. Cham, Switzerland, 2020. Springer International Publishing. doi:10.1007/978-3-030-50371-0_19.">Ayala <em>et al.</em>, 2020</a>]</span>.</p>
</dd>
<dt id="term-CUDA">CUDA<a class="headerlink" href="#term-CUDA" title="Link to this term">¶</a></dt><dd><p>For some algorithms like P<sup>3</sup>M,
ESPResSo provides GPU-accelerated implementations for NVIDIA GPUs.
We require CUDA 12.0 or later <a class="footnote-reference brackets" href="#id47" id="id9" role="doc-noteref"><span class="fn-bracket">[</span>6<span class="fn-bracket">]</span></a>.</p>
</dd>
<dt id="term-MPI">MPI<a class="headerlink" href="#term-MPI" title="Link to this term">¶</a></dt><dd><p>An MPI library that implements the MPI standard version 1.2 is required
to run simulations in parallel. ESPResSo is currently tested against
<a class="reference external" href="https://www.open-mpi.org">Open MPI</a> and
<a class="reference external" href="https://www.mpich.org">MPICH</a>, with and without
<a class="reference external" href="https://openucx.org">UCX</a> enabled.
Other MPI implementations like Intel MPI should also work, although
they are not actively tested in ESPResSo continuous integration.</p>
<p>Open MPI version 4.x is known to not properly support the MCA binding
policy “numa” in singleton mode on a few NUMA architectures.
On affected systems, e.g. AMD Ryzen or AMD EPYC, Open MPI halts with
a fatal error when setting the processor affinity in <code class="docutils literal notranslate"><span class="pre">MPI_Init</span></code>.
This issue can be resolved by setting the environment variable
<code class="docutils literal notranslate"><span class="pre">OMPI_MCA_hwloc_base_binding_policy</span></code> to a value other than “numa”,
such as “l3cache” to bind to a NUMA shared memory block, or to
“none” to disable binding (can cause performance loss).</p>
</dd>
<dt id="term-OpenMP">OpenMP<a class="headerlink" href="#term-OpenMP" title="Link to this term">¶</a></dt><dd><p>A compiler that implements the OpenMP standard version 5.0 is required
to run simulations with shared-memory parallelization.
ESPResSo leverages Kokkos <span id="id10">[<a class="reference internal" href="bibliography.html#id121" title="Christian R. Trott, Damien Lebrun-Grandié, Daniel Arndt, Jan Ciesko, Vinh Dang, Nathan Ellingwood, Rahulkumar Gayatri, Evan Harvey, Daisy S. Hollman, Dan Ibanez, Nevin Liber, Jonathan Madsen, Jeff Miles, David Poliakoff, Amy Powell, Sivasankaran Rajamanickam, Mikael Simberg, Dan Sunderland, Bruno Turcksin, and Jeremiah Wilke. Kokkos 3: programming model extensions for the exascale era. IEEE Transactions on Parallel and Distributed Systems, 33(4):805–817, 2022. doi:10.1109/TPDS.2021.3097283.">Trott <em>et al.</em>, 2022</a>]</span> and Cabana <span id="id11">[<a class="reference internal" href="bibliography.html#id108" title="Stuart Slattery, Samuel Temple Reeve, Christoph Junghans, Damien Lebrun-Grandié, Robert Bird, Guangye Chen, Shane Fogerty, Yuxing Qiu, Stephan Schulz, Aaron Scheinberg, Austin Isner, Kwitae Chong, Stan Moore, Timothy Germann, James Belak, and Susan Mniszewski. Cabana: a performance portable library for particle-based simulations. Journal of Open Source Software, 7(72):4115, 2022. doi:10.21105/joss.04115.">Slattery <em>et al.</em>, 2022</a>]</span>.</p>
</dd>
<dt id="term-Python">Python<a class="headerlink" href="#term-Python" title="Link to this term">¶</a></dt><dd><p>ESPResSo’s main user interface relies on Python 3.</p>
<p>We strongly recommend using Python environments to isolate
packages required by ESPResSo from packages installed system-wide.
This can be achieved using venv <a class="footnote-reference brackets" href="#id48" id="id12" role="doc-noteref"><span class="fn-bracket">[</span>7<span class="fn-bracket">]</span></a>, conda <a class="footnote-reference brackets" href="#id49" id="id13" role="doc-noteref"><span class="fn-bracket">[</span>8<span class="fn-bracket">]</span></a>, uv <a class="footnote-reference brackets" href="#id50" id="id14" role="doc-noteref"><span class="fn-bracket">[</span>9<span class="fn-bracket">]</span></a>, or any similar tool.
Inside an environment, commands of the form
<code class="docutils literal notranslate"><span class="pre">sudo</span> <span class="pre">apt</span> <span class="pre">install</span> <span class="pre">python3-numpy</span> <span class="pre">python3-scipy</span></code>
can be rewritten as <code class="docutils literal notranslate"><span class="pre">python3</span> <span class="pre">-m</span> <span class="pre">pip</span> <span class="pre">install</span> <span class="pre">numpy</span> <span class="pre">scipy</span></code>,
and thus do not require root privileges.
Whenever this documentation refers to <code class="file docutils literal notranslate"><span class="pre">requirements.txt</span></code>,
it is the one located in the top-level directory of the project.</p>
<p>Depending on your needs, you may choose to install all ESPResSo
dependencies inside the environment, or only the subset of
dependencies not already satisfied by your workstation or cluster.
For the exact syntax to create and configure an environment,
please refer to the tool documentation.</p>
</dd>
<dt id="term-Cython">Cython<a class="headerlink" href="#term-Cython" title="Link to this term">¶</a></dt><dd><p>Cython is used for connecting the C++ core to Python.</p>
<p>Python environment tools may allow you to install a Python executable
that is more recent than the system-wide Python executable.
Be aware this might lead to compatibility issues if Cython
accidentally picks up the system-wide <code class="file docutils literal notranslate"><span class="pre">Python.h</span></code> header file.
In that scenario, you will have to manually adapt the C++ compiler
include paths to find the correct <code class="file docutils literal notranslate"><span class="pre">Python.h</span></code> header file.</p>
</dd>
</dl>
<section id="installing-requirements-on-ubuntu">
<span id="id15"></span><h3><span class="section-number">2.2.1. </span>Installing requirements on Ubuntu<a class="headerlink" href="#installing-requirements-on-ubuntu" title="Link to this heading">¶</a></h3>
<p>To compile ESPResSo on Ubuntu 24.04 LTS, install the following build dependencies:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sudo<span class="w"> </span>apt<span class="w"> </span>install<span class="w"> </span>build-essential<span class="w"> </span>cmake<span class="w"> </span>cmake-curses-gui<span class="w"> </span>python3-dev<span class="w"> </span>openmpi-bin<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>libboost-all-dev<span class="w"> </span>libfftw3-dev<span class="w"> </span>libfftw3-mpi-dev<span class="w"> </span>libhdf5-dev<span class="w"> </span>libhdf5-openmpi-dev<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>python3-pip<span class="w"> </span>libgsl-dev<span class="w"> </span>freeglut3-dev
</pre></div>
</div>
<p>To run ESPResSo, install the following Python dependencies:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>python3<span class="w"> </span>-m<span class="w"> </span>venv<span class="w"> </span>espresso_env<span class="w"> </span><span class="c1"># here other virtual environment tools are also ok</span>
.<span class="w"> </span>espresso_env/bin/activate
python3<span class="w"> </span>-m<span class="w"> </span>pip<span class="w"> </span>install<span class="w"> </span>-c<span class="w"> </span>requirements.txt<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>cmake<span class="w"> </span>cython<span class="w"> </span>numpy<span class="w"> </span>scipy<span class="w"> </span>packaging<span class="w"> </span>setuptools<span class="w"> </span>h5py
</pre></div>
</div>
<p>These are the only hard requirements. In the following subsections,
only optional dependencies will be discussed. Unless you need extra features,
you can jump directly to the next section <a class="reference internal" href="#quick-installation"><span class="std std-ref">Quick installation</span></a>.</p>
<section id="nvidia-gpu-acceleration">
<span id="id16"></span><h4><span class="section-number">2.2.1.1. </span>Nvidia GPU acceleration<a class="headerlink" href="#nvidia-gpu-acceleration" title="Link to this heading">¶</a></h4>
<p>If your computer has an Nvidia graphics card and you would like to leverage
ESPResSo’s GPU algorithms, you should also download and install the CUDA SDK:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sudo<span class="w"> </span>apt<span class="w"> </span>install<span class="w"> </span>nvidia-cuda-toolkit
</pre></div>
</div>
<p>If you cannot install this package, for example because you are maintaining
multiple CUDA versions, you will need to configure the binary and library
paths before building the project, for example via environment variables:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">export</span><span class="w"> </span><span class="nv">CUDA_TOOLKIT_ROOT_DIR</span><span class="o">=</span><span class="s2">&quot;/usr/local/cuda-12.0&quot;</span>
<span class="nb">export</span><span class="w"> </span><span class="nv">PATH</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">CUDA_TOOLKIT_ROOT_DIR</span><span class="si">}</span><span class="s2">/bin</span><span class="si">${</span><span class="nv">PATH</span><span class="p">:+:</span><span class="nv">$PATH</span><span class="si">}</span><span class="s2">&quot;</span>
<span class="nb">export</span><span class="w"> </span><span class="nv">LD_LIBRARY_PATH</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">CUDA_TOOLKIT_ROOT_DIR</span><span class="si">}</span><span class="s2">/lib64</span><span class="si">${</span><span class="nv">LD_LIBRARY_PATH</span><span class="p">:+:</span><span class="nv">$LD_LIBRARY_PATH</span><span class="si">}</span><span class="s2">&quot;</span>
</pre></div>
</div>
<p>Later in the installation instructions, you will see CMake commands of the form
<code class="docutils literal notranslate"><span class="pre">cmake</span> <span class="pre">..</span></code> with optional arguments, such as <code class="docutils literal notranslate"><span class="pre">cmake</span> <span class="pre">..</span> <span class="pre">-D</span> <span class="pre">ESPRESSO_BUILD_WITH_CUDA=ON</span></code>
to activate CUDA. These commands may need to be adapted depending on which
operating system and CUDA version you are using.</p>
<p>You can control the list of CUDA architectures to generate device code for.
For example, <code class="docutils literal notranslate"><span class="pre">CUDAARCHS=&quot;75;86&quot;</span> <span class="pre">cmake</span> <span class="pre">..</span> <span class="pre">-D</span> <span class="pre">ESPRESSO_BUILD_WITH_CUDA=ON</span></code>
will generate device code for both sm_75 and sm_86 architectures.
The CMake option <code class="docutils literal notranslate"><span class="pre">ESPRESSO_CMAKE_CUDA_ARCHITECTURES</span></code> achieves the same effect.
Both take a semicolon-separated list of integers. There are online resources
to help determine which architecture match specific hardware <a class="footnote-reference brackets" href="#id53" id="id17" role="doc-noteref"><span class="fn-bracket">[</span>12<span class="fn-bracket">]</span></a>.
The CMake option <code class="docutils literal notranslate"><span class="pre">CMAKE_CUDA_ARCHITECTURES</span></code> cannot be used to set CUDA
architectures, because it has a default value that is too old for the
minimally required CUDA version.</p>
<p>On Ubuntu 24.04, the default GCC compiler may be too recent for nvcc.
You can either use GCC 12:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nv">CC</span><span class="o">=</span>gcc-12<span class="w"> </span><span class="nv">CXX</span><span class="o">=</span>g++-12<span class="w"> </span><span class="nv">CUDACXX</span><span class="o">=</span>/usr/local/cuda-12.0/bin/nvcc<span class="w"> </span>cmake<span class="w"> </span>..<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-D<span class="w"> </span><span class="nv">ESPRESSO_BUILD_WITH_CUDA</span><span class="o">=</span>ON<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-D<span class="w"> </span><span class="nv">CUDAToolkit_ROOT</span><span class="o">=</span>/usr/local/cuda-12.0<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-D<span class="w"> </span><span class="nv">CMAKE_CUDA_FLAGS</span><span class="o">=</span><span class="s2">&quot;--compiler-bindir=/usr/bin/g++-12&quot;</span>
</pre></div>
</div>
<p>or alternatively install Clang 19 as a replacement for nvcc and GCC:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nv">CC</span><span class="o">=</span>clang-19<span class="w"> </span><span class="nv">CXX</span><span class="o">=</span>clang++-19<span class="w"> </span><span class="nv">CUDACXX</span><span class="o">=</span>clang++-19<span class="w"> </span>cmake<span class="w"> </span>..<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-D<span class="w"> </span><span class="nv">ESPRESSO_BUILD_WITH_CUDA</span><span class="o">=</span>ON<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-D<span class="w"> </span><span class="nv">CUDAToolkit_ROOT</span><span class="o">=</span>/usr/local/cuda-12.0<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-D<span class="w"> </span><span class="nv">CMAKE_CXX_FLAGS</span><span class="o">=</span><span class="s2">&quot;-I/usr/include/x86_64-linux-gnu/c++/12 -I/usr/include/c++/12 --cuda-path=/usr/local/cuda-12.0&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-D<span class="w"> </span><span class="nv">CMAKE_CUDA_FLAGS</span><span class="o">=</span><span class="s2">&quot;-I/usr/include/x86_64-linux-gnu/c++/12 -I/usr/include/c++/12 --cuda-path=/usr/local/cuda-12.0&quot;</span>
</pre></div>
</div>
<p>Please note that all CMake options and compiler flags that involve
<code class="docutils literal notranslate"><span class="pre">/usr/local/cuda-*</span></code> need to be adapted to your CUDA environment.
But they are only necessary on systems with multiple CUDA releases installed,
and can be safely removed if you have only one CUDA release installed.</p>
<p>Please also note that with Clang, you still need the GCC 12 toolchain,
which can be set up with <code class="docutils literal notranslate"><span class="pre">apt</span> <span class="pre">install</span> <span class="pre">gcc-12</span> <span class="pre">g++-12</span> <span class="pre">libstdc++-12-dev</span></code>.
The extra compiler flags in the Clang CMake command above are needed to pin
the search paths of Clang. By default, it searches trough the most recent
GCC version, which is GCC 13 on Ubuntu 24.04. It is not possible to install
the NVIDIA driver without GCC 13 due to a dependency resolution issue
(<code class="docutils literal notranslate"><span class="pre">nvidia-dkms</span></code> depends on <code class="docutils literal notranslate"><span class="pre">dkms</span></code> which depends on <code class="docutils literal notranslate"><span class="pre">gcc-13</span></code>).</p>
</section>
<section id="setting-up-a-jupyter-environment">
<span id="id18"></span><h4><span class="section-number">2.2.1.2. </span>Setting up a Jupyter environment<a class="headerlink" href="#setting-up-a-jupyter-environment" title="Link to this heading">¶</a></h4>
<p>To run the samples and tutorials, start by installing the following packages:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sudo<span class="w"> </span>apt<span class="w"> </span>install<span class="w"> </span>ffmpeg
python3<span class="w"> </span>-m<span class="w"> </span>pip<span class="w"> </span>install<span class="w"> </span>-c<span class="w"> </span>requirements.txt<span class="w"> </span>matplotlib<span class="w"> </span>pint<span class="w"> </span>tqdm
</pre></div>
</div>
<p>The tutorials are written in the
<a class="reference external" href="https://nbformat.readthedocs.io/en/latest/">Notebook Format</a>
<span id="id19">[<a class="reference internal" href="bibliography.html#id67" title="Thomas Kluyver, Benjamin Ragan-Kelley, Fernando Pérez, Brian E Granger, Matthias Bussonnier, Jonathan Frederic, Kyle Kelley, Jessica B Hamrick, Jason Grout, Sylvain Corlay, Paul Ivanov, Damián Avila, Safia Abdalla, Carol Willing, and Jupyter Development Team. Jupyter Notebooks—a publishing format for reproducible computational workflows. In Fernando Loizides and Birgit Schmidt, editors, Positioning and Power in Academic Publishing: Players, Agents and Agendas, 87–90. IOS Press, 2016. doi:10.3233/978-1-61499-649-1-87.">Kluyver <em>et al.</em>, 2016</a>]</span> version 4.5 and can be executed by any of these tools:</p>
<ul class="simple">
<li><p><a class="reference external" href="https://jupyterlab.readthedocs.io/en/stable/">JupyterLab</a></p></li>
<li><p><a class="reference external" href="https://github.com/microsoft/vscode-jupyter">VS Code Jupyter</a></p></li>
<li><p><a class="reference external" href="https://jupyter-notebook.readthedocs.io/en/stable/notebook.html">Jupyter Notebook</a></p></li>
</ul>
<p>To check whether one of them is installed, run these commands:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>jupyter<span class="w"> </span>lab<span class="w"> </span>--version
jupyter<span class="w"> </span>notebook<span class="w"> </span>--version
code<span class="w"> </span>--version
</pre></div>
</div>
<p>If you don’t have any of these tools installed and aren’t sure which one
to use, we recommend installing JupyterLab:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>python3<span class="w"> </span>-m<span class="w"> </span>pip<span class="w"> </span>install<span class="w"> </span>-c<span class="w"> </span>requirements.txt<span class="w"> </span><span class="se">\</span>
<span class="w">    </span><span class="s2">&quot;jupyterlab&gt;=4.3&quot;</span><span class="w"> </span>nbformat<span class="w"> </span>nbconvert<span class="w"> </span><span class="s2">&quot;lxml[html_clean]&quot;</span><span class="w"> </span>jupyter_console
</pre></div>
</div>
<p>If you prefer the look and feel of Jupyter Classic, install the following extra package:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>python3<span class="w"> </span>-m<span class="w"> </span>pip<span class="w"> </span>install<span class="w"> </span>-c<span class="w"> </span>requirements.txt<span class="w"> </span>nbclassic
</pre></div>
</div>
<p>Alternatively, to use VS Code Jupyter, install the following extensions:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>code<span class="w"> </span>--install-extension<span class="w"> </span>ms-python.python
code<span class="w"> </span>--install-extension<span class="w"> </span>ms-toolsai.jupyter
code<span class="w"> </span>--install-extension<span class="w"> </span>ms-toolsai.jupyter-keymap
code<span class="w"> </span>--install-extension<span class="w"> </span>ms-toolsai.jupyter-renderers
</pre></div>
</div>
</section>
<section id="requirements-for-visualizers">
<span id="id20"></span><h4><span class="section-number">2.2.1.3. </span>Requirements for visualizers<a class="headerlink" href="#requirements-for-visualizers" title="Link to this heading">¶</a></h4>
<p>To install the OpenGL visualizer:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>python3<span class="w"> </span>-m<span class="w"> </span>pip<span class="w"> </span>install<span class="w"> </span>-c<span class="w"> </span>requirements.txt<span class="w"> </span>PyOpenGL
</pre></div>
</div>
<p>To install the ZnDraw visualizer:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>python3<span class="w"> </span>-m<span class="w"> </span>pip<span class="w"> </span>install<span class="w"> </span>-c<span class="w"> </span>requirements.txt<span class="w"> </span><span class="s1">&#39;zndraw==0.4.6&#39;</span>
</pre></div>
</div>
</section>
<section id="requirements-for-building-the-documentation">
<span id="id21"></span><h4><span class="section-number">2.2.1.4. </span>Requirements for building the documentation<a class="headerlink" href="#requirements-for-building-the-documentation" title="Link to this heading">¶</a></h4>
<p>To generate the Sphinx documentation, install the following packages:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>python3<span class="w"> </span>-m<span class="w"> </span>pip<span class="w"> </span>install<span class="w"> </span>-c<span class="w"> </span>requirements.txt<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>sphinx<span class="w"> </span>sphinxcontrib-bibtex<span class="w"> </span>sphinx-toggleprompt
</pre></div>
</div>
<p>To generate the Doxygen documentation, install the following packages:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sudo<span class="w"> </span>apt<span class="w"> </span>install<span class="w"> </span>doxygen<span class="w"> </span>graphviz
</pre></div>
</div>
</section>
</section>
<section id="installing-requirements-on-other-linux-distributions">
<span id="id22"></span><h3><span class="section-number">2.2.2. </span>Installing requirements on other Linux distributions<a class="headerlink" href="#installing-requirements-on-other-linux-distributions" title="Link to this heading">¶</a></h3>
<p>Please refer to the following Dockerfiles to find the minimum set of packages
required to compile ESPResSo on other Linux distributions:</p>
<ul class="simple">
<li><p><a class="reference external" href="https://github.com/espressomd/docker/blob/main/docker/Dockerfile-fedora">Fedora</a></p></li>
<li><p><a class="reference external" href="https://github.com/espressomd/docker/blob/main/docker/Dockerfile-debian">Debian</a></p></li>
</ul>
</section>
<section id="installing-requirements-on-windows-via-wsl">
<span id="id23"></span><h3><span class="section-number">2.2.3. </span>Installing requirements on Windows via WSL<a class="headerlink" href="#installing-requirements-on-windows-via-wsl" title="Link to this heading">¶</a></h3>
<p>To run ESPResSo on Windows, use the Linux subsystem (WSL). For that you need to</p>
<ul class="simple">
<li><p>follow <a class="reference external" href="https://learn.microsoft.com/en-us/windows/wsl/install">these instructions</a> to install Ubuntu</p></li>
<li><p>start Ubuntu (or open an Ubuntu tab in <a class="reference external" href="https://apps.microsoft.com/detail/9n0dx20hk701?hl=en-us&amp;gl=US">Windows Terminal</a>)</p></li>
<li><p>execute <code class="docutils literal notranslate"><span class="pre">sudo</span> <span class="pre">apt</span> <span class="pre">update</span></code> to prepare the installation of dependencies</p></li>
<li><p>optional step: If you have a NVIDIA graphics card available and want to make
use of ESPResSo’s GPU acceleration, follow <a class="reference external" href="https://docs.nvidia.com/cuda/wsl-user-guide/index.html">these instructions</a>
to set up CUDA.</p></li>
<li><p>follow the instructions for <a class="reference internal" href="#installing-requirements-on-ubuntu"><span class="std std-ref">Installing requirements on Ubuntu</span></a></p></li>
</ul>
</section>
<section id="installing-requirements-on-macos">
<span id="id24"></span><h3><span class="section-number">2.2.4. </span>Installing requirements on macOS<a class="headerlink" href="#installing-requirements-on-macos" title="Link to this heading">¶</a></h3>
<p>The first step is to install a C++ compiler, such as Xcode <a class="footnote-reference brackets" href="#id51" id="id25" role="doc-noteref"><span class="fn-bracket">[</span>10<span class="fn-bracket">]</span></a>.
Xcode is missing OpenMP, which is needed to enable shared-memory parallelization,
but the “R for macOS Developers” project provides binaries <a class="footnote-reference brackets" href="#id52" id="id26" role="doc-noteref"><span class="fn-bracket">[</span>11<span class="fn-bracket">]</span></a>.</p>
<p>To install libraries, a package manager will be needed.
While our instructions below are specific to Homebrew,
they should be fairly easy to adapt for other package managers.
If Homebrew isn’t available, it can be installed with
<a class="reference external" href="https://docs.brew.sh/Installation">these instructions</a>,
but bear in mind that it might conflict with other installed managers,
such as MacPorts.</p>
<p>If Homebrew is already installed, resolve any problems reported by the command:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>brew<span class="w"> </span>doctor
</pre></div>
</div>
<p>Install the following libraries:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>brew<span class="w"> </span>install<span class="w"> </span>boost<span class="w"> </span>boost-mpi<span class="w"> </span>fftw<span class="w"> </span>gsl<span class="w"> </span>freeglut<span class="w"> </span>hdf5-mpi
</pre></div>
</div>
<p>For the last step, we will use the uv utility
(<a class="reference external" href="https://docs.astral.sh/uv/getting-started/installation/">installation instructions</a>)
to install the Python interpreter and all required Python packages
in a virtual environment:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>uv<span class="w"> </span>venv<span class="w"> </span>--python<span class="w"> </span><span class="m">3</span>.13
.<span class="w"> </span>.venv/bin/activate
uv<span class="w"> </span>pip<span class="w"> </span>install<span class="w"> </span>-c<span class="w"> </span>requirements.txt<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>cmake<span class="w"> </span>cython<span class="w"> </span>numpy<span class="w"> </span>scipy<span class="w"> </span>matplotlib<span class="w"> </span>tqdm<span class="w"> </span>packaging<span class="w"> </span>setuptools<span class="w"> </span>h5py<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>PyOpenGL<span class="w"> </span><span class="s2">&quot;jupyterlab&gt;=4.3&quot;</span><span class="w"> </span>nbformat<span class="w"> </span>nbconvert<span class="w"> </span><span class="s2">&quot;lxml[html_clean]&quot;</span>
</pre></div>
</div>
</section>
</section>
<section id="quick-installation">
<span id="id27"></span><h2><span class="section-number">2.3. </span>Quick installation<a class="headerlink" href="#quick-installation" title="Link to this heading">¶</a></h2>
<p>If you have installed the requirements (see section <a class="reference internal" href="#requirements"><span class="std std-ref">Requirements</span></a>) in
standard locations, compiling ESPResSo is usually only a matter of creating a build
directory and calling <code class="docutils literal notranslate"><span class="pre">cmake</span></code> and <code class="docutils literal notranslate"><span class="pre">make</span></code> in it. See for example the command
lines below (optional steps which modify the build process are commented out):</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>mkdir<span class="w"> </span>build
<span class="nb">cd</span><span class="w"> </span>build
cmake<span class="w"> </span>..
<span class="c1">#ccmake . // in order to add/remove features like ScaFaCoS or CUDA</span>
make<span class="w"> </span>-j<span class="k">$(</span>nproc<span class="k">)</span>
</pre></div>
</div>
<p>This will build ESPResSo with a default feature set, namely
<code class="file docutils literal notranslate"><span class="pre">src/config/myconfig-default.hpp</span></code>. This file is a C++ header file,
which defines the features that should be compiled in.
You may want to adjust the feature set to your needs. This can be easily
done by copying the <code class="file docutils literal notranslate"><span class="pre">myconfig-sample.hpp</span></code> which has been created in
the <code class="file docutils literal notranslate"><span class="pre">build</span></code> directory to <code class="file docutils literal notranslate"><span class="pre">myconfig.hpp</span></code> and only uncomment
the features you want to use in your simulation.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">cmake</span></code> command looks for libraries and tools needed by ESPResSo.
The application can only be built if CMake reports no errors.</p>
<p>The command <code class="docutils literal notranslate"><span class="pre">make</span></code> will compile the source code. Depending on the
options passed to the program, <code class="docutils literal notranslate"><span class="pre">make</span></code> can also be used for a number of
other things:</p>
<ul class="simple">
<li><p>It can install and uninstall the program to some other directories.
However, normally it is not necessary to actually <em>install</em> to run
it: <code class="docutils literal notranslate"><span class="pre">make</span> <span class="pre">install</span></code></p></li>
<li><p>It can invoke code checks: <code class="docutils literal notranslate"><span class="pre">make</span> <span class="pre">check</span></code></p></li>
<li><p>It can build this documentation: <code class="docutils literal notranslate"><span class="pre">make</span> <span class="pre">sphinx</span></code></p></li>
</ul>
<p>When these steps have successfully completed, ESPResSo can be started with the
command:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>./pypresso<span class="w"> </span>script.py
</pre></div>
</div>
<p>where <code class="docutils literal notranslate"><span class="pre">script.py</span></code> is a Python script which has to be written by the user.
You can find some examples in the <code class="file docutils literal notranslate"><span class="pre">samples</span></code> folder of the source code
directory. If you want to run in parallel, you should have compiled with an
MPI library, and need to tell MPI to run in parallel.
The actual invocation is implementation-dependent, but in many cases, such as
<em>Open MPI</em> and <em>MPICH</em>, you can use</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>mpirun<span class="w"> </span>-n<span class="w"> </span><span class="m">4</span><span class="w"> </span>./pypresso<span class="w"> </span>script.py
</pre></div>
</div>
<p>where <code class="docutils literal notranslate"><span class="pre">4</span></code> is the number of processors to be used.</p>
</section>
<section id="features">
<span id="id28"></span><h2><span class="section-number">2.4. </span>Features<a class="headerlink" href="#features" title="Link to this heading">¶</a></h2>
<p>This chapter describes the features that can be activated in ESPResSo. Even if
possible, it is not recommended to activate all features, because this
will negatively affect ESPResSo’s performance.</p>
<p>Most features can be activated in the configuration header <code class="file docutils literal notranslate"><span class="pre">myconfig.hpp</span></code>
(see section <a class="reference internal" href="#myconfig-hpp-activating-and-deactivating-features"><span class="std std-ref">myconfig.hpp: Activating and deactivating features</span></a>).
To activate <code class="docutils literal notranslate"><span class="pre">FEATURE</span></code>, add the following line to the header file:</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="cp">#define FEATURE</span>
</pre></div>
</div>
<p>Some features cannot be manually enabled; they are instead automatically
enabled when a specific list of dependent features are enabled. For example,
<code class="docutils literal notranslate"><span class="pre">DIPOLAR_DIRECT_SUM</span></code> is automatically enabled when <code class="docutils literal notranslate"><span class="pre">DIPOLES</span></code>, <code class="docutils literal notranslate"><span class="pre">ROTATION</span></code>
and <code class="docutils literal notranslate"><span class="pre">CUDA</span></code> are enabled. Please note that <code class="docutils literal notranslate"><span class="pre">CUDA</span></code> is an external feature
and can only be enabled via a CMake option (see <a class="reference internal" href="#external-features"><span class="std std-ref">External features</span></a>).</p>
<section id="general-features">
<span id="id29"></span><h3><span class="section-number">2.4.1. </span>General features<a class="headerlink" href="#general-features" title="Link to this heading">¶</a></h3>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">ELECTROSTATICS</span></code> This enables the use of the various electrostatics algorithms, such as P3M.</p>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference internal" href="electrostatics.html#electrostatics"><span class="std std-ref">Electrostatics</span></a></p>
</div>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">MMM1D_MACHINE_PREC</span></code>: This enables high-precision Bessel functions
for MMM1D on CPU. Comes with a 60% slow-down penalty. The low-precision
functions are enabled by default and are precise enough for most applications.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">DIPOLES</span></code> This activates the dipole-moment property of particles and switches
on various magnetostatics algorithms</p>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference internal" href="magnetostatics.html#magnetostatics"><span class="std std-ref">Magnetostatics</span></a></p>
</div>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">SCAFACOS_DIPOLES</span></code> This activates magnetostatics methods of ScaFaCoS.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">DIPOLAR_DIRECT_SUM</span></code> This activates the GPU implementation of the dipolar direct sum.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">DIPOLE_FIELD_TRACKING</span></code> This enables the CPU implementation of the dipolar direct sum
to calculate the total dipole field at particle positions.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ROTATION</span></code> Switch on rotational degrees of freedom for the particles, as well as
the corresponding quaternion integrator.</p>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference internal" href="particles.html#setting-up-particles"><span class="std std-ref">Setting up particles</span></a></p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>When this feature is activated, every particle has three
additional degrees of freedom, which for example means that the
kinetic energy changes at constant temperature is twice as large.</p>
</div>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">THERMOSTAT_PER_PARTICLE</span></code> Allows setting a per-particle friction
coefficient for the Langevin and Brownian thermostats.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ROTATIONAL_INERTIA</span></code> Allows particles to have individual rotational inertia matrix eigenvalues.
When not built in, all eigenvalues are unity in simulation units.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">EXTERNAL_FORCES</span></code> Allows to define an arbitrary constant force for each particle
individually. Also allows to fix individual coordinates of particles,
keep them at a fixed position or within a plane.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">MASS</span></code> Allows particles to have individual masses.
When not built in, all masses are unity in simulation units.</p>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference internal" href="espressomd.html#espressomd.particle_data.ParticleHandle.mass" title="espressomd.particle_data.ParticleHandle.mass"><code class="xref py py-attr docutils literal notranslate"><span class="pre">espressomd.particle_data.ParticleHandle.mass</span></code></a></p>
</div>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">EXCLUSIONS</span></code> Allows particle pairs to be excluded from non-bonded interaction calculations.</p>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference internal" href="espressomd.html#espressomd.particle_data.ParticleHandle.add_exclusion" title="espressomd.particle_data.ParticleHandle.add_exclusion"><code class="xref py py-meth docutils literal notranslate"><span class="pre">espressomd.particle_data.ParticleHandle.add_exclusion()</span></code></a></p>
</div>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">BOND_CONSTRAINT</span></code> Turns on the RATTLE integrator which allows for fixed lengths bonds
between particles.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">VIRTUAL_SITES</span></code> Allows the creation of pseudo-particles whose forces,
torques, and orientations can be transferred to real particles.
They don’t have mass, and their position is generally
fixed in the simulation box or fixed to other particles.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">VIRTUAL_SITES_INERTIALESS_TRACERS</span></code> Allows to use virtual sites as tracers by advecting them with a LB fluid</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">VIRTUAL_SITES_RELATIVE</span></code> Virtual sites are particles, the position and velocity of which is
not obtained by integrating equations of motion. Rather, they are
placed using the position (and orientation) of other particles. The
feature allows for rigid arrangements of particles.</p>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference internal" href="particles.html#virtual-sites"><span class="std std-ref">Virtual sites</span></a></p>
</div>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">COLLISION_DETECTION</span></code> Allows particles to be bound on collision.</p></li>
</ul>
<p>In addition, there are switches that enable additional features in the
integrator or thermostat:</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">NPT</span></code> Enables the NpT integration scheme.</p>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference internal" href="integration.html#isotropic-npt-thermostat"><span class="std std-ref">Isotropic NpT thermostat</span></a></p>
</div>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">ENGINE</span></code> Activates swimming parameters for active particles (self-propelled particles)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">PARTICLE_ANISOTROPY</span></code> Allows the use of non-isotropic friction coefficients in thermostats.</p></li>
</ul>
</section>
<section id="fluid-dynamics-and-fluid-structure-interaction">
<span id="id30"></span><h3><span class="section-number">2.4.2. </span>Fluid dynamics and fluid structure interaction<a class="headerlink" href="#fluid-dynamics-and-fluid-structure-interaction" title="Link to this heading">¶</a></h3>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">DPD</span></code> Enables the dissipative particle dynamics thermostat and interaction.</p>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference internal" href="inter_non-bonded.html#dpd-interaction"><span class="std std-ref">DPD interaction</span></a></p>
</div>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">LB_ELECTROHYDRODYNAMICS</span></code> Enables the implicit calculation of electro-hydrodynamics for charged
particles and salt ions in an electric field.</p></li>
</ul>
</section>
<section id="interaction-features">
<span id="id31"></span><h3><span class="section-number">2.4.3. </span>Interaction features<a class="headerlink" href="#interaction-features" title="Link to this heading">¶</a></h3>
<p>The following switches turn on various short ranged interactions (see
section <a class="reference internal" href="inter_non-bonded.html#isotropic-non-bonded-interactions"><span class="std std-ref">Isotropic non-bonded interactions</span></a>):</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">TABULATED</span></code> Enable support for user-defined non-bonded interaction potentials.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">LENNARD_JONES</span></code> Enable the Lennard-Jones potential.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">LENNARD_JONES_GENERIC</span></code> Enable the generic Lennard-Jones potential with configurable
exponents and individual prefactors for the two terms.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">LJCOS</span></code> Enable the Lennard-Jones potential with a cosine-tail.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">LJCOS2</span></code> Same as <code class="docutils literal notranslate"><span class="pre">LJCOS</span></code>, but using a slightly different way of smoothing the
connection to 0.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">WCA</span></code> Enable the Weeks–Chandler–Andersen potential.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">GAY_BERNE</span></code> Enable the Gay–Berne potential.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">HERTZIAN</span></code> Enable the Hertzian potential.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">MORSE</span></code> Enable the Morse potential.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">BUCKINGHAM</span></code> Enable the Buckingham potential.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">SOFT_SPHERE</span></code> Enable the soft sphere potential.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">SMOOTH_STEP</span></code> Enable the smooth step potential, a step potential with
two length scales.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">BMHTF_NACL</span></code> Enable the Born–Meyer–Huggins–Tosi–Fumi potential,
which can be used to model salt melts.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">GAUSSIAN</span></code> Enable the Gaussian potential.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">HAT</span></code> Enable the Hat potential.</p></li>
</ul>
<p>Some of the short-range interactions have additional features:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">LJGEN_SOFTCORE</span></code> This modifies the generic Lennard-Jones potential
(<code class="docutils literal notranslate"><span class="pre">LENNARD_JONES_GENERIC</span></code>) with tunable parameters.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">THOLE</span></code> See <a class="reference internal" href="inter_non-bonded.html#thole-correction"><span class="std std-ref">Thole correction</span></a></p></li>
</ul>
</section>
<section id="debug-messages">
<span id="id32"></span><h3><span class="section-number">2.4.4. </span>Debug messages<a class="headerlink" href="#debug-messages" title="Link to this heading">¶</a></h3>
<p>Finally, there is a flag for debugging:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">ADDITIONAL_CHECKS</span></code> Enables numerous additional checks which can detect
inconsistencies especially in the cell systems. These checks are however
too slow to be enabled in production runs.</p></li>
</ul>
</section>
<section id="external-features">
<span id="id33"></span><h3><span class="section-number">2.4.5. </span>External features<a class="headerlink" href="#external-features" title="Link to this heading">¶</a></h3>
<p>External features cannot be added to the <code class="file docutils literal notranslate"><span class="pre">myconfig.hpp</span></code> file by the user.
They are added by CMake if the corresponding dependency was found on the
system. Some of these external features are optional and must be activated
using a CMake flag (see <a class="reference internal" href="#options-and-variables"><span class="std std-ref">Options and Variables</span></a>).</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">CUDA</span></code>: enable offloading to Nvidia GPUs for features that support it
(see <a class="reference internal" href="running.html#cuda-acceleration"><span class="std std-ref">CUDA acceleration</span></a>)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">FFTW</span></code>: enables features relying on the fast Fourier transforms,
such as the P3M method (see <a class="reference internal" href="electrostatics.html#coulomb-p3m"><span class="std std-ref">Coulomb P3M</span></a> and <a class="reference internal" href="magnetostatics.html#dipolar-p3m"><span class="std std-ref">Dipolar P3M</span></a>)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">H5MD</span></code>: enable parallel input/output to hdf5 files with H5MD specification
(see <a class="reference internal" href="io.html#writing-hdf5-files"><span class="std std-ref">Writing hdf5 files</span></a>)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">WALBERLA</span></code>: enable continuum-based solvers: lattice-Boltzmann method,
diffusion-advection-reaction equations solver, and Poisson equation solver
if <code class="docutils literal notranslate"><span class="pre">FFTW</span></code> is enabled (see <a class="reference internal" href="lb.html#lattice-boltzmann"><span class="std std-ref">Lattice-Boltzmann</span></a> and <a class="reference internal" href="ek.html#electrokinetics"><span class="std std-ref">Electrokinetics</span></a>)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">SCAFACOS</span></code>: enables features from the ScaFaCoS library (see
<a class="reference internal" href="electrostatics.html#scafacos-electrostatics"><span class="std std-ref">ScaFaCoS electrostatics</span></a>, <a class="reference internal" href="magnetostatics.html#scafacos-magnetostatics"><span class="std std-ref">ScaFaCoS magnetostatics</span></a>).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">GSL</span></code>: enables features relying on the GNU Scientific Library, e.g.
<a class="reference internal" href="espressomd.html#espressomd.cluster_analysis.Cluster.fractal_dimension" title="espressomd.cluster_analysis.Cluster.fractal_dimension"><code class="xref py py-meth docutils literal notranslate"><span class="pre">espressomd.cluster_analysis.Cluster.fractal_dimension()</span></code></a>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">STOKESIAN_DYNAMICS</span></code>: enable the Stokesian Dynamics propagator
(see <a class="reference internal" href="integration.html#stokesian-dynamics"><span class="std std-ref">Stokesian Dynamics</span></a>). Requires BLAS and LAPACK.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">SHARED_MEMORY_PARALLELISM</span></code>: enable shared-memory parallelism
(OpenMP, Kokkos, Cabana)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">CALIPER</span></code>, <code class="docutils literal notranslate"><span class="pre">VALGRIND</span></code>, <code class="docutils literal notranslate"><span class="pre">FPE</span></code>: enable various instrumentation tools
(see <a class="reference internal" href="running.html#instrumentation"><span class="std std-ref">Instrumentation</span></a>)</p></li>
</ul>
</section>
</section>
<section id="configuring">
<span id="id34"></span><h2><span class="section-number">2.5. </span>Configuring<a class="headerlink" href="#configuring" title="Link to this heading">¶</a></h2>
<section id="myconfig-hpp-activating-and-deactivating-features">
<span id="id35"></span><h3><span class="section-number">2.5.1. </span><code class="file docutils literal notranslate"><span class="pre">myconfig.hpp</span></code>: Activating and deactivating features<a class="headerlink" href="#myconfig-hpp-activating-and-deactivating-features" title="Link to this heading">¶</a></h3>
<p>ESPResSo has a large number of features that can be compiled into the binary.
However, it is not recommended to actually compile in all possible
features, as this will slow down ESPResSo significantly. Instead, compile in only
the features that are actually required. A strong gain in speed can be
achieved by disabling all non-bonded interactions except for a single
one, e.g. <code class="docutils literal notranslate"><span class="pre">LENNARD_JONES</span></code>. For developers, it is also possible to turn on or off a
number of debugging messages. The features and debug messages can be
controlled via a configuration header file that contains C-preprocessor
declarations. Subsection <a class="reference internal" href="#features"><span class="std std-ref">Features</span></a> describes all available features. If a
file named <code class="file docutils literal notranslate"><span class="pre">myconfig.hpp</span></code> is present in the build directory when <code class="docutils literal notranslate"><span class="pre">cmake</span></code>
is run, all features defined in it will be compiled in. If no such file exists,
the configuration file <code class="file docutils literal notranslate"><span class="pre">src/config/myconfig-default.hpp</span></code> will be used
instead, which turns on the default features.</p>
<p>When you distinguish between the build and the source directory, the
configuration header can be put in either of these. Note, however, that
when a configuration header is found in both directories, the one in the
build directory will be used.</p>
<p>By default, the configuration header is called <code class="file docutils literal notranslate"><span class="pre">myconfig.hpp</span></code>.
The configuration header can be used to compile different binary
versions of with a different set of features from the same source
directory. Suppose that you have a source directory <code class="file docutils literal notranslate"><span class="pre">$srcdir</span></code> and two
build directories <code class="file docutils literal notranslate"><span class="pre">$builddir1</span></code> and <code class="file docutils literal notranslate"><span class="pre">$builddir2</span></code> that contain
different configuration headers:</p>
<ul>
<li><p><code class="file docutils literal notranslate"><span class="pre">$builddir1/myconfig.hpp</span></code>:</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="cp">#define ELECTROSTATICS</span>
<span class="cp">#define LENNARD_JONES</span>
</pre></div>
</div>
</li>
<li><p><code class="file docutils literal notranslate"><span class="pre">$builddir2/myconfig.hpp</span></code>:</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="cp">#define LJCOS</span>
</pre></div>
</div>
</li>
</ul>
<p>Then you can simply compile two different versions of ESPResSo via:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span><span class="w"> </span><span class="nv">$builddir1</span>
cmake<span class="w"> </span>..
make

<span class="nb">cd</span><span class="w"> </span><span class="nv">$builddir2</span>
cmake<span class="w"> </span>..
make
</pre></div>
</div>
<p>To see what features were activated in <code class="file docutils literal notranslate"><span class="pre">myconfig.hpp</span></code>, run:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>./pypresso
</pre></div>
</div>
<p>and then in the Python interpreter:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">espressomd</span>
<span class="nb">print</span><span class="p">(</span><span class="n">espressomd</span><span class="o">.</span><span class="n">features</span><span class="p">())</span>
</pre></div>
</div>
</section>
<section id="cmake">
<span id="id36"></span><h3><span class="section-number">2.5.2. </span><code class="docutils literal notranslate"><span class="pre">cmake</span></code><a class="headerlink" href="#cmake" title="Link to this heading">¶</a></h3>
<p>In order to build the first step is to create a build directory in which
cmake can be executed. In cmake, the <em>source directory</em> (that contains
all the source files) is completely separated from the <em>build directory</em>
(where the files created by the build process are put). <code class="docutils literal notranslate"><span class="pre">cmake</span></code> is
designed to <em>not</em> be executed in the source directory. <code class="docutils literal notranslate"><span class="pre">cmake</span></code> will
determine how to use and where to find the compiler, as well as the
different libraries and tools required by the compilation process. By
having multiple build directories you can build several variants of ESPResSo,
each variant having different activated features, and for as many
platforms as you want.</p>
<p>Once you’ve run <code class="docutils literal notranslate"><span class="pre">ccmake</span></code>, you can list the configured variables with
<code class="docutils literal notranslate"><span class="pre">cmake</span> <span class="pre">-LAH</span> <span class="pre">-N</span> <span class="pre">.</span> <span class="pre">|</span> <span class="pre">less</span></code> (uses a pager) or with <code class="docutils literal notranslate"><span class="pre">ccmake</span> <span class="pre">..</span></code> and pressing
key <code class="docutils literal notranslate"><span class="pre">t</span></code> to toggle the advanced mode on (uses the <code class="docutils literal notranslate"><span class="pre">curses</span></code> interface).</p>
<p><strong>Example:</strong></p>
<p>When the source directory is <code class="file docutils literal notranslate"><span class="pre">srcdir</span></code> (the files where unpacked to this
directory), then the user can create a build directory <code class="file docutils literal notranslate"><span class="pre">build</span></code> below that
path by calling <code class="docutils literal notranslate"><span class="pre">mkdir</span> <span class="pre">srcdir/build</span></code>. In the build directory <code class="docutils literal notranslate"><span class="pre">cmake</span></code> is to be
executed, followed by a call to <code class="docutils literal notranslate"><span class="pre">make</span></code>. None of the files in the source directory
are ever modified by the build process.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span><span class="w"> </span>build
cmake<span class="w"> </span>..
make<span class="w"> </span>-j<span class="k">$(</span>nproc<span class="k">)</span>
</pre></div>
</div>
<p>Afterwards ESPResSo can be run by calling <code class="docutils literal notranslate"><span class="pre">./pypresso</span></code> from the command line.</p>
</section>
<section id="ccmake">
<span id="id37"></span><h3><span class="section-number">2.5.3. </span><code class="docutils literal notranslate"><span class="pre">ccmake</span></code><a class="headerlink" href="#ccmake" title="Link to this heading">¶</a></h3>
<p>Optionally and for easier use, the curses interface to cmake can be used
to configure ESPResSo interactively.</p>
<p><strong>Example:</strong></p>
<p>Alternatively to the previous example, instead of cmake, the ccmake executable
is called in the build directory to configure ESPResSo, followed by a call to make:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span><span class="w"> </span>build
ccmake<span class="w"> </span>..
make
</pre></div>
</div>
<p>Fig. <a class="reference internal" href="#ccmake-figure"><span class="std std-ref">ccmake interface</span></a> shows the interactive ccmake UI.</p>
<figure class="align-center" id="id54">
<span id="ccmake-figure"></span><a class="reference internal image-reference" href="_images/ccmake-example.png"><img alt="ccmake interface" src="_images/ccmake-example.png" style="width: 70.0%;" /></a>
<figcaption>
<p><span class="caption-text">ccmake interface</span><a class="headerlink" href="#id54" title="Link to this image">¶</a></p>
</figcaption>
</figure>
</section>
<section id="options-and-variables">
<span id="id38"></span><h3><span class="section-number">2.5.4. </span>Options and Variables<a class="headerlink" href="#options-and-variables" title="Link to this heading">¶</a></h3>
<p>The behavior of ESPResSo can be controlled by means of options and variables
in the <code class="file docutils literal notranslate"><span class="pre">CMakeLists.txt</span></code> file. Most options are boolean values
(<code class="docutils literal notranslate"><span class="pre">ON</span></code> or <code class="docutils literal notranslate"><span class="pre">OFF</span></code>). A few options are strings or semicolon-delimited lists.</p>
<p>The following options control features from external libraries:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">ESPRESSO_BUILD_WITH_CUDA</span></code>: Build with GPU support.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ESPRESSO_BUILD_WITH_HDF5</span></code>: Build with HDF5 support.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ESPRESSO_BUILD_WITH_FFTW</span></code>: Build with FFTW support.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ESPRESSO_BUILD_WITH_SCAFACOS</span></code>: Build with ScaFaCoS support.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ESPRESSO_BUILD_WITH_GSL</span></code>: Build with GSL support.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ESPRESSO_BUILD_WITH_STOKESIAN_DYNAMICS</span></code> Build with Stokesian Dynamics support.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ESPRESSO_BUILD_WITH_SHARED_MEMORY_PARALLELISM</span></code>: Build with shared-memory parallelism support (OpenMP, Cabana, Kokkos, etc.)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ESPRESSO_BUILD_WITH_WALBERLA</span></code>: Build with waLBerla support.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ESPRESSO_BUILD_WITH_WALBERLA_AVX</span></code>: Build waLBerla with AVX kernels instead of regular kernels.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ESPRESSO_BUILD_WITH_PYTHON</span></code>: Build with the Python interface.</p></li>
</ul>
<p>The following options control code instrumentation:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">ESPRESSO_BUILD_WITH_VALGRIND</span></code>: Build with Valgrind instrumentation</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ESPRESSO_BUILD_WITH_CALIPER</span></code>: Build with Caliper instrumentation</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ESPRESSO_BUILD_WITH_MSAN</span></code>: Compile C++ code with memory sanitizer</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ESPRESSO_BUILD_WITH_ASAN</span></code>: Compile C++ code with address sanitizer</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ESPRESSO_BUILD_WITH_UBSAN</span></code>: Compile C++ code with undefined behavior sanitizer</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ESPRESSO_BUILD_WITH_COVERAGE</span></code>: Generate C++ code coverage reports when running ESPResSo</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ESPRESSO_BUILD_WITH_COVERAGE_PYTHON</span></code>: Generate Python code coverage reports when running ESPResSo</p></li>
</ul>
<p>The following options control how the project is built and tested:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">ESPRESSO_BUILD_WITH_CLANG_TIDY</span></code>: Run Clang-Tidy during compilation.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ESPRESSO_BUILD_WITH_CPPCHECK</span></code>: Run Cppcheck during compilation.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ESPRESSO_BUILD_WITH_CCACHE</span></code>: Enable compiler cache for faster rebuilds.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ESPRESSO_BUILD_TESTS</span></code>: Enable C++ and Python tests.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ESPRESSO_BUILD_BENCHMARKS</span></code>: Enable benchmarks.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ESPRESSO_CTEST_ARGS</span></code> (string): Arguments passed to the <code class="docutils literal notranslate"><span class="pre">ctest</span></code> command (semicolon-separated list).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ESPRESSO_TEST_TIMEOUT</span></code>: Test timeout.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ESPRESSO_ADD_OMPI_SINGLETON_WARNING</span></code>: Add a runtime warning in the
pypresso and ipypresso scripts that is triggered in singleton mode
with Open MPI version 4.x on unsupported NUMA environments
(see <a class="reference internal" href="#term-MPI"><span class="xref std std-term">MPI installation requirements</span></a> for details).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ESPRESSO_MYCONFIG_NAME</span></code> (string): Filename of the user-provided config file</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">MPIEXEC_PREFLAGS</span></code>, <code class="docutils literal notranslate"><span class="pre">MPIEXEC_POSTFLAGS</span></code> (strings): Flags passed to the
<code class="docutils literal notranslate"><span class="pre">mpiexec</span></code> command in MPI-parallel tests and benchmarks.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">CMAKE_BUILD_TYPE</span></code> (string): Build type. Default is <code class="docutils literal notranslate"><span class="pre">Release</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">CMAKE_CXX_FLAGS</span></code> (string): Flags passed to the C++ compiler.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">CMAKE_CUDA_FLAGS</span></code> (string): Flags passed to the CUDA compiler.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">CMAKE_CUDA_ARCHITECTURES</span></code> (list): Semicolon-separated list of architectures to generate device code for.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">CUDAToolkit_ROOT</span></code> (string): Path to the CUDA toolkit directory.</p></li>
</ul>
<p>Most of these options are opt-in, meaning their default value is set to
<code class="docutils literal notranslate"><span class="pre">OFF</span></code> in the <code class="file docutils literal notranslate"><span class="pre">CMakeLists.txt</span></code> file. These options can be modified
by calling <code class="docutils literal notranslate"><span class="pre">cmake</span></code> with the command line argument <code class="docutils literal notranslate"><span class="pre">-D</span></code>:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>cmake<span class="w"> </span>-D<span class="w"> </span><span class="nv">ESPRESSO_BUILD_WITH_HDF5</span><span class="o">=</span>OFF<span class="w"> </span>..
</pre></div>
</div>
<p>When an option is enabled, additional options may become available.
For example with <code class="docutils literal notranslate"><span class="pre">-D</span> <span class="pre">ESPRESSO_BUILD_TESTS=ON</span></code>, one can specify
the CTest parameters with <code class="docutils literal notranslate"><span class="pre">-D</span> <span class="pre">ESPRESSO_CTEST_ARGS=-j$(nproc)</span></code>.</p>
<p>Environment variables can be passed to CMake. For example, to select the Clang
compiler and specify which GPU architectures to generate device code for, use
<code class="docutils literal notranslate"><span class="pre">CC=clang</span> <span class="pre">CXX=clang++</span> <span class="pre">CUDACXX=clang++</span> <span class="pre">CUDAARCHS=&quot;61;75&quot;</span> <span class="pre">cmake</span> <span class="pre">..</span> <span class="pre">-D</span> <span class="pre">ESPRESSO_BUILD_WITH_CUDA=ON</span></code>.
When multiple versions of the CUDA library are available, the correct one can be
selected with <code class="docutils literal notranslate"><span class="pre">CUDA_BIN_PATH=/usr/local/cuda-12.0</span> <span class="pre">cmake</span> <span class="pre">..</span> <span class="pre">-D</span> <span class="pre">ESPRESSO_BUILD_WITH_CUDA=ON</span></code>
(with Clang as the CUDA compiler, it is also necessary to override its default
CUDA path with <code class="docutils literal notranslate"><span class="pre">-D</span> <span class="pre">CMAKE_CUDA_FLAGS=--cuda-path=/usr/local/cuda-12.0</span></code>).</p>
<section id="build-types-and-compiler-flags">
<span id="id39"></span><h4><span class="section-number">2.5.4.1. </span>Build types and compiler flags<a class="headerlink" href="#build-types-and-compiler-flags" title="Link to this heading">¶</a></h4>
<p>The build type is controlled by <code class="docutils literal notranslate"><span class="pre">-D</span> <span class="pre">CMAKE_BUILD_TYPE=&lt;type&gt;</span></code> where
<code class="docutils literal notranslate"><span class="pre">&lt;type&gt;</span></code> can take one of the following values:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">Release</span></code>: for production use: disables assertions and debug information,
enables <code class="docutils literal notranslate"><span class="pre">-O3</span></code> optimization (this is the default)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">RelWithAssert</span></code>: for debugging purposes: enables assertions and
<code class="docutils literal notranslate"><span class="pre">-O3</span></code> optimization (use this to track the source of a fatal error)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Debug</span></code>: for debugging in GDB</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Coverage</span></code>: for code coverage</p></li>
</ul>
<p>Cluster users and HPC developers may be interested in manually editing the
<code class="docutils literal notranslate"><span class="pre">espresso_cpp_flags</span></code> target in the top-level <code class="docutils literal notranslate"><span class="pre">CMakeLists.txt</span></code> file for
finer control over compiler flags. The variable declaration is followed
by a series of conditionals to enable or disable compiler-specific flags.
Compiler flags passed to CMake via the <code class="docutils literal notranslate"><span class="pre">-D</span> <span class="pre">CMAKE_CXX_FLAGS</span></code> option
(such as <code class="docutils literal notranslate"><span class="pre">cmake</span> <span class="pre">.</span> <span class="pre">-D</span> <span class="pre">CMAKE_CXX_FLAGS=&quot;-ffast-math</span> <span class="pre">-fno-finite-math-only&quot;</span></code>)
will appear in the compiler command before the flags in <code class="docutils literal notranslate"><span class="pre">espresso_cpp_flags</span></code>,
and will therefore have lower precedence.</p>
<p>Be aware that fast-math mode can break ESPResSo. It is incompatible with the
<code class="docutils literal notranslate"><span class="pre">ADDITIONAL_CHECKS</span></code> feature due to the loss of precision in the LB code
on CPU. The Clang 10 compiler breaks field couplings with <code class="docutils literal notranslate"><span class="pre">-ffast-math</span></code>.
The Intel compiler enables the <code class="docutils literal notranslate"><span class="pre">-fp-model</span> <span class="pre">fast=1</span></code> flag by default;
it can be disabled by adding the <code class="docutils literal notranslate"><span class="pre">-fp-model=strict</span></code> flag.</p>
<p>ESPResSo currently doesn’t fully support link-time optimization (LTO).</p>
</section>
</section>
<section id="configuring-without-a-network-connection">
<span id="id40"></span><h3><span class="section-number">2.5.5. </span>Configuring without a network connection<a class="headerlink" href="#configuring-without-a-network-connection" title="Link to this heading">¶</a></h3>
<p>Several <a class="reference internal" href="#external-features"><span class="std std-ref">external features</span></a> in ESPResSo rely on
external libraries that are downloaded automatically by CMake. When a
network connection cannot be established due to firewall restrictions,
the CMake logic needs editing.</p>
<p>External libraries are downloaded and included into the CMake project using
<a class="reference external" href="https://cmake.org/cmake/help/latest/module/FetchContent.html">FetchContent</a>.
The repository URLs can be found in the <code class="docutils literal notranslate"><span class="pre">GIT_REPOSITORY</span></code> field of the
corresponding <code class="docutils literal notranslate"><span class="pre">FetchContent_Declare()</span></code> commands. The <code class="docutils literal notranslate"><span class="pre">GIT_TAG</span></code> field
provides the commit. Clone these repositories locally and edit the ESPResSo
build system such that <code class="docutils literal notranslate"><span class="pre">GIT_REPOSITORY</span></code> points to the absolute path of
the clone. You can automate this text substitution by adapting the following command:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sed<span class="w"> </span>-ri<span class="w"> </span><span class="s1">&#39;s|GIT_REPOSITORY +.+/([^/]+).git|GIT_REPOSITORY /work/username/\1|&#39;</span><span class="w"> </span>CMakeLists.txt
</pre></div>
</div>
</section>
</section>
<section id="compiling-testing-and-installing">
<h2><span class="section-number">2.6. </span>Compiling, testing and installing<a class="headerlink" href="#compiling-testing-and-installing" title="Link to this heading">¶</a></h2>
<p>The command <code class="docutils literal notranslate"><span class="pre">make</span></code> is mainly used to compile the source code, but it
can do a number of other things. The generic syntax of the <code class="docutils literal notranslate"><span class="pre">make</span></code>
command is:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>make<span class="w"> </span><span class="o">[</span>options<span class="o">]</span><span class="w"> </span><span class="o">[</span>target<span class="o">]</span><span class="w"> </span><span class="o">[</span><span class="nv">variable</span><span class="o">=</span>value<span class="o">]</span>
</pre></div>
</div>
<p>When no target is given, the target <code class="docutils literal notranslate"><span class="pre">all</span></code> is used. The following
targets are available:</p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">all</span></code></dt><dd><p>Compiles the complete source code.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">check</span></code></dt><dd><p>Runs the full testsuite. More fine-grained testsuites are available,
such as <code class="docutils literal notranslate"><span class="pre">check_unit_tests</span></code> and <code class="docutils literal notranslate"><span class="pre">check_python_skip_long</span></code>.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">test</span></code></dt><dd><p>Do not use this target, it is a broken feature
(see <a class="reference external" href="https://github.com/espressomd/espresso/issues/4370">issue #4370</a>).
Use <code class="docutils literal notranslate"><span class="pre">make</span> <span class="pre">check</span></code> instead.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">clean</span></code></dt><dd><p>Deletes all files that were created during the compilation.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">install</span></code></dt><dd><p>Install ESPResSo in the path specified by the CMake variable
<code class="docutils literal notranslate"><span class="pre">CMAKE_INSTALL_PREFIX</span></code>. The path can be changed by calling CMake
with <code class="docutils literal notranslate"><span class="pre">cmake</span> <span class="pre">..</span> <span class="pre">-D</span> <span class="pre">CMAKE_INSTALL_PREFIX=/path/to/espresso</span></code>. Do not use
<code class="docutils literal notranslate"><span class="pre">make</span> <span class="pre">DESTDIR=/path/to/espresso</span> <span class="pre">install</span></code> to install to a specific path,
this will cause issues with the runtime path (RPATH) and will conflict
with the CMake variable <code class="docutils literal notranslate"><span class="pre">CMAKE_INSTALL_PREFIX</span></code> if it has been set.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">doxygen</span></code></dt><dd><p>Creates the Doxygen code documentation in the <code class="file docutils literal notranslate"><span class="pre">doc/doxygen</span></code>
subdirectory.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">sphinx</span></code></dt><dd><p>Creates the <code class="docutils literal notranslate"><span class="pre">sphinx</span></code> code documentation in the <code class="file docutils literal notranslate"><span class="pre">doc/sphinx</span></code>
subdirectory.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">tutorials</span></code></dt><dd><p>Creates the tutorials in the <code class="file docutils literal notranslate"><span class="pre">doc/tutorials</span></code> subdirectory.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">doc</span></code></dt><dd><p>Creates all documentation in the <code class="file docutils literal notranslate"><span class="pre">doc</span></code> subdirectory (only when
using the development sources).</p>
</dd>
</dl>
<p>A number of options are available when calling <code class="docutils literal notranslate"><span class="pre">make</span></code>. The most
interesting option is probably <code class="docutils literal notranslate"><span class="pre">-j</span> <span class="pre">num_jobs</span></code>, which can be used for
parallel compilation. <code class="docutils literal notranslate"><span class="pre">num_jobs</span></code> specifies the maximal number of
concurrent jobs that will be run. Setting <code class="docutils literal notranslate"><span class="pre">num_jobs</span></code> to the number
of available processors speeds up the compilation process significantly.</p>
</section>
<section id="troubleshooting">
<span id="id41"></span><h2><span class="section-number">2.7. </span>Troubleshooting<a class="headerlink" href="#troubleshooting" title="Link to this heading">¶</a></h2>
<p>If you encounter issues when building ESPResSo or running it for the first time,
please have a look at the <a class="reference external" href="https://github.com/espressomd/espresso/wiki/Installation-FAQ">Installation FAQ</a>
on the wiki. If you still didn’t find an answer, try the debugging tools
documented in <a class="reference internal" href="running.html#debugging"><span class="std std-ref">Debugging</span></a>. If this still didn’t help, see <a class="reference internal" href="community.html#community-support"><span class="std std-ref">Community support</span></a>.</p>
<hr class="docutils" />
<aside class="footnote-list brackets">
<aside class="footnote brackets" id="id42" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id2">1</a><span class="fn-bracket">]</span></span>
<p><a class="reference external" href="https://espressomd.org">https://espressomd.org</a></p>
</aside>
<aside class="footnote brackets" id="id43" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id3">2</a><span class="fn-bracket">]</span></span>
<p><a class="reference external" href="https://git-scm.com/">https://git-scm.com/</a></p>
</aside>
<aside class="footnote brackets" id="id44" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id4">3</a><span class="fn-bracket">]</span></span>
<p><a class="reference external" href="https://github.com/espressomd/espresso">https://github.com/espressomd/espresso</a></p>
</aside>
<aside class="footnote brackets" id="id45" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id6">4</a><span class="fn-bracket">]</span></span>
<p><a class="reference external" href="https://cmake.org/">https://cmake.org/</a></p>
</aside>
<aside class="footnote brackets" id="id46" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id7">5</a><span class="fn-bracket">]</span></span>
<p><a class="reference external" href="https://www.fftw.org/">https://www.fftw.org/</a></p>
</aside>
<aside class="footnote brackets" id="id47" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id9">6</a><span class="fn-bracket">]</span></span>
<p><a class="reference external" href="https://docs.nvidia.com/cuda/">https://docs.nvidia.com/cuda/</a></p>
</aside>
<aside class="footnote brackets" id="id48" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id12">7</a><span class="fn-bracket">]</span></span>
<p><a class="reference external" href="https://docs.python.org/3/library/venv.html">https://docs.python.org/3/library/venv.html</a></p>
</aside>
<aside class="footnote brackets" id="id49" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id13">8</a><span class="fn-bracket">]</span></span>
<p><a class="reference external" href="https://conda.io/projects/conda/en/latest/user-guide/tasks/manage-environments.html">https://conda.io/projects/conda/en/latest/user-guide/tasks/manage-environments.html</a></p>
</aside>
<aside class="footnote brackets" id="id50" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id14">9</a><span class="fn-bracket">]</span></span>
<p><a class="reference external" href="https://docs.astral.sh/uv/">https://docs.astral.sh/uv/</a></p>
</aside>
<aside class="footnote brackets" id="id51" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id25">10</a><span class="fn-bracket">]</span></span>
<p><a class="reference external" href="https://developer.apple.com/xcode/">https://developer.apple.com/xcode/</a></p>
</aside>
<aside class="footnote brackets" id="id52" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id26">11</a><span class="fn-bracket">]</span></span>
<p><a class="reference external" href="https://mac.r-project.org/openmp/">https://mac.r-project.org/openmp/</a></p>
</aside>
<aside class="footnote brackets" id="id53" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id17">12</a><span class="fn-bracket">]</span></span>
<p><a class="reference external" href="https://arnon.dk/matching-sm-architectures-arch-and-gencode-for-various-nvidia-cards/">https://arnon.dk/matching-sm-architectures-arch-and-gencode-for-various-nvidia-cards/</a></p>
</aside>
</aside>
</section>
</section>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <div>
    <h3><a href="index.html">Table of Contents</a></h3>
    <ul>
<li><a class="reference internal" href="#">2. Installation</a><ul>
<li><a class="reference internal" href="#quickstart">2.1. Quickstart</a></li>
<li><a class="reference internal" href="#requirements">2.2. Requirements</a><ul>
<li><a class="reference internal" href="#installing-requirements-on-ubuntu">2.2.1. Installing requirements on Ubuntu</a></li>
<li><a class="reference internal" href="#installing-requirements-on-other-linux-distributions">2.2.2. Installing requirements on other Linux distributions</a></li>
<li><a class="reference internal" href="#installing-requirements-on-windows-via-wsl">2.2.3. Installing requirements on Windows via WSL</a></li>
<li><a class="reference internal" href="#installing-requirements-on-macos">2.2.4. Installing requirements on macOS</a></li>
</ul>
</li>
<li><a class="reference internal" href="#quick-installation">2.3. Quick installation</a></li>
<li><a class="reference internal" href="#features">2.4. Features</a><ul>
<li><a class="reference internal" href="#general-features">2.4.1. General features</a></li>
<li><a class="reference internal" href="#fluid-dynamics-and-fluid-structure-interaction">2.4.2. Fluid dynamics and fluid structure interaction</a></li>
<li><a class="reference internal" href="#interaction-features">2.4.3. Interaction features</a></li>
<li><a class="reference internal" href="#debug-messages">2.4.4. Debug messages</a></li>
<li><a class="reference internal" href="#external-features">2.4.5. External features</a></li>
</ul>
</li>
<li><a class="reference internal" href="#configuring">2.5. Configuring</a><ul>
<li><a class="reference internal" href="#myconfig-hpp-activating-and-deactivating-features">2.5.1. <code class="file docutils literal notranslate"><span class="pre">myconfig.hpp</span></code>: Activating and deactivating features</a></li>
<li><a class="reference internal" href="#cmake">2.5.2. <code class="docutils literal notranslate"><span class="pre">cmake</span></code></a></li>
<li><a class="reference internal" href="#ccmake">2.5.3. <code class="docutils literal notranslate"><span class="pre">ccmake</span></code></a></li>
<li><a class="reference internal" href="#options-and-variables">2.5.4. Options and Variables</a></li>
<li><a class="reference internal" href="#configuring-without-a-network-connection">2.5.5. Configuring without a network connection</a></li>
</ul>
</li>
<li><a class="reference internal" href="#compiling-testing-and-installing">2.6. Compiling, testing and installing</a></li>
<li><a class="reference internal" href="#troubleshooting">2.7. Troubleshooting</a></li>
</ul>
</li>
</ul>

  </div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2018-2023, The ESPResSo project.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 7.2.6</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
    </div>

    

    
  </body>
</html>