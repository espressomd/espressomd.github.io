<!DOCTYPE html>

<html lang="en" data-content_root="./">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>5. Setting up particles &#8212; ESPResSo 5.0.0 documentation</title>
    <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="_static/alabaster.css?v=97504538" />
    <link rel="stylesheet" type="text/css" href="_static/blockquotes.css?v=270de11a" />
    <link rel="stylesheet" type="text/css" href="_static/custom.css?v=539bf778" />
    <script src="_static/documentation_options.js?v=ce74c6a2"></script>
    <script src="_static/doctools.js?v=888ff710"></script>
    <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="_static/toggleprompt.js?v=5801b3bb"></script>
    <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="6. Integrators and thermostats" href="integration.html" />
    <link rel="prev" title="4. Setting up the system" href="system_setup.html" />
   
  <link rel="stylesheet" href="_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="setting-up-particles">
<span id="id1"></span><h1><span class="section-number">5. </span>Setting up particles<a class="headerlink" href="#setting-up-particles" title="Link to this heading">¶</a></h1>
<section id="overview-of-the-relevant-python-classes">
<span id="id2"></span><h2><span class="section-number">5.1. </span>Overview of the relevant Python classes<a class="headerlink" href="#overview-of-the-relevant-python-classes" title="Link to this heading">¶</a></h2>
<p>For understanding this chapter, it is helpful to be aware of the Python classes provided by ESPResSo to interact with particles:</p>
<ul class="simple">
<li><p><a class="reference internal" href="espressomd.html#espressomd.particle_data.ParticleHandle" title="espressomd.particle_data.ParticleHandle"><code class="xref py py-class docutils literal notranslate"><span class="pre">ParticleHandle</span></code></a> provides access to a single particle in the simulation.</p></li>
<li><p><a class="reference internal" href="espressomd.html#espressomd.particle_data.ParticleList" title="espressomd.particle_data.ParticleList"><code class="xref py py-class docutils literal notranslate"><span class="pre">ParticleList</span></code></a> provides access to all particles in the simulation</p></li>
<li><p><a class="reference internal" href="espressomd.html#espressomd.particle_data.ParticleSlice" title="espressomd.particle_data.ParticleSlice"><code class="xref py py-class docutils literal notranslate"><span class="pre">ParticleSlice</span></code></a> provides access to a subset of particles in the simulation identified by a list of ids or an instance of <code class="xref py py-class docutils literal notranslate"><span class="pre">slice</span></code> or <code class="xref py py-class docutils literal notranslate"><span class="pre">range</span></code>.</p></li>
</ul>
<p>In almost no case have these classes to be instantiated explicitly by the user.
Rather, access is provided via the system <a class="reference internal" href="espressomd.html#espressomd.system.System.part" title="espressomd.system.System.part"><code class="xref py py-attr docutils literal notranslate"><span class="pre">part</span></code></a> attribute.
The details are explained in the following sections.</p>
</section>
<section id="adding-particles">
<span id="id3"></span><h2><span class="section-number">5.2. </span>Adding particles<a class="headerlink" href="#adding-particles" title="Link to this heading">¶</a></h2>
<p>In order to add particles to the system, call
<a class="reference internal" href="espressomd.html#espressomd.particle_data.ParticleList.add" title="espressomd.particle_data.ParticleList.add"><code class="xref py py-meth docutils literal notranslate"><span class="pre">ParticleList.add()</span></code></a>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">espressomd</span>
<span class="n">system</span> <span class="o">=</span> <span class="n">espressomd</span><span class="o">.</span><span class="n">System</span><span class="p">(</span><span class="n">box_l</span><span class="o">=</span><span class="p">[</span><span class="mf">10.</span><span class="p">,</span> <span class="mf">10.</span><span class="p">,</span> <span class="mf">10.</span><span class="p">])</span>
<span class="n">p</span> <span class="o">=</span> <span class="n">system</span><span class="o">.</span><span class="n">part</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">pos</span><span class="o">=</span><span class="p">[</span><span class="mf">1.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">],</span> <span class="nb">type</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</pre></div>
</div>
<p>This command adds a single particle to the system with properties given
as arguments, and it returns an instance of
<a class="reference internal" href="espressomd.html#espressomd.particle_data.ParticleHandle" title="espressomd.particle_data.ParticleHandle"><code class="xref py py-class docutils literal notranslate"><span class="pre">ParticleHandle</span></code></a>, which will be used to access
properties of the newly created particle. The <code class="docutils literal notranslate"><span class="pre">pos</span></code> property is required, all
other properties are optional.
All available particle properties are members of <a class="reference internal" href="espressomd.html#espressomd.particle_data.ParticleHandle" title="espressomd.particle_data.ParticleHandle"><code class="xref py py-class docutils literal notranslate"><span class="pre">ParticleHandle</span></code></a>.</p>
<p>Note that the instances of <a class="reference internal" href="espressomd.html#espressomd.particle_data.ParticleHandle" title="espressomd.particle_data.ParticleHandle"><code class="xref py py-class docutils literal notranslate"><span class="pre">ParticleHandle</span></code></a> returned by
<a class="reference internal" href="espressomd.html#espressomd.particle_data.ParticleList.add" title="espressomd.particle_data.ParticleList.add"><code class="xref py py-meth docutils literal notranslate"><span class="pre">ParticleList.add()</span></code></a> are handles for the live particles in the
simulation, rather than offline copies. Changing their properties will affect the simulation.</p>
<p>It is also possible to add several particles at once:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="n">new_parts</span> <span class="o">=</span> <span class="n">system</span><span class="o">.</span><span class="n">part</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">pos</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">((</span><span class="mi">10</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span> <span class="o">*</span> <span class="n">box_length</span><span class="p">)</span>
</pre></div>
</div>
<p>If several particles are added at once, an instance of
<a class="reference internal" href="espressomd.html#espressomd.particle_data.ParticleSlice" title="espressomd.particle_data.ParticleSlice"><code class="xref py py-class docutils literal notranslate"><span class="pre">ParticleSlice</span></code></a> is returned.</p>
<p>Particles are identified via their <code class="docutils literal notranslate"><span class="pre">id</span></code> property. A unique id is given to them
automatically. Alternatively, you can assign an id manually when adding them to the system:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">system</span><span class="o">.</span><span class="n">part</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">pos</span><span class="o">=</span><span class="p">[</span><span class="mf">1.</span><span class="p">,</span> <span class="mf">2.</span><span class="p">,</span> <span class="mf">3.</span><span class="p">],</span> <span class="nb">id</span><span class="o">=</span><span class="n">system</span><span class="o">.</span><span class="n">part</span><span class="o">.</span><span class="n">highest_particle_id</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
<p>The id provides an alternative way to access particles in the system. To
retrieve the handle of the particle with id <code class="docutils literal notranslate"><span class="pre">5</span></code>, call:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">p</span> <span class="o">=</span> <span class="n">system</span><span class="o">.</span><span class="n">part</span><span class="o">.</span><span class="n">by_id</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="accessing-particle-properties">
<span id="id4"></span><h2><span class="section-number">5.3. </span>Accessing particle properties<a class="headerlink" href="#accessing-particle-properties" title="Link to this heading">¶</a></h2>
<p>Particle properties can be accessed like any class member.</p>
<p>For example, to print the particle’s current position, call:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">pos</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="modifying-particle-properties">
<span id="id5"></span><h2><span class="section-number">5.4. </span>Modifying particle properties<a class="headerlink" href="#modifying-particle-properties" title="Link to this heading">¶</a></h2>
<p>Similarly, the position can be set:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">p</span><span class="o">.</span><span class="n">pos</span> <span class="o">=</span> <span class="p">[</span><span class="mf">1.</span><span class="p">,</span> <span class="mf">2.5</span><span class="p">,</span> <span class="mf">3.</span><span class="p">]</span>
</pre></div>
</div>
<p>Not all properties are writeable. For example, properties that are
automatically derived from other properties are read-only attributes.</p>
<p>Please note that changing a particle property will not affect the ghost
particles until after the next integration loop. This can be an issue for
certain methods like <a class="reference internal" href="espressomd.html#espressomd.system.System.distance" title="espressomd.system.System.distance"><code class="xref py py-meth docutils literal notranslate"><span class="pre">espressomd.system.System.distance()</span></code></a> which use
the old ghost information, while other methods like particle-based analysis
tools and <a class="reference internal" href="espressomd.html#espressomd.cell_system.CellSystem.get_neighbors" title="espressomd.cell_system.CellSystem.get_neighbors"><code class="xref py py-meth docutils literal notranslate"><span class="pre">espressomd.cell_system.CellSystem.get_neighbors()</span></code></a> update the
ghost information before calculating the observable.</p>
<section id="vectorial-properties">
<span id="id6"></span><h3><span class="section-number">5.4.1. </span>Vectorial properties<a class="headerlink" href="#vectorial-properties" title="Link to this heading">¶</a></h3>
<p>For vectorial particle properties, component-wise manipulation like
<code class="docutils literal notranslate"><span class="pre">p.pos[0]</span> <span class="pre">=</span> <span class="pre">1</span></code> or in-place operators like <code class="docutils literal notranslate"><span class="pre">+=</span></code> or <code class="docutils literal notranslate"><span class="pre">*=</span></code>
are not allowed and raise an exception.
This behavior is inherited, so the same applies to <code class="docutils literal notranslate"><span class="pre">pos</span></code> after
<code class="docutils literal notranslate"><span class="pre">pos</span> <span class="pre">=</span> <span class="pre">p.pos</span></code>. If you want to use a vectorial property for further
calculations, you should explicitly make a copy e.g. via
<code class="docutils literal notranslate"><span class="pre">pos</span> <span class="pre">=</span> <span class="pre">numpy.copy(p.pos)</span></code>.</p>
</section>
</section>
<section id="deleting-particles">
<span id="id7"></span><h2><span class="section-number">5.5. </span>Deleting particles<a class="headerlink" href="#deleting-particles" title="Link to this heading">¶</a></h2>
<p>Particles can be easily deleted in Python using particle ids or ranges of particle ids.
For example, to delete all particles of type 1, run:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">system</span><span class="o">.</span><span class="n">part</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">remove</span><span class="p">()</span>
</pre></div>
</div>
<p>To delete all particles, use:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">system</span><span class="o">.</span><span class="n">part</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
</pre></div>
</div>
</section>
<section id="iterating-over-particles-and-pairs-of-particles">
<span id="id8"></span><h2><span class="section-number">5.6. </span>Iterating over particles and pairs of particles<a class="headerlink" href="#iterating-over-particles-and-pairs-of-particles" title="Link to this heading">¶</a></h2>
<p>You can iterate over all particles or over a subset of particles
(see <a class="reference internal" href="#interacting-with-groups-of-particles"><span class="std std-ref">Interacting with groups of particles</span></a>) as follows:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">system</span><span class="o">.</span><span class="n">part</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">pos</span><span class="p">)</span>

<span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">system</span><span class="o">.</span><span class="n">part</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">pos</span><span class="p">)</span>
</pre></div>
</div>
<p>You can iterate over all pairs of particles using:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">pair</span> <span class="ow">in</span> <span class="n">system</span><span class="o">.</span><span class="n">part</span><span class="o">.</span><span class="n">pairs</span><span class="p">():</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">pair</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">pair</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="exclusions">
<span id="id9"></span><h2><span class="section-number">5.7. </span>Exclusions<a class="headerlink" href="#exclusions" title="Link to this heading">¶</a></h2>
<p>Particles can have an exclusion list of all other particles where non-bonded interactions are ignored.
This is typically used in atomistic simulations,
where nearest and next nearest neighbor interactions along a chain of bonded
particles have to be omitted since they are included in the bonding potentials.
Exclusions do not apply to the short range part of electrostatics and magnetostatics methods, e.g. to P3M.</p>
<p>To create exclusions for particles pairs 0 and 1:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">system</span><span class="o">.</span><span class="n">part</span><span class="o">.</span><span class="n">by_id</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">add_exclusion</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
<p>To delete the exclusion:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">system</span><span class="o">.</span><span class="n">part</span><span class="o">.</span><span class="n">by_id</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">delete_exclusion</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
<p>The current list of exclusions is accessible in the
<a class="reference internal" href="espressomd.html#espressomd.particle_data.ParticleHandle.exclusions" title="espressomd.particle_data.ParticleHandle.exclusions"><code class="xref py py-attr docutils literal notranslate"><span class="pre">exclusions</span></code></a> property.</p>
</section>
<section id="rotational-degrees-of-freedom-and-particle-anisotropy">
<span id="id10"></span><h2><span class="section-number">5.8. </span>Rotational degrees of freedom and particle anisotropy<a class="headerlink" href="#rotational-degrees-of-freedom-and-particle-anisotropy" title="Link to this heading">¶</a></h2>
<p>When the feature <code class="docutils literal notranslate"><span class="pre">ROTATION</span></code> is compiled in, particles not only have a position,
but also an orientation that changes with an angular velocity.
A torque on a particle leads to a change in angular velocity depending on the
particles rotational inertia.
The property <a class="reference internal" href="espressomd.html#espressomd.particle_data.ParticleHandle.rinertia" title="espressomd.particle_data.ParticleHandle.rinertia"><code class="xref py py-attr docutils literal notranslate"><span class="pre">rinertia</span></code></a> has to
be specified as the three eigenvalues of the particles rotational inertia tensor.
Even if the particle rotational inertia is isotropic, the rotation state can be
important if, e.g., the particle carries a dipole or is an active particle.</p>
<p>The rotational degrees of freedom are integrated using a velocity Verlet scheme.
The implementation is based on a quaternion representation of the particle
orientation and described in <span id="id11">[<a class="reference internal" href="bibliography.html#id94" title="Igor P. Omelyan. On the numerical integration of motion for rigid polyatomics: the modified quaternion approach. Computers in Physics, 12(1):97–103, 1998. doi:10.1063/1.168642.">Omelyan, 1998</a>]</span> with quaternion components
indexing made according to the formalism
<span class="math notranslate nohighlight">\(q = a + b\mathbf{i} + c\mathbf{j} + d\mathbf{k}\)</span> <span id="id12">[<a class="reference internal" href="bibliography.html#id5" title="Michael P. Allen and Dominic J. Tildesley. Computer Simulation of Liquids. Oxford Science Publications. Oxford University Press, Oxford, 2nd edition, 2017. ISBN 978-0-19-880319-5. doi:10.1093/oso/9780198803195.001.0001.">Allen and Tildesley, 2017</a>]</span>.</p>
<p>When the Langevin thermostat is enabled, the rotational degrees of freedom are also thermalized.</p>
<p>Whether or not rotational degrees of freedom are propagated,
is controlled on a per-particle and per-axis level, where the axes
are the Cartesian axes of the particle in its body-fixed frame.
It is important to note that starting from version 4.0 and unlike
in earlier versions of ESPResSo, the particles’ rotation is disabled by default.
In this way, just compiling in the <code class="docutils literal notranslate"><span class="pre">ROTATION</span></code> feature no longer changes the physics of the system.</p>
<p>The rotation of a particle is controlled via the
<a class="reference internal" href="espressomd.html#espressomd.particle_data.ParticleHandle.rotation" title="espressomd.particle_data.ParticleHandle.rotation"><code class="xref py py-attr docutils literal notranslate"><span class="pre">rotation</span></code></a> property.
E.g., the following code adds a particle with rotation enabled around the x-axis of its body frame:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">espressomd</span>
<span class="n">system</span> <span class="o">=</span> <span class="n">espressomd</span><span class="o">.</span><span class="n">System</span><span class="p">(</span><span class="n">box_l</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
<span class="n">system</span><span class="o">.</span><span class="n">part</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">pos</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">rotation</span><span class="o">=</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">False</span><span class="p">))</span>
</pre></div>
</div>
<p>The rotational state of a particle is stored as a quaternion in the
<a class="reference internal" href="espressomd.html#espressomd.particle_data.ParticleHandle.quat" title="espressomd.particle_data.ParticleHandle.quat"><code class="xref py py-attr docutils literal notranslate"><span class="pre">quat</span></code></a> property.
For a value of (1,0,0,0), the body and space frames coincide.
When setting up a particle, its orientation state is by default aligned with the space frame of the box.
If your particles have a rotational symmetry, you can set up the particle direction
(the symmetry axis) using the <a class="reference internal" href="espressomd.html#espressomd.particle_data.ParticleHandle.director" title="espressomd.particle_data.ParticleHandle.director"><code class="xref py py-attr docutils literal notranslate"><span class="pre">director</span></code></a> property.
Note that then you have no control over the initial rotation angle around the symmetry axis.
If your particles are anisotropic in all three directions, you can either set
the <a class="reference internal" href="espressomd.html#espressomd.particle_data.ParticleHandle.quat" title="espressomd.particle_data.ParticleHandle.quat"><code class="xref py py-attr docutils literal notranslate"><span class="pre">quat</span></code></a> attribute directly,
or (recommended) set up all particle properties in the box frame and then use
<a class="reference internal" href="espressomd.html#espressomd.particle_data.ParticleHandle.rotate" title="espressomd.particle_data.ParticleHandle.rotate"><code class="xref py py-attr docutils literal notranslate"><span class="pre">rotate</span></code></a> to rotate the particle
to the desired state before starting the simulation.</p>
<p>Notes:</p>
<ul class="simple">
<li><p>The space-frame direction of the particle’s z-axis in its body frame is accessible
through the <a class="reference internal" href="espressomd.html#espressomd.particle_data.ParticleHandle.director" title="espressomd.particle_data.ParticleHandle.director"><code class="xref py py-attr docutils literal notranslate"><span class="pre">director</span></code></a> property.</p></li>
<li><p>Any other vector can be converted from body to space fixed frame using the
<a class="reference internal" href="espressomd.html#espressomd.particle_data.ParticleHandle.convert_vector_body_to_space" title="espressomd.particle_data.ParticleHandle.convert_vector_body_to_space"><code class="xref py py-meth docutils literal notranslate"><span class="pre">ParticleHandle.convert_vector_body_to_space()</span></code></a> method.</p></li>
<li><p>When <code class="docutils literal notranslate"><span class="pre">DIPOLES</span></code> are compiled in, the particles dipole moment is always
co-aligned with the z-axis in the body-fixed frame.</p></li>
<li><p>Changing the particles dipole moment and director will re-orient the particle
such that its z-axis in space frame is aligned parallel to the given vector.
No guarantees are made for the other two axes after setting the director or the dipole moment.</p></li>
</ul>
<p>The following particle properties are related to rotation:</p>
<ul class="simple">
<li><p><a class="reference internal" href="espressomd.html#espressomd.particle_data.ParticleHandle.dip" title="espressomd.particle_data.ParticleHandle.dip"><code class="xref py py-attr docutils literal notranslate"><span class="pre">dip</span></code></a></p></li>
<li><p><a class="reference internal" href="espressomd.html#espressomd.particle_data.ParticleHandle.director" title="espressomd.particle_data.ParticleHandle.director"><code class="xref py py-attr docutils literal notranslate"><span class="pre">director</span></code></a></p></li>
<li><p><a class="reference internal" href="espressomd.html#espressomd.particle_data.ParticleHandle.ext_torque" title="espressomd.particle_data.ParticleHandle.ext_torque"><code class="xref py py-attr docutils literal notranslate"><span class="pre">ext_torque</span></code></a></p></li>
<li><p><a class="reference internal" href="espressomd.html#espressomd.particle_data.ParticleHandle.gamma_rot" title="espressomd.particle_data.ParticleHandle.gamma_rot"><code class="xref py py-attr docutils literal notranslate"><span class="pre">gamma_rot</span></code></a></p></li>
<li><p><a class="reference internal" href="espressomd.html#espressomd.particle_data.ParticleHandle.omega_body" title="espressomd.particle_data.ParticleHandle.omega_body"><code class="xref py py-attr docutils literal notranslate"><span class="pre">omega_body</span></code></a></p></li>
<li><p><a class="reference internal" href="espressomd.html#espressomd.particle_data.ParticleHandle.omega_lab" title="espressomd.particle_data.ParticleHandle.omega_lab"><code class="xref py py-attr docutils literal notranslate"><span class="pre">omega_lab</span></code></a></p></li>
<li><p><a class="reference internal" href="espressomd.html#espressomd.particle_data.ParticleHandle.quat" title="espressomd.particle_data.ParticleHandle.quat"><code class="xref py py-attr docutils literal notranslate"><span class="pre">quat</span></code></a></p></li>
<li><p><a class="reference internal" href="espressomd.html#espressomd.particle_data.ParticleHandle.rinertia" title="espressomd.particle_data.ParticleHandle.rinertia"><code class="xref py py-attr docutils literal notranslate"><span class="pre">rinertia</span></code></a></p></li>
<li><p><a class="reference internal" href="espressomd.html#espressomd.particle_data.ParticleHandle.rotation" title="espressomd.particle_data.ParticleHandle.rotation"><code class="xref py py-attr docutils literal notranslate"><span class="pre">rotation</span></code></a></p></li>
<li><p><a class="reference internal" href="espressomd.html#espressomd.particle_data.ParticleHandle.torque_lab" title="espressomd.particle_data.ParticleHandle.torque_lab"><code class="xref py py-attr docutils literal notranslate"><span class="pre">torque_lab</span></code></a></p></li>
</ul>
</section>
<section id="virtual-sites">
<span id="id13"></span><h2><span class="section-number">5.9. </span>Virtual sites<a class="headerlink" href="#virtual-sites" title="Link to this heading">¶</a></h2>
<p>Virtual sites are particles, the positions and velocities of which are
not obtained by integrating an equation of motion. Rather, their
coordinates are obtained from the position (and orientation) of one or
more other particles. In this way, rigid arrangements of particles can
be constructed and a particle can be placed in the center of mass of a
set of other particles. Virtual sites can interact with other particles
in the system by means of interactions. Forces are added to them
according to their respective particle type. Before the next integration
step, the forces accumulated on a virtual site are distributed back to
those particles, from which the virtual site was derived.</p>
<p>There are different schemes for virtual sites, described in the following sections.
The scheme acting on a virtual site is dependent on its propagation mode.</p>
<section id="rigid-arrangements-of-particles">
<span id="id14"></span><h3><span class="section-number">5.9.1. </span>Rigid arrangements of particles<a class="headerlink" href="#rigid-arrangements-of-particles" title="Link to this heading">¶</a></h3>
<p>The relative implementation of virtual sites allows for the simulation
of rigid arrangements of particles. It can be used, for extended
dipoles and raspberry-particles, but also for more complex
configurations. Position and velocity of a virtual site are obtained
from the position and orientation of exactly one non-virtual particle,
which has to be placed in the center of mass of the rigid body. Several
virtual sites can be related to one and the same non-virtual particle.
The position of the virtual site is given by</p>
<div class="math notranslate nohighlight">
\[\vec{x_v} =\vec{x_n} +O_n (O_v \vec{E_z}) d,\]</div>
<p>where <span class="math notranslate nohighlight">\(\vec{x_n}\)</span> is the position of the non-virtual particle,
<span class="math notranslate nohighlight">\(O_n\)</span> is the orientation of the non-virtual particle, <span class="math notranslate nohighlight">\(O_v\)</span>
denotes the orientation of the vector <span class="math notranslate nohighlight">\(\vec{x_v}-\vec{x_n}\)</span> with
respect to the non-virtual particles body fixed frame and <span class="math notranslate nohighlight">\(d\)</span> the
distance between virtual and non-virtual particle. In words: The virtual
site is placed at a fixed distance from the non-virtual particle. When
the non-virtual particle rotates, the virtual sites rotates on an orbit
around the non-virtual particles center.</p>
<p>To use this implementation of virtual sites, activate the feature
<code class="docutils literal notranslate"><span class="pre">VIRTUAL_SITES_RELATIVE</span></code>. Furthermore, particles have to be set up with the
propagation modes <a class="reference internal" href="espressomd.html#espressomd.propagation.Propagation.TRANS_VS_RELATIVE" title="espressomd.propagation.Propagation.TRANS_VS_RELATIVE"><code class="xref py py-attr docutils literal notranslate"><span class="pre">TRANS_VS_RELATIVE</span></code></a>
and <a class="reference internal" href="espressomd.html#espressomd.propagation.Propagation.ROT_VS_RELATIVE" title="espressomd.propagation.Propagation.ROT_VS_RELATIVE"><code class="xref py py-attr docutils literal notranslate"><span class="pre">ROT_VS_RELATIVE</span></code></a>.</p>
<ol class="arabic">
<li><p>Place the particle to which the virtual site should be related.
It needs to be in the center of mass of the rigid arrangement of
particles you create:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">espressomd</span>
<span class="n">system</span> <span class="o">=</span> <span class="n">espressomd</span><span class="o">.</span><span class="n">System</span><span class="p">(</span><span class="n">box_l</span><span class="o">=</span><span class="p">[</span><span class="mf">10.</span><span class="p">,</span> <span class="mf">10.</span><span class="p">,</span> <span class="mf">10.</span><span class="p">])</span>
<span class="n">p1</span> <span class="o">=</span> <span class="n">system</span><span class="o">.</span><span class="n">part</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">pos</span><span class="o">=</span><span class="p">[</span><span class="mf">1.</span><span class="p">,</span> <span class="mf">2.</span><span class="p">,</span> <span class="mf">3.</span><span class="p">])</span>
</pre></div>
</div>
</li>
<li><p>Place a particle at the desired relative position, make it virtual
and relate it to the first particle:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">rel_offset</span> <span class="o">=</span> <span class="p">[</span><span class="mf">1.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">]</span>
<span class="n">p2</span> <span class="o">=</span> <span class="n">system</span><span class="o">.</span><span class="n">part</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">pos</span><span class="o">=</span><span class="n">p1</span><span class="o">.</span><span class="n">pos</span> <span class="o">+</span> <span class="n">rel_offset</span><span class="p">)</span>
<span class="n">p2</span><span class="o">.</span><span class="n">vs_auto_relate_to</span><span class="p">(</span><span class="n">p1</span><span class="p">)</span>
</pre></div>
</div>
<p>The <a class="reference internal" href="espressomd.html#espressomd.particle_data.ParticleHandle.is_virtual" title="espressomd.particle_data.ParticleHandle.is_virtual"><code class="xref py py-meth docutils literal notranslate"><span class="pre">is_virtual()</span></code></a>
method of particle <code class="docutils literal notranslate"><span class="pre">p2</span></code> will now return <code class="docutils literal notranslate"><span class="pre">True</span></code>, and its
<a class="reference internal" href="espressomd.html#espressomd.particle_data.ParticleHandle.propagation" title="espressomd.particle_data.ParticleHandle.propagation"><code class="xref py py-attr docutils literal notranslate"><span class="pre">propagation</span></code></a>
attribute will return the correct combination of flags.</p>
</li>
<li><p>Repeat the previous step with more virtual sites, if desired.</p></li>
<li><p>To update the positions of all virtual sites, call:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">system</span><span class="o">.</span><span class="n">integrator</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">recalc_forces</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</li>
</ol>
<p>Please note:</p>
<ul class="simple">
<li><p>The relative position of the virtual site is defined by its distance
from the non-virtual particle, the id of the non-virtual particle and
a quaternion which defines the vector from non-virtual particle to
virtual site in the non-virtual particles body-fixed frame. This
information is saved in the virtual site’s
<a class="reference internal" href="espressomd.html#espressomd.particle_data.ParticleHandle.vs_relative" title="espressomd.particle_data.ParticleHandle.vs_relative"><code class="xref py py-attr docutils literal notranslate"><span class="pre">vs_relative</span></code></a> attribute.
Take care, not to overwrite it after using
<a class="reference internal" href="espressomd.html#espressomd.particle_data.ParticleHandle.vs_auto_relate_to" title="espressomd.particle_data.ParticleHandle.vs_auto_relate_to"><code class="xref py py-meth docutils literal notranslate"><span class="pre">vs_auto_relate_to()</span></code></a>.</p></li>
<li><p>Virtual sites can not be placed relative to other virtual sites, as
the order in which the positions of virtual sites are updated is not
guaranteed. Always relate a virtual site to a non-virtual particle
placed in the center of mass of the rigid arrangement of particles.</p></li>
<li><p>In case you know the correct quaternions, you can also setup a virtual
site using its <a class="reference internal" href="espressomd.html#espressomd.particle_data.ParticleHandle.vs_relative" title="espressomd.particle_data.ParticleHandle.vs_relative"><code class="xref py py-attr docutils literal notranslate"><span class="pre">vs_relative</span></code></a>
and <a class="reference internal" href="espressomd.html#espressomd.particle_data.ParticleHandle.propagation" title="espressomd.particle_data.ParticleHandle.propagation"><code class="xref py py-attr docutils literal notranslate"><span class="pre">propagation</span></code></a> attributes.</p></li>
<li><p>In a simulation on more than one CPU, the effective cell size needs
to be larger than the largest distance between a non-virtual particle
and its associated virtual sites. To this aim, when running on more than one core,
you need to set the system’s <a class="reference internal" href="espressomd.html#espressomd.system.System.min_global_cut" title="espressomd.system.System.min_global_cut"><code class="xref py py-attr docutils literal notranslate"><span class="pre">min_global_cut</span></code></a>
attribute to this largest distance.
An error is generated when this requirement is not met.
Under very specific circumstances it may be desirable to disable this check,
e.g. when using certain setups with the hybrid decomposition scheme.
You can do so by setting the virtual sites property <code class="docutils literal notranslate"><span class="pre">override_cutoff_check</span> <span class="pre">=</span> <span class="pre">True</span></code>.
However, only consider this if you are absolutely sure of what you are doing.</p></li>
<li><p>If the virtual sites represent actual particles carrying a mass, the
inertia tensor of the non-virtual particle in the center of mass
needs to be adapted.</p></li>
<li><p>The presence of rigid bodies constructed by means of virtual sites
adds a contribution to the scalar pressure and pressure tensor.</p></li>
<li><p>The <a class="reference internal" href="espressomd.html#espressomd.particle_data.ParticleHandle.vs_auto_relate_to" title="espressomd.particle_data.ParticleHandle.vs_auto_relate_to"><code class="xref py py-meth docutils literal notranslate"><span class="pre">vs_auto_relate_to()</span></code></a>
has additional keyword arguments for controlling whether the virtual site
should be coupled to a lattice-Boltzmann fluid (<code class="docutils literal notranslate"><span class="pre">couple_to_lb=True</span></code>) or
to the Langevin thermostat (<code class="docutils literal notranslate"><span class="pre">couple_to_langevin=True</span></code>), or both
(in that case LB is used for translation and Langevin for rotation);
this is achieved internally by adding extra propagation flags.</p></li>
</ul>
</section>
<section id="inertialess-lattice-boltzmann-tracers">
<span id="id15"></span><h3><span class="section-number">5.9.2. </span>Inertialess lattice-Boltzmann tracers<a class="headerlink" href="#inertialess-lattice-boltzmann-tracers" title="Link to this heading">¶</a></h3>
<p>Using the propagation mode <a class="reference internal" href="espressomd.html#espressomd.propagation.Propagation.TRANS_LB_TRACER" title="espressomd.propagation.Propagation.TRANS_LB_TRACER"><code class="xref py py-attr docutils literal notranslate"><span class="pre">TRANS_LB_TRACER</span></code></a>,
the virtual sites follow the motion of a LB fluid. This is achieved by integrating
their position using the fluid velocity at the virtual sites’ position.
Forces acting on the virtual sites are directly transferred as a force density
onto the lattice-Boltzmann fluid, making the coupling free of inertia.
Please note that the velocity attribute of the virtual particles
does not carry valid information for this virtual sites scheme.
The feature stems from the implementation of the
<a class="reference internal" href="advanced_methods.html#immersed-boundary-method-for-soft-elastic-objects"><span class="std std-ref">Immersed Boundary Method for soft elastic objects</span></a>, but can be used independently.</p>
<p>In the following example, a particle is advected by a fluid flowing along the x-axis:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">espressomd</span>
<span class="kn">import</span> <span class="nn">espressomd.lb</span>
<span class="kn">import</span> <span class="nn">espressomd.propagation</span>
<span class="n">Propagation</span> <span class="o">=</span> <span class="n">espressomd</span><span class="o">.</span><span class="n">propagation</span><span class="o">.</span><span class="n">Propagation</span>
<span class="n">system</span> <span class="o">=</span> <span class="n">espressomd</span><span class="o">.</span><span class="n">System</span><span class="p">(</span><span class="n">box_l</span><span class="o">=</span><span class="p">[</span><span class="mf">8.</span><span class="p">,</span> <span class="mf">8.</span><span class="p">,</span> <span class="mf">8.</span><span class="p">])</span>
<span class="n">system</span><span class="o">.</span><span class="n">time_step</span> <span class="o">=</span> <span class="mf">0.01</span>
<span class="n">system</span><span class="o">.</span><span class="n">cell_system</span><span class="o">.</span><span class="n">skin</span> <span class="o">=</span> <span class="mf">0.</span>
<span class="n">lbf</span> <span class="o">=</span> <span class="n">espressomd</span><span class="o">.</span><span class="n">lb</span><span class="o">.</span><span class="n">LBFluidWalberla</span><span class="p">(</span><span class="n">agrid</span><span class="o">=</span><span class="mf">1.</span><span class="p">,</span> <span class="n">tau</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span> <span class="n">density</span><span class="o">=</span><span class="mf">1.</span><span class="p">,</span>
                                    <span class="n">kinematic_viscosity</span><span class="o">=</span><span class="mf">1.</span><span class="p">)</span>
<span class="n">system</span><span class="o">.</span><span class="n">lb</span> <span class="o">=</span> <span class="n">lbf</span>
<span class="n">system</span><span class="o">.</span><span class="n">thermostat</span><span class="o">.</span><span class="n">set_lb</span><span class="p">(</span><span class="n">LB_fluid</span><span class="o">=</span><span class="n">lbf</span><span class="p">,</span> <span class="n">seed</span><span class="o">=</span><span class="mi">123</span><span class="p">,</span> <span class="n">gamma</span><span class="o">=</span><span class="mf">1.5</span><span class="p">)</span>
<span class="n">lbf</span><span class="p">[:,</span> <span class="p">:,</span> <span class="p">:]</span><span class="o">.</span><span class="n">velocity</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">]</span>
<span class="n">p</span> <span class="o">=</span> <span class="n">system</span><span class="o">.</span><span class="n">part</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">pos</span><span class="o">=</span><span class="p">[</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">],</span> <span class="n">propagation</span><span class="o">=</span><span class="n">Propagation</span><span class="o">.</span><span class="n">TRANS_LB_TRACER</span><span class="p">)</span>
<span class="n">system</span><span class="o">.</span><span class="n">integrator</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">pos</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">3</span><span class="p">))</span>
</pre></div>
</div>
</section>
</section>
<section id="per-particle-propagation">
<span id="id16"></span><h2><span class="section-number">5.10. </span>Per-particle propagation<a class="headerlink" href="#per-particle-propagation" title="Link to this heading">¶</a></h2>
<p>Particle positions, quaternions, velocities and angular velocities are integrated
according to the main integrator, which may be coupled to a thermostat and a barostat
(see <a class="reference internal" href="integration.html#particle-integration-and-propagation"><span class="std std-ref">Particle integration and propagation</span></a> for more details).
The default integrator is the <a class="reference internal" href="integration.html#velocity-verlet-algorithm"><span class="std std-ref">Velocity Verlet algorithm</span></a>.</p>
<p>Which equations of motion are being used can be controlled on a per-particle level.
This is achieved by setting the particle
<a class="reference internal" href="espressomd.html#espressomd.particle_data.ParticleHandle.propagation" title="espressomd.particle_data.ParticleHandle.propagation"><code class="xref py py-attr docutils literal notranslate"><span class="pre">propagation</span></code></a> attribute with a
combination of propagation flags from <a class="reference internal" href="espressomd.html#espressomd.propagation.Propagation" title="espressomd.propagation.Propagation"><code class="xref py py-class docutils literal notranslate"><span class="pre">Propagation</span></code></a>.</p>
<p>Depending on which main integrator is selected, different “secondary” integrators
become available. The velocity Verlet integrator is available as a secondary
integrator, using flags <a class="reference internal" href="espressomd.html#espressomd.propagation.Propagation.TRANS_NEWTON" title="espressomd.propagation.Propagation.TRANS_NEWTON"><code class="xref py py-class docutils literal notranslate"><span class="pre">TRANS_NEWTON</span></code></a>
for translation following Newton’s equations of motion and
<a class="reference internal" href="espressomd.html#espressomd.propagation.Propagation.ROT_EULER" title="espressomd.propagation.Propagation.ROT_EULER"><code class="xref py py-class docutils literal notranslate"><span class="pre">ROT_EULER</span></code></a> for rotation
following Euler’s equations of rotation; in this way, selected particles
can be decoupled from a thermostat.
<a class="reference internal" href="#virtual-sites"><span class="std std-ref">Virtual sites</span></a> also rely on secondary integrators, such as
<a class="reference internal" href="espressomd.html#espressomd.propagation.Propagation.TRANS_VS_RELATIVE" title="espressomd.propagation.Propagation.TRANS_VS_RELATIVE"><code class="xref py py-class docutils literal notranslate"><span class="pre">TRANS_VS_RELATIVE</span></code></a> and
<a class="reference internal" href="espressomd.html#espressomd.propagation.Propagation.ROT_VS_RELATIVE" title="espressomd.propagation.Propagation.ROT_VS_RELATIVE"><code class="xref py py-class docutils literal notranslate"><span class="pre">ROT_VS_RELATIVE</span></code></a> for
<a class="reference internal" href="#rigid-arrangements-of-particles"><span class="std std-ref">Rigid arrangements of particles</span></a> or
<a class="reference internal" href="espressomd.html#espressomd.propagation.Propagation.TRANS_LB_TRACER" title="espressomd.propagation.Propagation.TRANS_LB_TRACER"><code class="xref py py-class docutils literal notranslate"><span class="pre">TRANS_LB_TRACER</span></code></a> for
<a class="reference internal" href="#inertialess-lattice-boltzmann-tracers"><span class="std std-ref">Inertialess lattice-Boltzmann tracers</span></a>.</p>
<p>In the following example, particle 1 follows Langevin dynamics (NVT ensemble),
while particle 2 follows Newtonian dynamics (NVE ensemble):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">espressomd</span>
<span class="kn">import</span> <span class="nn">espressomd.propagation</span>
<span class="n">Propagation</span> <span class="o">=</span> <span class="n">espressomd</span><span class="o">.</span><span class="n">propagation</span><span class="o">.</span><span class="n">Propagation</span>
<span class="n">system</span> <span class="o">=</span> <span class="n">espressomd</span><span class="o">.</span><span class="n">System</span><span class="p">(</span><span class="n">box_l</span><span class="o">=</span><span class="p">[</span><span class="mf">8.</span><span class="p">,</span> <span class="mf">8.</span><span class="p">,</span> <span class="mf">8.</span><span class="p">])</span>
<span class="n">system</span><span class="o">.</span><span class="n">time_step</span> <span class="o">=</span> <span class="mf">0.01</span>
<span class="n">system</span><span class="o">.</span><span class="n">cell_system</span><span class="o">.</span><span class="n">skin</span> <span class="o">=</span> <span class="mf">0.</span>
<span class="n">system</span><span class="o">.</span><span class="n">thermostat</span><span class="o">.</span><span class="n">set_langevin</span><span class="p">(</span><span class="n">kT</span><span class="o">=</span><span class="mf">0.001</span><span class="p">,</span> <span class="n">gamma</span><span class="o">=</span><span class="mf">2.</span><span class="p">,</span> <span class="n">seed</span><span class="o">=</span><span class="mi">42</span><span class="p">)</span>
<span class="n">p1</span> <span class="o">=</span> <span class="n">system</span><span class="o">.</span><span class="n">part</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">pos</span><span class="o">=</span><span class="p">[</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">],</span> <span class="n">v</span><span class="o">=</span><span class="p">[</span><span class="mf">1.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">],</span>
                     <span class="n">omega_lab</span><span class="o">=</span><span class="p">[</span><span class="mf">1.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">],</span> <span class="n">rotation</span><span class="o">=</span><span class="p">[</span><span class="kc">True</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="kc">True</span><span class="p">])</span>
<span class="n">p2</span> <span class="o">=</span> <span class="n">system</span><span class="o">.</span><span class="n">part</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">pos</span><span class="o">=</span><span class="p">[</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">],</span> <span class="n">v</span><span class="o">=</span><span class="p">[</span><span class="mf">1.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">],</span>
                     <span class="n">omega_lab</span><span class="o">=</span><span class="p">[</span><span class="mf">1.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">],</span> <span class="n">rotation</span><span class="o">=</span><span class="p">[</span><span class="kc">True</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="kc">True</span><span class="p">])</span>
<span class="n">p1</span><span class="o">.</span><span class="n">propagation</span> <span class="o">=</span> <span class="n">Propagation</span><span class="o">.</span><span class="n">TRANS_LANGEVIN</span> <span class="o">|</span> <span class="n">Propagation</span><span class="o">.</span><span class="n">ROT_LANGEVIN</span>
<span class="n">p2</span><span class="o">.</span><span class="n">propagation</span> <span class="o">=</span> <span class="n">Propagation</span><span class="o">.</span><span class="n">TRANS_NEWTON</span> <span class="o">|</span> <span class="n">Propagation</span><span class="o">.</span><span class="n">ROT_EULER</span>
<span class="n">system</span><span class="o">.</span><span class="n">integrator</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
<p>Not all combinations of propagation flags are allowed!</p>
<p>The friction coefficient of thermostats can be controlled on a per-particle level too.
Values stored in particle attributes <a class="reference internal" href="espressomd.html#espressomd.particle_data.ParticleHandle.gamma" title="espressomd.particle_data.ParticleHandle.gamma"><code class="xref py py-attr docutils literal notranslate"><span class="pre">gamma</span></code></a>
and <a class="reference internal" href="espressomd.html#espressomd.particle_data.ParticleHandle.gamma_rot" title="espressomd.particle_data.ParticleHandle.gamma_rot"><code class="xref py py-attr docutils literal notranslate"><span class="pre">gamma_rot</span></code></a> will override
the friction coefficients of most thermostats.
Requires feature <code class="docutils literal notranslate"><span class="pre">THERMOSTAT_PER_PARTICLE</span></code>.
This is used for example to model
<a class="reference internal" href="advanced_methods.html#particle-polarizability-with-thermalized-cold-drude-oscillators"><span class="std std-ref">Particle polarizability with thermalized cold Drude oscillators</span></a>.
These attributes can also be defined as 3D vectors to model particle anisotropy.
Requires feature <code class="docutils literal notranslate"><span class="pre">PARTICLE_ANISOTROPY</span></code>.</p>
</section>
<section id="interacting-with-groups-of-particles">
<span id="id17"></span><h2><span class="section-number">5.11. </span>Interacting with groups of particles<a class="headerlink" href="#interacting-with-groups-of-particles" title="Link to this heading">¶</a></h2>
<p>Groups of particles are addressed using <a class="reference internal" href="espressomd.html#espressomd.particle_data.ParticleSlice" title="espressomd.particle_data.ParticleSlice"><code class="xref py py-class docutils literal notranslate"><span class="pre">ParticleSlice</span></code></a> objects.
The objects behave similarly to <a class="reference internal" href="espressomd.html#espressomd.particle_data.ParticleList" title="espressomd.particle_data.ParticleList"><code class="xref py py-class docutils literal notranslate"><span class="pre">ParticleList</span></code></a> objects.
There are several ways to retrieve a particle slice:</p>
<ul>
<li><p>By calling <a class="reference internal" href="espressomd.html#espressomd.particle_data.ParticleList.add" title="espressomd.particle_data.ParticleList.add"><code class="xref py py-meth docutils literal notranslate"><span class="pre">ParticleList.add()</span></code></a></p>
<p>When adding several particles at once, a particle slice is returned instead
of a particle handle.</p>
</li>
<li><p>By calling <a class="reference internal" href="espressomd.html#espressomd.particle_data.ParticleList.by_ids" title="espressomd.particle_data.ParticleList.by_ids"><code class="xref py py-meth docutils literal notranslate"><span class="pre">ParticleList.by_ids()</span></code></a></p>
<p>It is also possible to get a slice containing particles of specific ids, e.g.:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">system</span><span class="o">.</span><span class="n">part</span><span class="o">.</span><span class="n">by_ids</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">3</span><span class="p">])</span>
</pre></div>
</div>
<p>would contain the particles with ids 1, 4, and 3 in that specific order.</p>
</li>
<li><p>By calling <a class="reference internal" href="espressomd.html#espressomd.particle_data.ParticleList.all" title="espressomd.particle_data.ParticleList.all"><code class="xref py py-meth docutils literal notranslate"><span class="pre">ParticleList.all()</span></code></a></p>
<p>You can get a slice containing all particles using:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">system</span><span class="o">.</span><span class="n">part</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
</pre></div>
</div>
</li>
<li><p>By calling <a class="reference internal" href="espressomd.html#espressomd.particle_data.ParticleList.select" title="espressomd.particle_data.ParticleList.select"><code class="xref py py-meth docutils literal notranslate"><span class="pre">ParticleList.select()</span></code></a></p>
<p>This is useful to filter out particles with distinct properties, e.g.:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">slice1</span> <span class="o">=</span> <span class="n">system</span><span class="o">.</span><span class="n">part</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">q</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">slice2</span> <span class="o">=</span> <span class="n">system</span><span class="o">.</span><span class="n">part</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="k">lambda</span> <span class="n">p</span><span class="p">:</span> <span class="n">p</span><span class="o">.</span><span class="n">pos</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mf">0.5</span><span class="p">)</span>
</pre></div>
</div>
</li>
</ul>
<p>Properties of particle slices can be accessed just like with single particles.
A list of all values is returned:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">system</span><span class="o">.</span><span class="n">part</span><span class="o">.</span><span class="n">all</span><span class="p">()</span><span class="o">.</span><span class="n">q</span><span class="p">)</span>
</pre></div>
</div>
<p>A particle slice can be iterated over, see <a class="reference internal" href="#iterating-over-particles-and-pairs-of-particles"><span class="std std-ref">Iterating over particles and pairs of particles</span></a>.</p>
<p>Setting properties of slices can be done by</p>
<ul>
<li><p>supplying a <em>single value</em> that is assigned to each entry of the slice, e.g.:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">system</span><span class="o">.</span><span class="n">part</span><span class="o">.</span><span class="n">by_ids</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">))</span><span class="o">.</span><span class="n">ext_force</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
</pre></div>
</div>
</li>
<li><p>supplying an <em>array of values</em> that matches the length of the slice which sets each entry individually, e.g.:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">system</span><span class="o">.</span><span class="n">part</span><span class="o">.</span><span class="n">by_ids</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">))</span><span class="o">.</span><span class="n">ext_force</span> <span class="o">=</span> <span class="p">[[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]]</span>
</pre></div>
</div>
</li>
</ul>
<p>For list properties that have no fixed length like <code class="docutils literal notranslate"><span class="pre">exclusions</span></code> or <code class="docutils literal notranslate"><span class="pre">bonds</span></code>, some care has to be taken.
There, <em>single value</em> assignment also accepts lists/tuples just like setting the property of an individual particle. For example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">system</span><span class="o">.</span><span class="n">part</span><span class="o">.</span><span class="n">by_id</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">exclusions</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span>
</pre></div>
</div>
<p>would both exclude short-range interactions of the particle pairs <code class="docutils literal notranslate"><span class="pre">0</span> <span class="pre">&lt;-&gt;</span> <span class="pre">1</span></code> and <code class="docutils literal notranslate"><span class="pre">0</span> <span class="pre">&lt;-&gt;</span> <span class="pre">2</span></code>.
Similarly, a list can also be assigned to each entry of the slice:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">system</span><span class="o">.</span><span class="n">part</span><span class="o">.</span><span class="n">by_ids</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">4</span><span class="p">))</span><span class="o">.</span><span class="n">exclusions</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
</pre></div>
</div>
<p>This would exclude interactions between <code class="docutils literal notranslate"><span class="pre">2</span> <span class="pre">&lt;-&gt;</span> <span class="pre">0</span></code>, <code class="docutils literal notranslate"><span class="pre">2</span> <span class="pre">&lt;-&gt;</span> <span class="pre">1</span></code>, <code class="docutils literal notranslate"><span class="pre">3</span> <span class="pre">&lt;-&gt;</span> <span class="pre">0</span></code> and <code class="docutils literal notranslate"><span class="pre">3</span> <span class="pre">&lt;-&gt;</span> <span class="pre">1</span></code>.
Now when it is desired to supply an <em>array of values</em> with individual values for each slice entry, the distinction can no longer be done
by the length of the input, as slice length and input length can be equal. Here, the nesting level of the input is the distinctive criterion:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">system</span><span class="o">.</span><span class="n">part</span><span class="o">.</span><span class="n">by_ids</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">4</span><span class="p">))</span><span class="o">.</span><span class="n">exclusions</span> <span class="o">=</span> <span class="p">[[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]]</span>
</pre></div>
</div>
<p>The above code snippet would lead to the same exclusions as the one before.
The same accounts for the <code class="docutils literal notranslate"><span class="pre">bonds</span></code> property by interchanging the integer entries of the exclusion list with
the tuple <code class="docutils literal notranslate"><span class="pre">(bond,</span> <span class="pre">partners)</span></code>.</p>
<p>You can select a subset of particles via using the select method. For example you can obtain a list of particles with charge -1 via using</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">system</span><span class="o">.</span><span class="n">part</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">q</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
<p>For further information on how to use selections see <a class="reference internal" href="espressomd.html#espressomd.particle_data.ParticleList.select" title="espressomd.particle_data.ParticleList.select"><code class="xref py py-meth docutils literal notranslate"><span class="pre">espressomd.particle_data.ParticleList.select()</span></code></a>.</p>
</section>
<section id="create-particular-particle-configurations">
<span id="id18"></span><h2><span class="section-number">5.12. </span>Create particular particle configurations<a class="headerlink" href="#create-particular-particle-configurations" title="Link to this heading">¶</a></h2>
<section id="setting-up-polymer-chains">
<span id="id19"></span><h3><span class="section-number">5.12.1. </span>Setting up polymer chains<a class="headerlink" href="#setting-up-polymer-chains" title="Link to this heading">¶</a></h3>
<p>If you want to have polymers in your system, you can use the function
<a class="reference internal" href="espressomd.html#espressomd.polymer.linear_polymer_positions" title="espressomd.polymer.linear_polymer_positions"><code class="xref py py-func docutils literal notranslate"><span class="pre">espressomd.polymer.linear_polymer_positions()</span></code></a> to determine suitable positions.</p>
<p>Required arguments are the desired number of polymers <code class="docutils literal notranslate"><span class="pre">n_polymers</span></code>, the
number of monomers per polymer chain <code class="docutils literal notranslate"><span class="pre">beads_per_chain</span></code>, and the parameter
<code class="docutils literal notranslate"><span class="pre">bond_length</span></code>, which determines the distance between adjacent monomers
within the polymer chains.
Determining suitable particle positions pseudo-randomly requires the use of
a pseudo-random number generator, which has to be seeded. This <code class="docutils literal notranslate"><span class="pre">seed</span></code>
is therefore also a mandatory parameter.</p>
<p>The function <a class="reference internal" href="espressomd.html#espressomd.polymer.linear_polymer_positions" title="espressomd.polymer.linear_polymer_positions"><code class="xref py py-func docutils literal notranslate"><span class="pre">espressomd.polymer.linear_polymer_positions()</span></code></a> returns a
three-dimensional numpy array, namely a list of polymers containing the
positions of monomers (x, y, z). A quick example of how to set up polymers:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">espressomd</span>
<span class="kn">import</span> <span class="nn">espressomd.polymer</span>
<span class="kn">import</span> <span class="nn">espressomd.interactions</span>

<span class="n">system</span> <span class="o">=</span> <span class="n">espressomd</span><span class="o">.</span><span class="n">System</span><span class="p">([</span><span class="mi">50</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">50</span><span class="p">])</span>
<span class="n">fene</span> <span class="o">=</span> <span class="n">espressomd</span><span class="o">.</span><span class="n">interactions</span><span class="o">.</span><span class="n">FeneBond</span><span class="p">(</span><span class="n">k</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">d_r_max</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="n">system</span><span class="o">.</span><span class="n">bonded_inter</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">fene</span><span class="p">)</span>
<span class="n">polymer_positions</span> <span class="o">=</span> <span class="n">espressomd</span><span class="o">.</span><span class="n">polymer</span><span class="o">.</span><span class="n">linear_polymer_positions</span><span class="p">(</span>
    <span class="n">n_polymers</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">beads_per_chain</span><span class="o">=</span><span class="mi">25</span><span class="p">,</span> <span class="n">bond_length</span><span class="o">=</span><span class="mf">0.9</span><span class="p">,</span> <span class="n">seed</span><span class="o">=</span><span class="mi">23</span><span class="p">)</span>

<span class="k">for</span> <span class="n">positions</span> <span class="ow">in</span> <span class="n">polymer_positions</span><span class="p">:</span>
    <span class="n">monomers</span> <span class="o">=</span> <span class="n">system</span><span class="o">.</span><span class="n">part</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">pos</span><span class="o">=</span><span class="n">positions</span><span class="p">)</span>
    <span class="n">previous_part</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">for</span> <span class="n">part</span> <span class="ow">in</span> <span class="n">monomers</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">previous_part</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">part</span><span class="o">.</span><span class="n">add_bond</span><span class="p">((</span><span class="n">fene</span><span class="p">,</span> <span class="n">previous_part</span><span class="p">))</span>
        <span class="n">previous_part</span> <span class="o">=</span> <span class="n">part</span>
</pre></div>
</div>
<p>If there are constraints present in your system which you want to be taken
into account when creating the polymer positions, you can set the optional
boolean parameter <code class="docutils literal notranslate"><span class="pre">respect_constraint=True</span></code>.
To simulate excluded volume while drawing the polymer positions, a minimum
distance between all particles can be set via <code class="docutils literal notranslate"><span class="pre">min_distance</span></code>. This will
also respect already existing particles in the system.
Both when setting <code class="docutils literal notranslate"><span class="pre">respect_constraints</span></code> and choosing a <code class="docutils literal notranslate"><span class="pre">min_distance</span></code>
trial positions are pseudo-randomly chosen and only accepted if the
requested requirement is fulfilled. Otherwise, a new attempt will be made,
up to <code class="docutils literal notranslate"><span class="pre">max_tries</span></code> times per monomer and if this fails <code class="docutils literal notranslate"><span class="pre">max_tries</span></code> per
polymer. The default value is <code class="docutils literal notranslate"><span class="pre">max_tries=1000</span></code>. Depending on the total
number of beads and constraints, this value may need to be adapted. If
determining suitable polymer positions within this limit fails, a runtime
error is thrown.</p>
<p>Note that the distance between adjacent monomers
during the course of the simulation depends on the applied potentials.
For fixed bond length please refer to the Rattle Shake
algorithm<span id="id20">[<a class="reference internal" href="bibliography.html#id6" title="Hans C. Andersen. Rattle: A “velocity” version of the shake algorithm for molecular dynamics calculations. Journal of Computational Physics, 52(1):24–34, 1983. doi:10.1016/0021-9991(83)90014-1.">Andersen, 1983</a>]</span>. The algorithm is based on
Verlet algorithm and satisfy internal constraints for molecular models
with internal constraints, using Lagrange multipliers.</p>
</section>
<section id="setting-up-diamond-polymer-networks">
<span id="id21"></span><h3><span class="section-number">5.12.2. </span>Setting up diamond polymer networks<a class="headerlink" href="#setting-up-diamond-polymer-networks" title="Link to this heading">¶</a></h3>
<p><a class="reference internal" href="espressomd.html#espressomd.polymer.setup_diamond_polymer" title="espressomd.polymer.setup_diamond_polymer"><code class="xref py py-func docutils literal notranslate"><span class="pre">espressomd.polymer.setup_diamond_polymer()</span></code></a> creates a diamond-structured
polymer network with 8 tetra-functional nodes
connected by <span class="math notranslate nohighlight">\(2 \times 8\)</span> polymer chains of length <code class="docutils literal notranslate"><span class="pre">MPC</span></code> with the system box as
the unit cell. The box therefore has to be cubic.
The diamond command creates <code class="docutils literal notranslate"><span class="pre">16*MPC+8</span></code> many particles
which are connected via the provided bond type (the term plus 8 stems from adding 8 nodes which are connecting the chains).
Chain monomers are placed at constant distance to each other
along the vector connecting network nodes. The distance between monomers is
<code class="docutils literal notranslate"><span class="pre">system.box_l[0]*(0.25</span> <span class="pre">*</span> <span class="pre">sqrt(3))/(MPC</span> <span class="pre">+</span> <span class="pre">1)</span></code>, which should be taken into account
when choosing the connecting bond.
The starting particle id, the charges of monomers, the frequency
of charged monomers in the chains as well as the types of the node particles,
the charged and the uncharged chain particles can be set via keyword arguments, see <a class="reference internal" href="espressomd.html#espressomd.polymer.setup_diamond_polymer" title="espressomd.polymer.setup_diamond_polymer"><code class="xref py py-func docutils literal notranslate"><span class="pre">espressomd.polymer.setup_diamond_polymer()</span></code></a>.</p>
<figure class="align-center" id="id27">
<span id="diamond"></span><a class="reference internal image-reference" href="_images/diamond.png"><img alt="Diamond-like polymer network with MPC=15." src="_images/diamond.png" style="height: 6.00000cm;" /></a>
<figcaption>
<p><span class="caption-text">Diamond-like polymer network with <code class="docutils literal notranslate"><span class="pre">MPC=15</span></code>.</span><a class="headerlink" href="#id27" title="Link to this image">¶</a></p>
</figcaption>
</figure>
<p>For simulating compressed or stretched gels, the function
<a class="reference internal" href="espressomd.html#espressomd.system.System.change_volume_and_rescale_particles" title="espressomd.system.System.change_volume_and_rescale_particles"><code class="xref py py-meth docutils literal notranslate"><span class="pre">espressomd.system.System.change_volume_and_rescale_particles()</span></code></a> may be used.</p>
</section>
</section>
<section id="particle-number-counting-feature">
<span id="id22"></span><h2><span class="section-number">5.13. </span>Particle number counting feature<a class="headerlink" href="#particle-number-counting-feature" title="Link to this heading">¶</a></h2>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Do not use these methods with the <a class="reference internal" href="espressomd.html#module-espressomd.collision_detection" title="espressomd.collision_detection"><code class="xref py py-mod docutils literal notranslate"><span class="pre">espressomd.collision_detection</span></code></a>
module since the collision detection may create or delete particles
without the particle number counting feature being aware of this.
Therefore the <a class="reference internal" href="espressomd.html#module-espressomd.reaction_methods" title="espressomd.reaction_methods"><code class="xref py py-mod docutils literal notranslate"><span class="pre">espressomd.reaction_methods</span></code></a> module may not
be used with the collision detection.</p>
</div>
<p>Knowing the number of particles of a certain type in simulations where
particle numbers can fluctuate is of interest.
Particle ids can be stored in a map for each individual type:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">espressomd</span>
<span class="n">system</span> <span class="o">=</span> <span class="n">espressomd</span><span class="o">.</span><span class="n">System</span><span class="p">(</span><span class="n">box_l</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
<span class="n">system</span><span class="o">.</span><span class="n">setup_type_map</span><span class="p">([</span><span class="n">_type</span><span class="p">])</span>
<span class="n">system</span><span class="o">.</span><span class="n">number_of_particles</span><span class="p">(</span><span class="n">_type</span><span class="p">)</span>
</pre></div>
</div>
<p>If you want to keep track of particle ids of a certain type you have to
initialize the method by calling</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">system</span><span class="o">.</span><span class="n">setup_type_map</span><span class="p">([</span><span class="n">_type</span><span class="p">])</span>
</pre></div>
</div>
<p>After that the system will keep track of particle ids of that type. Keeping
track of particles of a given type is not enabled by default since it requires
memory. The keyword <code class="docutils literal notranslate"><span class="pre">number_of_particles</span></code> as argument will return the number
of particles which have the given type. For counting the number of particles
of a given type you could also use
<a class="reference internal" href="espressomd.html#espressomd.particle_data.ParticleList.select" title="espressomd.particle_data.ParticleList.select"><code class="xref py py-meth docutils literal notranslate"><span class="pre">ParticleList.select()</span></code></a></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">espressomd</span>
<span class="n">system</span> <span class="o">=</span> <span class="n">espressomd</span><span class="o">.</span><span class="n">System</span><span class="p">(</span><span class="n">box_l</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
<span class="n">system</span><span class="o">.</span><span class="n">part</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">pos</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="nb">type</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">system</span><span class="o">.</span><span class="n">part</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">pos</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="nb">type</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">system</span><span class="o">.</span><span class="n">part</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">pos</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="nb">type</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">system</span><span class="o">.</span><span class="n">part</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="mi">0</span><span class="p">)))</span>
<span class="nb">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">system</span><span class="o">.</span><span class="n">part</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="mi">2</span><span class="p">)))</span>
</pre></div>
</div>
<p>However calling <code class="docutils literal notranslate"><span class="pre">select(type=type)</span></code> results in looping over all particles,
which is slow. In contrast, the system
<a class="reference internal" href="espressomd.html#espressomd.system.System.number_of_particles" title="espressomd.system.System.number_of_particles"><code class="xref py py-meth docutils literal notranslate"><span class="pre">number_of_particles()</span></code></a> method can return the
number of particles with that type.</p>
</section>
<section id="self-propelled-swimmers">
<span id="id23"></span><h2><span class="section-number">5.14. </span>Self-propelled swimmers<a class="headerlink" href="#self-propelled-swimmers" title="Link to this heading">¶</a></h2>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If you are using this feature, please cite <span id="id24">[<a class="reference internal" href="bibliography.html#id34" title="Joost de Graaf, Henri Menke, Arnold J.T.M. Mathijssen, Marc Fabritius, Christian Holm, and Tyler N. Shendruk. Lattice-Boltzmann hydrodynamics of anisotropic active matter. The Journal of Chemical Physics, 144:134106, 2016. doi:10.1063/1.4944962.">de Graaf <em>et al.</em>, 2016</a>]</span>.</p>
</div>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference internal" href="espressomd.html#espressomd.particle_data.ParticleHandle.swimming" title="espressomd.particle_data.ParticleHandle.swimming"><code class="xref py py-attr docutils literal notranslate"><span class="pre">swimming</span></code></a></p>
</div>
<section id="langevin-swimmers">
<span id="id25"></span><h3><span class="section-number">5.14.1. </span>Langevin swimmers<a class="headerlink" href="#langevin-swimmers" title="Link to this heading">¶</a></h3>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Requires feature <code class="docutils literal notranslate"><span class="pre">ENGINE</span></code>.</p>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">espressomd</span>
<span class="n">system</span> <span class="o">=</span> <span class="n">espressomd</span><span class="o">.</span><span class="n">System</span><span class="p">(</span><span class="n">box_l</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
<span class="n">system</span><span class="o">.</span><span class="n">part</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">pos</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">swimming</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;f_swim&#39;</span><span class="p">:</span> <span class="mf">0.03</span><span class="p">})</span>
</pre></div>
</div>
<p>This enables the particle to be self-propelled along its director.
The terminal propulsion speed is determined by the friction of a (Langevin)
thermostat (<code class="docutils literal notranslate"><span class="pre">v_swim</span> <span class="pre">=</span> <span class="pre">f_swim</span> <span class="pre">/</span> <span class="pre">gamma</span></code>).</p>
</section>
<section id="lattice-boltzmann-swimmers">
<span id="id26"></span><h3><span class="section-number">5.14.2. </span>Lattice-Boltzmann swimmers<a class="headerlink" href="#lattice-boltzmann-swimmers" title="Link to this heading">¶</a></h3>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Requires features <code class="docutils literal notranslate"><span class="pre">ENGINE</span></code> and <code class="docutils literal notranslate"><span class="pre">VIRTUAL_SITES_RELATIVE</span></code>.</p>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">espressomd</span>
<span class="n">system</span> <span class="o">=</span> <span class="n">espressomd</span><span class="o">.</span><span class="n">System</span><span class="p">(</span><span class="n">box_l</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
<span class="n">swimmer</span> <span class="o">=</span> <span class="n">system</span><span class="o">.</span><span class="n">part</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">pos</span><span class="o">=</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
                          <span class="n">rotation</span><span class="o">=</span><span class="p">[</span><span class="kc">True</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="kc">True</span><span class="p">],</span>
                          <span class="n">swimming</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;f_swim&#39;</span><span class="p">:</span> <span class="mf">0.01</span><span class="p">})</span>
</pre></div>
</div>
<p>In lattice-Boltzmann, self-propulsion is less trivial than for regular MD, because for hydrodynamic
interactions it is important that the propulsion force is generated by the swimmer itself and
not by an external force. Since the swimmer can only push itself forward by pushing fluid backward,
the total system is net force-free at all times. The resulting flow-field can thus not contain
monopolar contributions in the far field and the slowest-decaying flow-field mode is a dipole.
In ESPResSo, the propulsion mechanism can be mimicked by applying a force to the fluid that is equal in
magnitude but opposite in sign to the forward force on the swimming particle.
For this, particles can be marked as force appliers as shown in the following example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">dipole</span> <span class="o">=</span> <span class="n">system</span><span class="o">.</span><span class="n">part</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">pos</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
                         <span class="n">swimming</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;f_swim&quot;</span><span class="p">:</span> <span class="n">swimmer</span><span class="o">.</span><span class="n">swimming</span><span class="p">[</span><span class="s2">&quot;f_swim&quot;</span><span class="p">],</span>
                                   <span class="s2">&quot;is_engine_force_on_fluid&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">})</span>
<span class="n">dipole</span><span class="o">.</span><span class="n">vs_auto_relate_to</span><span class="p">(</span><span class="n">swimmer</span><span class="p">)</span>
<span class="n">dipole</span><span class="o">.</span><span class="n">vs_quat</span> <span class="o">=</span> <span class="n">calc_quaternions_from_angles</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="mf">0.</span><span class="p">)</span>
</pre></div>
</div>
<p>This makes the dipole particle not experience any friction or stochastic forces,
but apply <code class="docutils literal notranslate"><span class="pre">f_swim</span></code> along its internal orientation (<code class="docutils literal notranslate"><span class="pre">director</span></code>)
and follow the swimmer while updating its orientation accordingly.
ESPResSo provides a helper function <a class="reference internal" href="espressomd.html#espressomd.swimmer_helpers.add_dipole_particle" title="espressomd.swimmer_helpers.add_dipole_particle"><code class="xref py py-func docutils literal notranslate"><span class="pre">add_dipole_particle()</span></code></a> to set
up the virtual particle with the correct distance, relative position and orientation:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">espressomd.swimmer_helpers.add_dipole_particle</span> <span class="k">as</span> <span class="nn">add_dip</span>
<span class="n">dipole</span> <span class="o">=</span> <span class="n">add_dip</span><span class="p">(</span><span class="n">system</span><span class="p">,</span> <span class="n">swimmer</span><span class="p">,</span> <span class="mf">2.</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;pusher&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>It creates pushers with the propulsion behind the swimmer and pullers with the
propulsion in front of the swimmer.</p>
<p>Notes:</p>
<ul class="simple">
<li><p>The terminal velocity is <strong>not</strong> <code class="docutils literal notranslate"><span class="pre">v_swim</span> <span class="pre">=</span> <span class="pre">gamma_lb</span> <span class="pre">*</span> <span class="pre">f_swim</span></code>. The flow-field generated
by the dipole particle interacts in a non-trivial way with the swimmer particle.
You will have to calibrate your propulsion force to the desired swim velocity.</p></li>
<li><p>For the same reason, do not place the dipole particle too close to the swimmer
(at least one grid spacing is recommended). Lattice-Boltzmann cannot create an exact,
mathematical dipole, which would require zero distance but diverging forces.</p></li>
<li><p>Since the swimmer is a point particle, it cannot experience shear or rotational flow
components, only random rotational noise. If shear or rotational flow are important in your
system, consider creating an extended, raspberry particle as described in <a class="reference internal" href="#rigid-arrangements-of-particles"><span class="std std-ref">Rigid arrangements of particles</span></a>.</p></li>
</ul>
</section>
</section>
</section>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <div>
    <h3><a href="index.html">Table of Contents</a></h3>
    <ul>
<li><a class="reference internal" href="#">5. Setting up particles</a><ul>
<li><a class="reference internal" href="#overview-of-the-relevant-python-classes">5.1. Overview of the relevant Python classes</a></li>
<li><a class="reference internal" href="#adding-particles">5.2. Adding particles</a></li>
<li><a class="reference internal" href="#accessing-particle-properties">5.3. Accessing particle properties</a></li>
<li><a class="reference internal" href="#modifying-particle-properties">5.4. Modifying particle properties</a><ul>
<li><a class="reference internal" href="#vectorial-properties">5.4.1. Vectorial properties</a></li>
</ul>
</li>
<li><a class="reference internal" href="#deleting-particles">5.5. Deleting particles</a></li>
<li><a class="reference internal" href="#iterating-over-particles-and-pairs-of-particles">5.6. Iterating over particles and pairs of particles</a></li>
<li><a class="reference internal" href="#exclusions">5.7. Exclusions</a></li>
<li><a class="reference internal" href="#rotational-degrees-of-freedom-and-particle-anisotropy">5.8. Rotational degrees of freedom and particle anisotropy</a></li>
<li><a class="reference internal" href="#virtual-sites">5.9. Virtual sites</a><ul>
<li><a class="reference internal" href="#rigid-arrangements-of-particles">5.9.1. Rigid arrangements of particles</a></li>
<li><a class="reference internal" href="#inertialess-lattice-boltzmann-tracers">5.9.2. Inertialess lattice-Boltzmann tracers</a></li>
</ul>
</li>
<li><a class="reference internal" href="#per-particle-propagation">5.10. Per-particle propagation</a></li>
<li><a class="reference internal" href="#interacting-with-groups-of-particles">5.11. Interacting with groups of particles</a></li>
<li><a class="reference internal" href="#create-particular-particle-configurations">5.12. Create particular particle configurations</a><ul>
<li><a class="reference internal" href="#setting-up-polymer-chains">5.12.1. Setting up polymer chains</a></li>
<li><a class="reference internal" href="#setting-up-diamond-polymer-networks">5.12.2. Setting up diamond polymer networks</a></li>
</ul>
</li>
<li><a class="reference internal" href="#particle-number-counting-feature">5.13. Particle number counting feature</a></li>
<li><a class="reference internal" href="#self-propelled-swimmers">5.14. Self-propelled swimmers</a><ul>
<li><a class="reference internal" href="#langevin-swimmers">5.14.1. Langevin swimmers</a></li>
<li><a class="reference internal" href="#lattice-boltzmann-swimmers">5.14.2. Lattice-Boltzmann swimmers</a></li>
</ul>
</li>
</ul>
</li>
</ul>

  </div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2018-2023, The ESPResSo project.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 7.2.6</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
    </div>

    

    
  </body>
</html>