
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>espressomd.visualization &#8212; ESPResSo 4.2.2 documentation</title>
    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/alabaster.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/blockquotes.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/custom.css" />
    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/toggleprompt.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
   
  <link rel="stylesheet" href="../../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <h1>Source code for espressomd.visualization</h1><div class="highlight"><pre>
<span></span><span class="c1"># Copyright (C) 2010-2022 The ESPResSo project</span>
<span class="c1">#</span>
<span class="c1"># This file is part of ESPResSo.</span>
<span class="c1">#</span>
<span class="c1"># ESPResSo is free software: you can redistribute it and/or modify</span>
<span class="c1"># it under the terms of the GNU General Public License as published by</span>
<span class="c1"># the Free Software Foundation, either version 3 of the License, or</span>
<span class="c1"># (at your option) any later version.</span>
<span class="c1">#</span>
<span class="c1"># ESPResSo is distributed in the hope that it will be useful,</span>
<span class="c1"># but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<span class="c1"># MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
<span class="c1"># GNU General Public License for more details.</span>
<span class="c1">#</span>
<span class="c1"># You should have received a copy of the GNU General Public License</span>
<span class="c1"># along with this program.  If not, see &lt;http://www.gnu.org/licenses/&gt;.</span>
<span class="kn">import</span> <span class="nn">ctypes</span>
<span class="kn">import</span> <span class="nn">math</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">itertools</span>
<span class="kn">import</span> <span class="nn">threading</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span>

<span class="kn">import</span> <span class="nn">OpenGL.GL</span>
<span class="kn">import</span> <span class="nn">OpenGL.GLE</span>
<span class="kn">import</span> <span class="nn">OpenGL.GLU</span>
<span class="kn">import</span> <span class="nn">OpenGL.GLUT</span>

<span class="kn">import</span> <span class="nn">espressomd</span>
<span class="kn">import</span> <span class="nn">espressomd.particle_data</span>


<div class="viewcode-block" id="openGLLive"><a class="viewcode-back" href="../../espressomd.html#espressomd.visualization.openGLLive">[docs]</a><span class="k">class</span> <span class="nc">openGLLive</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This class provides live visualization using pyOpenGL.</span>
<span class="sd">    Use the update method to push your current simulation state after</span>
<span class="sd">    integrating. Modify the appearance with a list of keywords.</span>
<span class="sd">    Timed callbacks can be registered via the :meth:`register_callback` method</span>
<span class="sd">    and keyboard callbacks via :meth:`keyboard_manager.register_button()</span>
<span class="sd">    &lt;espressomd.visualization.KeyboardManager.register_button&gt;`.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>

<span class="sd">    system : :class:`espressomd.system.System`</span>
<span class="sd">    window_size : (2,) array_like of :obj:`int`, optional</span>
<span class="sd">        Size of the visualizer window in pixels.</span>
<span class="sd">    name : :obj:`str`, optional</span>
<span class="sd">        The name of the visualizer window.</span>
<span class="sd">    background_color : (3,) array_like of :obj:`float`, optional</span>
<span class="sd">        RGB of the background.</span>
<span class="sd">    periodic_images : (3,) array_like of :obj:`int`, optional</span>
<span class="sd">        Periodic repetitions on both sides of the box in xyz-direction.</span>
<span class="sd">    draw_box : :obj:`bool`, optional</span>
<span class="sd">        Draw wireframe boundaries.</span>
<span class="sd">    draw_axis : :obj:`bool`, optional</span>
<span class="sd">        Draw xyz system axes.</span>
<span class="sd">    draw_nodes : :obj:`bool`, optional</span>
<span class="sd">        Draw node boxes.</span>
<span class="sd">    draw_cells : :obj:`bool`, optional</span>
<span class="sd">        Draw cell boxes.</span>
<span class="sd">    quality_particles : :obj:`int`, optional</span>
<span class="sd">        The number of subdivisions for particle spheres.</span>
<span class="sd">    quality_bonds : :obj:`int`, optional</span>
<span class="sd">        The number of subdivisions for cylindrical bonds.</span>
<span class="sd">    quality_arrows : :obj:`int`, optional</span>
<span class="sd">        The number of subdivisions for external force arrows.</span>
<span class="sd">    quality_constraints : :obj:`int`, optional</span>
<span class="sd">        The number of subdivisions for primitive constraints.</span>
<span class="sd">    close_cut_distance : :obj:`float`, optional</span>
<span class="sd">        The distance from the viewer to the near clipping plane.</span>
<span class="sd">    far_cut_distance : :obj:`float`, optional</span>
<span class="sd">        The distance from the viewer to the far clipping plane.</span>
<span class="sd">    camera_position : :obj:`str` or (3,) array_like of :obj:`float`, optional</span>
<span class="sd">        Initial camera position. Use ``&#39;auto&#39;`` (default) for shifted position in z-direction.</span>
<span class="sd">    camera_target : :obj:`str` or (3,) array_like of :obj:`float`, optional</span>
<span class="sd">        Initial camera target. Use ``&#39;auto&#39;`` (default) to look towards the system center.</span>
<span class="sd">    camera_right : (3,) array_like of :obj:`float`, optional</span>
<span class="sd">        Camera right vector in system coordinates. Default is ``[1, 0, 0]``</span>
<span class="sd">    particle_sizes : :obj:`str` or array_like of :obj:`float` or callable, optional</span>
<span class="sd">        * ``&#39;auto&#39;`` (default): The Lennard-Jones sigma value of the</span>
<span class="sd">          self-interaction is used for the particle diameter.</span>
<span class="sd">        * callable: A lambda function with one argument. Internally,</span>
<span class="sd">          the numerical particle type is passed to the lambda</span>
<span class="sd">          function to determine the particle radius.</span>
<span class="sd">        * list: A list of particle radii, indexed by the particle type.</span>
<span class="sd">    particle_coloring : :obj:`str`, optional</span>
<span class="sd">        * ``&#39;auto&#39;`` (default): Colors of charged particles are</span>
<span class="sd">          specified by ``particle_charge_colors``, neutral particles</span>
<span class="sd">          by ``particle_type_colors``.</span>
<span class="sd">        * ``&#39;charge&#39;``: Minimum and maximum charge of all particles is determined by the</span>
<span class="sd">          visualizer. All particles are colored by a linear</span>
<span class="sd">          interpolation of the two colors given by</span>
<span class="sd">          ``particle_charge_colors`` according to their charge.</span>
<span class="sd">        * ``&#39;type&#39;``: Particle colors are specified by ``particle_type_colors``,</span>
<span class="sd">          indexed by their numerical particle type.</span>
<span class="sd">        * ``&#39;node&#39;``: Color according to the node the particle is on.</span>
<span class="sd">    particle_type_colors : array_like of :obj:`float`, optional</span>
<span class="sd">        Colors for particle types.</span>
<span class="sd">    particle_type_materials : array_like of :obj:`str`, optional</span>
<span class="sd">        Materials of the particle types.</span>
<span class="sd">    particle_charge_colors : (2,) array_like of :obj:`float`, optional</span>
<span class="sd">        Two colors for min/max charged particles.</span>
<span class="sd">    draw_constraints : :obj:`bool`, optional</span>
<span class="sd">        Enables constraint visualization. For simple constraints</span>
<span class="sd">        (planes, spheres and cylinders), OpenGL primitives are</span>
<span class="sd">        used. Otherwise, visualization by rasterization is used.</span>
<span class="sd">    rasterize_pointsize : :obj:`float`, optional</span>
<span class="sd">        Point size for the rasterization dots.</span>
<span class="sd">    rasterize_resolution : :obj:`float`, optional</span>
<span class="sd">        Accuracy of the rasterization.</span>
<span class="sd">    quality_constraints : :obj:`int`, optional</span>
<span class="sd">        The number of subdivisions for primitive constraints.</span>
<span class="sd">    constraint_type_colors : array_like of :obj:`float`, optional</span>
<span class="sd">        Colors of the constraints by type.</span>
<span class="sd">    constraint_type_materials : array_like of :obj:`str`, optional</span>
<span class="sd">        Materials of the constraints by type.</span>
<span class="sd">    draw_bonds : :obj:`bool`, optional</span>
<span class="sd">        Enables bond visualization.</span>
<span class="sd">    bond_type_radius : array_like of :obj:`float`, optional</span>
<span class="sd">        Radii of bonds by type.</span>
<span class="sd">    bond_type_colors : array_like of :obj:`float`, optional</span>
<span class="sd">        Color of bonds by type.</span>
<span class="sd">    bond_type_materials : array_like of :obj:`str`, optional</span>
<span class="sd">        Materials of bonds by type.</span>
<span class="sd">    ext_force_arrows : :obj:`bool`, optional</span>
<span class="sd">        Enables external force visualization.</span>
<span class="sd">    ext_force_arrows_type_scale : array_like of :obj:`float`, optional</span>
<span class="sd">        List of scale factors of external force arrows for different particle types.</span>
<span class="sd">    ext_force_arrows_type_colors : array_like of :obj:`float`, optional</span>
<span class="sd">        Colors of ext_force arrows for different particle types.</span>
<span class="sd">    ext_force_arrows_type_materials : array_like of :obj:`str`, optional</span>
<span class="sd">        Materials of ext_force arrows for different particle types.</span>
<span class="sd">    ext_force_arrows_type_radii : array_like of :obj:`float`, optional</span>
<span class="sd">        List of arrow radii for different particle types.</span>
<span class="sd">    force_arrows : :obj:`bool`, optional</span>
<span class="sd">        Enables particle force visualization.</span>
<span class="sd">    force_arrows_type_scale : array_like of :obj:`float`, optional</span>
<span class="sd">        List of scale factors of particle force arrows for different particle types.</span>
<span class="sd">    force_arrows_type_colors : array_like of :obj:`float`, optional</span>
<span class="sd">        Colors of particle force arrows for different particle types.</span>
<span class="sd">    force_arrows_type_materials : array_like of :obj:`str`, optional</span>
<span class="sd">        Materials of particle force arrows for different particle types.</span>
<span class="sd">    force_arrows_type_radii : array_like of :obj:`float`, optional</span>
<span class="sd">        List of arrow radii for different particle types.</span>
<span class="sd">    velocity_arrows : :obj:`bool`, optional</span>
<span class="sd">        Enables particle velocity visualization.</span>
<span class="sd">    velocity_arrows_type_scale : array_like of :obj:`float`, optional</span>
<span class="sd">        List of scale factors of particle velocity arrows for different particle types.</span>
<span class="sd">    velocity_arrows_type_colors : array_like of :obj:`float`, optional</span>
<span class="sd">        Colors of particle velocity arrows for different particle types.</span>
<span class="sd">    velocity_arrows_type_materials : array_like of :obj:`str`, optional</span>
<span class="sd">        Materials of particle velocity arrows for different particle types.</span>
<span class="sd">    velocity_arrows_type_radii : array_like of :obj:`float`, optional</span>
<span class="sd">        List of arrow radii for different particle types.</span>
<span class="sd">    director_arrows : :obj:`bool`, optional</span>
<span class="sd">        Enables particle director visualization.</span>
<span class="sd">    director_arrows_type_scale : :obj:`float`, optional</span>
<span class="sd">        Scale factor of particle director arrows for different particle types.</span>
<span class="sd">    director_arrows_type_colors : array_like of :obj:`float`, optional</span>
<span class="sd">        Colors of particle director arrows for different particle types.</span>
<span class="sd">    director_arrows_type_materials : array_like of :obj:`str`, optional</span>
<span class="sd">        Materials of particle director arrows for different particle types.</span>
<span class="sd">    director_arrows_type_radii : array_like of :obj:`float`, optional</span>
<span class="sd">        List of arrow radii for different particle types.</span>
<span class="sd">    drag_enabled : :obj:`bool`, optional</span>
<span class="sd">        Enables mouse-controlled particles dragging (Default: False)</span>
<span class="sd">    drag_force : :obj:`bool`, optional</span>
<span class="sd">        Factor for particle dragging</span>
<span class="sd">    LB_draw_nodes : :obj:`bool`, optional</span>
<span class="sd">        Draws a lattice representation of the LB nodes that are no boundaries.</span>
<span class="sd">    LB_draw_node_boundaries : :obj:`bool`, optional</span>
<span class="sd">        Draws a lattice representation of the LB nodes that are boundaries.</span>
<span class="sd">    LB_draw_boundaries : :obj:`bool`, optional</span>
<span class="sd">        Draws the LB shapes.</span>
<span class="sd">    LB_draw_velocity_plane : :obj:`bool`, optional</span>
<span class="sd">        Draws LB node velocity arrows in a plane perpendicular to the axis in</span>
<span class="sd">        ``LB_plane_axis``, at a distance ``LB_plane_dist`` from the origin,</span>
<span class="sd">        every ``LB_plane_ngrid`` grid points.</span>
<span class="sd">    LB_plane_axis : :obj:`int`, optional</span>
<span class="sd">        LB node velocity arrows are drawn in a plane perpendicular to the</span>
<span class="sd">        x, y, or z axes, which are encoded by values 0, 1, or 2 respectively.</span>
<span class="sd">    LB_plane_dist : :obj:`float`, optional</span>
<span class="sd">        LB node velocity arrows are drawn in a plane perpendicular to the</span>
<span class="sd">        x, y, or z axes, at a distance ``LB_plane_dist`` from the origin.</span>
<span class="sd">    LB_plane_ngrid : :obj:`int`, optional</span>
<span class="sd">        LB node velocity arrows are drawn in a plane perpendicular to the</span>
<span class="sd">        x, y, or z axes, every ``LB_plane_ngrid`` grid points.</span>
<span class="sd">    LB_vel_scale : :obj:`float`, optional</span>
<span class="sd">        Rescale LB node velocity arrow length.</span>
<span class="sd">    LB_vel_radius_scale : :obj:`float`, optional</span>
<span class="sd">        Rescale LB node velocity arrow radii.</span>
<span class="sd">    LB_arrow_color : (3,) array_like of :obj:`float`, optional</span>
<span class="sd">        RGB of the LB velocity arrows.</span>
<span class="sd">    LB_arrow_material : :obj:`str`, optional</span>
<span class="sd">        Material of LB arrows.</span>
<span class="sd">    quality_constraints : :obj:`int`, optional</span>
<span class="sd">        The number of subdivisions for LB arrows.</span>
<span class="sd">    light_pos : (3,) array_like of :obj:`float`, optional</span>
<span class="sd">        If auto (default) is used, the light is placed dynamically in</span>
<span class="sd">        the particle barycenter of the system. Otherwise, a fixed</span>
<span class="sd">        coordinate can be set.</span>
<span class="sd">    light_colors : array_like of :obj:`float`, optional</span>
<span class="sd">        Three lists to specify ambient, diffuse and specular light colors.</span>
<span class="sd">    light_brightness : :obj:`float`, optional</span>
<span class="sd">        Brightness (inverse constant attenuation) of the light.</span>
<span class="sd">    light_size : :obj:`float`, optional</span>
<span class="sd">        Size (inverse linear attenuation) of the light. If auto</span>
<span class="sd">        (default) is used, the light size will be set to a reasonable</span>
<span class="sd">        value according to the box size at start.</span>
<span class="sd">    spotlight_enabled : :obj:`bool`, optional</span>
<span class="sd">        If set to True (default), it enables a spotlight on the</span>
<span class="sd">        camera position pointing in look direction.</span>
<span class="sd">    spotlight_colors : array_like of :obj:`float`, optional</span>
<span class="sd">        Three lists to specify ambient, diffuse and specular spotlight colors.</span>
<span class="sd">    spotlight_angle : :obj:`float`, optional</span>
<span class="sd">        The spread angle of the spotlight in degrees (from 0 to 90).</span>
<span class="sd">    spotlight_brightness : :obj:`float`, optional</span>
<span class="sd">        Brightness (inverse constant attenuation) of the spotlight.</span>
<span class="sd">    spotlight_focus : :obj:`float`, optional</span>
<span class="sd">        Focus (spot exponent) for the spotlight from 0 (uniform) to 128.</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    The visualization of some constraints is either improved by or even relies</span>
<span class="sd">    on the presence of an installed OpenGL Extrusion library on your system.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">materials</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;bright&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.9</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">],</span>
        <span class="s1">&#39;medium&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.6</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">],</span>
        <span class="s1">&#39;dark&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.4</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">],</span>
        <span class="s1">&#39;transparent1&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.6</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">],</span>
        <span class="s1">&#39;transparent2&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.6</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">],</span>
        <span class="s1">&#39;transparent3&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.6</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">],</span>
        <span class="s1">&#39;rubber&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">,</span> <span class="mf">0.7</span><span class="p">,</span> <span class="mf">0.078125</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">],</span>
        <span class="s1">&#39;chrome&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.25</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">,</span> <span class="mf">0.774597</span><span class="p">,</span> <span class="mf">0.6</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">],</span>
        <span class="s1">&#39;plastic&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.55</span><span class="p">,</span> <span class="mf">0.7</span><span class="p">,</span> <span class="mf">0.25</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">],</span>
        <span class="s1">&#39;steel&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.25</span><span class="p">,</span> <span class="mf">0.38</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mf">0.32</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">]</span>
    <span class="p">}</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">system</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="c1"># default properties</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">specs</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;window_size&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">800</span><span class="p">,</span> <span class="mi">800</span><span class="p">],</span>
            <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;ESPResSo Visualization&#39;</span><span class="p">,</span>

            <span class="s1">&#39;background_color&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>

            <span class="s1">&#39;draw_fps&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
            <span class="s1">&#39;draw_box&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s1">&#39;draw_axis&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s1">&#39;draw_nodes&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
            <span class="s1">&#39;draw_cells&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>

            <span class="s1">&#39;update_fps&#39;</span><span class="p">:</span> <span class="mi">30</span><span class="p">,</span>

            <span class="s1">&#39;periodic_images&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>

            <span class="s1">&#39;quality_particles&#39;</span><span class="p">:</span> <span class="mi">20</span><span class="p">,</span>
            <span class="s1">&#39;quality_bonds&#39;</span><span class="p">:</span> <span class="mi">16</span><span class="p">,</span>
            <span class="s1">&#39;quality_arrows&#39;</span><span class="p">:</span> <span class="mi">16</span><span class="p">,</span>
            <span class="s1">&#39;quality_constraints&#39;</span><span class="p">:</span> <span class="mi">32</span><span class="p">,</span>

            <span class="s1">&#39;close_cut_distance&#39;</span><span class="p">:</span> <span class="mf">0.1</span><span class="p">,</span>
            <span class="s1">&#39;far_cut_distance&#39;</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span>

            <span class="s1">&#39;camera_position&#39;</span><span class="p">:</span> <span class="s1">&#39;auto&#39;</span><span class="p">,</span>
            <span class="s1">&#39;camera_target&#39;</span><span class="p">:</span> <span class="s1">&#39;auto&#39;</span><span class="p">,</span>
            <span class="s1">&#39;camera_right&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">],</span>

            <span class="s1">&#39;particle_coloring&#39;</span><span class="p">:</span> <span class="s1">&#39;auto&#39;</span><span class="p">,</span>
            <span class="s1">&#39;particle_sizes&#39;</span><span class="p">:</span> <span class="s1">&#39;auto&#39;</span><span class="p">,</span>
            <span class="s1">&#39;particle_type_colors&#39;</span><span class="p">:</span>
                <span class="p">[[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
                    <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mf">0.5</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]],</span>
            <span class="s1">&#39;particle_type_materials&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;medium&#39;</span><span class="p">],</span>
            <span class="s1">&#39;particle_charge_colors&#39;</span><span class="p">:</span> <span class="p">[[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]],</span>

            <span class="s1">&#39;draw_constraints&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s1">&#39;rasterize_pointsize&#39;</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span>
            <span class="s1">&#39;rasterize_resolution&#39;</span><span class="p">:</span> <span class="mf">75.0</span><span class="p">,</span>
            <span class="s1">&#39;constraint_type_colors&#39;</span><span class="p">:</span>
                <span class="p">[[</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">],</span> <span class="p">[</span><span class="mf">0.5</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">],</span>
                    <span class="p">[</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">],</span> <span class="p">[</span><span class="mf">0.5</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]],</span>
            <span class="s1">&#39;constraint_type_materials&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;transparent1&#39;</span><span class="p">],</span>

            <span class="s1">&#39;draw_bonds&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s1">&#39;bond_type_radius&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">],</span>
            <span class="s1">&#39;bond_type_colors&#39;</span><span class="p">:</span>
                <span class="p">[[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
                    <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mf">0.5</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]],</span>
            <span class="s1">&#39;bond_type_materials&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;medium&#39;</span><span class="p">],</span>

            <span class="s1">&#39;ext_force_arrows&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
            <span class="s1">&#39;ext_force_arrows_type_scale&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">1.0</span><span class="p">],</span>
            <span class="s1">&#39;ext_force_arrows_type_colors&#39;</span><span class="p">:</span>
                <span class="p">[[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
                    <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mf">0.5</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]],</span>
            <span class="s1">&#39;ext_force_arrows_type_materials&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;transparent2&#39;</span><span class="p">],</span>
            <span class="s1">&#39;ext_force_arrows_type_radii&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.2</span><span class="p">],</span>

            <span class="s1">&#39;velocity_arrows&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
            <span class="s1">&#39;velocity_arrows_type_scale&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">1.0</span><span class="p">],</span>
            <span class="s1">&#39;velocity_arrows_type_colors&#39;</span><span class="p">:</span>
                <span class="p">[[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
                    <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mf">0.5</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]],</span>
            <span class="s1">&#39;velocity_arrows_type_materials&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;transparent2&#39;</span><span class="p">],</span>
            <span class="s1">&#39;velocity_arrows_type_radii&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.2</span><span class="p">],</span>

            <span class="s1">&#39;force_arrows&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
            <span class="s1">&#39;force_arrows_type_scale&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">1.0</span><span class="p">],</span>
            <span class="s1">&#39;force_arrows_type_colors&#39;</span><span class="p">:</span>
                <span class="p">[[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
                    <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mf">0.5</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]],</span>
            <span class="s1">&#39;force_arrows_type_materials&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;transparent2&#39;</span><span class="p">],</span>
            <span class="s1">&#39;force_arrows_type_radii&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.2</span><span class="p">],</span>

            <span class="s1">&#39;director_arrows&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
            <span class="s1">&#39;director_arrows_type_scale&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">1.0</span><span class="p">],</span>
            <span class="s1">&#39;director_arrows_type_colors&#39;</span><span class="p">:</span>
                <span class="p">[[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
                    <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mf">0.5</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]],</span>
            <span class="s1">&#39;director_arrows_type_materials&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;transparent2&#39;</span><span class="p">],</span>
            <span class="s1">&#39;director_arrows_type_radii&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.2</span><span class="p">],</span>

            <span class="s1">&#39;LB_draw_nodes&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
            <span class="s1">&#39;LB_draw_node_boundaries&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
            <span class="s1">&#39;LB_draw_boundaries&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>

            <span class="s1">&#39;LB_draw_velocity_plane&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
            <span class="s1">&#39;LB_plane_axis&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
            <span class="s1">&#39;LB_plane_dist&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
            <span class="s1">&#39;LB_plane_ngrid&#39;</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span>
            <span class="s1">&#39;LB_vel_scale&#39;</span><span class="p">:</span> <span class="mf">1.0</span><span class="p">,</span>
            <span class="s1">&#39;LB_vel_radius_scale&#39;</span><span class="p">:</span> <span class="mf">0.005</span><span class="p">,</span>
            <span class="s1">&#39;LB_arrow_color&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">],</span>
            <span class="s1">&#39;LB_arrow_material&#39;</span><span class="p">:</span> <span class="s1">&#39;transparent1&#39;</span><span class="p">,</span>
            <span class="s1">&#39;LB_arrow_quality&#39;</span><span class="p">:</span> <span class="mi">16</span><span class="p">,</span>

            <span class="s1">&#39;light_pos&#39;</span><span class="p">:</span> <span class="s1">&#39;auto&#39;</span><span class="p">,</span>
            <span class="s1">&#39;light_colors&#39;</span><span class="p">:</span>
                <span class="p">[[</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">],</span> <span class="p">[</span><span class="mf">0.9</span><span class="p">,</span> <span class="mf">0.9</span><span class="p">,</span> <span class="mf">0.9</span><span class="p">],</span> <span class="p">[</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">]],</span>
            <span class="s1">&#39;light_brightness&#39;</span><span class="p">:</span> <span class="mf">1.0</span><span class="p">,</span>
            <span class="s1">&#39;light_size&#39;</span><span class="p">:</span> <span class="s1">&#39;auto&#39;</span><span class="p">,</span>

            <span class="s1">&#39;spotlight_enabled&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
            <span class="s1">&#39;spotlight_colors&#39;</span><span class="p">:</span>
                <span class="p">[[</span><span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">],</span> <span class="p">[</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">],</span> <span class="p">[</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">]],</span>
            <span class="s1">&#39;spotlight_angle&#39;</span><span class="p">:</span> <span class="mi">45</span><span class="p">,</span>
            <span class="s1">&#39;spotlight_focus&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
            <span class="s1">&#39;spotlight_brightness&#39;</span><span class="p">:</span> <span class="mf">0.6</span><span class="p">,</span>

            <span class="s1">&#39;drag_enabled&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
            <span class="s1">&#39;drag_force&#39;</span><span class="p">:</span> <span class="mf">3.0</span>
        <span class="p">}</span>

        <span class="c1"># overwrite with user properties</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">specs</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">f</span><span class="s1">&#39;</span><span class="si">{key}</span><span class="s1"> is no valid visualization property&#39;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">specs</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>

        <span class="c1"># dependencies</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">espressomd</span><span class="o">.</span><span class="n">has_features</span><span class="p">(</span><span class="s1">&#39;EXTERNAL_FORCES&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">specs</span><span class="p">[</span><span class="s1">&#39;drag_enabled&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">specs</span><span class="p">[</span><span class="s1">&#39;ext_force_arrows&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">espressomd</span><span class="o">.</span><span class="n">has_features</span><span class="p">(</span><span class="s1">&#39;ROTATION&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">specs</span><span class="p">[</span><span class="s1">&#39;director_arrows&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">espressomd</span><span class="o">.</span><span class="n">has_features</span><span class="p">(</span><span class="s1">&#39;LB_BOUNDARIES&#39;</span><span class="p">)</span> <span class="ow">and</span> \
                <span class="ow">not</span> <span class="n">espressomd</span><span class="o">.</span><span class="n">has_features</span><span class="p">(</span><span class="s1">&#39;LB_BOUNDARIES_GPU&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">specs</span><span class="p">[</span><span class="s1">&#39;LB_draw_boundaries&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">specs</span><span class="p">[</span><span class="s1">&#39;LB_draw_node_boundaries&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="c1"># ESPResSo-related inits that are known only when running the</span>
        <span class="c1"># integration loop are called once in the update loop</span>
        <span class="c1"># (constraints, node boxes, cell boxes, charge range, bonds)</span>

        <span class="c1"># ESPResSo-related inits that are known on instantiation go here:</span>

        <span class="c1"># content of particle data</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">has_particle_data</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;velocity&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">specs</span><span class="p">[</span><span class="s1">&#39;velocity_arrows&#39;</span><span class="p">],</span>
            <span class="s1">&#39;force&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">specs</span><span class="p">[</span><span class="s1">&#39;force_arrows&#39;</span><span class="p">],</span>
            <span class="s1">&#39;ext_force&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">specs</span><span class="p">[</span><span class="s1">&#39;ext_force_arrows&#39;</span><span class="p">]</span> <span class="ow">or</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">specs</span><span class="p">[</span><span class="s1">&#39;drag_enabled&#39;</span><span class="p">]}</span>

        <span class="k">if</span> <span class="n">espressomd</span><span class="o">.</span><span class="n">has_features</span><span class="p">(</span><span class="s1">&#39;ELECTROSTATICS&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">has_particle_data</span><span class="p">[</span><span class="s1">&#39;charge&#39;</span><span class="p">]</span> <span class="o">=</span> \
                <span class="bp">self</span><span class="o">.</span><span class="n">specs</span><span class="p">[</span><span class="s1">&#39;particle_coloring&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;auto&#39;</span> <span class="ow">or</span> \
                <span class="bp">self</span><span class="o">.</span><span class="n">specs</span><span class="p">[</span><span class="s1">&#39;particle_coloring&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;charge&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">has_particle_data</span><span class="p">[</span><span class="s1">&#39;charge&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">has_particle_data</span><span class="p">[</span><span class="s1">&#39;director&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">specs</span><span class="p">[</span><span class="s1">&#39;director_arrows&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">has_particle_data</span><span class="p">[</span><span class="s1">&#39;node&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">specs</span><span class="p">[</span><span class="s1">&#39;particle_coloring&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;node&#39;</span>

        <span class="c1"># particle info of highlighted particle: collect particle attributes</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">highlighted_particle</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">particle_attributes</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="nb">dir</span><span class="p">(</span><span class="n">espressomd</span><span class="o">.</span><span class="n">particle_data</span><span class="o">.</span><span class="n">ParticleHandle</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="n">espressomd</span><span class="o">.</span><span class="n">particle_data</span><span class="o">.</span><span class="n">ParticleHandle</span><span class="p">,</span> <span class="n">d</span><span class="p">),</span>
                          <span class="nb">type</span><span class="p">(</span><span class="n">espressomd</span><span class="o">.</span><span class="n">particle_data</span><span class="o">.</span><span class="n">ParticleHandle</span><span class="o">.</span><span class="n">pos</span><span class="p">)):</span>
                <span class="k">if</span> <span class="n">d</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;pos_folded&quot;</span><span class="p">]:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">particle_attributes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">max_len_attr</span> <span class="o">=</span> <span class="nb">max</span><span class="p">([</span><span class="nb">len</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">particle_attributes</span><span class="p">])</span>

        <span class="c1"># fixed colors from inverse background color for good contrast</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">inverse_bg_color</span> <span class="o">=</span> \
            <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">specs</span><span class="p">[</span><span class="s1">&#39;background_color&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span>
                      <span class="mi">1</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">specs</span><span class="p">[</span><span class="s1">&#39;background_color&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span>
                      <span class="mi">1</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">specs</span><span class="p">[</span><span class="s1">&#39;background_color&#39;</span><span class="p">][</span><span class="mi">2</span><span class="p">],</span> <span class="mf">1.0</span><span class="p">])</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">node_box_color</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">inverse_bg_color</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">node_box_color</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="mf">0.5</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">node_box_color</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">cell_box_color</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">inverse_bg_color</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cell_box_color</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="mf">0.5</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">cell_box_color</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">lb_box_color</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">inverse_bg_color</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lb_box_color</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.5</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">lb_box_color_boundary</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">inverse_bg_color</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lb_box_color_boundary</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.5</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">text_color</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">inverse_bg_color</span><span class="p">)</span>

        <span class="c1"># increase line thickness if node/cell box is enabled</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">line_width_fac</span> <span class="o">=</span> <span class="mf">1.0</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">specs</span><span class="p">[</span><span class="s1">&#39;draw_nodes&#39;</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">line_width_fac</span> <span class="o">+=</span> <span class="mf">0.5</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">specs</span><span class="p">[</span><span class="s1">&#39;draw_cells&#39;</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">line_width_fac</span> <span class="o">+=</span> <span class="mf">0.5</span>

        <span class="c1"># has periodic images</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">has_images</span> <span class="o">=</span> <span class="nb">any</span><span class="p">(</span><span class="n">i</span> <span class="o">!=</span> <span class="mi">0</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">specs</span><span class="p">[</span><span class="s1">&#39;periodic_images&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">image_vectors</span> <span class="o">=</span> <span class="p">[</span>
            <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="o">-</span><span class="n">i</span><span class="p">,</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">specs</span><span class="p">[</span><span class="s1">&#39;periodic_images&#39;</span><span class="p">]]</span>

        <span class="c1"># various inits</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">system</span> <span class="o">=</span> <span class="n">system</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">system_info</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">last_box_l</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">system</span><span class="o">.</span><span class="n">box_l</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fps_last</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fps</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fps_count</span> <span class="o">=</span> <span class="mi">1</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">glut_main_loop_started</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">screenshot_initialized</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">hasParticleData</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">quit_safely</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">paused</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">take_screenshot</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">screenshot_captured</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">keyboard_manager</span> <span class="o">=</span> <span class="n">KeyboardManager</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mouse_manager</span> <span class="o">=</span> <span class="n">MouseManager</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">camera</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_init_camera</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">timers</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">particles</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="c1"># times of last call of update(), redraw_on_idle()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">last_update</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">last_draw</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">trigger_set_particle_drag</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">trigger_reset_particle_drag</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">drag_id</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>

        <span class="c1"># list of [(x, y), string] for user-defined text</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">user_texts</span> <span class="o">=</span> <span class="p">[]</span>

<div class="viewcode-block" id="openGLLive.update_system_info"><a class="viewcode-back" href="../../espressomd.html#espressomd.visualization.openGLLive.update_system_info">[docs]</a>    <span class="k">def</span> <span class="nf">update_system_info</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Update the information stored in dict self.system_info.</span>

<span class="sd">        The dictionary is used for showing system information, such as particle</span>
<span class="sd">        or constraint information, in the visualizer window.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># collect system information</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">system_info</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;Actors&#39;</span><span class="p">:</span> <span class="p">[],</span> <span class="s1">&#39;Non-bonded interactions&#39;</span><span class="p">:</span> <span class="p">[],</span>
            <span class="s1">&#39;Bonded interactions&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">b</span> <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">system</span><span class="o">.</span><span class="n">bonded_inter</span><span class="p">],</span>
            <span class="s1">&#39;Constraints&#39;</span><span class="p">:</span> <span class="p">[],</span> <span class="s1">&#39;Thermostat&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">system</span><span class="o">.</span><span class="n">thermostat</span><span class="o">.</span><span class="n">get_state</span><span class="p">()</span>
        <span class="p">}</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">system_info</span><span class="p">[</span><span class="s1">&#39;Bonded interactions&#39;</span><span class="p">])</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">system_info</span><span class="p">[</span><span class="s1">&#39;Bonded interactions&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;None&#39;</span><span class="p">)</span>

        <span class="c1"># collect all actors</span>
        <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">system</span><span class="o">.</span><span class="n">actors</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">system_info</span><span class="p">[</span><span class="s1">&#39;Actors&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">a</span><span class="p">))</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">system_info</span><span class="p">[</span><span class="s1">&#39;Actors&#39;</span><span class="p">])</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">system_info</span><span class="p">[</span><span class="s1">&#39;Actors&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;None&#39;</span><span class="p">)</span>

        <span class="c1"># collect all types from particles and constraints</span>
        <span class="n">all_types</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">system</span><span class="o">.</span><span class="n">part</span><span class="o">.</span><span class="n">all</span><span class="p">()</span><span class="o">.</span><span class="n">type</span><span class="p">)</span>
        <span class="n">constraint_types</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">system</span><span class="o">.</span><span class="n">constraints</span><span class="p">[:]:</span>
            <span class="n">constraint_types</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">get_parameter</span><span class="p">(</span><span class="s1">&#39;particle_type&#39;</span><span class="p">))</span>
        <span class="n">all_types</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">constraint_types</span><span class="p">)</span>

        <span class="c1"># collect all active non-bonded interactions</span>
        <span class="n">all_non_bonded_inters</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">dir</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">system</span><span class="o">.</span><span class="n">non_bonded_inter</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">x</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;__&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">x</span> <span class="o">!=</span> <span class="s1">&#39;type1&#39;</span> <span class="ow">and</span> <span class="n">x</span> <span class="o">!=</span> <span class="s1">&#39;type2&#39;</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">t1</span> <span class="ow">in</span> <span class="n">all_types</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">t2</span> <span class="ow">in</span> <span class="n">all_types</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">check_nb</span> <span class="ow">in</span> <span class="n">all_non_bonded_inters</span><span class="p">:</span>
                    <span class="n">nb</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">system</span><span class="o">.</span><span class="n">non_bonded_inter</span><span class="p">[</span><span class="n">t1</span><span class="p">,</span> <span class="n">t2</span><span class="p">],</span> <span class="n">check_nb</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">nb</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">nb</span><span class="o">.</span><span class="n">is_active</span><span class="p">():</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">system_info</span><span class="p">[</span><span class="s1">&#39;Non-bonded interactions&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                            <span class="p">[</span><span class="n">t1</span><span class="p">,</span> <span class="n">t2</span><span class="p">,</span> <span class="n">nb</span><span class="o">.</span><span class="n">type_name</span><span class="p">(),</span> <span class="n">nb</span><span class="o">.</span><span class="n">get_params</span><span class="p">()])</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">system_info</span><span class="p">[</span><span class="s1">&#39;Non-bonded interactions&#39;</span><span class="p">])</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">system_info</span><span class="p">[</span><span class="s1">&#39;Non-bonded interactions&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;None&#39;</span><span class="p">)</span>

        <span class="c1"># collect constraints</span>
        <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">system</span><span class="o">.</span><span class="n">constraints</span><span class="p">[:]:</span>
            <span class="n">co</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">get_params</span><span class="p">()</span>
            <span class="n">co_s</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">get_parameter</span><span class="p">(</span><span class="s1">&#39;shape&#39;</span><span class="p">)</span>
            <span class="n">co</span><span class="p">[</span><span class="s1">&#39;shape&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">co_s</span><span class="o">.</span><span class="n">name</span><span class="p">(),</span> <span class="n">co_s</span><span class="o">.</span><span class="n">get_params</span><span class="p">()]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">system_info</span><span class="p">[</span><span class="s1">&#39;Constraints&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">co</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">system_info</span><span class="p">[</span><span class="s1">&#39;Constraints&#39;</span><span class="p">])</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">system_info</span><span class="p">[</span><span class="s1">&#39;Constraints&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;None&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="openGLLive.register_callback"><a class="viewcode-back" href="../../espressomd.html#espressomd.visualization.openGLLive.register_callback">[docs]</a>    <span class="k">def</span> <span class="nf">register_callback</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cb</span><span class="p">,</span> <span class="n">interval</span><span class="o">=</span><span class="mi">1000</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Register timed callbacks.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">timers</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="nb">int</span><span class="p">(</span><span class="n">interval</span><span class="p">),</span> <span class="n">cb</span><span class="p">))</span></div>

<div class="viewcode-block" id="openGLLive.screenshot"><a class="viewcode-back" href="../../espressomd.html#espressomd.visualization.openGLLive.screenshot">[docs]</a>    <span class="k">def</span> <span class="nf">screenshot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Renders the current state into an image file at ``path`` with</span>
<span class="sd">        dimensions of ``specs[&#39;window_size&#39;]`` in PNG format.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># on first call: init and create buffers</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">screenshot_initialized</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">screenshot_initialized</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_init_opengl</span><span class="p">()</span>

            <span class="c1"># create buffers that can be larger than the screen frame buffer</span>
            <span class="n">fbo</span> <span class="o">=</span> <span class="n">OpenGL</span><span class="o">.</span><span class="n">GL</span><span class="o">.</span><span class="n">glGenFramebuffers</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">OpenGL</span><span class="o">.</span><span class="n">GL</span><span class="o">.</span><span class="n">glBindFramebuffer</span><span class="p">(</span><span class="n">OpenGL</span><span class="o">.</span><span class="n">GL</span><span class="o">.</span><span class="n">GL_FRAMEBUFFER</span><span class="p">,</span> <span class="n">fbo</span><span class="p">)</span>
            <span class="c1"># color buffer</span>
            <span class="n">rbo</span> <span class="o">=</span> <span class="n">OpenGL</span><span class="o">.</span><span class="n">GL</span><span class="o">.</span><span class="n">glGenRenderbuffers</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">OpenGL</span><span class="o">.</span><span class="n">GL</span><span class="o">.</span><span class="n">glBindRenderbuffer</span><span class="p">(</span><span class="n">OpenGL</span><span class="o">.</span><span class="n">GL</span><span class="o">.</span><span class="n">GL_RENDERBUFFER</span><span class="p">,</span> <span class="n">rbo</span><span class="p">)</span>
            <span class="n">OpenGL</span><span class="o">.</span><span class="n">GL</span><span class="o">.</span><span class="n">glRenderbufferStorage</span><span class="p">(</span>
                <span class="n">OpenGL</span><span class="o">.</span><span class="n">GL</span><span class="o">.</span><span class="n">GL_RENDERBUFFER</span><span class="p">,</span>
                <span class="n">OpenGL</span><span class="o">.</span><span class="n">GL</span><span class="o">.</span><span class="n">GL_RGB</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">specs</span><span class="p">[</span><span class="s1">&#39;window_size&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">specs</span><span class="p">[</span><span class="s1">&#39;window_size&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">OpenGL</span><span class="o">.</span><span class="n">GL</span><span class="o">.</span><span class="n">glFramebufferRenderbuffer</span><span class="p">(</span>
                <span class="n">OpenGL</span><span class="o">.</span><span class="n">GL</span><span class="o">.</span><span class="n">GL_FRAMEBUFFER</span><span class="p">,</span>
                <span class="n">OpenGL</span><span class="o">.</span><span class="n">GL</span><span class="o">.</span><span class="n">GL_COLOR_ATTACHMENT0</span><span class="p">,</span>
                <span class="n">OpenGL</span><span class="o">.</span><span class="n">GL</span><span class="o">.</span><span class="n">GL_RENDERBUFFER</span><span class="p">,</span>
                <span class="n">rbo</span><span class="p">)</span>
            <span class="c1"># depth buffer</span>
            <span class="n">dbo</span> <span class="o">=</span> <span class="n">OpenGL</span><span class="o">.</span><span class="n">GL</span><span class="o">.</span><span class="n">glGenRenderbuffers</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">OpenGL</span><span class="o">.</span><span class="n">GL</span><span class="o">.</span><span class="n">glBindRenderbuffer</span><span class="p">(</span><span class="n">OpenGL</span><span class="o">.</span><span class="n">GL</span><span class="o">.</span><span class="n">GL_RENDERBUFFER</span><span class="p">,</span> <span class="n">dbo</span><span class="p">)</span>
            <span class="n">OpenGL</span><span class="o">.</span><span class="n">GL</span><span class="o">.</span><span class="n">glRenderbufferStorage</span><span class="p">(</span>
                <span class="n">OpenGL</span><span class="o">.</span><span class="n">GL</span><span class="o">.</span><span class="n">GL_RENDERBUFFER</span><span class="p">,</span> <span class="n">OpenGL</span><span class="o">.</span><span class="n">GL</span><span class="o">.</span><span class="n">GL_DEPTH_COMPONENT</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">specs</span><span class="p">[</span><span class="s1">&#39;window_size&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">specs</span><span class="p">[</span><span class="s1">&#39;window_size&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">OpenGL</span><span class="o">.</span><span class="n">GL</span><span class="o">.</span><span class="n">glFramebufferRenderbuffer</span><span class="p">(</span>
                <span class="n">OpenGL</span><span class="o">.</span><span class="n">GL</span><span class="o">.</span><span class="n">GL_FRAMEBUFFER</span><span class="p">,</span>
                <span class="n">OpenGL</span><span class="o">.</span><span class="n">GL</span><span class="o">.</span><span class="n">GL_DEPTH_ATTACHMENT</span><span class="p">,</span>
                <span class="n">OpenGL</span><span class="o">.</span><span class="n">GL</span><span class="o">.</span><span class="n">GL_RENDERBUFFER</span><span class="p">,</span>
                <span class="n">dbo</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">_reshape_window</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">specs</span><span class="p">[</span><span class="s1">&#39;window_size&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">specs</span><span class="p">[</span><span class="s1">&#39;window_size&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">OpenGL</span><span class="o">.</span><span class="n">GLUT</span><span class="o">.</span><span class="n">glutHideWindow</span><span class="p">()</span>

        <span class="c1"># initialize properties that depend on the ESPResSo system</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_init_espresso_visualization</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_initial_espresso_updates</span><span class="p">()</span>

        <span class="c1"># draw the simulation box</span>
        <span class="n">OpenGL</span><span class="o">.</span><span class="n">GL</span><span class="o">.</span><span class="n">glClear</span><span class="p">(</span>
            <span class="n">OpenGL</span><span class="o">.</span><span class="n">GL</span><span class="o">.</span><span class="n">GL_COLOR_BUFFER_BIT</span> <span class="o">|</span> <span class="n">OpenGL</span><span class="o">.</span><span class="n">GL</span><span class="o">.</span><span class="n">GL_DEPTH_BUFFER_BIT</span><span class="p">)</span>
        <span class="n">OpenGL</span><span class="o">.</span><span class="n">GL</span><span class="o">.</span><span class="n">glLoadMatrixf</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">camera</span><span class="o">.</span><span class="n">modelview</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_draw_system</span><span class="p">()</span>

        <span class="c1"># read the pixels</span>
        <span class="n">OpenGL</span><span class="o">.</span><span class="n">GL</span><span class="o">.</span><span class="n">glReadBuffer</span><span class="p">(</span><span class="n">OpenGL</span><span class="o">.</span><span class="n">GL</span><span class="o">.</span><span class="n">GL_COLOR_ATTACHMENT0</span><span class="p">)</span>

        <span class="c1"># save image</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_make_screenshot</span><span class="p">(</span><span class="n">path</span><span class="p">)</span></div>

<div class="viewcode-block" id="openGLLive.run"><a class="viewcode-back" href="../../espressomd.html#espressomd.visualization.openGLLive.run">[docs]</a>    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">integration_steps</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Convenience method with a simple integration thread.</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
            <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">update</span><span class="p">()</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">paused</span><span class="p">:</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">system</span><span class="o">.</span><span class="n">integrator</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">integration_steps</span><span class="p">)</span>
                    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                        <span class="nb">print</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
                        <span class="n">os</span><span class="o">.</span><span class="n">_exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

                <span class="c1"># Necessary to regularly drop the Global Interpreter Lock (GIL)</span>
                <span class="c1"># which prevents freezing of the visualizer under certain</span>
                <span class="c1"># circumstances (see Issue #3764).</span>
                <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">1e-12</span><span class="p">)</span>

        <span class="n">t</span> <span class="o">=</span> <span class="n">threading</span><span class="o">.</span><span class="n">Thread</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="n">main</span><span class="p">)</span>
        <span class="n">t</span><span class="o">.</span><span class="n">daemon</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">t</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">start</span><span class="p">()</span></div>

<div class="viewcode-block" id="openGLLive.start"><a class="viewcode-back" href="../../espressomd.html#espressomd.visualization.openGLLive.start">[docs]</a>    <span class="k">def</span> <span class="nf">start</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;The blocking start method.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_init_opengl</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_init_espresso_visualization</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_init_controls</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_init_OpenGL_callbacks</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_init_timers</span><span class="p">()</span>

        <span class="c1"># start the blocking main loop</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">glut_main_loop_started</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">OpenGL</span><span class="o">.</span><span class="n">GLUT</span><span class="o">.</span><span class="n">glutMainLoop</span><span class="p">()</span></div>

<div class="viewcode-block" id="openGLLive.update"><a class="viewcode-back" href="../../espressomd.html#espressomd.visualization.openGLLive.update">[docs]</a>    <span class="k">def</span> <span class="nf">update</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Update method to be called after integration.</span>
<span class="sd">        Changes of ESPResSo system can only happen here.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">glut_main_loop_started</span><span class="p">:</span>

            <span class="c1"># update on startup</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">hasParticleData</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_initial_espresso_updates</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">hasParticleData</span> <span class="o">=</span> <span class="kc">True</span>

            <span class="c1"># updates</span>
            <span class="n">refresh_time</span> <span class="o">=</span> <span class="mf">1.</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">specs</span><span class="p">[</span><span class="s1">&#39;update_fps&#39;</span><span class="p">]</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">last_update</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">refresh_time</span><span class="p">:</span>
                <span class="c1"># update particle/bond data after system propagation,</span>
                <span class="c1"># or on pause to display particle info</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_update_particles_and_bonds</span><span class="p">()</span>

                <span class="c1"># LB update</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">specs</span><span class="p">[</span><span class="s1">&#39;LB_draw_velocity_plane&#39;</span><span class="p">]:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_update_lb_velocity_plane</span><span class="p">()</span>

                <span class="c1"># box_l changed</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">last_box_l</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">system</span><span class="o">.</span><span class="n">box_l</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">():</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">last_box_l</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">system</span><span class="o">.</span><span class="n">box_l</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_box_size_dependence</span><span class="p">()</span>

                <span class="c1"># keyboard callbacks may change ESPResSo system properties,</span>
                <span class="c1"># only safe to change here</span>
                <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">keyboard_manager</span><span class="o">.</span><span class="n">userCallbackStack</span><span class="p">:</span>
                    <span class="n">c</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">keyboard_manager</span><span class="o">.</span><span class="n">userCallbackStack</span> <span class="o">=</span> <span class="p">[]</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">last_update</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>

            <span class="c1"># drag particles</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">specs</span><span class="p">[</span><span class="s1">&#39;drag_enabled&#39;</span><span class="p">]:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">trigger_set_particle_drag</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">drag_id</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">system</span><span class="o">.</span><span class="n">part</span><span class="o">.</span><span class="n">by_id</span><span class="p">(</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">drag_id</span><span class="p">)</span><span class="o">.</span><span class="n">ext_force</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dragExtForce</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">trigger_set_particle_drag</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">trigger_reset_particle_drag</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">drag_id</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">system</span><span class="o">.</span><span class="n">part</span><span class="o">.</span><span class="n">by_id</span><span class="p">(</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">drag_id</span><span class="p">)</span><span class="o">.</span><span class="n">ext_force</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">extForceOld</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">trigger_reset_particle_drag</span> <span class="o">=</span> <span class="kc">False</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">drag_id</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>

        <span class="c1"># &lt;escape&gt; key was pressed: wait for ESPResSo to complete current task,</span>
        <span class="c1"># then call sys exit from main thread</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">quit_safely</span><span class="p">:</span>
            <span class="n">os</span><span class="o">.</span><span class="n">_exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span></div>

    <span class="c1"># fetch data on startup</span>
    <span class="k">def</span> <span class="nf">_initial_espresso_updates</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_update_particles_and_bonds</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">has_particle_data</span><span class="p">[</span><span class="s1">&#39;charge&#39;</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_update_charge_color_range</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">specs</span><span class="p">[</span><span class="s1">&#39;draw_constraints&#39;</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_update_constraints</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">specs</span><span class="p">[</span><span class="s1">&#39;draw_cells&#39;</span><span class="p">]</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">specs</span><span class="p">[</span><span class="s1">&#39;draw_nodes&#39;</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_update_nodes</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">specs</span><span class="p">[</span><span class="s1">&#39;draw_cells&#39;</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_update_cells</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_update_particles_and_bonds</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Fetch particle data from core and put it in the data dicts</span>
<span class="sd">        used by the visualizer.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">parts_from_core</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">system</span><span class="o">.</span><span class="n">part</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_update_particles</span><span class="p">(</span><span class="n">parts_from_core</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_update_bonds</span><span class="p">(</span><span class="n">parts_from_core</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_update_particles</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">particle_data</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Updates particle data used for drawing particles.</span>
<span class="sd">        Do not call directly but use _update_particles_and_bonds()!</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">particles</span><span class="p">[</span><span class="s1">&#39;pos&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">particle_data</span><span class="o">.</span><span class="n">pos_folded</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">particles</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">particle_data</span><span class="o">.</span><span class="n">type</span>
        <span class="c1"># particle ids can be discontiguous, therefore create a dict that maps</span>
        <span class="c1"># particle ids to respective index in data arrays (used by</span>
        <span class="c1"># _draw_bonds())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">index_from_id</span> <span class="o">=</span> <span class="p">{</span>
            <span class="nb">id</span><span class="p">:</span> <span class="n">ndx</span> <span class="k">for</span> <span class="n">ndx</span><span class="p">,</span> <span class="nb">id</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span>
                <span class="n">particle_data</span><span class="o">.</span><span class="n">id</span><span class="p">)}</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">has_particle_data</span><span class="p">[</span><span class="s1">&#39;velocity&#39;</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">particles</span><span class="p">[</span><span class="s1">&#39;velocity&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">particle_data</span><span class="o">.</span><span class="n">v</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">has_particle_data</span><span class="p">[</span><span class="s1">&#39;force&#39;</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">particles</span><span class="p">[</span><span class="s1">&#39;force&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">particle_data</span><span class="o">.</span><span class="n">f</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">has_particle_data</span><span class="p">[</span><span class="s1">&#39;ext_force&#39;</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">particles</span><span class="p">[</span><span class="s1">&#39;ext_force&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">particle_data</span><span class="o">.</span><span class="n">ext_force</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">has_particle_data</span><span class="p">[</span><span class="s1">&#39;charge&#39;</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">particles</span><span class="p">[</span><span class="s1">&#39;charge&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">particle_data</span><span class="o">.</span><span class="n">q</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">has_particle_data</span><span class="p">[</span><span class="s1">&#39;director&#39;</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">particles</span><span class="p">[</span><span class="s1">&#39;director&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">particle_data</span><span class="o">.</span><span class="n">director</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">has_particle_data</span><span class="p">[</span><span class="s1">&#39;node&#39;</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">particles</span><span class="p">[</span><span class="s1">&#39;node&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">particle_data</span><span class="o">.</span><span class="n">node</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">info_id</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
            <span class="c1"># data array index of particle with id info_id</span>
            <span class="n">info_index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">index_from_id</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">info_id</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">attr</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">particle_attributes</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">highlighted_particle</span><span class="p">[</span><span class="n">attr</span><span class="p">]</span> <span class="o">=</span> \
                    <span class="nb">getattr</span><span class="p">(</span><span class="n">particle_data</span><span class="p">,</span> <span class="n">attr</span><span class="p">)[</span><span class="n">info_index</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">_update_lb_velocity_plane</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">lb_is_cpu</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_update_lb_velocity_plane_cpu</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_update_lb_velocity_plane_gpu</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_update_lb_velocity_plane_cpu</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">agrid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lb_params</span><span class="p">[</span><span class="s1">&#39;agrid&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lb_plane_vel</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">ng</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">specs</span><span class="p">[</span><span class="s1">&#39;LB_plane_ngrid&#39;</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">xi</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">ng</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">xj</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">ng</span><span class="p">):</span>
                <span class="n">pp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">lb_plane_p</span> <span class="o">+</span> <span class="n">xi</span> <span class="o">*</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="n">ng</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">lb_plane_b1</span> <span class="o">+</span>
                              <span class="n">xj</span> <span class="o">*</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="n">ng</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">lb_plane_b2</span><span class="p">)</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">system</span><span class="o">.</span><span class="n">box_l</span><span class="p">)</span>
                <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span> <span class="o">=</span> <span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">ppp</span> <span class="o">/</span> <span class="n">agrid</span><span class="p">)</span> <span class="k">for</span> <span class="n">ppp</span> <span class="ow">in</span> <span class="n">pp</span><span class="p">)</span>
                <span class="n">lb_vel</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lb</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">velocity</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lb_plane_vel</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">pp</span><span class="p">,</span> <span class="n">lb_vel</span><span class="p">])</span>

    <span class="k">def</span> <span class="nf">_update_lb_velocity_plane_gpu</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">ng</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">specs</span><span class="p">[</span><span class="s1">&#39;LB_plane_ngrid&#39;</span><span class="p">]</span>
        <span class="n">col_pos</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">xi</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">ng</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">xj</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">ng</span><span class="p">):</span>
                <span class="n">p</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">lb_plane_p</span> <span class="o">+</span> <span class="n">xi</span> <span class="o">*</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="n">ng</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">lb_plane_b1</span> <span class="o">+</span>
                              <span class="n">xj</span> <span class="o">*</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="n">ng</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">lb_plane_b2</span><span class="p">)</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">system</span><span class="o">.</span><span class="n">box_l</span><span class="p">)</span>
                <span class="n">col_pos</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>

        <span class="n">lb_vels</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lb</span><span class="o">.</span><span class="n">get_interpolated_fluid_velocity_at_positions</span><span class="p">(</span>
            <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">col_pos</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lb_plane_vel</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">p</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">col_pos</span><span class="p">,</span> <span class="n">lb_vels</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lb_plane_vel</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">p</span><span class="p">,</span> <span class="n">v</span><span class="p">])</span>

    <span class="k">def</span> <span class="nf">_update_cells</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cell_box_origins</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">cell_system_state</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">system</span><span class="o">.</span><span class="n">cell_system</span><span class="o">.</span><span class="n">get_state</span><span class="p">()</span>
        <span class="c1"># Not all particle decompositions have a cell grid, if</span>
        <span class="c1"># it does not exist in the cell system state, we just</span>
        <span class="c1"># ignore it</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cell_size</span> <span class="o">=</span> <span class="n">cell_system_state</span><span class="p">[</span><span class="s1">&#39;cell_size&#39;</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">cell_system_state</span><span class="p">[</span><span class="s1">&#39;cell_grid&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]):</span>
                <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">cell_system_state</span><span class="p">[</span><span class="s1">&#39;cell_grid&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]):</span>
                    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">cell_system_state</span><span class="p">[</span><span class="s1">&#39;cell_grid&#39;</span><span class="p">][</span><span class="mi">2</span><span class="p">]):</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">cell_box_origins</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                            <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">])</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">cell_size</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">_update_nodes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">node_box_origins</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">local_box_l</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">system</span><span class="o">.</span><span class="n">cell_system</span><span class="o">.</span><span class="n">node_grid</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">system</span><span class="o">.</span><span class="n">cell_system</span><span class="o">.</span><span class="n">node_grid</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
                <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">system</span><span class="o">.</span><span class="n">cell_system</span><span class="o">.</span><span class="n">node_grid</span><span class="p">[</span><span class="mi">2</span><span class="p">]):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">node_box_origins</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                        <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">])</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">local_box_l</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_update_constraints</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Collect shapes and interaction type (for coloring) from constraints</span>
<span class="sd">        and update the list self.shapes with instances of the respective Shape</span>
<span class="sd">        (or child) classes.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">shapes</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c1"># helper functions and shape dictionary</span>
        <span class="k">def</span> <span class="nf">unpack_shapes</span><span class="p">(</span><span class="n">shapes_list</span><span class="p">):</span>
            <span class="sd">&quot;&quot;&quot;Return a list of shapes, where all unions have been unpacked.</span>

<span class="sd">            &quot;&quot;&quot;</span>
            <span class="n">shapes</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="c1"># recursively unpack unions</span>
                <span class="k">for</span> <span class="n">shape</span> <span class="ow">in</span> <span class="n">shapes_list</span><span class="p">:</span>
                    <span class="n">shapes</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">unpack_shapes</span><span class="p">(</span><span class="n">shape</span><span class="p">))</span>
            <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
                <span class="c1"># otherwise just append the shape</span>
                <span class="n">shapes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">shapes_list</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">shapes</span>

        <span class="k">def</span> <span class="nf">shape_arguments</span><span class="p">(</span><span class="n">shape</span><span class="p">,</span> <span class="n">part_type</span><span class="p">):</span>
            <span class="sd">&quot;&quot;&quot;Helper function returning argument list for initialization of</span>
<span class="sd">            Shape class (or respective child classes).</span>

<span class="sd">            &quot;&quot;&quot;</span>
            <span class="n">arguments</span> <span class="o">=</span> <span class="p">[</span>
                <span class="n">shape</span><span class="p">,</span> <span class="n">part_type</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_modulo_indexing</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">specs</span><span class="p">[</span><span class="s1">&#39;constraint_type_colors&#39;</span><span class="p">],</span>
                                      <span class="n">part_type</span><span class="p">),</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">materials</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_modulo_indexing</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">specs</span><span class="p">[</span><span class="s1">&#39;constraint_type_materials&#39;</span><span class="p">],</span> <span class="n">part_type</span><span class="p">)],</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">specs</span><span class="p">[</span><span class="s1">&#39;quality_constraints&#39;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">system</span><span class="o">.</span><span class="n">box_l</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">specs</span><span class="p">[</span><span class="s1">&#39;rasterize_resolution&#39;</span><span class="p">],</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">specs</span><span class="p">[</span><span class="s1">&#39;rasterize_pointsize&#39;</span><span class="p">]</span>
            <span class="p">]</span>
            <span class="k">return</span> <span class="n">arguments</span>

        <span class="n">shape_mapping</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;Shapes::Cylinder&#39;</span><span class="p">:</span> <span class="n">Cylinder</span><span class="p">,</span>
            <span class="s1">&#39;Shapes::Ellipsoid&#39;</span><span class="p">:</span> <span class="n">Ellipsoid</span><span class="p">,</span>
            <span class="s1">&#39;Shapes::HollowConicalFrustum&#39;</span><span class="p">:</span> <span class="n">HollowConicalFrustum</span><span class="p">,</span>
            <span class="s1">&#39;Shapes::SimplePore&#39;</span><span class="p">:</span> <span class="n">SimplePore</span><span class="p">,</span>
            <span class="s1">&#39;Shapes::Slitpore&#39;</span><span class="p">:</span> <span class="n">Slitpore</span><span class="p">,</span>
            <span class="s1">&#39;Shapes::Sphere&#39;</span><span class="p">:</span> <span class="n">Sphere</span><span class="p">,</span>
            <span class="s1">&#39;Shapes::SpheroCylinder&#39;</span><span class="p">:</span> <span class="n">Spherocylinder</span><span class="p">,</span>
            <span class="s1">&#39;Shapes::Wall&#39;</span><span class="p">:</span> <span class="n">Wall</span>
        <span class="p">}</span>

        <span class="c1"># collect shapes using the helper functions</span>
        <span class="k">for</span> <span class="n">constraint</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">system</span><span class="o">.</span><span class="n">constraints</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">constraint</span><span class="p">,</span>
                          <span class="n">espressomd</span><span class="o">.</span><span class="n">constraints</span><span class="o">.</span><span class="n">ShapeBasedConstraint</span><span class="p">):</span>
                <span class="n">part_type</span> <span class="o">=</span> <span class="n">constraint</span><span class="o">.</span><span class="n">get_parameter</span><span class="p">(</span><span class="s1">&#39;particle_type&#39;</span><span class="p">)</span>
                <span class="n">shape</span> <span class="o">=</span> <span class="n">constraint</span><span class="o">.</span><span class="n">get_parameter</span><span class="p">(</span><span class="s1">&#39;shape&#39;</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">sub_shape</span> <span class="ow">in</span> <span class="n">unpack_shapes</span><span class="p">(</span><span class="n">shape</span><span class="p">):</span>
                    <span class="n">arguments</span> <span class="o">=</span> <span class="n">shape_arguments</span><span class="p">(</span><span class="n">sub_shape</span><span class="p">,</span> <span class="n">part_type</span><span class="p">)</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">shapes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                            <span class="n">shape_mapping</span><span class="p">[</span><span class="n">sub_shape</span><span class="o">.</span><span class="n">name</span><span class="p">()](</span><span class="o">*</span><span class="n">arguments</span><span class="p">))</span>
                    <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">shapes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Shape</span><span class="p">(</span><span class="o">*</span><span class="n">arguments</span><span class="p">))</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">specs</span><span class="p">[</span><span class="s1">&#39;LB_draw_boundaries&#39;</span><span class="p">]:</span>
            <span class="n">ni</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">for</span> <span class="n">constraint</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">system</span><span class="o">.</span><span class="n">lbboundaries</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">constraint</span><span class="p">,</span> <span class="n">espressomd</span><span class="o">.</span><span class="n">lbboundaries</span><span class="o">.</span><span class="n">LBBoundary</span><span class="p">):</span>
                    <span class="n">part_type</span> <span class="o">=</span> <span class="n">ni</span>
                    <span class="n">ni</span> <span class="o">+=</span> <span class="mi">1</span>
                    <span class="n">shape</span> <span class="o">=</span> <span class="n">constraint</span><span class="o">.</span><span class="n">get_parameter</span><span class="p">(</span><span class="s1">&#39;shape&#39;</span><span class="p">)</span>
                    <span class="k">for</span> <span class="n">sub_shape</span> <span class="ow">in</span> <span class="n">unpack_shapes</span><span class="p">(</span><span class="n">shape</span><span class="p">):</span>
                        <span class="n">arguments</span> <span class="o">=</span> <span class="n">shape_arguments</span><span class="p">(</span><span class="n">sub_shape</span><span class="p">,</span> <span class="n">part_type</span><span class="p">)</span>
                        <span class="k">try</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">shapes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                                <span class="n">shape_mapping</span><span class="p">[</span><span class="n">sub_shape</span><span class="o">.</span><span class="n">name</span><span class="p">()](</span><span class="o">*</span><span class="n">arguments</span><span class="p">))</span>
                        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">shapes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Shape</span><span class="p">(</span><span class="o">*</span><span class="n">arguments</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_update_bonds</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">particle_data</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Update bond data used for drawing bonds.</span>
<span class="sd">        Do not call directly but use</span>
<span class="sd">        :meth:`~espressomd.visualization_opengl.openGLLive._update_particles_and_bonds`!</span>

<span class="sd">        Updates data array ``self.bonds[]``; structure of elements is:</span>
<span class="sd">        ``[&lt;id of first bond partner&gt;, &lt;id of second bond partner&gt;, &lt;bond type&gt;]``</span>

<span class="sd">         &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">specs</span><span class="p">[</span><span class="s1">&#39;draw_bonds&#39;</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">bonds</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">particle</span> <span class="ow">in</span> <span class="n">particle_data</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">bond</span> <span class="ow">in</span> <span class="n">particle</span><span class="o">.</span><span class="n">bonds</span><span class="p">:</span>
                    <span class="c1"># input data:</span>
                    <span class="c1"># bond[0]: bond type, bond[1:] bond partners</span>
                    <span class="n">bond_type</span> <span class="o">=</span> <span class="n">bond</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">type_number</span><span class="p">()</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">bond</span><span class="p">)</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">bonds</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">particle</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">bond</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">bond_type</span><span class="p">])</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">bonds</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">particle</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">bond</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">bond_type</span><span class="p">])</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">bonds</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">bond</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">bond</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">bond_type</span><span class="p">])</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">for</span> <span class="n">bond_partner</span> <span class="ow">in</span> <span class="n">bond</span><span class="p">[</span><span class="mi">1</span><span class="p">:]:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">bonds</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                                <span class="p">[</span><span class="n">particle</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">bond_partner</span><span class="p">,</span> <span class="n">bond_type</span><span class="p">])</span>

    <span class="k">def</span> <span class="nf">_draw_text</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">text</span><span class="p">,</span> <span class="n">color</span><span class="p">,</span>
                   <span class="n">font</span><span class="o">=</span><span class="n">OpenGL</span><span class="o">.</span><span class="n">GLUT</span><span class="o">.</span><span class="n">GLUT_BITMAP_9_BY_15</span><span class="p">):</span>
        <span class="n">OpenGL</span><span class="o">.</span><span class="n">GL</span><span class="o">.</span><span class="n">glColor</span><span class="p">(</span><span class="n">color</span><span class="p">)</span>
        <span class="n">OpenGL</span><span class="o">.</span><span class="n">GL</span><span class="o">.</span><span class="n">glWindowPos2f</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">ch</span> <span class="ow">in</span> <span class="n">text</span><span class="p">:</span>
            <span class="n">OpenGL</span><span class="o">.</span><span class="n">GLUT</span><span class="o">.</span><span class="n">glutBitmapCharacter</span><span class="p">(</span><span class="n">font</span><span class="p">,</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">c_int</span><span class="p">(</span><span class="nb">ord</span><span class="p">(</span><span class="n">ch</span><span class="p">)))</span>

    <span class="c1"># draw called automatically from GLUT display function</span>
    <span class="k">def</span> <span class="nf">_draw_system</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">specs</span><span class="p">[</span><span class="s1">&#39;LB_draw_velocity_plane&#39;</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_draw_lb_vel</span><span class="p">()</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">specs</span><span class="p">[</span><span class="s1">&#39;draw_axis&#39;</span><span class="p">]:</span>
            <span class="n">axis_fac</span> <span class="o">=</span> <span class="mf">0.2</span>
            <span class="n">axis_r</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">system</span><span class="o">.</span><span class="n">box_l</span><span class="p">)</span> <span class="o">/</span> <span class="mf">50.0</span>
            <span class="n">draw_arrow</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">system</span><span class="o">.</span><span class="n">box_l</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">axis_fac</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">axis_r</span><span class="p">,</span>
                       <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">materials</span><span class="p">[</span><span class="s1">&#39;chrome&#39;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">specs</span><span class="p">[</span><span class="s1">&#39;quality_arrows&#39;</span><span class="p">])</span>
            <span class="n">draw_arrow</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">system</span><span class="o">.</span><span class="n">box_l</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">*</span> <span class="n">axis_fac</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">axis_r</span><span class="p">,</span>
                       <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">materials</span><span class="p">[</span><span class="s1">&#39;chrome&#39;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">specs</span><span class="p">[</span><span class="s1">&#39;quality_arrows&#39;</span><span class="p">])</span>
            <span class="n">draw_arrow</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">system</span><span class="o">.</span><span class="n">box_l</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">*</span> <span class="n">axis_fac</span><span class="p">],</span> <span class="n">axis_r</span><span class="p">,</span>
                       <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">materials</span><span class="p">[</span><span class="s1">&#39;chrome&#39;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">specs</span><span class="p">[</span><span class="s1">&#39;quality_arrows&#39;</span><span class="p">])</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">specs</span><span class="p">[</span><span class="s1">&#39;draw_bonds&#39;</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_draw_bonds</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_draw_system_particles</span><span class="p">()</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">specs</span><span class="p">[</span><span class="s1">&#39;draw_constraints&#39;</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_draw_constraints</span><span class="p">()</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">specs</span><span class="p">[</span><span class="s1">&#39;draw_box&#39;</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_draw_system_box</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">specs</span><span class="p">[</span><span class="s1">&#39;draw_nodes&#39;</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_draw_nodes</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">specs</span><span class="p">[</span><span class="s1">&#39;draw_cells&#39;</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_draw_cells</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">specs</span><span class="p">[</span><span class="s1">&#39;LB_draw_nodes&#39;</span><span class="p">]</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">specs</span><span class="p">[</span><span class="s1">&#39;LB_draw_node_boundaries&#39;</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_draw_lb_grid</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_draw_system_box</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">draw_box</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">system</span><span class="o">.</span><span class="n">box_l</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">inverse_bg_color</span><span class="p">,</span>
                 <span class="bp">self</span><span class="o">.</span><span class="n">materials</span><span class="p">[</span><span class="s1">&#39;medium&#39;</span><span class="p">],</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">line_width_fac</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_draw_nodes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">node_box_origins</span><span class="p">:</span>
            <span class="n">draw_box</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">local_box_l</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">node_box_color</span><span class="p">,</span>
                     <span class="bp">self</span><span class="o">.</span><span class="n">materials</span><span class="p">[</span><span class="s1">&#39;transparent1&#39;</span><span class="p">],</span> <span class="mf">1.5</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">line_width_fac</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_draw_cells</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">node_box_origins</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">cell_box_origins</span><span class="p">:</span>
                <span class="n">draw_box</span><span class="p">(</span>
                    <span class="n">c</span> <span class="o">+</span> <span class="n">n</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cell_size</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cell_box_color</span><span class="p">,</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">materials</span><span class="p">[</span><span class="s1">&#39;transparent1&#39;</span><span class="p">],</span> <span class="mf">0.75</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">line_width_fac</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_draw_lb_grid</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">a</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lb_params</span><span class="p">[</span><span class="s1">&#39;agrid&#39;</span><span class="p">]</span>
        <span class="n">cell_size</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">a</span><span class="p">]</span> <span class="o">*</span> <span class="mi">3</span><span class="p">)</span>
        <span class="n">dims</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">rint</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">system</span><span class="o">.</span><span class="n">box_l</span><span class="p">)</span> <span class="o">/</span> <span class="n">a</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">dims</span><span class="p">[</span><span class="mi">0</span><span class="p">])):</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">dims</span><span class="p">[</span><span class="mi">1</span><span class="p">])):</span>
                <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">dims</span><span class="p">[</span><span class="mi">2</span><span class="p">])):</span>
                    <span class="n">n</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">])</span> <span class="o">*</span> <span class="n">cell_size</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">specs</span><span class="p">[</span><span class="s1">&#39;LB_draw_node_boundaries&#39;</span><span class="p">]</span> \
                            <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">lb</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">boundary</span><span class="p">:</span>
                        <span class="n">draw_box</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">cell_size</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">lb_box_color_boundary</span><span class="p">,</span>
                                 <span class="bp">self</span><span class="o">.</span><span class="n">materials</span><span class="p">[</span><span class="s1">&#39;transparent2&#39;</span><span class="p">],</span> <span class="mf">5.0</span><span class="p">)</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">specs</span><span class="p">[</span><span class="s1">&#39;LB_draw_nodes&#39;</span><span class="p">]</span> \
                            <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">lb</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">boundary</span><span class="p">:</span>
                        <span class="n">draw_box</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">cell_size</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">lb_box_color</span><span class="p">,</span>
                                 <span class="bp">self</span><span class="o">.</span><span class="n">materials</span><span class="p">[</span><span class="s1">&#39;transparent2&#39;</span><span class="p">],</span> <span class="mf">1.5</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_draw_constraints</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="c1"># clip borders of simulation box</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">6</span><span class="p">):</span>
            <span class="n">OpenGL</span><span class="o">.</span><span class="n">GL</span><span class="o">.</span><span class="n">glEnable</span><span class="p">(</span><span class="n">OpenGL</span><span class="o">.</span><span class="n">GL</span><span class="o">.</span><span class="n">GL_CLIP_PLANE0</span> <span class="o">+</span> <span class="n">i</span><span class="p">)</span>
            <span class="n">OpenGL</span><span class="o">.</span><span class="n">GL</span><span class="o">.</span><span class="n">glClipPlane</span><span class="p">(</span><span class="n">OpenGL</span><span class="o">.</span><span class="n">GL</span><span class="o">.</span><span class="n">GL_CLIP_PLANE0</span> <span class="o">+</span> <span class="n">i</span><span class="p">,</span>
                                  <span class="bp">self</span><span class="o">.</span><span class="n">box_eqn</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:])</span>

        <span class="k">for</span> <span class="n">shape</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">shapes</span><span class="p">:</span>
            <span class="n">shape</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">6</span><span class="p">):</span>
            <span class="n">OpenGL</span><span class="o">.</span><span class="n">GL</span><span class="o">.</span><span class="n">glDisable</span><span class="p">(</span><span class="n">OpenGL</span><span class="o">.</span><span class="n">GL</span><span class="o">.</span><span class="n">GL_CLIP_PLANE0</span> <span class="o">+</span> <span class="n">i</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_determine_radius</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">part_type</span><span class="p">):</span>
        <span class="k">def</span> <span class="nf">radius_by_lj</span><span class="p">(</span><span class="n">part_type</span><span class="p">):</span>
            <span class="n">ia</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">system</span><span class="o">.</span><span class="n">non_bonded_inter</span><span class="p">[</span><span class="n">part_type</span><span class="p">,</span> <span class="n">part_type</span><span class="p">]</span>
            <span class="n">radius</span> <span class="o">=</span> <span class="mf">0.0</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">ia</span><span class="p">,</span> <span class="s2">&quot;lennard_jones&quot;</span><span class="p">):</span>
                <span class="n">radius</span> <span class="o">=</span> <span class="n">ia</span><span class="o">.</span><span class="n">lennard_jones</span><span class="o">.</span><span class="n">get_params</span><span class="p">()[</span><span class="s2">&quot;sigma&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="mf">0.5</span>
            <span class="k">if</span> <span class="n">radius</span> <span class="o">==</span> <span class="mf">0.0</span> <span class="ow">and</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">ia</span><span class="p">,</span> <span class="s2">&quot;wca&quot;</span><span class="p">):</span>
                <span class="n">radius</span> <span class="o">=</span> <span class="n">ia</span><span class="o">.</span><span class="n">wca</span><span class="o">.</span><span class="n">get_params</span><span class="p">()[</span><span class="s2">&quot;sigma&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="mf">0.5</span>
            <span class="k">if</span> <span class="n">radius</span> <span class="o">==</span> <span class="mf">0.0</span><span class="p">:</span>
                <span class="n">radius</span> <span class="o">=</span> <span class="mf">0.5</span>
            <span class="k">return</span> <span class="n">radius</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">specs</span><span class="p">[</span><span class="s1">&#39;particle_sizes&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;auto&#39;</span><span class="p">:</span>
            <span class="n">radius</span> <span class="o">=</span> <span class="n">radius_by_lj</span><span class="p">(</span><span class="n">part_type</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">callable</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">specs</span><span class="p">[</span><span class="s1">&#39;particle_sizes&#39;</span><span class="p">]):</span>
            <span class="n">radius</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">specs</span><span class="p">[</span><span class="s1">&#39;particle_sizes&#39;</span><span class="p">](</span><span class="n">part_type</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">radius</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_modulo_indexing</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">specs</span><span class="p">[</span><span class="s1">&#39;particle_sizes&#39;</span><span class="p">],</span> <span class="n">part_type</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">RuntimeError</span><span class="p">:</span>
                <span class="n">radius</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">radius_by_lj</span><span class="p">(</span><span class="n">part_type</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">radius</span>

    <span class="k">def</span> <span class="nf">_draw_system_particles</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">color_by_id</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="n">part_type</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
        <span class="n">reset_material</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="k">for</span> <span class="n">part_id</span><span class="p">,</span> <span class="n">index</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">index_from_id</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">part_type_last</span> <span class="o">=</span> <span class="n">part_type</span>
            <span class="n">part_type</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">particles</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">][</span><span class="n">index</span><span class="p">])</span>

            <span class="c1"># Only change material if type/charge has changed, color_by_id or</span>
            <span class="c1"># material was reset by arrows</span>
            <span class="k">if</span> <span class="n">reset_material</span> <span class="ow">or</span> <span class="n">color_by_id</span> <span class="ow">or</span> <span class="n">part_type</span> <span class="o">!=</span> <span class="n">part_type_last</span> <span class="ow">or</span> \
                    <span class="n">part_id</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">drag_id</span> <span class="ow">or</span> <span class="n">part_id</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">info_id</span> <span class="ow">or</span> \
                    <span class="bp">self</span><span class="o">.</span><span class="n">specs</span><span class="p">[</span><span class="s1">&#39;particle_coloring&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;node&#39;</span><span class="p">:</span>
                <span class="n">reset_material</span> <span class="o">=</span> <span class="kc">False</span>

                <span class="n">radius</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_determine_radius</span><span class="p">(</span><span class="n">part_type</span><span class="p">)</span>

                <span class="n">m</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_modulo_indexing</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">specs</span><span class="p">[</span><span class="s1">&#39;particle_type_materials&#39;</span><span class="p">],</span> <span class="n">part_type</span><span class="p">)</span>
                <span class="n">material</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">materials</span><span class="p">[</span><span class="n">m</span><span class="p">]</span>

                <span class="k">if</span> <span class="n">color_by_id</span><span class="p">:</span>
                    <span class="n">color</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_id_to_fcolor</span><span class="p">(</span><span class="n">part_id</span><span class="p">)</span>
                    <span class="n">OpenGL</span><span class="o">.</span><span class="n">GL</span><span class="o">.</span><span class="n">glColor</span><span class="p">(</span><span class="n">color</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">specs</span><span class="p">[</span><span class="s1">&#39;particle_coloring&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;auto&#39;</span><span class="p">:</span>
                        <span class="c1"># Color auto: Charge then Type</span>
                        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">has_particle_data</span><span class="p">[</span><span class="s1">&#39;charge&#39;</span><span class="p">]</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">particles</span><span class="p">[</span><span class="s1">&#39;charge&#39;</span><span class="p">][</span><span class="n">index</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                            <span class="n">color</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_color_by_charge</span><span class="p">(</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">particles</span><span class="p">[</span><span class="s1">&#39;charge&#39;</span><span class="p">][</span><span class="n">index</span><span class="p">])</span>
                            <span class="n">reset_material</span> <span class="o">=</span> <span class="kc">True</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">color</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_modulo_indexing</span><span class="p">(</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">specs</span><span class="p">[</span><span class="s1">&#39;particle_type_colors&#39;</span><span class="p">],</span> <span class="n">part_type</span><span class="p">)</span>
                    <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">specs</span><span class="p">[</span><span class="s1">&#39;particle_coloring&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;charge&#39;</span><span class="p">:</span>
                        <span class="n">color</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_color_by_charge</span><span class="p">(</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">particles</span><span class="p">[</span><span class="s1">&#39;charge&#39;</span><span class="p">][</span><span class="n">index</span><span class="p">])</span>
                        <span class="n">reset_material</span> <span class="o">=</span> <span class="kc">True</span>
                    <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">specs</span><span class="p">[</span><span class="s1">&#39;particle_coloring&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;type&#39;</span><span class="p">:</span>
                        <span class="n">color</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_modulo_indexing</span><span class="p">(</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">specs</span><span class="p">[</span><span class="s1">&#39;particle_type_colors&#39;</span><span class="p">],</span> <span class="n">part_type</span><span class="p">)</span>
                    <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">specs</span><span class="p">[</span><span class="s1">&#39;particle_coloring&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;node&#39;</span><span class="p">:</span>
                        <span class="n">color</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_modulo_indexing</span><span class="p">(</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">specs</span><span class="p">[</span><span class="s1">&#39;particle_type_colors&#39;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">particles</span><span class="p">[</span><span class="s1">&#39;node&#39;</span><span class="p">][</span><span class="n">index</span><span class="p">])</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                            <span class="n">f</span><span class="s2">&quot;Cannot process particle_coloring=</span><span class="si">{self.specs[&#39;particle_coloring&#39;]}</span><span class="s2">&quot;</span><span class="p">)</span>

                    <span class="c1"># Invert color of highlighted particle</span>
                    <span class="k">if</span> <span class="n">part_id</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">drag_id</span> <span class="ow">or</span> <span class="n">part_id</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">info_id</span><span class="p">:</span>
                        <span class="n">reset_material</span> <span class="o">=</span> <span class="kc">True</span>
                        <span class="n">color</span> <span class="o">=</span> <span class="p">[</span><span class="mf">1.</span> <span class="o">-</span> <span class="n">color</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mf">1.</span> <span class="o">-</span> <span class="n">color</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mf">1.</span> <span class="o">-</span> <span class="n">color</span><span class="p">[</span><span class="mi">2</span><span class="p">]]</span>

                    <span class="n">set_solid_material</span><span class="p">(</span><span class="n">color</span><span class="p">,</span> <span class="n">material</span><span class="p">)</span>

                <span class="c1"># Create a new display list, used until next material/color</span>
                <span class="c1"># change</span>
                <span class="n">OpenGL</span><span class="o">.</span><span class="n">GL</span><span class="o">.</span><span class="n">glNewList</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dl_sphere</span><span class="p">,</span> <span class="n">OpenGL</span><span class="o">.</span><span class="n">GL</span><span class="o">.</span><span class="n">GL_COMPILE</span><span class="p">)</span>
                <span class="n">OpenGL</span><span class="o">.</span><span class="n">GLUT</span><span class="o">.</span><span class="n">glutSolidSphere</span><span class="p">(</span>
                    <span class="n">radius</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">specs</span><span class="p">[</span><span class="s1">&#39;quality_particles&#39;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">specs</span><span class="p">[</span><span class="s1">&#39;quality_particles&#39;</span><span class="p">])</span>
                <span class="n">OpenGL</span><span class="o">.</span><span class="n">GL</span><span class="o">.</span><span class="n">glEndList</span><span class="p">()</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">_redraw_sphere</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">particles</span><span class="p">[</span><span class="s1">&#39;pos&#39;</span><span class="p">][</span><span class="n">index</span><span class="p">])</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">has_images</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">imx</span><span class="p">,</span> <span class="n">imy</span><span class="p">,</span> <span class="n">imz</span> <span class="ow">in</span> <span class="n">itertools</span><span class="o">.</span><span class="n">product</span><span class="p">(</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">image_vectors</span><span class="p">):</span>
                    <span class="k">if</span> <span class="n">imx</span> <span class="o">!=</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">imy</span> <span class="o">!=</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">imz</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="n">offset</span> <span class="o">=</span> <span class="p">[</span><span class="n">imx</span><span class="p">,</span> <span class="n">imy</span><span class="p">,</span> <span class="n">imz</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">system</span><span class="o">.</span><span class="n">box_l</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_redraw_sphere</span><span class="p">(</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">particles</span><span class="p">[</span><span class="s1">&#39;pos&#39;</span><span class="p">][</span><span class="n">index</span><span class="p">]</span> <span class="o">+</span> <span class="n">offset</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">espressomd</span><span class="o">.</span><span class="n">has_features</span><span class="p">(</span><span class="s1">&#39;EXTERNAL_FORCES&#39;</span><span class="p">):</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">specs</span><span class="p">[</span><span class="s1">&#39;ext_force_arrows&#39;</span><span class="p">]</span> <span class="ow">or</span> <span class="n">part_id</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">drag_id</span><span class="p">:</span>
                    <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">v</span> <span class="o">!=</span> <span class="mi">0</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">particles</span><span class="p">[</span><span class="s1">&#39;ext_force&#39;</span><span class="p">][</span><span class="n">index</span><span class="p">]):</span>
                        <span class="k">if</span> <span class="n">part_id</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">drag_id</span><span class="p">:</span>
                            <span class="n">sc</span> <span class="o">=</span> <span class="mi">1</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">sc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_modulo_indexing</span><span class="p">(</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">specs</span><span class="p">[</span><span class="s1">&#39;ext_force_arrows_type_scale&#39;</span><span class="p">],</span> <span class="n">part_type</span><span class="p">)</span>
                        <span class="k">if</span> <span class="n">sc</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                            <span class="n">arrow_col</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_modulo_indexing</span><span class="p">(</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">specs</span><span class="p">[</span><span class="s1">&#39;ext_force_arrows_type_colors&#39;</span><span class="p">],</span> <span class="n">part_type</span><span class="p">)</span>
                            <span class="n">arrow_radius</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_modulo_indexing</span><span class="p">(</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">specs</span><span class="p">[</span><span class="s1">&#39;ext_force_arrows_type_radii&#39;</span><span class="p">],</span> <span class="n">part_type</span><span class="p">)</span>
                            <span class="n">draw_arrow</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">particles</span><span class="p">[</span><span class="s1">&#39;pos&#39;</span><span class="p">][</span><span class="n">index</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">particles</span><span class="p">[</span><span class="s1">&#39;ext_force&#39;</span><span class="p">][</span><span class="n">index</span><span class="p">])</span> <span class="o">*</span> <span class="n">sc</span><span class="p">,</span> <span class="n">arrow_radius</span><span class="p">,</span> <span class="n">arrow_col</span><span class="p">,</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">materials</span><span class="p">[</span><span class="s1">&#39;chrome&#39;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">specs</span><span class="p">[</span><span class="s1">&#39;quality_arrows&#39;</span><span class="p">])</span>
                            <span class="n">reset_material</span> <span class="o">=</span> <span class="kc">True</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">specs</span><span class="p">[</span><span class="s1">&#39;velocity_arrows&#39;</span><span class="p">]:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_draw_arrow_property</span><span class="p">(</span>
                    <span class="n">part_id</span><span class="p">,</span> <span class="n">part_type</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">specs</span><span class="p">[</span><span class="s1">&#39;velocity_arrows_type_scale&#39;</span><span class="p">],</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">specs</span><span class="p">[</span><span class="s1">&#39;velocity_arrows_type_colors&#39;</span><span class="p">],</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">specs</span><span class="p">[</span><span class="s1">&#39;velocity_arrows_type_materials&#39;</span><span class="p">],</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">specs</span><span class="p">[</span><span class="s1">&#39;velocity_arrows_type_radii&#39;</span><span class="p">],</span> <span class="s1">&#39;velocity&#39;</span><span class="p">)</span>
                <span class="n">reset_material</span> <span class="o">=</span> <span class="kc">True</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">specs</span><span class="p">[</span><span class="s1">&#39;force_arrows&#39;</span><span class="p">]:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_draw_arrow_property</span><span class="p">(</span>
                    <span class="n">part_id</span><span class="p">,</span> <span class="n">part_type</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">specs</span><span class="p">[</span><span class="s1">&#39;force_arrows_type_scale&#39;</span><span class="p">],</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">specs</span><span class="p">[</span><span class="s1">&#39;force_arrows_type_colors&#39;</span><span class="p">],</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">specs</span><span class="p">[</span><span class="s1">&#39;force_arrows_type_materials&#39;</span><span class="p">],</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">specs</span><span class="p">[</span><span class="s1">&#39;force_arrows_type_radii&#39;</span><span class="p">],</span> <span class="s1">&#39;force&#39;</span><span class="p">)</span>
                <span class="n">reset_material</span> <span class="o">=</span> <span class="kc">True</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">specs</span><span class="p">[</span><span class="s1">&#39;director_arrows&#39;</span><span class="p">]:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_draw_arrow_property</span><span class="p">(</span>
                    <span class="n">part_id</span><span class="p">,</span> <span class="n">part_type</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">specs</span><span class="p">[</span><span class="s1">&#39;director_arrows_type_scale&#39;</span><span class="p">],</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">specs</span><span class="p">[</span><span class="s1">&#39;director_arrows_type_colors&#39;</span><span class="p">],</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">specs</span><span class="p">[</span><span class="s1">&#39;director_arrows_type_materials&#39;</span><span class="p">],</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">specs</span><span class="p">[</span><span class="s1">&#39;director_arrows_type_radii&#39;</span><span class="p">],</span> <span class="s1">&#39;director&#39;</span><span class="p">)</span>
                <span class="n">reset_material</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="nf">_draw_arrow_property</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">part_id</span><span class="p">,</span> <span class="n">part_type</span><span class="p">,</span> <span class="n">type_scale</span><span class="p">,</span>
                             <span class="n">type_colors</span><span class="p">,</span> <span class="n">type_materials</span><span class="p">,</span> <span class="n">type_radii</span><span class="p">,</span> <span class="n">prop</span><span class="p">):</span>
        <span class="n">sc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_modulo_indexing</span><span class="p">(</span><span class="n">type_scale</span><span class="p">,</span> <span class="n">part_type</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">sc</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">v</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">particles</span><span class="p">[</span><span class="n">prop</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">index_from_id</span><span class="p">[</span><span class="n">part_id</span><span class="p">]]</span>
            <span class="n">col</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_modulo_indexing</span><span class="p">(</span><span class="n">type_colors</span><span class="p">,</span> <span class="n">part_type</span><span class="p">)</span>
            <span class="n">radius</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_modulo_indexing</span><span class="p">(</span><span class="n">type_radii</span><span class="p">,</span> <span class="n">part_type</span><span class="p">)</span>
            <span class="n">material</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_modulo_indexing</span><span class="p">(</span><span class="n">type_materials</span><span class="p">,</span> <span class="n">part_type</span><span class="p">)</span>
            <span class="n">draw_arrow</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">particles</span><span class="p">[</span><span class="s1">&#39;pos&#39;</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">index_from_id</span><span class="p">[</span><span class="n">part_id</span><span class="p">]],</span>
                       <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span> <span class="o">*</span> <span class="n">sc</span><span class="p">,</span> <span class="n">radius</span><span class="p">,</span> <span class="n">col</span><span class="p">,</span>
                       <span class="bp">self</span><span class="o">.</span><span class="n">materials</span><span class="p">[</span><span class="n">material</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">specs</span><span class="p">[</span><span class="s1">&#39;quality_arrows&#39;</span><span class="p">])</span>

    <span class="k">def</span> <span class="nf">_draw_bonds</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">half_box_l</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">system</span><span class="o">.</span><span class="n">box_l</span> <span class="o">/</span> <span class="mf">2.0</span>
        <span class="n">quality_bonds</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">specs</span><span class="p">[</span><span class="s1">&#39;quality_bonds&#39;</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">bonds</span><span class="p">:</span>
            <span class="n">col</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_modulo_indexing</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">specs</span><span class="p">[</span><span class="s1">&#39;bond_type_colors&#39;</span><span class="p">],</span> <span class="n">b</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
            <span class="n">mat</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">materials</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_modulo_indexing</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">specs</span><span class="p">[</span><span class="s1">&#39;bond_type_materials&#39;</span><span class="p">],</span> <span class="n">b</span><span class="p">[</span><span class="mi">2</span><span class="p">])]</span>
            <span class="n">radius</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_modulo_indexing</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">specs</span><span class="p">[</span><span class="s1">&#39;bond_type_radius&#39;</span><span class="p">],</span> <span class="n">b</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
            <span class="c1"># if particles are deleted in the core, index_from_id might</span>
            <span class="c1"># throw a KeyError -- e. g. when deleting a bond created by</span>
            <span class="c1"># collision_detection (using virtual site particles)</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">x_a</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">particles</span><span class="p">[</span><span class="s1">&#39;pos&#39;</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">index_from_id</span><span class="p">[</span><span class="n">b</span><span class="p">[</span><span class="mi">0</span><span class="p">]]]</span>
                <span class="n">x_b</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">particles</span><span class="p">[</span><span class="s1">&#39;pos&#39;</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">index_from_id</span><span class="p">[</span><span class="n">b</span><span class="p">[</span><span class="mi">1</span><span class="p">]]]</span>
            <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                <span class="c1"># skip this bond</span>
                <span class="k">continue</span>
            <span class="n">dx</span> <span class="o">=</span> <span class="n">x_b</span> <span class="o">-</span> <span class="n">x_a</span>

            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">dx</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">half_box_l</span><span class="p">):</span>
                <span class="c1"># bond completely inside box</span>
                <span class="n">draw_cylinder</span><span class="p">(</span><span class="n">x_a</span><span class="p">,</span> <span class="n">x_b</span><span class="p">,</span> <span class="n">radius</span><span class="p">,</span> <span class="n">col</span><span class="p">,</span> <span class="n">mat</span><span class="p">,</span> <span class="n">quality_bonds</span><span class="p">)</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">has_images</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">imx</span><span class="p">,</span> <span class="n">imy</span><span class="p">,</span> <span class="n">imz</span> <span class="ow">in</span> <span class="n">itertools</span><span class="o">.</span><span class="n">product</span><span class="p">(</span>
                            <span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">image_vectors</span><span class="p">):</span>
                        <span class="k">if</span> <span class="n">imx</span> <span class="o">!=</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">imy</span> <span class="o">!=</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">imz</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                            <span class="n">offset</span> <span class="o">=</span> <span class="p">[</span><span class="n">imx</span><span class="p">,</span> <span class="n">imy</span><span class="p">,</span> <span class="n">imz</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">system</span><span class="o">.</span><span class="n">box_l</span>
                            <span class="n">draw_cylinder</span><span class="p">(</span><span class="n">x_a</span> <span class="o">+</span> <span class="n">offset</span><span class="p">,</span> <span class="n">x_b</span> <span class="o">+</span> <span class="n">offset</span><span class="p">,</span> <span class="n">radius</span><span class="p">,</span>
                                          <span class="n">col</span><span class="p">,</span> <span class="n">mat</span><span class="p">,</span> <span class="n">quality_bonds</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># bond crosses the box boundaries</span>
                <span class="n">d</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cut_bond</span><span class="p">(</span><span class="n">x_a</span><span class="p">,</span> <span class="n">dx</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">d</span> <span class="ow">is</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">:</span>
                    <span class="k">continue</span>

                <span class="n">s_a</span> <span class="o">=</span> <span class="n">x_a</span> <span class="o">+</span> <span class="n">d</span> <span class="o">*</span> <span class="n">dx</span>
                <span class="n">s_b</span> <span class="o">=</span> <span class="n">x_b</span> <span class="o">-</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">d</span><span class="p">)</span> <span class="o">*</span> <span class="n">dx</span>
                <span class="n">draw_cylinder</span><span class="p">(</span><span class="n">x_a</span><span class="p">,</span> <span class="n">s_a</span><span class="p">,</span> <span class="n">radius</span><span class="p">,</span> <span class="n">col</span><span class="p">,</span> <span class="n">mat</span><span class="p">,</span> <span class="n">quality_bonds</span><span class="p">)</span>
                <span class="n">draw_cylinder</span><span class="p">(</span><span class="n">x_b</span><span class="p">,</span> <span class="n">s_b</span><span class="p">,</span> <span class="n">radius</span><span class="p">,</span> <span class="n">col</span><span class="p">,</span> <span class="n">mat</span><span class="p">,</span> <span class="n">quality_bonds</span><span class="p">)</span>

                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">has_images</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">imx</span><span class="p">,</span> <span class="n">imy</span><span class="p">,</span> <span class="n">imz</span> <span class="ow">in</span> <span class="n">itertools</span><span class="o">.</span><span class="n">product</span><span class="p">(</span>
                            <span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">image_vectors</span><span class="p">):</span>
                        <span class="k">if</span> <span class="n">imx</span> <span class="o">!=</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">imy</span> <span class="o">!=</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">imz</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                            <span class="n">offset</span> <span class="o">=</span> <span class="p">[</span><span class="n">imx</span><span class="p">,</span> <span class="n">imy</span><span class="p">,</span> <span class="n">imz</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">system</span><span class="o">.</span><span class="n">box_l</span>
                            <span class="n">draw_cylinder</span><span class="p">(</span><span class="n">x_a</span> <span class="o">+</span> <span class="n">offset</span><span class="p">,</span> <span class="n">s_a</span> <span class="o">+</span> <span class="n">offset</span><span class="p">,</span> <span class="n">radius</span><span class="p">,</span>
                                          <span class="n">col</span><span class="p">,</span> <span class="n">mat</span><span class="p">,</span> <span class="n">quality_bonds</span><span class="p">)</span>
                            <span class="n">draw_cylinder</span><span class="p">(</span><span class="n">x_b</span> <span class="o">+</span> <span class="n">offset</span><span class="p">,</span> <span class="n">s_b</span> <span class="o">+</span> <span class="n">offset</span><span class="p">,</span> <span class="n">radius</span><span class="p">,</span>
                                          <span class="n">col</span><span class="p">,</span> <span class="n">mat</span><span class="p">,</span> <span class="n">quality_bonds</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_redraw_sphere</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pos</span><span class="p">):</span>
        <span class="n">OpenGL</span><span class="o">.</span><span class="n">GL</span><span class="o">.</span><span class="n">glPushMatrix</span><span class="p">()</span>
        <span class="n">OpenGL</span><span class="o">.</span><span class="n">GL</span><span class="o">.</span><span class="n">glTranslatef</span><span class="p">(</span><span class="n">pos</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">pos</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">pos</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
        <span class="n">OpenGL</span><span class="o">.</span><span class="n">GL</span><span class="o">.</span><span class="n">glCallList</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dl_sphere</span><span class="p">)</span>
        <span class="n">OpenGL</span><span class="o">.</span><span class="n">GL</span><span class="o">.</span><span class="n">glPopMatrix</span><span class="p">()</span>

    <span class="c1"># helper to draw periodic bonds</span>
    <span class="k">def</span> <span class="nf">_cut_bond</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x_a</span><span class="p">,</span> <span class="n">dx</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Algorithm for the line-plane intersection problem. Given the unfolded</span>
<span class="sd">        positions of two particles, determine: 1) the box image that minimizes</span>
<span class="sd">        the folded bond length, 2) which side of the simulation box is crossed</span>
<span class="sd">        by the bond, 3) how much of the bond is inside the unit cell starting</span>
<span class="sd">        from the first particle. That scalar is returned by the function, and</span>
<span class="sd">        can be used to calculate the coordinates of the line-plane</span>
<span class="sd">        intersection point. The algorithm can be found at</span>
<span class="sd">        https://en.wikipedia.org/w/index.php?title=Line%E2%80%93plane_intersection&amp;oldid=940427752#Algebraic_form</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># corner case: the two particles occupy the same position</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">dx</span><span class="p">,</span> <span class="n">dx</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mf">1e-9</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span>
        <span class="c1"># find the box image that minimizes the unfolded bond length</span>
        <span class="n">shift</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">rint</span><span class="p">(</span><span class="n">dx</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">system</span><span class="o">.</span><span class="n">box_l</span><span class="p">)</span>
        <span class="c1"># get the unfolded bond vector</span>
        <span class="n">dx</span> <span class="o">-=</span> <span class="n">shift</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">system</span><span class="o">.</span><span class="n">box_l</span>
        <span class="c1"># find which side of the simulation box is crossed by the bond</span>
        <span class="n">best_d</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">dx</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">continue</span>  <span class="c1"># corner case: bond is parallel to a face</span>
            <span class="k">elif</span> <span class="n">dx</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">p0_i</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">system</span><span class="o">.</span><span class="n">box_l</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">p0_i</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="c1"># calculate the length of the bond that is inside the box using</span>
            <span class="c1"># an optimized version of `np.dot(p0 - x0, n) / np.dot(dx, n)`</span>
            <span class="c1"># where the dot products decay to an array access, because `n`</span>
            <span class="c1"># is always a unit vector in rectangular boxes and its sign</span>
            <span class="c1"># is canceled out by the division</span>
            <span class="n">d</span> <span class="o">=</span> <span class="p">(</span><span class="n">p0_i</span> <span class="o">-</span> <span class="n">x_a</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">/</span> <span class="n">dx</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">d</span> <span class="o">&lt;</span> <span class="n">best_d</span><span class="p">:</span>
                <span class="n">best_d</span> <span class="o">=</span> <span class="n">d</span>
        <span class="k">return</span> <span class="n">best_d</span>

    <span class="c1"># arrows in a plane for LB velocities</span>
    <span class="k">def</span> <span class="nf">_draw_lb_vel</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="k">for</span> <span class="n">lb_pos</span><span class="p">,</span> <span class="n">lb_vel</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lb_plane_vel</span><span class="p">:</span>
            <span class="n">draw_arrow</span><span class="p">(</span>
                <span class="n">lb_pos</span><span class="p">,</span>
                <span class="n">lb_vel</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">specs</span><span class="p">[</span><span class="s1">&#39;LB_vel_scale&#39;</span><span class="p">],</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lb_arrow_radius</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">specs</span><span class="p">[</span><span class="s1">&#39;LB_arrow_color&#39;</span><span class="p">],</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">materials</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">specs</span><span class="p">[</span><span class="s1">&#39;LB_arrow_material&#39;</span><span class="p">]],</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">specs</span><span class="p">[</span><span class="s1">&#39;LB_arrow_quality&#39;</span><span class="p">])</span>

    <span class="c1"># use modulo if there are more particle types than type definitions for</span>
    <span class="c1"># colors, materials etc.</span>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_modulo_indexing</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">t</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">l</span><span class="p">[</span><span class="n">t</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="n">l</span><span class="p">)]</span>

    <span class="c1"># fade particle charge color from white (q=0) to plus_color (q=q_max) resp</span>
    <span class="c1"># minus_color (q=q_min)</span>
    <span class="k">def</span> <span class="nf">_color_by_charge</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">q</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">q</span> <span class="o">&lt;</span> <span class="mf">0.</span><span class="p">:</span>
            <span class="n">c</span> <span class="o">=</span> <span class="n">q</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">min_q</span>
            <span class="n">minus_color</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">specs</span><span class="p">[</span><span class="s1">&#39;particle_charge_colors&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">return</span> <span class="p">(</span><span class="mf">1.</span> <span class="o">-</span> <span class="n">c</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="o">+</span> <span class="n">c</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">minus_color</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">c</span> <span class="o">=</span> <span class="n">q</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_q</span>
            <span class="n">plus_color</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">specs</span><span class="p">[</span><span class="s1">&#39;particle_charge_colors&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
            <span class="k">return</span> <span class="p">(</span><span class="mf">1.</span> <span class="o">-</span> <span class="n">c</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="o">+</span> <span class="n">c</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">plus_color</span><span class="p">)</span>

    <span class="c1"># on initialization, check q_max/q_min</span>
    <span class="k">def</span> <span class="nf">_update_charge_color_range</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">particles</span><span class="p">[</span><span class="s1">&#39;charge&#39;</span><span class="p">][:])</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">min_q</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">particles</span><span class="p">[</span><span class="s1">&#39;charge&#39;</span><span class="p">][:])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">max_q</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">particles</span><span class="p">[</span><span class="s1">&#39;charge&#39;</span><span class="p">][:])</span>

    <span class="k">def</span> <span class="nf">_handle_screenshot</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">take_screenshot</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">take_screenshot</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="n">script_name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">0</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>

            <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">while</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;</span><span class="si">{script_name}</span><span class="s2">_</span><span class="si">{i:04d}</span><span class="s2">.png&quot;</span><span class="p">):</span>
                <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">file_name</span> <span class="o">=</span> <span class="n">f</span><span class="s2">&quot;</span><span class="si">{script_name}</span><span class="s2">_</span><span class="si">{i:04d}</span><span class="s2">.png&quot;</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">_make_screenshot</span><span class="p">(</span><span class="n">file_name</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">screenshot_captured</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">screenshot_capture_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">screenshot_capture_txt</span> <span class="o">=</span> <span class="n">f</span><span class="s2">&quot;Saved screenshot </span><span class="si">{file_name}</span><span class="s2">&quot;</span>

    <span class="k">def</span> <span class="nf">_make_screenshot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filepath</span><span class="p">):</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">OpenGL</span><span class="o">.</span><span class="n">GL</span><span class="o">.</span><span class="n">glReadPixels</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">specs</span><span class="p">[</span><span class="s1">&#39;window_size&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span>
                                      <span class="bp">self</span><span class="o">.</span><span class="n">specs</span><span class="p">[</span><span class="s1">&#39;window_size&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span>
                                      <span class="n">OpenGL</span><span class="o">.</span><span class="n">GL</span><span class="o">.</span><span class="n">GL_RGB</span><span class="p">,</span> <span class="n">OpenGL</span><span class="o">.</span><span class="n">GL</span><span class="o">.</span><span class="n">GL_FLOAT</span><span class="p">)</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">flipud</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">3</span><span class="p">)))</span>
        <span class="n">matplotlib</span><span class="o">.</span><span class="n">pyplot</span><span class="o">.</span><span class="n">imsave</span><span class="p">(</span><span class="n">filepath</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_display_all</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="n">OpenGL</span><span class="o">.</span><span class="n">GL</span><span class="o">.</span><span class="n">glClear</span><span class="p">(</span>
            <span class="n">OpenGL</span><span class="o">.</span><span class="n">GL</span><span class="o">.</span><span class="n">GL_COLOR_BUFFER_BIT</span> <span class="o">|</span> <span class="n">OpenGL</span><span class="o">.</span><span class="n">GL</span><span class="o">.</span><span class="n">GL_DEPTH_BUFFER_BIT</span><span class="p">)</span>

        <span class="n">OpenGL</span><span class="o">.</span><span class="n">GL</span><span class="o">.</span><span class="n">glLoadMatrixf</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">camera</span><span class="o">.</span><span class="n">modelview</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_set_camera_spotlight</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_draw_system</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_draw_texts</span><span class="p">()</span>

        <span class="n">OpenGL</span><span class="o">.</span><span class="n">GLUT</span><span class="o">.</span><span class="n">glutSwapBuffers</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_handle_screenshot</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_draw_texts</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="c1"># draw user text</span>
        <span class="k">for</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">),</span> <span class="n">text</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">user_texts</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_draw_text</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">text</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">text_color</span><span class="p">)</span>

        <span class="c1"># draw fps text</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">specs</span><span class="p">[</span><span class="s1">&#39;draw_fps&#39;</span><span class="p">]:</span>
            <span class="n">t</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">t</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">fps_last</span> <span class="o">&gt;</span> <span class="mf">1.0</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">fps_last</span> <span class="o">=</span> <span class="n">t</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">fps</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fps_count</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">fps_count</span> <span class="o">=</span> <span class="mi">0</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">_draw_text</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="n">f</span><span class="s2">&quot;</span><span class="si">{self.fps}</span><span class="s2"> fps&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">text_color</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_draw_text</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="n">f</span><span class="s2">&quot;{1000.0 / self.fps} ms/frame&quot;</span><span class="p">,</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">text_color</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fps_count</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="c1"># draw particle info</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">show_system_info</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_draw_sysinfo_dict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">system_info</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">info_id</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_draw_particle_dict</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">highlighted_particle</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_len_attr</span><span class="p">)</span>

        <span class="c1"># indicate screen capture</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">screenshot_captured</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">take_screenshot</span><span class="p">:</span>
            <span class="n">col</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">text_color</span><span class="p">)</span>
            <span class="n">ts</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">screenshot_capture_time</span>
            <span class="n">fadetime</span> <span class="o">=</span> <span class="mf">2.0</span>
            <span class="n">col</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">-</span> <span class="n">ts</span> <span class="o">/</span> <span class="n">fadetime</span>
            <span class="k">if</span> <span class="n">ts</span> <span class="o">&gt;</span> <span class="n">fadetime</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">screenshot_captured</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_draw_text</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">specs</span><span class="p">[</span><span class="s1">&#39;window_size&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">screenshot_capture_txt</span><span class="p">)</span> <span class="o">*</span> <span class="mf">9.0</span> <span class="o">-</span> <span class="mi">15</span><span class="p">,</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">specs</span><span class="p">[</span><span class="s1">&#39;window_size&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="mi">15</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">screenshot_capture_txt</span><span class="p">,</span> <span class="n">col</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_draw_sysinfo_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sysinfo_dict</span><span class="p">):</span>
        <span class="n">y</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value_list</span> <span class="ow">in</span> <span class="n">sysinfo_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="c1"># category title</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_draw_text</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">specs</span><span class="p">[</span><span class="s1">&#39;window_size&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="mi">10</span> <span class="o">-</span> <span class="mi">15</span> <span class="o">*</span> <span class="n">y</span><span class="p">,</span>
                            <span class="n">f</span><span class="s2">&quot;</span><span class="si">{key}</span><span class="s2">:&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">text_color</span><span class="p">)</span>
            <span class="c1"># item list</span>
            <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">value_list</span><span class="p">:</span>
                <span class="n">txt</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
                <span class="n">n_lines</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span>
                    <span class="nb">len</span><span class="p">(</span><span class="n">txt</span><span class="p">)</span> <span class="o">*</span> <span class="mf">9.0</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">specs</span><span class="p">[</span><span class="s1">&#39;window_size&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span> <span class="o">+</span> <span class="mi">1</span>
                <span class="n">chars_per_line</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">specs</span><span class="p">[</span><span class="s1">&#39;window_size&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="mi">9</span><span class="p">)</span> <span class="o">-</span> <span class="mi">4</span>
                <span class="k">if</span> <span class="n">chars_per_line</span> <span class="o">&lt;</span> <span class="mi">20</span><span class="p">:</span>
                    <span class="k">break</span>
                <span class="n">ls</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_lines</span><span class="p">):</span>
                    <span class="n">y</span> <span class="o">+=</span> <span class="mi">1</span>
                    <span class="n">line_txt</span> <span class="o">=</span> <span class="n">txt</span><span class="p">[</span><span class="n">ls</span><span class="p">:</span><span class="n">ls</span> <span class="o">+</span> <span class="n">chars_per_line</span><span class="p">]</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_draw_text</span><span class="p">(</span>
                        <span class="mi">30</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">specs</span><span class="p">[</span><span class="s1">&#39;window_size&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="mi">10</span> <span class="o">-</span> <span class="mi">15</span> <span class="o">*</span> <span class="n">y</span><span class="p">,</span>
                        <span class="n">line_txt</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">text_color</span><span class="p">)</span>
                    <span class="n">ls</span> <span class="o">+=</span> <span class="n">chars_per_line</span>
            <span class="n">y</span> <span class="o">+=</span> <span class="mf">1.5</span>

    <span class="k">def</span> <span class="nf">_draw_particle_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">particle_dict</span><span class="p">,</span> <span class="n">max_len</span><span class="p">):</span>
        <span class="n">y</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">particle_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">txt</span> <span class="o">=</span> <span class="n">f</span><span class="s2">&quot;</span><span class="si">{k}</span><span class="s2"> {(max_len - len(k)) * &#39; &#39;} </span><span class="si">{v}</span><span class="s2">&quot;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_draw_text</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">specs</span><span class="p">[</span><span class="s1">&#39;window_size&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="mi">10</span> <span class="o">-</span> <span class="mi">15</span> <span class="o">*</span> <span class="n">y</span><span class="p">,</span>
                            <span class="n">txt</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">text_color</span><span class="p">)</span>
            <span class="n">y</span> <span class="o">+=</span> <span class="mi">1</span>

    <span class="c1"># called on window position/size change</span>
    <span class="k">def</span> <span class="nf">_reshape_window</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">h</span><span class="p">):</span>
        <span class="n">OpenGL</span><span class="o">.</span><span class="n">GL</span><span class="o">.</span><span class="n">glViewport</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">h</span><span class="p">)</span>
        <span class="n">OpenGL</span><span class="o">.</span><span class="n">GL</span><span class="o">.</span><span class="n">glMatrixMode</span><span class="p">(</span><span class="n">OpenGL</span><span class="o">.</span><span class="n">GL</span><span class="o">.</span><span class="n">GL_PROJECTION</span><span class="p">)</span>
        <span class="n">OpenGL</span><span class="o">.</span><span class="n">GL</span><span class="o">.</span><span class="n">glLoadIdentity</span><span class="p">()</span>
        <span class="n">box_diag</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">system</span><span class="o">.</span><span class="n">box_l</span><span class="p">)</span>
        <span class="n">OpenGL</span><span class="o">.</span><span class="n">GLU</span><span class="o">.</span><span class="n">gluPerspective</span><span class="p">(</span><span class="mi">40</span><span class="p">,</span> <span class="mf">1.0</span> <span class="o">*</span> <span class="n">w</span> <span class="o">/</span> <span class="n">h</span><span class="p">,</span>
                                  <span class="bp">self</span><span class="o">.</span><span class="n">specs</span><span class="p">[</span><span class="s1">&#39;close_cut_distance&#39;</span><span class="p">],</span>
                                  <span class="bp">self</span><span class="o">.</span><span class="n">specs</span><span class="p">[</span><span class="s1">&#39;far_cut_distance&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">box_diag</span><span class="p">)</span>
        <span class="n">OpenGL</span><span class="o">.</span><span class="n">GL</span><span class="o">.</span><span class="n">glMatrixMode</span><span class="p">(</span><span class="n">OpenGL</span><span class="o">.</span><span class="n">GL</span><span class="o">.</span><span class="n">GL_MODELVIEW</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">specs</span><span class="p">[</span><span class="s1">&#39;window_size&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">w</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">specs</span><span class="p">[</span><span class="s1">&#39;window_size&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">h</span>

    <span class="c1"># inits for GLUT functions</span>
    <span class="k">def</span> <span class="nf">_init_OpenGL_callbacks</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># OpenGL callbacks</span>
        <span class="k">def</span> <span class="nf">display</span><span class="p">():</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">hasParticleData</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">glut_main_loop_started</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_display_all</span><span class="p">()</span>

        <span class="c1"># pylint: disable=unused-argument</span>
        <span class="k">def</span> <span class="nf">keyboard_up</span><span class="p">(</span><span class="n">button</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">button</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">):</span>
                <span class="n">button</span> <span class="o">=</span> <span class="n">button</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">keyboard_manager</span><span class="o">.</span><span class="n">keyboard_up</span><span class="p">(</span><span class="n">button</span><span class="p">)</span>

        <span class="c1"># pylint: disable=unused-argument</span>
        <span class="k">def</span> <span class="nf">keyboard_down</span><span class="p">(</span><span class="n">button</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">button</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">):</span>
                <span class="n">button</span> <span class="o">=</span> <span class="n">button</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">keyboard_manager</span><span class="o">.</span><span class="n">keyboard_down</span><span class="p">(</span><span class="n">button</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">mouse</span><span class="p">(</span><span class="n">button</span><span class="p">,</span> <span class="n">state</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mouse_manager</span><span class="o">.</span><span class="n">mouse_click</span><span class="p">(</span><span class="n">button</span><span class="p">,</span> <span class="n">state</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">motion</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mouse_manager</span><span class="o">.</span><span class="n">mouse_move</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">redraw_on_idle</span><span class="p">():</span>
            <span class="c1"># don&#39;t repost faster than 60 fps</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">last_draw</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="mf">60.0</span><span class="p">:</span>
                <span class="n">OpenGL</span><span class="o">.</span><span class="n">GLUT</span><span class="o">.</span><span class="n">glutPostRedisplay</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">last_draw</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>

        <span class="k">def</span> <span class="nf">reshape_callback</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="n">h</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_reshape_window</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="n">h</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">close_window</span><span class="p">():</span>
            <span class="n">os</span><span class="o">.</span><span class="n">_exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

        <span class="n">OpenGL</span><span class="o">.</span><span class="n">GLUT</span><span class="o">.</span><span class="n">glutDisplayFunc</span><span class="p">(</span><span class="n">display</span><span class="p">)</span>
        <span class="n">OpenGL</span><span class="o">.</span><span class="n">GLUT</span><span class="o">.</span><span class="n">glutMouseFunc</span><span class="p">(</span><span class="n">mouse</span><span class="p">)</span>
        <span class="n">OpenGL</span><span class="o">.</span><span class="n">GLUT</span><span class="o">.</span><span class="n">glutKeyboardFunc</span><span class="p">(</span><span class="n">keyboard_down</span><span class="p">)</span>
        <span class="n">OpenGL</span><span class="o">.</span><span class="n">GLUT</span><span class="o">.</span><span class="n">glutKeyboardUpFunc</span><span class="p">(</span><span class="n">keyboard_up</span><span class="p">)</span>
        <span class="n">OpenGL</span><span class="o">.</span><span class="n">GLUT</span><span class="o">.</span><span class="n">glutSpecialFunc</span><span class="p">(</span><span class="n">keyboard_down</span><span class="p">)</span>
        <span class="n">OpenGL</span><span class="o">.</span><span class="n">GLUT</span><span class="o">.</span><span class="n">glutSpecialUpFunc</span><span class="p">(</span><span class="n">keyboard_up</span><span class="p">)</span>
        <span class="n">OpenGL</span><span class="o">.</span><span class="n">GLUT</span><span class="o">.</span><span class="n">glutReshapeFunc</span><span class="p">(</span><span class="n">reshape_callback</span><span class="p">)</span>
        <span class="n">OpenGL</span><span class="o">.</span><span class="n">GLUT</span><span class="o">.</span><span class="n">glutMotionFunc</span><span class="p">(</span><span class="n">motion</span><span class="p">)</span>
        <span class="n">OpenGL</span><span class="o">.</span><span class="n">GLUT</span><span class="o">.</span><span class="n">glutWMCloseFunc</span><span class="p">(</span><span class="n">close_window</span><span class="p">)</span>
        <span class="n">OpenGL</span><span class="o">.</span><span class="n">GLUT</span><span class="o">.</span><span class="n">glutIdleFunc</span><span class="p">(</span><span class="n">redraw_on_idle</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_init_timers</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Starts infinite loops of timed function callbacks.</span>

<span class="sd">        Using `OpenGL.GLUT.glutTimerFunc()` a timed function callback is</span>
<span class="sd">        registered that after (at least) the specified time calls a</span>
<span class="sd">        specific function, which re-registers a timed callback to itself</span>
<span class="sd">        plus does some other stuff.</span>
<span class="sd">        Per callback registered in `self.timers`, one such infinite</span>
<span class="sd">        callback loop is started.</span>
<span class="sd">        In addition, potential keyboard input is handled every (at least)</span>
<span class="sd">        17 ms, corresponding to a rate of ~60 1/s.</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># timers for register_callback</span>
        <span class="k">def</span> <span class="nf">dummy_timer</span><span class="p">(</span><span class="n">index</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">timers</span><span class="p">[</span><span class="n">index</span><span class="p">][</span><span class="mi">1</span><span class="p">]()</span>
            <span class="n">OpenGL</span><span class="o">.</span><span class="n">GLUT</span><span class="o">.</span><span class="n">glutTimerFunc</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">timers</span><span class="p">[</span><span class="n">index</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">dummy_timer</span><span class="p">,</span> <span class="n">index</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">timer</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">timers</span><span class="p">):</span>
            <span class="n">OpenGL</span><span class="o">.</span><span class="n">GLUT</span><span class="o">.</span><span class="n">glutTimerFunc</span><span class="p">(</span><span class="n">timer</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">dummy_timer</span><span class="p">,</span> <span class="n">index</span><span class="p">)</span>

        <span class="c1"># handle input with 60 fps</span>
        <span class="c1"># pylint: disable=unused-argument</span>
        <span class="k">def</span> <span class="nf">timed_handle_input</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">keyboard_manager</span><span class="o">.</span><span class="n">handle_input</span><span class="p">()</span>
            <span class="n">OpenGL</span><span class="o">.</span><span class="n">GLUT</span><span class="o">.</span><span class="n">glutTimerFunc</span><span class="p">(</span><span class="mi">17</span><span class="p">,</span> <span class="n">timed_handle_input</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>

        <span class="n">OpenGL</span><span class="o">.</span><span class="n">GLUT</span><span class="o">.</span><span class="n">glutTimerFunc</span><span class="p">(</span><span class="mi">17</span><span class="p">,</span> <span class="n">timed_handle_input</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>

    <span class="c1"># click on particle: drag; click on background: change camera angle.</span>
    <span class="k">def</span> <span class="nf">_mouse_motion</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mouse_pos</span><span class="p">,</span> <span class="n">mouse_pos_old</span><span class="p">,</span> <span class="n">mouse_button_state</span><span class="p">):</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">specs</span><span class="p">[</span><span class="s1">&#39;drag_enabled&#39;</span><span class="p">]</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">drag_id</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
            <span class="n">part_pos</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">particles</span><span class="p">[</span><span class="s1">&#39;pos&#39;</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">drag_id</span><span class="p">]</span>
            <span class="n">viewport</span> <span class="o">=</span> <span class="n">OpenGL</span><span class="o">.</span><span class="n">GL</span><span class="o">.</span><span class="n">glGetIntegerv</span><span class="p">(</span><span class="n">OpenGL</span><span class="o">.</span><span class="n">GL</span><span class="o">.</span><span class="n">GL_VIEWPORT</span><span class="p">)</span>
            <span class="n">mouse_world</span> <span class="o">=</span> <span class="n">OpenGL</span><span class="o">.</span><span class="n">GLU</span><span class="o">.</span><span class="n">gluUnProject</span><span class="p">(</span>
                <span class="n">mouse_pos</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">viewport</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">-</span> <span class="n">mouse_pos</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">depth</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">dragExtForce</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">specs</span><span class="p">[</span><span class="s1">&#39;drag_force&#39;</span><span class="p">]</span> <span class="o">*</span> \
                <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">mouse_world</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">part_pos</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">trigger_set_particle_drag</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">camera</span><span class="o">.</span><span class="n">rotate_camera</span><span class="p">(</span><span class="n">mouse_pos</span><span class="p">,</span> <span class="n">mouse_pos_old</span><span class="p">,</span>
                                      <span class="n">mouse_button_state</span><span class="p">)</span>

    <span class="c1"># re-draw scene without light to identify particle id by pixel color</span>
    <span class="k">def</span> <span class="nf">_get_particle_id</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pos</span><span class="p">):</span>

        <span class="n">OpenGL</span><span class="o">.</span><span class="n">GL</span><span class="o">.</span><span class="n">glClearColor</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>
        <span class="n">OpenGL</span><span class="o">.</span><span class="n">GL</span><span class="o">.</span><span class="n">glClear</span><span class="p">(</span>
            <span class="n">OpenGL</span><span class="o">.</span><span class="n">GL</span><span class="o">.</span><span class="n">GL_COLOR_BUFFER_BIT</span> <span class="o">|</span> <span class="n">OpenGL</span><span class="o">.</span><span class="n">GL</span><span class="o">.</span><span class="n">GL_DEPTH_BUFFER_BIT</span><span class="p">)</span>

        <span class="n">OpenGL</span><span class="o">.</span><span class="n">GL</span><span class="o">.</span><span class="n">glLoadMatrixf</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">camera</span><span class="o">.</span><span class="n">modelview</span><span class="p">)</span>

        <span class="n">OpenGL</span><span class="o">.</span><span class="n">GL</span><span class="o">.</span><span class="n">glDisable</span><span class="p">(</span><span class="n">OpenGL</span><span class="o">.</span><span class="n">GL</span><span class="o">.</span><span class="n">GL_LIGHTING</span><span class="p">)</span>
        <span class="n">OpenGL</span><span class="o">.</span><span class="n">GL</span><span class="o">.</span><span class="n">glDisable</span><span class="p">(</span><span class="n">OpenGL</span><span class="o">.</span><span class="n">GL</span><span class="o">.</span><span class="n">GL_LIGHT0</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">specs</span><span class="p">[</span><span class="s1">&#39;spotlight_enabled&#39;</span><span class="p">]:</span>
            <span class="n">OpenGL</span><span class="o">.</span><span class="n">GL</span><span class="o">.</span><span class="n">glDisable</span><span class="p">(</span><span class="n">OpenGL</span><span class="o">.</span><span class="n">GL</span><span class="o">.</span><span class="n">GL_LIGHT1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_draw_system_particles</span><span class="p">(</span><span class="n">color_by_id</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">viewport</span> <span class="o">=</span> <span class="n">OpenGL</span><span class="o">.</span><span class="n">GL</span><span class="o">.</span><span class="n">glGetIntegerv</span><span class="p">(</span><span class="n">OpenGL</span><span class="o">.</span><span class="n">GL</span><span class="o">.</span><span class="n">GL_VIEWPORT</span><span class="p">)</span>

        <span class="n">read_pixel</span> <span class="o">=</span> <span class="n">OpenGL</span><span class="o">.</span><span class="n">GL</span><span class="o">.</span><span class="n">glReadPixelsui</span><span class="p">(</span>
            <span class="n">pos</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">viewport</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">-</span> <span class="n">pos</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span>
            <span class="n">OpenGL</span><span class="o">.</span><span class="n">GL</span><span class="o">.</span><span class="n">GL_RGB</span><span class="p">,</span> <span class="n">OpenGL</span><span class="o">.</span><span class="n">GL</span><span class="o">.</span><span class="n">GL_FLOAT</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">depth</span> <span class="o">=</span> <span class="n">OpenGL</span><span class="o">.</span><span class="n">GL</span><span class="o">.</span><span class="n">glReadPixelsf</span><span class="p">(</span>
            <span class="n">pos</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">viewport</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">-</span> <span class="n">pos</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span>
            <span class="n">OpenGL</span><span class="o">.</span><span class="n">GL</span><span class="o">.</span><span class="n">GL_DEPTH_COMPONENT</span><span class="p">,</span> <span class="n">OpenGL</span><span class="o">.</span><span class="n">GL</span><span class="o">.</span><span class="n">GL_FLOAT</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>

        <span class="n">part_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fcolor_to_id</span><span class="p">(</span><span class="n">read_pixel</span><span class="p">)</span>

        <span class="n">OpenGL</span><span class="o">.</span><span class="n">GL</span><span class="o">.</span><span class="n">glEnable</span><span class="p">(</span><span class="n">OpenGL</span><span class="o">.</span><span class="n">GL</span><span class="o">.</span><span class="n">GL_LIGHTING</span><span class="p">)</span>
        <span class="n">OpenGL</span><span class="o">.</span><span class="n">GL</span><span class="o">.</span><span class="n">glEnable</span><span class="p">(</span><span class="n">OpenGL</span><span class="o">.</span><span class="n">GL</span><span class="o">.</span><span class="n">GL_LIGHT0</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">specs</span><span class="p">[</span><span class="s1">&#39;spotlight_enabled&#39;</span><span class="p">]:</span>
            <span class="n">OpenGL</span><span class="o">.</span><span class="n">GL</span><span class="o">.</span><span class="n">glEnable</span><span class="p">(</span><span class="n">OpenGL</span><span class="o">.</span><span class="n">GL</span><span class="o">.</span><span class="n">GL_LIGHT1</span><span class="p">)</span>
        <span class="n">OpenGL</span><span class="o">.</span><span class="n">GL</span><span class="o">.</span><span class="n">glClearColor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">specs</span><span class="p">[</span><span class="s1">&#39;background_color&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span>
                               <span class="bp">self</span><span class="o">.</span><span class="n">specs</span><span class="p">[</span><span class="s1">&#39;background_color&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span>
                               <span class="bp">self</span><span class="o">.</span><span class="n">specs</span><span class="p">[</span><span class="s1">&#39;background_color&#39;</span><span class="p">][</span><span class="mi">2</span><span class="p">],</span> <span class="mf">1.</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">part_id</span><span class="p">,</span> <span class="n">depth</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_id_to_fcolor</span><span class="p">(</span><span class="n">part_id</span><span class="p">):</span>
        <span class="n">part_id</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">return</span> <span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">part_id</span> <span class="o">/</span> <span class="mi">256</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="mf">255.0</span><span class="p">,</span>
                <span class="nb">int</span><span class="p">((</span><span class="n">part_id</span> <span class="o">%</span> <span class="mi">256</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="mi">256</span><span class="p">)</span> <span class="o">/</span> <span class="mf">255.0</span><span class="p">,</span>
                <span class="p">(</span><span class="n">part_id</span> <span class="o">%</span> <span class="mi">256</span><span class="p">)</span> <span class="o">/</span> <span class="mf">255.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">]</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_fcolor_to_id</span><span class="p">(</span><span class="n">fcolor</span><span class="p">):</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">fcolor</span> <span class="o">==</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span><span class="o">.</span><span class="n">all</span><span class="p">():</span>
            <span class="k">return</span> <span class="o">-</span><span class="mi">1</span>
        <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="n">fcolor</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="mi">255</span><span class="p">)</span> <span class="o">*</span> <span class="mi">256</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> \
            <span class="nb">int</span><span class="p">(</span><span class="n">fcolor</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="mi">255</span><span class="p">)</span> <span class="o">*</span> <span class="mi">256</span> <span class="o">+</span> \
            <span class="nb">int</span><span class="p">(</span><span class="n">fcolor</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">*</span> <span class="mi">255</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>

    <span class="c1"># pylint: disable=unused-argument</span>
    <span class="k">def</span> <span class="nf">_set_particle_drag</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pos</span><span class="p">,</span> <span class="n">pos_old</span><span class="p">):</span>
        <span class="n">part_id</span><span class="p">,</span> <span class="n">depth</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_particle_id</span><span class="p">(</span><span class="n">pos</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">drag_id</span> <span class="o">=</span> <span class="n">part_id</span>

        <span class="k">if</span> <span class="n">part_id</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dragPosInitial</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">particles</span><span class="p">[</span><span class="s1">&#39;pos&#39;</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">drag_id</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">extForceOld</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">particles</span><span class="p">[</span><span class="s1">&#39;ext_force&#39;</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">drag_id</span><span class="p">][:]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">depth</span> <span class="o">=</span> <span class="n">depth</span>

    <span class="c1"># pylint: disable=unused-argument</span>
    <span class="k">def</span> <span class="nf">_reset_particle_drag</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pos</span><span class="p">,</span> <span class="n">pos_old</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">drag_id</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">trigger_reset_particle_drag</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="nf">_get_particle_info</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pos</span><span class="p">,</span> <span class="n">pos_old</span><span class="p">):</span>
        <span class="n">part_id</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_particle_id</span><span class="p">(</span><span class="n">pos</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">show_system_info</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">show_system_info</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">elif</span> <span class="n">part_id</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">info_id</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">show_system_info</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">update_system_info</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">info_id</span> <span class="o">=</span> <span class="n">part_id</span>

    <span class="k">def</span> <span class="nf">_next_particle_info</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">info_id</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">info_id</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">particles</span><span class="p">[</span><span class="s1">&#39;pos&#39;</span><span class="p">])</span>

    <span class="k">def</span> <span class="nf">_previous_particle_info</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">info_id</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">info_id</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">particles</span><span class="p">[</span><span class="s1">&#39;pos&#39;</span><span class="p">])</span>

    <span class="k">def</span> <span class="nf">_init_espresso_visualization</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># initialize properties that depend on the ESPResSo system</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">max_q</span> <span class="o">=</span> <span class="mf">0.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">min_q</span> <span class="o">=</span> <span class="mf">0.</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">drag_id</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">info_id</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">show_system_info</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dragPosInitial</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">extForceOld</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dragExtForceOld</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">trigger_reset_particle_drag</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">trigger_set_particle_drag</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">depth</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="c1"># LOOK FOR LB ACTOR</span>
        <span class="n">lb_types</span> <span class="o">=</span> <span class="p">[</span><span class="n">espressomd</span><span class="o">.</span><span class="n">lb</span><span class="o">.</span><span class="n">LBFluid</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">espressomd</span><span class="o">.</span><span class="n">has_features</span><span class="p">(</span><span class="s1">&#39;CUDA&#39;</span><span class="p">):</span>
            <span class="n">lb_types</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">espressomd</span><span class="o">.</span><span class="n">lb</span><span class="o">.</span><span class="n">LBFluidGPU</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">actor</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">system</span><span class="o">.</span><span class="n">actors</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">actor</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">lb_types</span><span class="p">)):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lb_params</span> <span class="o">=</span> <span class="n">actor</span><span class="o">.</span><span class="n">get_params</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lb</span> <span class="o">=</span> <span class="n">actor</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lb_is_cpu</span> <span class="o">=</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">actor</span><span class="p">,</span> <span class="n">espressomd</span><span class="o">.</span><span class="n">lb</span><span class="o">.</span><span class="n">LBFluid</span><span class="p">)</span>
                <span class="k">break</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">specs</span><span class="p">[</span><span class="s1">&#39;LB_draw_velocity_plane&#39;</span><span class="p">]:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">specs</span><span class="p">[</span><span class="s1">&#39;LB_plane_axis&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">pn</span> <span class="o">=</span> <span class="p">[</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lb_plane_b1</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lb_plane_b2</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">]</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">specs</span><span class="p">[</span><span class="s1">&#39;LB_plane_axis&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">pn</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lb_plane_b1</span> <span class="o">=</span> <span class="p">[</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lb_plane_b2</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">pn</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lb_plane_b1</span> <span class="o">=</span> <span class="p">[</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lb_plane_b2</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">]</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">lb_plane_b1</span> <span class="o">*=</span> <span class="bp">self</span><span class="o">.</span><span class="n">system</span><span class="o">.</span><span class="n">box_l</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lb_plane_b2</span> <span class="o">*=</span> <span class="bp">self</span><span class="o">.</span><span class="n">system</span><span class="o">.</span><span class="n">box_l</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lb_plane_p</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">pn</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">specs</span><span class="p">[</span><span class="s1">&#39;LB_plane_dist&#39;</span><span class="p">]</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">lb_arrow_radius</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">system</span><span class="o">.</span><span class="n">box_l</span><span class="p">[</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">specs</span><span class="p">[</span><span class="s1">&#39;LB_plane_axis&#39;</span><span class="p">]]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">specs</span><span class="p">[</span><span class="s1">&#39;LB_vel_radius_scale&#39;</span><span class="p">]</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">lb_min_vel</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="o">-</span><span class="mf">1e-6</span><span class="p">]</span> <span class="o">*</span> <span class="mi">3</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lb_max_vel</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">1e-6</span><span class="p">]</span> <span class="o">*</span> <span class="mi">3</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lb_vel_range</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lb_max_vel</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">lb_min_vel</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lb_min_dens</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="mi">3</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lb_max_dens</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="mi">3</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">_update_lb_velocity_plane</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_box_size_dependence</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_box_size_dependence</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># initialize properties that depend on the box geometry</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">specs</span><span class="p">[</span><span class="s1">&#39;draw_cells&#39;</span><span class="p">]</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">specs</span><span class="p">[</span><span class="s1">&#39;draw_nodes&#39;</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_update_nodes</span><span class="p">()</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">specs</span><span class="p">[</span><span class="s1">&#39;draw_cells&#39;</span><span class="p">]:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_update_cells</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">box_eqn</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">((</span><span class="mi">6</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>
        <span class="c1"># set face normals of box</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">box_eqn</span><span class="p">[:</span><span class="mi">3</span><span class="p">,</span> <span class="p">:</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">identity</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">box_eqn</span><span class="p">[</span><span class="mi">3</span><span class="p">:,</span> <span class="p">:</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">identity</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
        <span class="c1"># set face parameters of box</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">box_eqn</span><span class="p">[:</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.001</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">system</span><span class="o">.</span><span class="n">box_l</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">box_eqn</span><span class="p">[</span><span class="mi">3</span><span class="p">:,</span> <span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.001</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">system</span><span class="o">.</span><span class="n">box_l</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">camera</span><span class="o">.</span><span class="n">center</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">system</span><span class="o">.</span><span class="n">box_l</span><span class="p">)</span> <span class="o">*</span> <span class="mf">0.5</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">camera</span><span class="o">.</span><span class="n">update_modelview</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_init_controls</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># initialize mouse/keyboard event listeners</span>

        <span class="c1"># mouse look/rotate/drag</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mouse_manager</span><span class="o">.</span><span class="n">register_button</span><span class="p">(</span><span class="n">MouseButtonEvent</span><span class="p">(</span>
            <span class="kc">None</span><span class="p">,</span> <span class="n">MouseFireEvent</span><span class="o">.</span><span class="n">FreeMotion</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mouse_motion</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">mouse_manager</span><span class="o">.</span><span class="n">register_button</span><span class="p">(</span><span class="n">MouseButtonEvent</span><span class="p">(</span>
            <span class="mi">3</span><span class="p">,</span> <span class="n">MouseFireEvent</span><span class="o">.</span><span class="n">ButtonPressed</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">camera</span><span class="o">.</span><span class="n">move_backward</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">mouse_manager</span><span class="o">.</span><span class="n">register_button</span><span class="p">(</span><span class="n">MouseButtonEvent</span><span class="p">(</span>
            <span class="mi">4</span><span class="p">,</span> <span class="n">MouseFireEvent</span><span class="o">.</span><span class="n">ButtonPressed</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">camera</span><span class="o">.</span><span class="n">move_forward</span><span class="p">))</span>

        <span class="c1"># left mouse button to start/stop drag</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">specs</span><span class="p">[</span><span class="s1">&#39;drag_enabled&#39;</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mouse_manager</span><span class="o">.</span><span class="n">register_button</span><span class="p">(</span><span class="n">MouseButtonEvent</span><span class="p">(</span>
                <span class="n">OpenGL</span><span class="o">.</span><span class="n">GLUT</span><span class="o">.</span><span class="n">GLUT_LEFT_BUTTON</span><span class="p">,</span> <span class="n">MouseFireEvent</span><span class="o">.</span><span class="n">ButtonPressed</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_set_particle_drag</span><span class="p">,</span> <span class="kc">True</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mouse_manager</span><span class="o">.</span><span class="n">register_button</span><span class="p">(</span><span class="n">MouseButtonEvent</span><span class="p">(</span>
                <span class="n">OpenGL</span><span class="o">.</span><span class="n">GLUT</span><span class="o">.</span><span class="n">GLUT_LEFT_BUTTON</span><span class="p">,</span> <span class="n">MouseFireEvent</span><span class="o">.</span><span class="n">ButtonReleased</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_reset_particle_drag</span><span class="p">,</span> <span class="kc">True</span><span class="p">))</span>

        <span class="c1"># left mouse button for particle information</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mouse_manager</span><span class="o">.</span><span class="n">register_button</span><span class="p">(</span><span class="n">MouseButtonEvent</span><span class="p">(</span>
            <span class="n">OpenGL</span><span class="o">.</span><span class="n">GLUT</span><span class="o">.</span><span class="n">GLUT_LEFT_BUTTON</span><span class="p">,</span> <span class="n">MouseFireEvent</span><span class="o">.</span><span class="n">DoubleClick</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_particle_info</span><span class="p">,</span> <span class="kc">True</span><span class="p">))</span>

        <span class="c1"># left/right arrows to cycle through particles</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">keyboard_manager</span><span class="o">.</span><span class="n">register_button</span><span class="p">(</span><span class="n">KeyboardButtonEvent</span><span class="p">(</span>
            <span class="n">OpenGL</span><span class="o">.</span><span class="n">GLUT</span><span class="o">.</span><span class="n">GLUT_KEY_LEFT</span><span class="p">,</span> <span class="n">KeyboardFireEvent</span><span class="o">.</span><span class="n">Pressed</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_previous_particle_info</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">keyboard_manager</span><span class="o">.</span><span class="n">register_button</span><span class="p">(</span><span class="n">KeyboardButtonEvent</span><span class="p">(</span>
            <span class="n">OpenGL</span><span class="o">.</span><span class="n">GLUT</span><span class="o">.</span><span class="n">GLUT_KEY_RIGHT</span><span class="p">,</span> <span class="n">KeyboardFireEvent</span><span class="o">.</span><span class="n">Pressed</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_next_particle_info</span><span class="p">))</span>

        <span class="c1"># &lt;space&gt; key to pause integration thread</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">keyboard_manager</span><span class="o">.</span><span class="n">register_button</span><span class="p">(</span><span class="n">KeyboardButtonEvent</span><span class="p">(</span>
            <span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="n">KeyboardFireEvent</span><span class="o">.</span><span class="n">Pressed</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pause</span><span class="p">,</span> <span class="kc">True</span><span class="p">))</span>

        <span class="c1"># &lt;return&gt; key to take screenshot</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">keyboard_manager</span><span class="o">.</span><span class="n">register_button</span><span class="p">(</span><span class="n">KeyboardButtonEvent</span><span class="p">(</span>
            <span class="s1">&#39;</span><span class="se">\x0d</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">KeyboardFireEvent</span><span class="o">.</span><span class="n">Pressed</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_trigger_screenshot</span><span class="p">,</span> <span class="kc">True</span><span class="p">))</span>

        <span class="c1"># &lt;escape&gt; key to quit</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">keyboard_manager</span><span class="o">.</span><span class="n">register_button</span><span class="p">(</span><span class="n">KeyboardButtonEvent</span><span class="p">(</span>
            <span class="s1">&#39;</span><span class="se">\x1b</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">KeyboardFireEvent</span><span class="o">.</span><span class="n">Pressed</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_quit</span><span class="p">,</span> <span class="kc">True</span><span class="p">))</span>

        <span class="c1"># camera control via keyboard</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">keyboard_manager</span><span class="o">.</span><span class="n">register_button</span><span class="p">(</span><span class="n">KeyboardButtonEvent</span><span class="p">(</span>
            <span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="n">KeyboardFireEvent</span><span class="o">.</span><span class="n">Hold</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">camera</span><span class="o">.</span><span class="n">move_up</span><span class="p">,</span> <span class="kc">True</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">keyboard_manager</span><span class="o">.</span><span class="n">register_button</span><span class="p">(</span><span class="n">KeyboardButtonEvent</span><span class="p">(</span>
            <span class="s1">&#39;s&#39;</span><span class="p">,</span> <span class="n">KeyboardFireEvent</span><span class="o">.</span><span class="n">Hold</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">camera</span><span class="o">.</span><span class="n">move_down</span><span class="p">,</span> <span class="kc">True</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">keyboard_manager</span><span class="o">.</span><span class="n">register_button</span><span class="p">(</span><span class="n">KeyboardButtonEvent</span><span class="p">(</span>
            <span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="n">KeyboardFireEvent</span><span class="o">.</span><span class="n">Hold</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">camera</span><span class="o">.</span><span class="n">move_left</span><span class="p">,</span> <span class="kc">True</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">keyboard_manager</span><span class="o">.</span><span class="n">register_button</span><span class="p">(</span><span class="n">KeyboardButtonEvent</span><span class="p">(</span>
            <span class="s1">&#39;d&#39;</span><span class="p">,</span> <span class="n">KeyboardFireEvent</span><span class="o">.</span><span class="n">Hold</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">camera</span><span class="o">.</span><span class="n">move_right</span><span class="p">,</span> <span class="kc">True</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">keyboard_manager</span><span class="o">.</span><span class="n">register_button</span><span class="p">(</span><span class="n">KeyboardButtonEvent</span><span class="p">(</span>
            <span class="s1">&#39;e&#39;</span><span class="p">,</span> <span class="n">KeyboardFireEvent</span><span class="o">.</span><span class="n">Hold</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">camera</span><span class="o">.</span><span class="n">rotate_system_XR</span><span class="p">,</span> <span class="kc">True</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">keyboard_manager</span><span class="o">.</span><span class="n">register_button</span><span class="p">(</span><span class="n">KeyboardButtonEvent</span><span class="p">(</span>
            <span class="s1">&#39;q&#39;</span><span class="p">,</span> <span class="n">KeyboardFireEvent</span><span class="o">.</span><span class="n">Hold</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">camera</span><span class="o">.</span><span class="n">rotate_system_XL</span><span class="p">,</span> <span class="kc">True</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">keyboard_manager</span><span class="o">.</span><span class="n">register_button</span><span class="p">(</span><span class="n">KeyboardButtonEvent</span><span class="p">(</span>
            <span class="s1">&#39;c&#39;</span><span class="p">,</span> <span class="n">KeyboardFireEvent</span><span class="o">.</span><span class="n">Hold</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">camera</span><span class="o">.</span><span class="n">rotate_system_YR</span><span class="p">,</span> <span class="kc">True</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">keyboard_manager</span><span class="o">.</span><span class="n">register_button</span><span class="p">(</span><span class="n">KeyboardButtonEvent</span><span class="p">(</span>
            <span class="s1">&#39;z&#39;</span><span class="p">,</span> <span class="n">KeyboardFireEvent</span><span class="o">.</span><span class="n">Hold</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">camera</span><span class="o">.</span><span class="n">rotate_system_YL</span><span class="p">,</span> <span class="kc">True</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">keyboard_manager</span><span class="o">.</span><span class="n">register_button</span><span class="p">(</span><span class="n">KeyboardButtonEvent</span><span class="p">(</span>
            <span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">KeyboardFireEvent</span><span class="o">.</span><span class="n">Hold</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">camera</span><span class="o">.</span><span class="n">rotate_system_ZR</span><span class="p">,</span> <span class="kc">True</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">keyboard_manager</span><span class="o">.</span><span class="n">register_button</span><span class="p">(</span><span class="n">KeyboardButtonEvent</span><span class="p">(</span>
            <span class="s1">&#39;f&#39;</span><span class="p">,</span> <span class="n">KeyboardFireEvent</span><span class="o">.</span><span class="n">Hold</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">camera</span><span class="o">.</span><span class="n">rotate_system_ZL</span><span class="p">,</span> <span class="kc">True</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">keyboard_manager</span><span class="o">.</span><span class="n">register_button</span><span class="p">(</span><span class="n">KeyboardButtonEvent</span><span class="p">(</span>
            <span class="s1">&#39;t&#39;</span><span class="p">,</span> <span class="n">KeyboardFireEvent</span><span class="o">.</span><span class="n">Hold</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">camera</span><span class="o">.</span><span class="n">move_forward</span><span class="p">,</span> <span class="kc">True</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">keyboard_manager</span><span class="o">.</span><span class="n">register_button</span><span class="p">(</span><span class="n">KeyboardButtonEvent</span><span class="p">(</span>
            <span class="s1">&#39;g&#39;</span><span class="p">,</span> <span class="n">KeyboardFireEvent</span><span class="o">.</span><span class="n">Hold</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">camera</span><span class="o">.</span><span class="n">move_backward</span><span class="p">,</span> <span class="kc">True</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_quit</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">quit_safely</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="nf">_pause</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">paused</span> <span class="o">=</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">paused</span>

    <span class="k">def</span> <span class="nf">_trigger_screenshot</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">take_screenshot</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="c1"># asynchronous parallel calls to glLight() causes segfaults, so only change</span>
    <span class="c1"># light at central display() method and trigger changes</span>
    <span class="k">def</span> <span class="nf">_set_camera_spotlight</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">specs</span><span class="p">[</span><span class="s1">&#39;spotlight_enabled&#39;</span><span class="p">]:</span>
            <span class="n">p</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">camera</span><span class="o">.</span><span class="n">cam_pos</span>
            <span class="n">fp</span> <span class="o">=</span> <span class="p">[</span><span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="mi">1</span><span class="p">]</span>
            <span class="n">OpenGL</span><span class="o">.</span><span class="n">GL</span><span class="o">.</span><span class="n">glLightfv</span><span class="p">(</span><span class="n">OpenGL</span><span class="o">.</span><span class="n">GL</span><span class="o">.</span><span class="n">GL_LIGHT1</span><span class="p">,</span> <span class="n">OpenGL</span><span class="o">.</span><span class="n">GL</span><span class="o">.</span><span class="n">GL_POSITION</span><span class="p">,</span> <span class="n">fp</span><span class="p">)</span>
            <span class="n">OpenGL</span><span class="o">.</span><span class="n">GL</span><span class="o">.</span><span class="n">glLightfv</span><span class="p">(</span>
                <span class="n">OpenGL</span><span class="o">.</span><span class="n">GL</span><span class="o">.</span><span class="n">GL_LIGHT1</span><span class="p">,</span>
                <span class="n">OpenGL</span><span class="o">.</span><span class="n">GL</span><span class="o">.</span><span class="n">GL_SPOT_DIRECTION</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">camera</span><span class="o">.</span><span class="n">state_target</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_init_camera</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">system</span><span class="o">.</span><span class="n">box_l</span><span class="p">)</span>
        <span class="n">box_diag</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>
        <span class="n">box_center</span> <span class="o">=</span> <span class="n">b</span> <span class="o">*</span> <span class="mf">0.5</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">specs</span><span class="p">[</span><span class="s1">&#39;camera_position&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;auto&#39;</span><span class="p">:</span>
            <span class="n">cp</span> <span class="o">=</span> <span class="p">[</span><span class="n">box_center</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">box_center</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">b</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">*</span> <span class="mi">3</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">cp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">specs</span><span class="p">[</span><span class="s1">&#39;camera_position&#39;</span><span class="p">]</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">specs</span><span class="p">[</span><span class="s1">&#39;camera_target&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;auto&#39;</span><span class="p">:</span>
            <span class="n">ct</span> <span class="o">=</span> <span class="n">box_center</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ct</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">specs</span><span class="p">[</span><span class="s1">&#39;camera_target&#39;</span><span class="p">]</span>

        <span class="n">cr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">specs</span><span class="p">[</span><span class="s1">&#39;camera_right&#39;</span><span class="p">])</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_set_camera_spotlight</span><span class="p">()</span>

        <span class="k">return</span> <span class="n">Camera</span><span class="p">(</span><span class="n">cam_pos</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">cp</span><span class="p">),</span> <span class="n">cam_target</span><span class="o">=</span><span class="n">ct</span><span class="p">,</span> <span class="n">cam_right</span><span class="o">=</span><span class="n">cr</span><span class="p">,</span>
                      <span class="n">move_speed</span><span class="o">=</span><span class="mf">0.5</span> <span class="o">*</span> <span class="n">box_diag</span> <span class="o">/</span> <span class="mf">17.0</span><span class="p">,</span> <span class="n">center</span><span class="o">=</span><span class="n">box_center</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_init_opengl</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">OpenGL</span><span class="o">.</span><span class="n">GLUT</span><span class="o">.</span><span class="n">glutInit</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">specs</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">])</span>
        <span class="n">OpenGL</span><span class="o">.</span><span class="n">GLUT</span><span class="o">.</span><span class="n">glutInitDisplayMode</span><span class="p">(</span>
            <span class="n">OpenGL</span><span class="o">.</span><span class="n">GLUT</span><span class="o">.</span><span class="n">GLUT_DOUBLE</span> <span class="o">|</span> <span class="n">OpenGL</span><span class="o">.</span><span class="n">GLUT</span><span class="o">.</span><span class="n">GLUT_RGB</span> <span class="o">|</span> <span class="n">OpenGL</span><span class="o">.</span><span class="n">GLUT</span><span class="o">.</span><span class="n">GLUT_DEPTH</span><span class="p">)</span>

        <span class="n">OpenGL</span><span class="o">.</span><span class="n">GLUT</span><span class="o">.</span><span class="n">glutInitWindowSize</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">specs</span><span class="p">[</span><span class="s1">&#39;window_size&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span>
                                       <span class="bp">self</span><span class="o">.</span><span class="n">specs</span><span class="p">[</span><span class="s1">&#39;window_size&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>

        <span class="n">OpenGL</span><span class="o">.</span><span class="n">GLUT</span><span class="o">.</span><span class="n">glutCreateWindow</span><span class="p">(</span><span class="sa">b</span><span class="s2">&quot;ESPResSo visualization&quot;</span><span class="p">)</span>

        <span class="n">OpenGL</span><span class="o">.</span><span class="n">GL</span><span class="o">.</span><span class="n">glClearColor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">specs</span><span class="p">[</span><span class="s1">&#39;background_color&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span>
                               <span class="bp">self</span><span class="o">.</span><span class="n">specs</span><span class="p">[</span><span class="s1">&#39;background_color&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span>
                               <span class="bp">self</span><span class="o">.</span><span class="n">specs</span><span class="p">[</span><span class="s1">&#39;background_color&#39;</span><span class="p">][</span><span class="mi">2</span><span class="p">],</span> <span class="mf">1.</span><span class="p">)</span>

        <span class="n">OpenGL</span><span class="o">.</span><span class="n">GL</span><span class="o">.</span><span class="n">glEnable</span><span class="p">(</span><span class="n">OpenGL</span><span class="o">.</span><span class="n">GL</span><span class="o">.</span><span class="n">GL_BLEND</span><span class="p">)</span>
        <span class="n">OpenGL</span><span class="o">.</span><span class="n">GL</span><span class="o">.</span><span class="n">glBlendFunc</span><span class="p">(</span>
            <span class="n">OpenGL</span><span class="o">.</span><span class="n">GL</span><span class="o">.</span><span class="n">GL_SRC_ALPHA</span><span class="p">,</span>
            <span class="n">OpenGL</span><span class="o">.</span><span class="n">GL</span><span class="o">.</span><span class="n">GL_ONE_MINUS_SRC_ALPHA</span><span class="p">)</span>

        <span class="n">OpenGL</span><span class="o">.</span><span class="n">GL</span><span class="o">.</span><span class="n">glEnable</span><span class="p">(</span><span class="n">OpenGL</span><span class="o">.</span><span class="n">GL</span><span class="o">.</span><span class="n">GL_POINT_SMOOTH</span><span class="p">)</span>
        <span class="n">OpenGL</span><span class="o">.</span><span class="n">GL</span><span class="o">.</span><span class="n">glEnable</span><span class="p">(</span><span class="n">OpenGL</span><span class="o">.</span><span class="n">GL</span><span class="o">.</span><span class="n">GL_LINE_SMOOTH</span><span class="p">)</span>
        <span class="n">OpenGL</span><span class="o">.</span><span class="n">GL</span><span class="o">.</span><span class="n">glHint</span><span class="p">(</span><span class="n">OpenGL</span><span class="o">.</span><span class="n">GL</span><span class="o">.</span><span class="n">GL_LINE_SMOOTH_HINT</span><span class="p">,</span> <span class="n">OpenGL</span><span class="o">.</span><span class="n">GL</span><span class="o">.</span><span class="n">GL_NICEST</span><span class="p">)</span>

        <span class="c1"># bad for transparent particles</span>
        <span class="c1"># OpenGL.GL.glEnable(OpenGL.GL.GL_CULL_FACE)</span>
        <span class="c1"># OpenGL.GL.glCullFace(OpenGL.GL.GL_BACK)</span>

        <span class="n">OpenGL</span><span class="o">.</span><span class="n">GL</span><span class="o">.</span><span class="n">glLineWidth</span><span class="p">(</span><span class="mf">2.0</span><span class="p">)</span>
        <span class="n">OpenGL</span><span class="o">.</span><span class="n">GLUT</span><span class="o">.</span><span class="n">glutIgnoreKeyRepeat</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

        <span class="c1"># setup lighting</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">specs</span><span class="p">[</span><span class="s1">&#39;light_size&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;auto&#39;</span><span class="p">:</span>
            <span class="n">box_diag</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">system</span><span class="o">.</span><span class="n">box_l</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">specs</span><span class="p">[</span><span class="s1">&#39;light_size&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">box_diag</span> <span class="o">*</span> <span class="mf">2.0</span>

        <span class="n">OpenGL</span><span class="o">.</span><span class="n">GL</span><span class="o">.</span><span class="n">glEnable</span><span class="p">(</span><span class="n">OpenGL</span><span class="o">.</span><span class="n">GL</span><span class="o">.</span><span class="n">GL_DEPTH_TEST</span><span class="p">)</span>
        <span class="n">OpenGL</span><span class="o">.</span><span class="n">GL</span><span class="o">.</span><span class="n">glEnable</span><span class="p">(</span><span class="n">OpenGL</span><span class="o">.</span><span class="n">GL</span><span class="o">.</span><span class="n">GL_LIGHTING</span><span class="p">)</span>

        <span class="c1"># LIGHT0</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">specs</span><span class="p">[</span><span class="s1">&#39;light_pos&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;auto&#39;</span><span class="p">:</span>
            <span class="n">OpenGL</span><span class="o">.</span><span class="n">GL</span><span class="o">.</span><span class="n">glLightfv</span><span class="p">(</span><span class="n">OpenGL</span><span class="o">.</span><span class="n">GL</span><span class="o">.</span><span class="n">GL_LIGHT0</span><span class="p">,</span> <span class="n">OpenGL</span><span class="o">.</span><span class="n">GL</span><span class="o">.</span><span class="n">GL_POSITION</span><span class="p">,</span>
                                <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">specs</span><span class="p">[</span><span class="s1">&#39;light_pos&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">tolist</span><span class="p">())</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">OpenGL</span><span class="o">.</span><span class="n">GL</span><span class="o">.</span><span class="n">glLightfv</span><span class="p">(</span><span class="n">OpenGL</span><span class="o">.</span><span class="n">GL</span><span class="o">.</span><span class="n">GL_LIGHT0</span><span class="p">,</span> <span class="n">OpenGL</span><span class="o">.</span><span class="n">GL</span><span class="o">.</span><span class="n">GL_POSITION</span><span class="p">,</span>
                                <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">system</span><span class="o">.</span><span class="n">box_l</span><span class="p">)</span> <span class="o">*</span> <span class="mf">1.1</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">())</span>

        <span class="n">OpenGL</span><span class="o">.</span><span class="n">GL</span><span class="o">.</span><span class="n">glLightfv</span><span class="p">(</span>
            <span class="n">OpenGL</span><span class="o">.</span><span class="n">GL</span><span class="o">.</span><span class="n">GL_LIGHT0</span><span class="p">,</span>
            <span class="n">OpenGL</span><span class="o">.</span><span class="n">GL</span><span class="o">.</span><span class="n">GL_AMBIENT</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">specs</span><span class="p">[</span><span class="s1">&#39;light_colors&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">OpenGL</span><span class="o">.</span><span class="n">GL</span><span class="o">.</span><span class="n">glLightfv</span><span class="p">(</span>
            <span class="n">OpenGL</span><span class="o">.</span><span class="n">GL</span><span class="o">.</span><span class="n">GL_LIGHT0</span><span class="p">,</span>
            <span class="n">OpenGL</span><span class="o">.</span><span class="n">GL</span><span class="o">.</span><span class="n">GL_DIFFUSE</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">specs</span><span class="p">[</span><span class="s1">&#39;light_colors&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">OpenGL</span><span class="o">.</span><span class="n">GL</span><span class="o">.</span><span class="n">glLightfv</span><span class="p">(</span>
            <span class="n">OpenGL</span><span class="o">.</span><span class="n">GL</span><span class="o">.</span><span class="n">GL_LIGHT0</span><span class="p">,</span>
            <span class="n">OpenGL</span><span class="o">.</span><span class="n">GL</span><span class="o">.</span><span class="n">GL_SPECULAR</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">specs</span><span class="p">[</span><span class="s1">&#39;light_colors&#39;</span><span class="p">][</span><span class="mi">2</span><span class="p">])</span>

        <span class="n">OpenGL</span><span class="o">.</span><span class="n">GL</span><span class="o">.</span><span class="n">glLightf</span><span class="p">(</span>
            <span class="n">OpenGL</span><span class="o">.</span><span class="n">GL</span><span class="o">.</span><span class="n">GL_LIGHT0</span><span class="p">,</span> <span class="n">OpenGL</span><span class="o">.</span><span class="n">GL</span><span class="o">.</span><span class="n">GL_CONSTANT_ATTENUATION</span><span class="p">,</span>
            <span class="mf">1.0</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">specs</span><span class="p">[</span><span class="s1">&#39;light_brightness&#39;</span><span class="p">])</span>
        <span class="n">OpenGL</span><span class="o">.</span><span class="n">GL</span><span class="o">.</span><span class="n">glLightf</span><span class="p">(</span>
            <span class="n">OpenGL</span><span class="o">.</span><span class="n">GL</span><span class="o">.</span><span class="n">GL_LIGHT0</span><span class="p">,</span> <span class="n">OpenGL</span><span class="o">.</span><span class="n">GL</span><span class="o">.</span><span class="n">GL_LINEAR_ATTENUATION</span><span class="p">,</span>
            <span class="mf">1.0</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">specs</span><span class="p">[</span><span class="s1">&#39;light_size&#39;</span><span class="p">])</span>
        <span class="n">OpenGL</span><span class="o">.</span><span class="n">GL</span><span class="o">.</span><span class="n">glEnable</span><span class="p">(</span><span class="n">OpenGL</span><span class="o">.</span><span class="n">GL</span><span class="o">.</span><span class="n">GL_LIGHT0</span><span class="p">)</span>

        <span class="c1"># LIGHT1: spotlight on camera in look direction</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">specs</span><span class="p">[</span><span class="s1">&#39;spotlight_enabled&#39;</span><span class="p">]:</span>
            <span class="n">OpenGL</span><span class="o">.</span><span class="n">GL</span><span class="o">.</span><span class="n">glLightfv</span><span class="p">(</span>
                <span class="n">OpenGL</span><span class="o">.</span><span class="n">GL</span><span class="o">.</span><span class="n">GL_LIGHT1</span><span class="p">,</span>
                <span class="n">OpenGL</span><span class="o">.</span><span class="n">GL</span><span class="o">.</span><span class="n">GL_POSITION</span><span class="p">,</span>
                <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>

            <span class="n">OpenGL</span><span class="o">.</span><span class="n">GL</span><span class="o">.</span><span class="n">glLightfv</span><span class="p">(</span>
                <span class="n">OpenGL</span><span class="o">.</span><span class="n">GL</span><span class="o">.</span><span class="n">GL_LIGHT1</span><span class="p">,</span>
                <span class="n">OpenGL</span><span class="o">.</span><span class="n">GL</span><span class="o">.</span><span class="n">GL_AMBIENT</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">specs</span><span class="p">[</span><span class="s1">&#39;spotlight_colors&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">OpenGL</span><span class="o">.</span><span class="n">GL</span><span class="o">.</span><span class="n">glLightfv</span><span class="p">(</span>
                <span class="n">OpenGL</span><span class="o">.</span><span class="n">GL</span><span class="o">.</span><span class="n">GL_LIGHT1</span><span class="p">,</span>
                <span class="n">OpenGL</span><span class="o">.</span><span class="n">GL</span><span class="o">.</span><span class="n">GL_DIFFUSE</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">specs</span><span class="p">[</span><span class="s1">&#39;spotlight_colors&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">OpenGL</span><span class="o">.</span><span class="n">GL</span><span class="o">.</span><span class="n">glLightfv</span><span class="p">(</span><span class="n">OpenGL</span><span class="o">.</span><span class="n">GL</span><span class="o">.</span><span class="n">GL_LIGHT1</span><span class="p">,</span> <span class="n">OpenGL</span><span class="o">.</span><span class="n">GL</span><span class="o">.</span><span class="n">GL_SPECULAR</span><span class="p">,</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">specs</span><span class="p">[</span><span class="s1">&#39;spotlight_colors&#39;</span><span class="p">][</span><span class="mi">2</span><span class="p">])</span>

            <span class="n">OpenGL</span><span class="o">.</span><span class="n">GL</span><span class="o">.</span><span class="n">glLightf</span><span class="p">(</span>
                <span class="n">OpenGL</span><span class="o">.</span><span class="n">GL</span><span class="o">.</span><span class="n">GL_LIGHT1</span><span class="p">,</span>
                <span class="n">OpenGL</span><span class="o">.</span><span class="n">GL</span><span class="o">.</span><span class="n">GL_SPOT_CUTOFF</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">specs</span><span class="p">[</span><span class="s1">&#39;spotlight_angle&#39;</span><span class="p">])</span>
            <span class="n">OpenGL</span><span class="o">.</span><span class="n">GL</span><span class="o">.</span><span class="n">glLightfv</span><span class="p">(</span>
                <span class="n">OpenGL</span><span class="o">.</span><span class="n">GL</span><span class="o">.</span><span class="n">GL_LIGHT1</span><span class="p">,</span>
                <span class="n">OpenGL</span><span class="o">.</span><span class="n">GL</span><span class="o">.</span><span class="n">GL_SPOT_DIRECTION</span><span class="p">,</span>
                <span class="p">[</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">])</span>
            <span class="n">OpenGL</span><span class="o">.</span><span class="n">GL</span><span class="o">.</span><span class="n">glLightf</span><span class="p">(</span><span class="n">OpenGL</span><span class="o">.</span><span class="n">GL</span><span class="o">.</span><span class="n">GL_LIGHT1</span><span class="p">,</span> <span class="n">OpenGL</span><span class="o">.</span><span class="n">GL</span><span class="o">.</span><span class="n">GL_SPOT_EXPONENT</span><span class="p">,</span>
                               <span class="bp">self</span><span class="o">.</span><span class="n">specs</span><span class="p">[</span><span class="s1">&#39;spotlight_focus&#39;</span><span class="p">])</span>

            <span class="n">OpenGL</span><span class="o">.</span><span class="n">GL</span><span class="o">.</span><span class="n">glLightf</span><span class="p">(</span>
                <span class="n">OpenGL</span><span class="o">.</span><span class="n">GL</span><span class="o">.</span><span class="n">GL_LIGHT1</span><span class="p">,</span> <span class="n">OpenGL</span><span class="o">.</span><span class="n">GL</span><span class="o">.</span><span class="n">GL_CONSTANT_ATTENUATION</span><span class="p">,</span>
                <span class="mf">1.0</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">specs</span><span class="p">[</span><span class="s1">&#39;spotlight_brightness&#39;</span><span class="p">])</span>
            <span class="n">OpenGL</span><span class="o">.</span><span class="n">GL</span><span class="o">.</span><span class="n">glLightf</span><span class="p">(</span>
                <span class="n">OpenGL</span><span class="o">.</span><span class="n">GL</span><span class="o">.</span><span class="n">GL_LIGHT1</span><span class="p">,</span>
                <span class="n">OpenGL</span><span class="o">.</span><span class="n">GL</span><span class="o">.</span><span class="n">GL_LINEAR_ATTENUATION</span><span class="p">,</span>
                <span class="mf">0.0</span><span class="p">)</span>
            <span class="n">OpenGL</span><span class="o">.</span><span class="n">GL</span><span class="o">.</span><span class="n">glLightf</span><span class="p">(</span>
                <span class="n">OpenGL</span><span class="o">.</span><span class="n">GL</span><span class="o">.</span><span class="n">GL_LIGHT1</span><span class="p">,</span>
                <span class="n">OpenGL</span><span class="o">.</span><span class="n">GL</span><span class="o">.</span><span class="n">GL_QUADRATIC_ATTENUATION</span><span class="p">,</span>
                <span class="mf">0.0</span><span class="p">)</span>
            <span class="n">OpenGL</span><span class="o">.</span><span class="n">GL</span><span class="o">.</span><span class="n">glEnable</span><span class="p">(</span><span class="n">OpenGL</span><span class="o">.</span><span class="n">GL</span><span class="o">.</span><span class="n">GL_LIGHT1</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">dl_sphere</span> <span class="o">=</span> <span class="n">OpenGL</span><span class="o">.</span><span class="n">GL</span><span class="o">.</span><span class="n">glGenLists</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span></div>


<span class="c1"># END OF MAIN CLASS</span>

<div class="viewcode-block" id="Shape"><a class="viewcode-back" href="../../espressomd.html#espressomd.visualization.Shape">[docs]</a><span class="k">class</span> <span class="nc">Shape</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Shape base class in the visualizer context.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">shape</span><span class="p">,</span> <span class="n">particle_type</span><span class="p">,</span> <span class="n">color</span><span class="p">,</span> <span class="n">material</span><span class="p">,</span>
                 <span class="n">quality</span><span class="p">,</span> <span class="n">box_l</span><span class="p">,</span> <span class="n">rasterize_resolution</span><span class="p">,</span> <span class="n">rasterize_pointsize</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">shape</span> <span class="o">=</span> <span class="n">shape</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">particle_type</span> <span class="o">=</span> <span class="n">particle_type</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">color</span> <span class="o">=</span> <span class="n">color</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">material</span> <span class="o">=</span> <span class="n">material</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">quality</span> <span class="o">=</span> <span class="n">quality</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">box_l</span> <span class="o">=</span> <span class="n">box_l</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rasterize_resolution</span> <span class="o">=</span> <span class="n">rasterize_resolution</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pointsize</span> <span class="o">=</span> <span class="n">rasterize_pointsize</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rasterized_surface_points</span> <span class="o">=</span> <span class="kc">None</span>

<div class="viewcode-block" id="Shape.draw"><a class="viewcode-back" href="../../espressomd.html#espressomd.visualization.Shape.draw">[docs]</a>    <span class="k">def</span> <span class="nf">draw</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Draw shape via rasterization. Used as a default draw method.</span>
<span class="sd">        Can and should be overwritten in child classes to implement a better</span>
<span class="sd">        draw method.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># get and store points of rasterized surface if not already present</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">rasterized_surface_points</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rasterized_surface_points</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_rasterize_shape</span><span class="p">()</span>

        <span class="n">set_solid_material</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">color</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">material</span><span class="p">)</span>
        <span class="n">OpenGL</span><span class="o">.</span><span class="n">GL</span><span class="o">.</span><span class="n">glPointSize</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pointsize</span><span class="p">)</span>
        <span class="n">OpenGL</span><span class="o">.</span><span class="n">GL</span><span class="o">.</span><span class="n">glBegin</span><span class="p">(</span><span class="n">OpenGL</span><span class="o">.</span><span class="n">GL</span><span class="o">.</span><span class="n">GL_POINTS</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">point</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">rasterized_surface_points</span><span class="p">:</span>
            <span class="n">OpenGL</span><span class="o">.</span><span class="n">GL</span><span class="o">.</span><span class="n">glVertex3f</span><span class="p">(</span><span class="n">point</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">point</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">point</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
        <span class="n">OpenGL</span><span class="o">.</span><span class="n">GL</span><span class="o">.</span><span class="n">glEnd</span><span class="p">()</span></div>

    <span class="k">def</span> <span class="nf">_rasterize_shape</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># rasterize brute force</span>
        <span class="n">spacing</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">box_l</span><span class="p">)</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">rasterize_resolution</span>
        <span class="n">resolution</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">box_l</span><span class="p">)</span> <span class="o">/</span> <span class="n">spacing</span>

        <span class="n">points</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">resolution</span><span class="p">[</span><span class="mi">0</span><span class="p">])):</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">resolution</span><span class="p">[</span><span class="mi">1</span><span class="p">])):</span>
                <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">resolution</span><span class="p">[</span><span class="mi">2</span><span class="p">])):</span>
                    <span class="c1"># some shapes may not have a well-defined distance function</span>
                    <span class="c1"># in the whole domain and may throw a ValueError</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">p</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">])</span> <span class="o">*</span> <span class="n">spacing</span>
                        <span class="n">dist</span><span class="p">,</span> <span class="n">vec</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">shape</span><span class="o">.</span><span class="n">call_method</span><span class="p">(</span>
                            <span class="s2">&quot;calc_distance&quot;</span><span class="p">,</span> <span class="n">position</span><span class="o">=</span><span class="n">p</span><span class="o">.</span><span class="n">tolist</span><span class="p">())</span>
                        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">vec</span><span class="p">)</span><span class="o">.</span><span class="n">any</span><span class="p">()</span> <span class="ow">or</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">dist</span><span class="p">))</span> \
                                <span class="ow">and</span> <span class="nb">abs</span><span class="p">(</span><span class="n">dist</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">spacing</span><span class="p">:</span>
                            <span class="n">points</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">p</span> <span class="o">-</span> <span class="n">vec</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">())</span>
                    <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                        <span class="k">continue</span>
        <span class="k">return</span> <span class="n">points</span>

    <span class="k">def</span> <span class="nf">_has_gle_features</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">feature_names</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">feature_name</span> <span class="ow">in</span> <span class="n">feature_names</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">bool</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="n">OpenGL</span><span class="o">.</span><span class="n">GLE</span><span class="p">,</span> <span class="n">feature_name</span><span class="p">)):</span>
                <span class="k">return</span> <span class="kc">False</span>
        <span class="k">return</span> <span class="kc">True</span></div>


<div class="viewcode-block" id="Cylinder"><a class="viewcode-back" href="../../espressomd.html#espressomd.visualization.Cylinder">[docs]</a><span class="k">class</span> <span class="nc">Cylinder</span><span class="p">(</span><span class="n">Shape</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Drawable Shape Cylinder.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">shape</span><span class="p">,</span> <span class="n">particle_type</span><span class="p">,</span> <span class="n">color</span><span class="p">,</span> <span class="n">material</span><span class="p">,</span>
                 <span class="n">quality</span><span class="p">,</span> <span class="n">box_l</span><span class="p">,</span> <span class="n">rasterize_resolution</span><span class="p">,</span> <span class="n">rasterize_pointsize</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">shape</span><span class="p">,</span> <span class="n">particle_type</span><span class="p">,</span> <span class="n">color</span><span class="p">,</span> <span class="n">material</span><span class="p">,</span>
                         <span class="n">quality</span><span class="p">,</span> <span class="n">box_l</span><span class="p">,</span> <span class="n">rasterize_resolution</span><span class="p">,</span> <span class="n">rasterize_pointsize</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">center</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">shape</span><span class="o">.</span><span class="n">get_parameter</span><span class="p">(</span><span class="s1">&#39;center&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">axis</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">shape</span><span class="o">.</span><span class="n">get_parameter</span><span class="p">(</span><span class="s1">&#39;axis&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">length</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">shape</span><span class="o">.</span><span class="n">get_parameter</span><span class="p">(</span><span class="s1">&#39;length&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">radius</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">shape</span><span class="o">.</span><span class="n">get_parameter</span><span class="p">(</span><span class="s1">&#39;radius&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">open</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">shape</span><span class="o">.</span><span class="n">get_parameter</span><span class="p">(</span><span class="s1">&#39;open&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cap_center_1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">center</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">axis</span> <span class="o">/</span> \
            <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">axis</span><span class="p">)</span> <span class="o">*</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">length</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cap_center_2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">center</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">axis</span> <span class="o">/</span> \
            <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">axis</span><span class="p">)</span> <span class="o">*</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">length</span>

<div class="viewcode-block" id="Cylinder.draw"><a class="viewcode-back" href="../../espressomd.html#espressomd.visualization.Cylinder.draw">[docs]</a>    <span class="k">def</span> <span class="nf">draw</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">draw_cylinder</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cap_center_1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cap_center_2</span><span class="p">,</span>
                      <span class="bp">self</span><span class="o">.</span><span class="n">radius</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">color</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">material</span><span class="p">,</span>
                      <span class="bp">self</span><span class="o">.</span><span class="n">quality</span><span class="p">,</span> <span class="n">draw_caps</span><span class="o">=</span><span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">open</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="Ellipsoid"><a class="viewcode-back" href="../../espressomd.html#espressomd.visualization.Ellipsoid">[docs]</a><span class="k">class</span> <span class="nc">Ellipsoid</span><span class="p">(</span><span class="n">Shape</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Drawable Shape Ellipsoid.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">shape</span><span class="p">,</span> <span class="n">particle_type</span><span class="p">,</span> <span class="n">color</span><span class="p">,</span> <span class="n">material</span><span class="p">,</span>
                 <span class="n">quality</span><span class="p">,</span> <span class="n">box_l</span><span class="p">,</span> <span class="n">rasterize_resolution</span><span class="p">,</span> <span class="n">rasterize_pointsize</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">shape</span><span class="p">,</span> <span class="n">particle_type</span><span class="p">,</span> <span class="n">color</span><span class="p">,</span> <span class="n">material</span><span class="p">,</span>
                         <span class="n">quality</span><span class="p">,</span> <span class="n">box_l</span><span class="p">,</span> <span class="n">rasterize_resolution</span><span class="p">,</span> <span class="n">rasterize_pointsize</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">center</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">shape</span><span class="o">.</span><span class="n">get_parameter</span><span class="p">(</span><span class="s1">&#39;center&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">semiaxis_a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">shape</span><span class="o">.</span><span class="n">get_parameter</span><span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">semiaxis_b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">shape</span><span class="o">.</span><span class="n">get_parameter</span><span class="p">(</span><span class="s1">&#39;b&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">semiaxis_c</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">shape</span><span class="o">.</span><span class="n">get_parameter</span><span class="p">(</span><span class="s1">&#39;b&#39;</span><span class="p">))</span>

<div class="viewcode-block" id="Ellipsoid.draw"><a class="viewcode-back" href="../../espressomd.html#espressomd.visualization.Ellipsoid.draw">[docs]</a>    <span class="k">def</span> <span class="nf">draw</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">set_solid_material</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">color</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">material</span><span class="p">)</span>
        <span class="n">OpenGL</span><span class="o">.</span><span class="n">GL</span><span class="o">.</span><span class="n">glPushMatrix</span><span class="p">()</span>
        <span class="n">OpenGL</span><span class="o">.</span><span class="n">GL</span><span class="o">.</span><span class="n">glTranslatef</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">center</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">center</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">center</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
        <span class="n">OpenGL</span><span class="o">.</span><span class="n">GL</span><span class="o">.</span><span class="n">glScalef</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">semiaxis_a</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">semiaxis_b</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">semiaxis_c</span><span class="p">)</span>
        <span class="n">OpenGL</span><span class="o">.</span><span class="n">GLUT</span><span class="o">.</span><span class="n">glutSolidSphere</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">quality</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">quality</span><span class="p">)</span>
        <span class="n">OpenGL</span><span class="o">.</span><span class="n">GL</span><span class="o">.</span><span class="n">glPopMatrix</span><span class="p">()</span></div></div>


<div class="viewcode-block" id="HollowConicalFrustum"><a class="viewcode-back" href="../../espressomd.html#espressomd.visualization.HollowConicalFrustum">[docs]</a><span class="k">class</span> <span class="nc">HollowConicalFrustum</span><span class="p">(</span><span class="n">Shape</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Drawable Shape HollowConicalFrustum.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">shape</span><span class="p">,</span> <span class="n">particle_type</span><span class="p">,</span> <span class="n">color</span><span class="p">,</span> <span class="n">material</span><span class="p">,</span>
                 <span class="n">quality</span><span class="p">,</span> <span class="n">box_l</span><span class="p">,</span> <span class="n">rasterize_resolution</span><span class="p">,</span> <span class="n">rasterize_pointsize</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">shape</span><span class="p">,</span> <span class="n">particle_type</span><span class="p">,</span> <span class="n">color</span><span class="p">,</span> <span class="n">material</span><span class="p">,</span>
                         <span class="n">quality</span><span class="p">,</span> <span class="n">box_l</span><span class="p">,</span> <span class="n">rasterize_resolution</span><span class="p">,</span> <span class="n">rasterize_pointsize</span><span class="p">)</span>
        <span class="n">ctp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">shape</span><span class="o">.</span><span class="n">get_parameter</span><span class="p">(</span><span class="s1">&#39;cyl_transform_params&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">center</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">ctp</span><span class="o">.</span><span class="n">center</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">axis</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">ctp</span><span class="o">.</span><span class="n">axis</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">orientation</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">ctp</span><span class="o">.</span><span class="n">orientation</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">radius_1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">shape</span><span class="o">.</span><span class="n">get_parameter</span><span class="p">(</span><span class="s1">&#39;r1&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">radius_2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">shape</span><span class="o">.</span><span class="n">get_parameter</span><span class="p">(</span><span class="s1">&#39;r2&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">length</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">shape</span><span class="o">.</span><span class="n">get_parameter</span><span class="p">(</span><span class="s1">&#39;length&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">thickness</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">shape</span><span class="o">.</span><span class="n">get_parameter</span><span class="p">(</span><span class="s1">&#39;thickness&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">central_angle</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">shape</span><span class="o">.</span><span class="n">get_parameter</span><span class="p">(</span><span class="s1">&#39;central_angle&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">use_gle</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_has_gle_features</span><span class="p">(</span>
            <span class="p">[</span><span class="s2">&quot;gleSpiral&quot;</span><span class="p">,</span> <span class="s2">&quot;gleSetNumSides&quot;</span><span class="p">,</span> <span class="s2">&quot;gleSetJoinStyle&quot;</span><span class="p">])</span>

<div class="viewcode-block" id="HollowConicalFrustum.draw"><a class="viewcode-back" href="../../espressomd.html#espressomd.visualization.HollowConicalFrustum.draw">[docs]</a>    <span class="k">def</span> <span class="nf">draw</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Draw using OpenGL Extrusion library, if available.</span>
<span class="sd">        Use rasterization of base class, otherwise.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">use_gle</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">central_angle</span> <span class="o">==</span> <span class="mf">0.</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_draw_using_gle</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span></div>

    <span class="c1"># if available, use the GL Extrusion library</span>
    <span class="k">def</span> <span class="nf">_draw_using_gle</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">set_solid_material</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">color</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">material</span><span class="p">)</span>
        <span class="n">OpenGL</span><span class="o">.</span><span class="n">GL</span><span class="o">.</span><span class="n">glPushMatrix</span><span class="p">()</span>
        <span class="c1"># basic position and orientation</span>
        <span class="n">OpenGL</span><span class="o">.</span><span class="n">GL</span><span class="o">.</span><span class="n">glTranslate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">center</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">center</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">center</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
        <span class="n">ax</span><span class="p">,</span> <span class="n">rx</span><span class="p">,</span> <span class="n">ry</span> <span class="o">=</span> <span class="n">rotation_helper</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">axis</span><span class="p">)</span>
        <span class="n">OpenGL</span><span class="o">.</span><span class="n">GL</span><span class="o">.</span><span class="n">glRotatef</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">rx</span><span class="p">,</span> <span class="n">ry</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span>

        <span class="n">n</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">quality</span><span class="p">)</span>
        <span class="n">rotation_angle</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arctan</span><span class="p">(</span>
            <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">radius_1</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">radius_2</span><span class="p">)</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">length</span><span class="p">)</span>
        <span class="n">l</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">length</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">rotation_angle</span><span class="p">)</span>

        <span class="n">contour</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">theta</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mf">0.5</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
            <span class="n">contour</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span> <span class="o">*</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">thickness</span><span class="p">,</span>
                            <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span> <span class="o">*</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">thickness</span> <span class="o">+</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">l</span><span class="p">])</span>
        <span class="k">for</span> <span class="n">theta</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">0.5</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.5</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
            <span class="n">contour</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span> <span class="o">*</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">thickness</span><span class="p">,</span>
                            <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span> <span class="o">*</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">thickness</span> <span class="o">-</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">l</span><span class="p">])</span>
        <span class="n">contour</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">matmul</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">contour</span><span class="p">),</span>
                            <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">rotation_angle</span><span class="p">),</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">rotation_angle</span><span class="p">)],</span>
                                      <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">rotation_angle</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">rotation_angle</span><span class="p">)]]))</span>

        <span class="n">normals</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">contour</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">normals</span> <span class="o">/=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">normals</span><span class="p">,</span> <span class="nb">ord</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">keepdims</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">normals</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">roll</span><span class="p">(</span><span class="n">normals</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

        <span class="n">OpenGL</span><span class="o">.</span><span class="n">GLE</span><span class="o">.</span><span class="n">gleSetJoinStyle</span><span class="p">(</span><span class="n">OpenGL</span><span class="o">.</span><span class="n">GLE</span><span class="o">.</span><span class="n">TUBE_JN_ANGLE</span><span class="p">)</span>
        <span class="n">OpenGL</span><span class="o">.</span><span class="n">GLE</span><span class="o">.</span><span class="n">gleSetNumSides</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="mi">90</span><span class="p">,</span> <span class="mi">3</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">quality</span><span class="p">))</span>
        <span class="n">OpenGL</span><span class="o">.</span><span class="n">GLE</span><span class="o">.</span><span class="n">gleSpiral</span><span class="p">(</span><span class="n">contour</span><span class="p">,</span> <span class="n">normals</span><span class="p">,</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">radius_1</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">radius_2</span><span class="p">),</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span>
                             <span class="p">[[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]],</span> <span class="p">[[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]],</span> <span class="mf">0.</span><span class="p">,</span> <span class="mi">360</span><span class="p">)</span>

        <span class="n">OpenGL</span><span class="o">.</span><span class="n">GL</span><span class="o">.</span><span class="n">glPopMatrix</span><span class="p">()</span></div>


<div class="viewcode-block" id="SimplePore"><a class="viewcode-back" href="../../espressomd.html#espressomd.visualization.SimplePore">[docs]</a><span class="k">class</span> <span class="nc">SimplePore</span><span class="p">(</span><span class="n">Shape</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Drawable Shape SimplePore.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">shape</span><span class="p">,</span> <span class="n">particle_type</span><span class="p">,</span> <span class="n">color</span><span class="p">,</span> <span class="n">material</span><span class="p">,</span>
                 <span class="n">quality</span><span class="p">,</span> <span class="n">box_l</span><span class="p">,</span> <span class="n">rasterize_resolution</span><span class="p">,</span> <span class="n">rasterize_pointsize</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">shape</span><span class="p">,</span> <span class="n">particle_type</span><span class="p">,</span> <span class="n">color</span><span class="p">,</span> <span class="n">material</span><span class="p">,</span>
                         <span class="n">quality</span><span class="p">,</span> <span class="n">box_l</span><span class="p">,</span> <span class="n">rasterize_resolution</span><span class="p">,</span> <span class="n">rasterize_pointsize</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">center</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">shape</span><span class="o">.</span><span class="n">get_parameter</span><span class="p">(</span><span class="s1">&#39;center&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">axis</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">shape</span><span class="o">.</span><span class="n">get_parameter</span><span class="p">(</span><span class="s1">&#39;axis&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">length</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">shape</span><span class="o">.</span><span class="n">get_parameter</span><span class="p">(</span><span class="s1">&#39;length&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">radius</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">shape</span><span class="o">.</span><span class="n">get_parameter</span><span class="p">(</span><span class="s1">&#39;radius&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">smoothing_radius</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">shape</span><span class="o">.</span><span class="n">get_parameter</span><span class="p">(</span><span class="s1">&#39;smoothing_radius&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">max_box_l</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">box_l</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">use_gle</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_has_gle_features</span><span class="p">(</span>
            <span class="p">[</span><span class="s2">&quot;gleSpiral&quot;</span><span class="p">,</span> <span class="s2">&quot;gleSetNumSides&quot;</span><span class="p">,</span> <span class="s2">&quot;gleSetJoinStyle&quot;</span><span class="p">])</span>

<div class="viewcode-block" id="SimplePore.draw"><a class="viewcode-back" href="../../espressomd.html#espressomd.visualization.SimplePore.draw">[docs]</a>    <span class="k">def</span> <span class="nf">draw</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Draw using OpenGL Extrusion library, if available.</span>
<span class="sd">        Use OpenGL primitives + clip planes, otherwise.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">set_solid_material</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">color</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">material</span><span class="p">)</span>
        <span class="n">OpenGL</span><span class="o">.</span><span class="n">GL</span><span class="o">.</span><span class="n">glPushMatrix</span><span class="p">()</span>
        <span class="c1"># basic position and orientation</span>
        <span class="n">OpenGL</span><span class="o">.</span><span class="n">GL</span><span class="o">.</span><span class="n">glTranslate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">center</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">center</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">center</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
        <span class="n">ax</span><span class="p">,</span> <span class="n">rx</span><span class="p">,</span> <span class="n">ry</span> <span class="o">=</span> <span class="n">rotation_helper</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">axis</span><span class="p">)</span>
        <span class="n">OpenGL</span><span class="o">.</span><span class="n">GL</span><span class="o">.</span><span class="n">glRotatef</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">rx</span><span class="p">,</span> <span class="n">ry</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">use_gle</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_draw_using_gle</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_draw_using_primitives</span><span class="p">()</span>

        <span class="n">OpenGL</span><span class="o">.</span><span class="n">GL</span><span class="o">.</span><span class="n">glPopMatrix</span><span class="p">()</span></div>

    <span class="k">def</span> <span class="nf">_draw_using_gle</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">n</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">quality</span> <span class="o">//</span> <span class="mi">3</span><span class="p">)</span>
        <span class="n">contour</span> <span class="o">=</span> <span class="p">[[</span><span class="mf">0.5</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_box_l</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.5</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">length</span><span class="p">]]</span>
        <span class="k">for</span> <span class="n">theta</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
            <span class="n">contour</span><span class="o">.</span><span class="n">append</span><span class="p">([(</span><span class="mf">1.</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">theta</span><span class="p">))</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">smoothing_radius</span><span class="p">,</span>
                            <span class="o">-</span><span class="mf">0.5</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">length</span> <span class="o">+</span> <span class="p">(</span><span class="mf">1.</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">theta</span><span class="p">))</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">smoothing_radius</span><span class="p">])</span>
        <span class="k">for</span> <span class="n">theta</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">0.5</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
            <span class="n">contour</span><span class="o">.</span><span class="n">append</span><span class="p">([(</span><span class="mf">1.</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">theta</span><span class="p">))</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">smoothing_radius</span><span class="p">,</span>
                            <span class="mf">0.5</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">length</span> <span class="o">-</span> <span class="p">(</span><span class="mf">1.</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">theta</span><span class="p">))</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">smoothing_radius</span><span class="p">])</span>
        <span class="n">contour</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="mf">0.5</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_box_l</span><span class="p">,</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">length</span><span class="p">])</span>

        <span class="n">normals</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">contour</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">normals</span> <span class="o">/=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">normals</span><span class="p">,</span> <span class="nb">ord</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">keepdims</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">normals</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">roll</span><span class="p">(</span><span class="n">normals</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">normals</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">*=</span> <span class="o">-</span><span class="mi">1</span>

        <span class="n">OpenGL</span><span class="o">.</span><span class="n">GLE</span><span class="o">.</span><span class="n">gleSetJoinStyle</span><span class="p">(</span><span class="n">OpenGL</span><span class="o">.</span><span class="n">GLE</span><span class="o">.</span><span class="n">TUBE_JN_ANGLE</span><span class="p">)</span>
        <span class="n">OpenGL</span><span class="o">.</span><span class="n">GLE</span><span class="o">.</span><span class="n">gleSetNumSides</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="mi">90</span><span class="p">,</span> <span class="mi">3</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">quality</span><span class="p">))</span>
        <span class="n">OpenGL</span><span class="o">.</span><span class="n">GLE</span><span class="o">.</span><span class="n">gleSpiral</span><span class="p">(</span><span class="n">contour</span><span class="p">,</span> <span class="n">normals</span><span class="p">,</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">radius</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span>
                             <span class="p">[[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]],</span> <span class="p">[[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]],</span> <span class="mf">0.</span><span class="p">,</span> <span class="mi">360</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_draw_using_primitives</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">clip_plane</span> <span class="o">=</span> <span class="n">get_extra_clip_plane</span><span class="p">()</span>
        <span class="c1"># cylinder</span>
        <span class="n">OpenGL</span><span class="o">.</span><span class="n">GL</span><span class="o">.</span><span class="n">glTranslate</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.5</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">length</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">smoothing_radius</span><span class="p">)</span>
        <span class="n">quadric</span> <span class="o">=</span> <span class="n">OpenGL</span><span class="o">.</span><span class="n">GLU</span><span class="o">.</span><span class="n">gluNewQuadric</span><span class="p">()</span>
        <span class="n">OpenGL</span><span class="o">.</span><span class="n">GLU</span><span class="o">.</span><span class="n">gluCylinder</span><span class="p">(</span><span class="n">quadric</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">radius</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">radius</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">length</span> <span class="o">-</span> <span class="mi">2</span> <span class="o">*</span>
                               <span class="bp">self</span><span class="o">.</span><span class="n">smoothing_radius</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">quality</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">quality</span><span class="p">)</span>
        <span class="c1"># torus segment</span>
        <span class="n">OpenGL</span><span class="o">.</span><span class="n">GL</span><span class="o">.</span><span class="n">glEnable</span><span class="p">(</span><span class="n">clip_plane</span><span class="p">)</span>
        <span class="n">OpenGL</span><span class="o">.</span><span class="n">GL</span><span class="o">.</span><span class="n">glClipPlane</span><span class="p">(</span><span class="n">clip_plane</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
        <span class="n">OpenGL</span><span class="o">.</span><span class="n">GLUT</span><span class="o">.</span><span class="n">glutSolidTorus</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">smoothing_radius</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">radius</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">smoothing_radius</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">quality</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">quality</span><span class="p">)</span>
        <span class="n">OpenGL</span><span class="o">.</span><span class="n">GL</span><span class="o">.</span><span class="n">glDisable</span><span class="p">(</span><span class="n">clip_plane</span><span class="p">)</span>
        <span class="c1"># wall</span>
        <span class="n">OpenGL</span><span class="o">.</span><span class="n">GL</span><span class="o">.</span><span class="n">glTranslate</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">smoothing_radius</span><span class="p">)</span>
        <span class="n">OpenGL</span><span class="o">.</span><span class="n">GLU</span><span class="o">.</span><span class="n">gluPartialDisk</span><span class="p">(</span><span class="n">quadric</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">radius</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">smoothing_radius</span><span class="p">,</span>
                                  <span class="mf">2.0</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_box_l</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">quality</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">360</span><span class="p">)</span>
        <span class="c1"># torus segment</span>
        <span class="n">OpenGL</span><span class="o">.</span><span class="n">GL</span><span class="o">.</span><span class="n">glTranslate</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">length</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">smoothing_radius</span><span class="p">)</span>
        <span class="n">OpenGL</span><span class="o">.</span><span class="n">GL</span><span class="o">.</span><span class="n">glEnable</span><span class="p">(</span><span class="n">clip_plane</span><span class="p">)</span>
        <span class="n">OpenGL</span><span class="o">.</span><span class="n">GL</span><span class="o">.</span><span class="n">glClipPlane</span><span class="p">(</span><span class="n">clip_plane</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
        <span class="n">OpenGL</span><span class="o">.</span><span class="n">GLUT</span><span class="o">.</span><span class="n">glutSolidTorus</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">smoothing_radius</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">radius</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">smoothing_radius</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">quality</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">quality</span><span class="p">)</span>
        <span class="n">OpenGL</span><span class="o">.</span><span class="n">GL</span><span class="o">.</span><span class="n">glDisable</span><span class="p">(</span><span class="n">clip_plane</span><span class="p">)</span>
        <span class="c1"># wall</span>
        <span class="n">OpenGL</span><span class="o">.</span><span class="n">GL</span><span class="o">.</span><span class="n">glTranslate</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">smoothing_radius</span><span class="p">)</span>
        <span class="n">OpenGL</span><span class="o">.</span><span class="n">GLU</span><span class="o">.</span><span class="n">gluPartialDisk</span><span class="p">(</span><span class="n">quadric</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">radius</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">smoothing_radius</span><span class="p">,</span>
                                  <span class="mf">2.0</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_box_l</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">quality</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">360</span><span class="p">)</span>

        <span class="n">OpenGL</span><span class="o">.</span><span class="n">GLU</span><span class="o">.</span><span class="n">gluDeleteQuadric</span><span class="p">(</span><span class="n">quadric</span><span class="p">)</span></div>


<div class="viewcode-block" id="Slitpore"><a class="viewcode-back" href="../../espressomd.html#espressomd.visualization.Slitpore">[docs]</a><span class="k">class</span> <span class="nc">Slitpore</span><span class="p">(</span><span class="n">Shape</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Drawable Shape Slitpore.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">shape</span><span class="p">,</span> <span class="n">particle_type</span><span class="p">,</span> <span class="n">color</span><span class="p">,</span> <span class="n">material</span><span class="p">,</span>
                 <span class="n">quality</span><span class="p">,</span> <span class="n">box_l</span><span class="p">,</span> <span class="n">rasterize_resolution</span><span class="p">,</span> <span class="n">rasterize_pointsize</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">shape</span><span class="p">,</span> <span class="n">particle_type</span><span class="p">,</span> <span class="n">color</span><span class="p">,</span> <span class="n">material</span><span class="p">,</span>
                         <span class="n">quality</span><span class="p">,</span> <span class="n">box_l</span><span class="p">,</span> <span class="n">rasterize_resolution</span><span class="p">,</span> <span class="n">rasterize_pointsize</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">channel_width</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">shape</span><span class="o">.</span><span class="n">get_parameter</span><span class="p">(</span><span class="s1">&#39;channel_width&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lower_smoothing_radius</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">shape</span><span class="o">.</span><span class="n">get_parameter</span><span class="p">(</span><span class="s1">&#39;lower_smoothing_radius&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">upper_smoothing_radius</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">shape</span><span class="o">.</span><span class="n">get_parameter</span><span class="p">(</span><span class="s1">&#39;upper_smoothing_radius&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pore_length</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">shape</span><span class="o">.</span><span class="n">get_parameter</span><span class="p">(</span><span class="s1">&#39;pore_length&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pore_mouth</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">shape</span><span class="o">.</span><span class="n">get_parameter</span><span class="p">(</span><span class="s1">&#39;pore_mouth&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pore_width</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">shape</span><span class="o">.</span><span class="n">get_parameter</span><span class="p">(</span><span class="s1">&#39;pore_width&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dividing_plane</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">shape</span><span class="o">.</span><span class="n">get_parameter</span><span class="p">(</span><span class="s1">&#39;dividing_plane&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">max_box_l</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">box_l</span><span class="p">)</span>

<div class="viewcode-block" id="Slitpore.draw"><a class="viewcode-back" href="../../espressomd.html#espressomd.visualization.Slitpore.draw">[docs]</a>    <span class="k">def</span> <span class="nf">draw</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">set_solid_material</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">color</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">material</span><span class="p">)</span>
        <span class="c1"># If pore is large, an additional wall is necessary</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">pore_width</span> <span class="o">&gt;</span> <span class="mf">2.</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">lower_smoothing_radius</span><span class="p">:</span>
            <span class="n">wall_0</span> <span class="o">=</span> <span class="p">[</span>
                <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">dividing_plane</span> <span class="o">-</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">pore_width</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">lower_smoothing_radius</span><span class="p">,</span>
                 <span class="mf">0.</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">pore_mouth</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">pore_length</span><span class="p">],</span>
                <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">dividing_plane</span> <span class="o">+</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">pore_width</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">lower_smoothing_radius</span><span class="p">,</span>
                 <span class="mf">0.</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">pore_mouth</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">pore_length</span><span class="p">],</span>
                <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">dividing_plane</span> <span class="o">+</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">pore_width</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">lower_smoothing_radius</span><span class="p">,</span>
                 <span class="bp">self</span><span class="o">.</span><span class="n">max_box_l</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">pore_mouth</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">pore_length</span><span class="p">],</span>
                <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">dividing_plane</span> <span class="o">-</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">pore_width</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">lower_smoothing_radius</span><span class="p">,</span>
                 <span class="bp">self</span><span class="o">.</span><span class="n">max_box_l</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">pore_mouth</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">pore_length</span><span class="p">]]</span>
            <span class="n">draw_plane</span><span class="p">(</span><span class="n">wall_0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">color</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">material</span><span class="p">)</span>

        <span class="c1"># Add the remaining walls</span>
        <span class="n">wall_1</span> <span class="o">=</span> <span class="p">[</span>
            <span class="p">[</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">channel_width</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">pore_mouth</span><span class="p">],</span>
            <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">max_box_l</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">channel_width</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">pore_mouth</span><span class="p">],</span>
            <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">max_box_l</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_box_l</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">channel_width</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">pore_mouth</span><span class="p">],</span>
            <span class="p">[</span><span class="mf">0.</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_box_l</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">channel_width</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">pore_mouth</span><span class="p">]]</span>

        <span class="n">wall_2</span> <span class="o">=</span> <span class="p">[</span>
            <span class="p">[</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">pore_mouth</span><span class="p">],</span>
            <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">dividing_plane</span> <span class="o">-</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">pore_width</span> <span class="o">-</span>
             <span class="bp">self</span><span class="o">.</span><span class="n">upper_smoothing_radius</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">pore_mouth</span><span class="p">],</span>
            <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">dividing_plane</span> <span class="o">-</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">pore_width</span> <span class="o">-</span>
             <span class="bp">self</span><span class="o">.</span><span class="n">upper_smoothing_radius</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_box_l</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">pore_mouth</span><span class="p">],</span>
            <span class="p">[</span><span class="mf">0.</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_box_l</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">pore_mouth</span><span class="p">]]</span>

        <span class="n">wall_3</span> <span class="o">=</span> <span class="p">[</span>
            <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">dividing_plane</span> <span class="o">+</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">pore_width</span> <span class="o">+</span>
             <span class="bp">self</span><span class="o">.</span><span class="n">upper_smoothing_radius</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">pore_mouth</span><span class="p">],</span>
            <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">max_box_l</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">pore_mouth</span><span class="p">],</span>
            <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">max_box_l</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_box_l</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">pore_mouth</span><span class="p">],</span>
            <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">dividing_plane</span> <span class="o">+</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">pore_width</span> <span class="o">+</span>
             <span class="bp">self</span><span class="o">.</span><span class="n">upper_smoothing_radius</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_box_l</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">pore_mouth</span><span class="p">]]</span>

        <span class="n">wall_4</span> <span class="o">=</span> <span class="p">[</span>
            <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">dividing_plane</span> <span class="o">-</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">pore_width</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span>
             <span class="bp">self</span><span class="o">.</span><span class="n">pore_mouth</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">upper_smoothing_radius</span><span class="p">],</span>
            <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">dividing_plane</span> <span class="o">-</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">pore_width</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_box_l</span><span class="p">,</span>
             <span class="bp">self</span><span class="o">.</span><span class="n">pore_mouth</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">upper_smoothing_radius</span><span class="p">],</span>
            <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">dividing_plane</span> <span class="o">-</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">pore_width</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_box_l</span><span class="p">,</span>
             <span class="bp">self</span><span class="o">.</span><span class="n">pore_mouth</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">pore_length</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">lower_smoothing_radius</span><span class="p">],</span>
            <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">dividing_plane</span> <span class="o">-</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">pore_width</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span>
             <span class="bp">self</span><span class="o">.</span><span class="n">pore_mouth</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">pore_length</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">lower_smoothing_radius</span><span class="p">]]</span>

        <span class="n">wall_5</span> <span class="o">=</span> <span class="p">[</span>
            <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">dividing_plane</span> <span class="o">+</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">pore_width</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span>
             <span class="bp">self</span><span class="o">.</span><span class="n">pore_mouth</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">upper_smoothing_radius</span><span class="p">],</span>
            <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">dividing_plane</span> <span class="o">+</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">pore_width</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_box_l</span><span class="p">,</span>
             <span class="bp">self</span><span class="o">.</span><span class="n">pore_mouth</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">upper_smoothing_radius</span><span class="p">],</span>
            <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">dividing_plane</span> <span class="o">+</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">pore_width</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_box_l</span><span class="p">,</span>
             <span class="bp">self</span><span class="o">.</span><span class="n">pore_mouth</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">pore_length</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">lower_smoothing_radius</span><span class="p">],</span>
            <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">dividing_plane</span> <span class="o">+</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">pore_width</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span>
             <span class="bp">self</span><span class="o">.</span><span class="n">pore_mouth</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">pore_length</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">lower_smoothing_radius</span><span class="p">]]</span>

        <span class="n">draw_plane</span><span class="p">(</span><span class="n">wall_1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">color</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">material</span><span class="p">)</span>
        <span class="n">draw_plane</span><span class="p">(</span><span class="n">wall_2</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">color</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">material</span><span class="p">)</span>
        <span class="n">draw_plane</span><span class="p">(</span><span class="n">wall_3</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">color</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">material</span><span class="p">)</span>
        <span class="n">draw_plane</span><span class="p">(</span><span class="n">wall_4</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">color</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">material</span><span class="p">)</span>
        <span class="n">draw_plane</span><span class="p">(</span><span class="n">wall_5</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">color</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">material</span><span class="p">)</span>

        <span class="c1"># Add smooth edges via clipped cylinders</span>
        <span class="n">ax</span><span class="p">,</span> <span class="n">rx</span><span class="p">,</span> <span class="n">ry</span> <span class="o">=</span> <span class="n">rotation_helper</span><span class="p">([</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">])</span>

        <span class="n">OpenGL</span><span class="o">.</span><span class="n">GL</span><span class="o">.</span><span class="n">glPushMatrix</span><span class="p">()</span>
        <span class="n">quadric</span> <span class="o">=</span> <span class="n">OpenGL</span><span class="o">.</span><span class="n">GLU</span><span class="o">.</span><span class="n">gluNewQuadric</span><span class="p">()</span>
        <span class="n">OpenGL</span><span class="o">.</span><span class="n">GL</span><span class="o">.</span><span class="n">glTranslate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dividing_plane</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">upper_smoothing_radius</span> <span class="o">-</span>
                              <span class="mf">0.5</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">pore_width</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">pore_mouth</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">upper_smoothing_radius</span><span class="p">)</span>
        <span class="n">OpenGL</span><span class="o">.</span><span class="n">GL</span><span class="o">.</span><span class="n">glRotatef</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">rx</span><span class="p">,</span> <span class="n">ry</span><span class="p">,</span> <span class="mf">0.</span><span class="p">)</span>

        <span class="c1"># Upper edges</span>
        <span class="n">clip_plane</span> <span class="o">=</span> <span class="n">get_extra_clip_plane</span><span class="p">()</span>
        <span class="n">OpenGL</span><span class="o">.</span><span class="n">GL</span><span class="o">.</span><span class="n">glEnable</span><span class="p">(</span><span class="n">clip_plane</span><span class="p">)</span>
        <span class="n">OpenGL</span><span class="o">.</span><span class="n">GL</span><span class="o">.</span><span class="n">glClipPlane</span><span class="p">(</span><span class="n">clip_plane</span><span class="p">,</span>
                              <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">upper_smoothing_radius</span><span class="p">))</span>
        <span class="n">OpenGL</span><span class="o">.</span><span class="n">GLU</span><span class="o">.</span><span class="n">gluCylinder</span><span class="p">(</span><span class="n">quadric</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">upper_smoothing_radius</span><span class="p">,</span>
                               <span class="bp">self</span><span class="o">.</span><span class="n">upper_smoothing_radius</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_box_l</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">quality</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">quality</span><span class="p">)</span>

        <span class="n">OpenGL</span><span class="o">.</span><span class="n">GL</span><span class="o">.</span><span class="n">glTranslate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pore_width</span> <span class="o">+</span> <span class="mf">2.</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">upper_smoothing_radius</span><span class="p">,</span>
                              <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">OpenGL</span><span class="o">.</span><span class="n">GL</span><span class="o">.</span><span class="n">glClipPlane</span><span class="p">(</span><span class="n">clip_plane</span><span class="p">,</span>
                              <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">upper_smoothing_radius</span><span class="p">))</span>
        <span class="n">OpenGL</span><span class="o">.</span><span class="n">GLU</span><span class="o">.</span><span class="n">gluCylinder</span><span class="p">(</span><span class="n">quadric</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">upper_smoothing_radius</span><span class="p">,</span>
                               <span class="bp">self</span><span class="o">.</span><span class="n">upper_smoothing_radius</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_box_l</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">quality</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">quality</span><span class="p">)</span>

        <span class="c1"># Lower edges</span>
        <span class="n">OpenGL</span><span class="o">.</span><span class="n">GL</span><span class="o">.</span><span class="n">glTranslate</span><span class="p">(</span><span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">upper_smoothing_radius</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">lower_smoothing_radius</span><span class="p">,</span>
                              <span class="bp">self</span><span class="o">.</span><span class="n">pore_length</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">upper_smoothing_radius</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">lower_smoothing_radius</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">OpenGL</span><span class="o">.</span><span class="n">GL</span><span class="o">.</span><span class="n">glClipPlane</span><span class="p">(</span><span class="n">clip_plane</span><span class="p">,</span>
                              <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">lower_smoothing_radius</span><span class="p">))</span>
        <span class="n">OpenGL</span><span class="o">.</span><span class="n">GLU</span><span class="o">.</span><span class="n">gluCylinder</span><span class="p">(</span><span class="n">quadric</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">lower_smoothing_radius</span><span class="p">,</span>
                               <span class="bp">self</span><span class="o">.</span><span class="n">lower_smoothing_radius</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_box_l</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">quality</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">quality</span><span class="p">)</span>

        <span class="n">OpenGL</span><span class="o">.</span><span class="n">GL</span><span class="o">.</span><span class="n">glTranslate</span><span class="p">(</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">pore_width</span> <span class="o">+</span> <span class="mf">2.</span> <span class="o">*</span>
                              <span class="bp">self</span><span class="o">.</span><span class="n">lower_smoothing_radius</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">OpenGL</span><span class="o">.</span><span class="n">GL</span><span class="o">.</span><span class="n">glClipPlane</span><span class="p">(</span><span class="n">clip_plane</span><span class="p">,</span>
                              <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">lower_smoothing_radius</span><span class="p">))</span>
        <span class="n">OpenGL</span><span class="o">.</span><span class="n">GLU</span><span class="o">.</span><span class="n">gluCylinder</span><span class="p">(</span><span class="n">quadric</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">lower_smoothing_radius</span><span class="p">,</span>
                               <span class="bp">self</span><span class="o">.</span><span class="n">lower_smoothing_radius</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_box_l</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">quality</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">quality</span><span class="p">)</span>

        <span class="n">OpenGL</span><span class="o">.</span><span class="n">GL</span><span class="o">.</span><span class="n">glDisable</span><span class="p">(</span><span class="n">clip_plane</span><span class="p">)</span>
        <span class="n">OpenGL</span><span class="o">.</span><span class="n">GLU</span><span class="o">.</span><span class="n">gluDeleteQuadric</span><span class="p">(</span><span class="n">quadric</span><span class="p">)</span>
        <span class="n">OpenGL</span><span class="o">.</span><span class="n">GL</span><span class="o">.</span><span class="n">glPopMatrix</span><span class="p">()</span></div></div>


<div class="viewcode-block" id="Sphere"><a class="viewcode-back" href="../../espressomd.html#espressomd.visualization.Sphere">[docs]</a><span class="k">class</span> <span class="nc">Sphere</span><span class="p">(</span><span class="n">Shape</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Drawable Shape Sphere.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">shape</span><span class="p">,</span> <span class="n">particle_type</span><span class="p">,</span> <span class="n">color</span><span class="p">,</span> <span class="n">material</span><span class="p">,</span>
                 <span class="n">quality</span><span class="p">,</span> <span class="n">box_l</span><span class="p">,</span> <span class="n">rasterize_resolution</span><span class="p">,</span> <span class="n">rasterize_pointsize</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">shape</span><span class="p">,</span> <span class="n">particle_type</span><span class="p">,</span> <span class="n">color</span><span class="p">,</span> <span class="n">material</span><span class="p">,</span>
                         <span class="n">quality</span><span class="p">,</span> <span class="n">box_l</span><span class="p">,</span> <span class="n">rasterize_resolution</span><span class="p">,</span> <span class="n">rasterize_pointsize</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">center</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">shape</span><span class="o">.</span><span class="n">get_parameter</span><span class="p">(</span><span class="s1">&#39;center&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">radius</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">shape</span><span class="o">.</span><span class="n">get_parameter</span><span class="p">(</span><span class="s1">&#39;radius&#39;</span><span class="p">)</span>

<div class="viewcode-block" id="Sphere.draw"><a class="viewcode-back" href="../../espressomd.html#espressomd.visualization.Sphere.draw">[docs]</a>    <span class="k">def</span> <span class="nf">draw</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">OpenGL</span><span class="o">.</span><span class="n">GL</span><span class="o">.</span><span class="n">glPushMatrix</span><span class="p">()</span>
        <span class="n">OpenGL</span><span class="o">.</span><span class="n">GL</span><span class="o">.</span><span class="n">glTranslatef</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">center</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">center</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">center</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
        <span class="n">set_solid_material</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">color</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">material</span><span class="p">)</span>
        <span class="n">OpenGL</span><span class="o">.</span><span class="n">GLUT</span><span class="o">.</span><span class="n">glutSolidSphere</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">radius</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">quality</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">quality</span><span class="p">)</span>
        <span class="n">OpenGL</span><span class="o">.</span><span class="n">GL</span><span class="o">.</span><span class="n">glPopMatrix</span><span class="p">()</span></div></div>


<div class="viewcode-block" id="Spherocylinder"><a class="viewcode-back" href="../../espressomd.html#espressomd.visualization.Spherocylinder">[docs]</a><span class="k">class</span> <span class="nc">Spherocylinder</span><span class="p">(</span><span class="n">Shape</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Drawable Shape Spherocylinder.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">shape</span><span class="p">,</span> <span class="n">particle_type</span><span class="p">,</span> <span class="n">color</span><span class="p">,</span> <span class="n">material</span><span class="p">,</span>
                 <span class="n">quality</span><span class="p">,</span> <span class="n">box_l</span><span class="p">,</span> <span class="n">rasterize_resolution</span><span class="p">,</span> <span class="n">rasterize_pointsize</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">shape</span><span class="p">,</span> <span class="n">particle_type</span><span class="p">,</span> <span class="n">color</span><span class="p">,</span> <span class="n">material</span><span class="p">,</span>
                         <span class="n">quality</span><span class="p">,</span> <span class="n">box_l</span><span class="p">,</span> <span class="n">rasterize_resolution</span><span class="p">,</span> <span class="n">rasterize_pointsize</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">center</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">shape</span><span class="o">.</span><span class="n">get_parameter</span><span class="p">(</span><span class="s1">&#39;center&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">axis</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">shape</span><span class="o">.</span><span class="n">get_parameter</span><span class="p">(</span><span class="s1">&#39;axis&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">length</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">shape</span><span class="o">.</span><span class="n">get_parameter</span><span class="p">(</span><span class="s1">&#39;length&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">radius</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">shape</span><span class="o">.</span><span class="n">get_parameter</span><span class="p">(</span><span class="s1">&#39;radius&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cap_center_1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">center</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">axis</span> <span class="o">/</span> \
            <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">axis</span><span class="p">)</span> <span class="o">*</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">length</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cap_center_2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">center</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">axis</span> <span class="o">/</span> \
            <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">axis</span><span class="p">)</span> <span class="o">*</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">length</span>

<div class="viewcode-block" id="Spherocylinder.draw"><a class="viewcode-back" href="../../espressomd.html#espressomd.visualization.Spherocylinder.draw">[docs]</a>    <span class="k">def</span> <span class="nf">draw</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">set_solid_material</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">color</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">material</span><span class="p">)</span>
        <span class="n">OpenGL</span><span class="o">.</span><span class="n">GL</span><span class="o">.</span><span class="n">glPushMatrix</span><span class="p">()</span>
        <span class="n">quadric</span> <span class="o">=</span> <span class="n">OpenGL</span><span class="o">.</span><span class="n">GLU</span><span class="o">.</span><span class="n">gluNewQuadric</span><span class="p">()</span>

        <span class="n">d</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cap_center_2</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">cap_center_1</span>
        <span class="k">if</span> <span class="n">d</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="mf">0.0</span><span class="p">:</span>
            <span class="n">d</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0001</span>

        <span class="n">v</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">v</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">ax</span> <span class="o">=</span> <span class="mf">57.2957795</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ax</span> <span class="o">=</span> <span class="mf">57.2957795</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">acos</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">/</span> <span class="n">v</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">d</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mf">0.0</span><span class="p">:</span>
            <span class="n">ax</span> <span class="o">=</span> <span class="o">-</span><span class="n">ax</span>
        <span class="n">rx</span> <span class="o">=</span> <span class="o">-</span><span class="n">d</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">d</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
        <span class="n">ry</span> <span class="o">=</span> <span class="n">d</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">d</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
        <span class="n">length</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>
        <span class="n">OpenGL</span><span class="o">.</span><span class="n">GL</span><span class="o">.</span><span class="n">glTranslatef</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cap_center_1</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cap_center_1</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cap_center_1</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
        <span class="n">OpenGL</span><span class="o">.</span><span class="n">GL</span><span class="o">.</span><span class="n">glRotatef</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">rx</span><span class="p">,</span> <span class="n">ry</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span>

        <span class="c1"># First hemispherical cap</span>
        <span class="n">clip_plane</span> <span class="o">=</span> <span class="n">get_extra_clip_plane</span><span class="p">()</span>
        <span class="n">OpenGL</span><span class="o">.</span><span class="n">GL</span><span class="o">.</span><span class="n">glEnable</span><span class="p">(</span><span class="n">clip_plane</span><span class="p">)</span>
        <span class="n">OpenGL</span><span class="o">.</span><span class="n">GL</span><span class="o">.</span><span class="n">glClipPlane</span><span class="p">(</span><span class="n">clip_plane</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
        <span class="n">OpenGL</span><span class="o">.</span><span class="n">GLU</span><span class="o">.</span><span class="n">gluSphere</span><span class="p">(</span><span class="n">quadric</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">radius</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">quality</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">quality</span><span class="p">)</span>
        <span class="n">OpenGL</span><span class="o">.</span><span class="n">GL</span><span class="o">.</span><span class="n">glDisable</span><span class="p">(</span><span class="n">clip_plane</span><span class="p">)</span>
        <span class="c1"># Cylinder</span>
        <span class="n">OpenGL</span><span class="o">.</span><span class="n">GLU</span><span class="o">.</span><span class="n">gluCylinder</span><span class="p">(</span><span class="n">quadric</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">radius</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">radius</span><span class="p">,</span>
                               <span class="n">length</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">quality</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">quality</span><span class="p">)</span>
        <span class="c1"># Second hemispherical cap</span>
        <span class="n">OpenGL</span><span class="o">.</span><span class="n">GL</span><span class="o">.</span><span class="n">glTranslatef</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span>
        <span class="n">OpenGL</span><span class="o">.</span><span class="n">GL</span><span class="o">.</span><span class="n">glEnable</span><span class="p">(</span><span class="n">clip_plane</span><span class="p">)</span>
        <span class="n">OpenGL</span><span class="o">.</span><span class="n">GL</span><span class="o">.</span><span class="n">glClipPlane</span><span class="p">(</span><span class="n">clip_plane</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
        <span class="n">OpenGL</span><span class="o">.</span><span class="n">GLU</span><span class="o">.</span><span class="n">gluSphere</span><span class="p">(</span><span class="n">quadric</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">radius</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">quality</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">quality</span><span class="p">)</span>
        <span class="n">OpenGL</span><span class="o">.</span><span class="n">GL</span><span class="o">.</span><span class="n">glDisable</span><span class="p">(</span><span class="n">clip_plane</span><span class="p">)</span>

        <span class="n">OpenGL</span><span class="o">.</span><span class="n">GLU</span><span class="o">.</span><span class="n">gluDeleteQuadric</span><span class="p">(</span><span class="n">quadric</span><span class="p">)</span>
        <span class="n">OpenGL</span><span class="o">.</span><span class="n">GL</span><span class="o">.</span><span class="n">glPopMatrix</span><span class="p">()</span></div></div>


<div class="viewcode-block" id="Wall"><a class="viewcode-back" href="../../espressomd.html#espressomd.visualization.Wall">[docs]</a><span class="k">class</span> <span class="nc">Wall</span><span class="p">(</span><span class="n">Shape</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Drawable Shape Wall.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">shape</span><span class="p">,</span> <span class="n">particle_type</span><span class="p">,</span> <span class="n">color</span><span class="p">,</span> <span class="n">material</span><span class="p">,</span>
                 <span class="n">quality</span><span class="p">,</span> <span class="n">box_l</span><span class="p">,</span> <span class="n">rasterize_resolution</span><span class="p">,</span> <span class="n">rasterize_pointsize</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">shape</span><span class="p">,</span> <span class="n">particle_type</span><span class="p">,</span> <span class="n">color</span><span class="p">,</span> <span class="n">material</span><span class="p">,</span>
                         <span class="n">quality</span><span class="p">,</span> <span class="n">box_l</span><span class="p">,</span> <span class="n">rasterize_resolution</span><span class="p">,</span> <span class="n">rasterize_pointsize</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">distance</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">shape</span><span class="o">.</span><span class="n">get_parameter</span><span class="p">(</span><span class="s1">&#39;dist&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">normal</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">shape</span><span class="o">.</span><span class="n">get_parameter</span><span class="p">(</span><span class="s1">&#39;normal&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">box_diag</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">box_l</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">edges</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_edges_from_pn</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">distance</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">normal</span><span class="p">),</span>
                                         <span class="bp">self</span><span class="o">.</span><span class="n">normal</span><span class="p">,</span> <span class="mi">2</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">box_diag</span><span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_get_tangents</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
        <span class="n">n</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
        <span class="n">v1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
        <span class="n">v1</span> <span class="o">-=</span> <span class="n">v1</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="o">*</span> <span class="n">n</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">n</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span>
        <span class="n">v2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cross</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">v1</span><span class="p">)</span>
        <span class="n">v1</span> <span class="o">/=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">v1</span><span class="p">)</span>
        <span class="n">v2</span> <span class="o">/=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">v2</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">v1</span><span class="p">,</span> <span class="n">v2</span>

    <span class="k">def</span> <span class="nf">_edges_from_pn</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">diag</span><span class="p">):</span>
        <span class="n">v1</span><span class="p">,</span> <span class="n">v2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_tangents</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
        <span class="n">edges</span> <span class="o">=</span> <span class="p">[</span><span class="n">p</span> <span class="o">+</span> <span class="n">diag</span> <span class="o">*</span> <span class="n">v1</span><span class="p">,</span> <span class="n">p</span> <span class="o">+</span> <span class="n">diag</span> <span class="o">*</span> <span class="n">v2</span><span class="p">,</span> <span class="n">p</span> <span class="o">-</span> <span class="n">diag</span> <span class="o">*</span> <span class="n">v1</span><span class="p">,</span> <span class="n">p</span> <span class="o">-</span> <span class="n">diag</span> <span class="o">*</span> <span class="n">v2</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">edges</span>

<div class="viewcode-block" id="Wall.draw"><a class="viewcode-back" href="../../espressomd.html#espressomd.visualization.Wall.draw">[docs]</a>    <span class="k">def</span> <span class="nf">draw</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">draw_plane</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">edges</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">color</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">material</span><span class="p">)</span></div></div>


<span class="c1"># OPENGL DRAW WRAPPERS</span>

<div class="viewcode-block" id="set_solid_material"><a class="viewcode-back" href="../../espressomd.html#espressomd.visualization.set_solid_material">[docs]</a><span class="k">def</span> <span class="nf">set_solid_material</span><span class="p">(</span><span class="n">color</span><span class="p">,</span> <span class="n">material</span><span class="o">=</span><span class="p">(</span><span class="mf">0.6</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)):</span>
    <span class="n">OpenGL</span><span class="o">.</span><span class="n">GL</span><span class="o">.</span><span class="n">glMaterialfv</span><span class="p">(</span><span class="n">OpenGL</span><span class="o">.</span><span class="n">GL</span><span class="o">.</span><span class="n">GL_FRONT_AND_BACK</span><span class="p">,</span> <span class="n">OpenGL</span><span class="o">.</span><span class="n">GL</span><span class="o">.</span><span class="n">GL_AMBIENT</span><span class="p">,</span> <span class="p">[</span>
        <span class="n">color</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">material</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">color</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">material</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">color</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">*</span> <span class="n">material</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">material</span><span class="p">[</span><span class="mi">4</span><span class="p">]])</span>
    <span class="n">OpenGL</span><span class="o">.</span><span class="n">GL</span><span class="o">.</span><span class="n">glMaterialfv</span><span class="p">(</span><span class="n">OpenGL</span><span class="o">.</span><span class="n">GL</span><span class="o">.</span><span class="n">GL_FRONT_AND_BACK</span><span class="p">,</span> <span class="n">OpenGL</span><span class="o">.</span><span class="n">GL</span><span class="o">.</span><span class="n">GL_DIFFUSE</span><span class="p">,</span> <span class="p">[</span>
        <span class="n">color</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">material</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">color</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">material</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">color</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">*</span> <span class="n">material</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">material</span><span class="p">[</span><span class="mi">4</span><span class="p">]])</span>
    <span class="n">OpenGL</span><span class="o">.</span><span class="n">GL</span><span class="o">.</span><span class="n">glMaterialfv</span><span class="p">(</span><span class="n">OpenGL</span><span class="o">.</span><span class="n">GL</span><span class="o">.</span><span class="n">GL_FRONT_AND_BACK</span><span class="p">,</span> <span class="n">OpenGL</span><span class="o">.</span><span class="n">GL</span><span class="o">.</span><span class="n">GL_SPECULAR</span><span class="p">,</span> <span class="p">[</span>
        <span class="n">color</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">material</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">color</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">material</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">color</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">*</span> <span class="n">material</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">material</span><span class="p">[</span><span class="mi">4</span><span class="p">]])</span>
    <span class="n">OpenGL</span><span class="o">.</span><span class="n">GL</span><span class="o">.</span><span class="n">glMaterialf</span><span class="p">(</span>
        <span class="n">OpenGL</span><span class="o">.</span><span class="n">GL</span><span class="o">.</span><span class="n">GL_FRONT_AND_BACK</span><span class="p">,</span>
        <span class="n">OpenGL</span><span class="o">.</span><span class="n">GL</span><span class="o">.</span><span class="n">GL_SHININESS</span><span class="p">,</span>
        <span class="nb">int</span><span class="p">(</span><span class="n">material</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">*</span> <span class="mi">128</span><span class="p">))</span></div>


<div class="viewcode-block" id="draw_box"><a class="viewcode-back" href="../../espressomd.html#espressomd.visualization.draw_box">[docs]</a><span class="k">def</span> <span class="nf">draw_box</span><span class="p">(</span><span class="n">p0</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">color</span><span class="p">,</span> <span class="n">material</span><span class="p">,</span> <span class="n">width</span><span class="p">):</span>
    <span class="n">OpenGL</span><span class="o">.</span><span class="n">GL</span><span class="o">.</span><span class="n">glLineWidth</span><span class="p">(</span><span class="n">width</span><span class="p">)</span>
    <span class="n">set_solid_material</span><span class="p">(</span><span class="n">color</span><span class="p">,</span> <span class="n">material</span><span class="p">)</span>
    <span class="n">OpenGL</span><span class="o">.</span><span class="n">GL</span><span class="o">.</span><span class="n">glPushMatrix</span><span class="p">()</span>
    <span class="n">OpenGL</span><span class="o">.</span><span class="n">GL</span><span class="o">.</span><span class="n">glTranslatef</span><span class="p">(</span><span class="n">p0</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">p0</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">p0</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
    <span class="n">OpenGL</span><span class="o">.</span><span class="n">GL</span><span class="o">.</span><span class="n">glBegin</span><span class="p">(</span><span class="n">OpenGL</span><span class="o">.</span><span class="n">GL</span><span class="o">.</span><span class="n">GL_LINE_LOOP</span><span class="p">)</span>
    <span class="n">OpenGL</span><span class="o">.</span><span class="n">GL</span><span class="o">.</span><span class="n">glVertex3f</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span>
    <span class="n">OpenGL</span><span class="o">.</span><span class="n">GL</span><span class="o">.</span><span class="n">glVertex3f</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span>
    <span class="n">OpenGL</span><span class="o">.</span><span class="n">GL</span><span class="o">.</span><span class="n">glVertex3f</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">s</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mf">0.0</span><span class="p">)</span>
    <span class="n">OpenGL</span><span class="o">.</span><span class="n">GL</span><span class="o">.</span><span class="n">glVertex3f</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">s</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mf">0.0</span><span class="p">)</span>
    <span class="n">OpenGL</span><span class="o">.</span><span class="n">GL</span><span class="o">.</span><span class="n">glEnd</span><span class="p">()</span>
    <span class="n">OpenGL</span><span class="o">.</span><span class="n">GL</span><span class="o">.</span><span class="n">glBegin</span><span class="p">(</span><span class="n">OpenGL</span><span class="o">.</span><span class="n">GL</span><span class="o">.</span><span class="n">GL_LINE_LOOP</span><span class="p">)</span>
    <span class="n">OpenGL</span><span class="o">.</span><span class="n">GL</span><span class="o">.</span><span class="n">glVertex3f</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">s</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
    <span class="n">OpenGL</span><span class="o">.</span><span class="n">GL</span><span class="o">.</span><span class="n">glVertex3f</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">s</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
    <span class="n">OpenGL</span><span class="o">.</span><span class="n">GL</span><span class="o">.</span><span class="n">glVertex3f</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">s</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">s</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
    <span class="n">OpenGL</span><span class="o">.</span><span class="n">GL</span><span class="o">.</span><span class="n">glVertex3f</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">s</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">s</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
    <span class="n">OpenGL</span><span class="o">.</span><span class="n">GL</span><span class="o">.</span><span class="n">glEnd</span><span class="p">()</span>
    <span class="n">OpenGL</span><span class="o">.</span><span class="n">GL</span><span class="o">.</span><span class="n">glBegin</span><span class="p">(</span><span class="n">OpenGL</span><span class="o">.</span><span class="n">GL</span><span class="o">.</span><span class="n">GL_LINES</span><span class="p">)</span>
    <span class="n">OpenGL</span><span class="o">.</span><span class="n">GL</span><span class="o">.</span><span class="n">glVertex3f</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span>
    <span class="n">OpenGL</span><span class="o">.</span><span class="n">GL</span><span class="o">.</span><span class="n">glVertex3f</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">s</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
    <span class="n">OpenGL</span><span class="o">.</span><span class="n">GL</span><span class="o">.</span><span class="n">glVertex3f</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span>
    <span class="n">OpenGL</span><span class="o">.</span><span class="n">GL</span><span class="o">.</span><span class="n">glVertex3f</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">s</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
    <span class="n">OpenGL</span><span class="o">.</span><span class="n">GL</span><span class="o">.</span><span class="n">glVertex3f</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">s</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mf">0.0</span><span class="p">)</span>
    <span class="n">OpenGL</span><span class="o">.</span><span class="n">GL</span><span class="o">.</span><span class="n">glVertex3f</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">s</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">s</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
    <span class="n">OpenGL</span><span class="o">.</span><span class="n">GL</span><span class="o">.</span><span class="n">glVertex3f</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">s</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mf">0.0</span><span class="p">)</span>
    <span class="n">OpenGL</span><span class="o">.</span><span class="n">GL</span><span class="o">.</span><span class="n">glVertex3f</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">s</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">s</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
    <span class="n">OpenGL</span><span class="o">.</span><span class="n">GL</span><span class="o">.</span><span class="n">glEnd</span><span class="p">()</span>

    <span class="n">OpenGL</span><span class="o">.</span><span class="n">GL</span><span class="o">.</span><span class="n">glPopMatrix</span><span class="p">()</span></div>


<div class="viewcode-block" id="draw_plane"><a class="viewcode-back" href="../../espressomd.html#espressomd.visualization.draw_plane">[docs]</a><span class="k">def</span> <span class="nf">draw_plane</span><span class="p">(</span><span class="n">corners</span><span class="p">,</span> <span class="n">color</span><span class="p">,</span> <span class="n">material</span><span class="p">):</span>

    <span class="n">set_solid_material</span><span class="p">(</span><span class="n">color</span><span class="p">,</span> <span class="n">material</span><span class="p">)</span>

    <span class="n">OpenGL</span><span class="o">.</span><span class="n">GL</span><span class="o">.</span><span class="n">glBegin</span><span class="p">(</span><span class="n">OpenGL</span><span class="o">.</span><span class="n">GL</span><span class="o">.</span><span class="n">GL_QUADS</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">corners</span><span class="p">:</span>
        <span class="n">OpenGL</span><span class="o">.</span><span class="n">GL</span><span class="o">.</span><span class="n">glVertex3f</span><span class="p">(</span><span class="n">c</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">c</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">c</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
    <span class="n">OpenGL</span><span class="o">.</span><span class="n">GL</span><span class="o">.</span><span class="n">glEnd</span><span class="p">()</span></div>


<div class="viewcode-block" id="draw_cylinder"><a class="viewcode-back" href="../../espressomd.html#espressomd.visualization.draw_cylinder">[docs]</a><span class="k">def</span> <span class="nf">draw_cylinder</span><span class="p">(</span><span class="n">posA</span><span class="p">,</span> <span class="n">posB</span><span class="p">,</span> <span class="n">radius</span><span class="p">,</span> <span class="n">color</span><span class="p">,</span> <span class="n">material</span><span class="p">,</span> <span class="n">quality</span><span class="p">,</span>
                  <span class="n">draw_caps</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="n">set_solid_material</span><span class="p">(</span><span class="n">color</span><span class="p">,</span> <span class="n">material</span><span class="p">)</span>
    <span class="n">OpenGL</span><span class="o">.</span><span class="n">GL</span><span class="o">.</span><span class="n">glPushMatrix</span><span class="p">()</span>
    <span class="n">quadric</span> <span class="o">=</span> <span class="n">OpenGL</span><span class="o">.</span><span class="n">GLU</span><span class="o">.</span><span class="n">gluNewQuadric</span><span class="p">()</span>

    <span class="n">d</span> <span class="o">=</span> <span class="n">posB</span> <span class="o">-</span> <span class="n">posA</span>

    <span class="n">length</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>
    <span class="n">OpenGL</span><span class="o">.</span><span class="n">GL</span><span class="o">.</span><span class="n">glTranslatef</span><span class="p">(</span><span class="n">posA</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">posA</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">posA</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>

    <span class="n">ax</span><span class="p">,</span> <span class="n">rx</span><span class="p">,</span> <span class="n">ry</span> <span class="o">=</span> <span class="n">rotation_helper</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>
    <span class="n">OpenGL</span><span class="o">.</span><span class="n">GL</span><span class="o">.</span><span class="n">glRotatef</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">rx</span><span class="p">,</span> <span class="n">ry</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span>
    <span class="n">OpenGL</span><span class="o">.</span><span class="n">GLU</span><span class="o">.</span><span class="n">gluCylinder</span><span class="p">(</span><span class="n">quadric</span><span class="p">,</span> <span class="n">radius</span><span class="p">,</span> <span class="n">radius</span><span class="p">,</span> <span class="n">length</span><span class="p">,</span> <span class="n">quality</span><span class="p">,</span> <span class="n">quality</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">draw_caps</span><span class="p">:</span>
        <span class="n">OpenGL</span><span class="o">.</span><span class="n">GLU</span><span class="o">.</span><span class="n">gluDisk</span><span class="p">(</span><span class="n">quadric</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">radius</span><span class="p">,</span> <span class="n">quality</span><span class="p">,</span> <span class="n">quality</span><span class="p">)</span>
        <span class="n">OpenGL</span><span class="o">.</span><span class="n">GL</span><span class="o">.</span><span class="n">glTranslatef</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">length</span><span class="p">)</span>
        <span class="n">OpenGL</span><span class="o">.</span><span class="n">GLU</span><span class="o">.</span><span class="n">gluDisk</span><span class="p">(</span><span class="n">quadric</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">radius</span><span class="p">,</span> <span class="n">quality</span><span class="p">,</span> <span class="n">quality</span><span class="p">)</span>

    <span class="n">OpenGL</span><span class="o">.</span><span class="n">GLU</span><span class="o">.</span><span class="n">gluDeleteQuadric</span><span class="p">(</span><span class="n">quadric</span><span class="p">)</span>
    <span class="n">OpenGL</span><span class="o">.</span><span class="n">GL</span><span class="o">.</span><span class="n">glPopMatrix</span><span class="p">()</span></div>


<div class="viewcode-block" id="rotation_helper"><a class="viewcode-back" href="../../espressomd.html#espressomd.visualization.rotation_helper">[docs]</a><span class="k">def</span> <span class="nf">rotation_helper</span><span class="p">(</span><span class="n">d</span><span class="p">):</span>
    <span class="c1"># the rotation axis is the cross product between z and d</span>
    <span class="n">vz</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cross</span><span class="p">([</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">],</span> <span class="n">d</span><span class="p">)</span>
    <span class="c1"># get the angle using a dot product</span>
    <span class="n">norm</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>
    <span class="n">angle</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
    <span class="k">if</span> <span class="n">norm</span> <span class="o">!=</span> <span class="mf">0.</span><span class="p">:</span>
        <span class="n">angle</span> <span class="o">=</span> <span class="mf">180.0</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">acos</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">/</span> <span class="n">norm</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">angle</span><span class="p">,</span> <span class="n">vz</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">vz</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span></div>


<div class="viewcode-block" id="get_extra_clip_plane"><a class="viewcode-back" href="../../espressomd.html#espressomd.visualization.get_extra_clip_plane">[docs]</a><span class="k">def</span> <span class="nf">get_extra_clip_plane</span><span class="p">():</span>

    <span class="c1"># ON SOME HARDWARE (e.g. MAC) only 6 CLIP PLANES ARE ALLOWED,</span>
    <span class="c1"># SO CAPPING OF BOX BOUNDARIES AND ADDITIONAL SHAPE CLIP PLANES</span>
    <span class="c1"># ARE NOT POSSIBLE. THIS WILL CAUSE THE SHAPES THAT NEED ADDITIONAL</span>
    <span class="c1"># CLIP PLANES TO NOT BE CLIPPED ON ONE FACE OF THE BOX</span>

    <span class="k">if</span> <span class="n">sys</span><span class="o">.</span><span class="n">platform</span> <span class="o">==</span> <span class="s2">&quot;darwin&quot;</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">OpenGL</span><span class="o">.</span><span class="n">GL</span><span class="o">.</span><span class="n">GL_CLIP_PLANE0</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">OpenGL</span><span class="o">.</span><span class="n">GL</span><span class="o">.</span><span class="n">GL_CLIP_PLANE0</span> <span class="o">+</span> <span class="mi">6</span></div>


<div class="viewcode-block" id="draw_arrow"><a class="viewcode-back" href="../../espressomd.html#espressomd.visualization.draw_arrow">[docs]</a><span class="k">def</span> <span class="nf">draw_arrow</span><span class="p">(</span><span class="n">pos</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">radius</span><span class="p">,</span> <span class="n">color</span><span class="p">,</span> <span class="n">material</span><span class="p">,</span> <span class="n">quality</span><span class="p">):</span>
    <span class="n">pos2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">pos</span><span class="p">)</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>

    <span class="n">draw_cylinder</span><span class="p">(</span><span class="n">pos</span><span class="p">,</span> <span class="n">pos2</span><span class="p">,</span> <span class="n">radius</span><span class="p">,</span> <span class="n">color</span><span class="p">,</span> <span class="n">material</span><span class="p">,</span> <span class="n">quality</span><span class="p">)</span>

    <span class="n">ax</span><span class="p">,</span> <span class="n">rx</span><span class="p">,</span> <span class="n">ry</span> <span class="o">=</span> <span class="n">rotation_helper</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">math</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">ax</span><span class="p">):</span>
        <span class="k">return</span>

    <span class="n">OpenGL</span><span class="o">.</span><span class="n">GL</span><span class="o">.</span><span class="n">glPushMatrix</span><span class="p">()</span>
    <span class="n">OpenGL</span><span class="o">.</span><span class="n">GL</span><span class="o">.</span><span class="n">glTranslatef</span><span class="p">(</span><span class="n">pos2</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">pos2</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">pos2</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
    <span class="n">OpenGL</span><span class="o">.</span><span class="n">GL</span><span class="o">.</span><span class="n">glRotatef</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">rx</span><span class="p">,</span> <span class="n">ry</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span>
    <span class="n">OpenGL</span><span class="o">.</span><span class="n">GLUT</span><span class="o">.</span><span class="n">glutSolidCone</span><span class="p">(</span><span class="n">radius</span> <span class="o">*</span> <span class="mi">3</span><span class="p">,</span> <span class="n">radius</span> <span class="o">*</span> <span class="mi">3</span><span class="p">,</span> <span class="n">quality</span><span class="p">,</span> <span class="n">quality</span><span class="p">)</span>
    <span class="n">OpenGL</span><span class="o">.</span><span class="n">GL</span><span class="o">.</span><span class="n">glPopMatrix</span><span class="p">()</span></div>


<span class="c1"># MOUSE EVENT MANAGER</span>
<div class="viewcode-block" id="MouseFireEvent"><a class="viewcode-back" href="../../espressomd.html#espressomd.visualization.MouseFireEvent">[docs]</a><span class="k">class</span> <span class="nc">MouseFireEvent</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Event type of mouse button used for mouse callbacks.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">ButtonPressed</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">FreeMotion</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">ButtonMotion</span> <span class="o">=</span> <span class="mi">2</span>
    <span class="n">ButtonReleased</span> <span class="o">=</span> <span class="mi">3</span>
    <span class="n">DoubleClick</span> <span class="o">=</span> <span class="mi">4</span></div>


<div class="viewcode-block" id="MouseButtonEvent"><a class="viewcode-back" href="../../espressomd.html#espressomd.visualization.MouseButtonEvent">[docs]</a><span class="k">class</span> <span class="nc">MouseButtonEvent</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Mouse event used for mouse callbacks. Stores button and callback.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">button</span><span class="p">,</span> <span class="n">fireEvent</span><span class="p">,</span> <span class="n">callback</span><span class="p">,</span> <span class="n">positional</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">button</span> <span class="o">=</span> <span class="n">button</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fireEvent</span> <span class="o">=</span> <span class="n">fireEvent</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">callback</span> <span class="o">=</span> <span class="n">callback</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">positional</span> <span class="o">=</span> <span class="n">positional</span></div>


<div class="viewcode-block" id="MouseManager"><a class="viewcode-back" href="../../espressomd.html#espressomd.visualization.MouseManager">[docs]</a><span class="k">class</span> <span class="nc">MouseManager</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Handles mouse callbacks.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mousePos</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mousePosOld</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mouseEventsPressed</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mouseEventsFreeMotion</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mouseEventsButtonMotion</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mouseEventsReleased</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mouseEventsDoubleClick</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mouseState</span> <span class="o">=</span> <span class="p">{</span><span class="n">OpenGL</span><span class="o">.</span><span class="n">GLUT</span><span class="o">.</span><span class="n">GLUT_LEFT_BUTTON</span><span class="p">:</span> <span class="n">OpenGL</span><span class="o">.</span><span class="n">GLUT</span><span class="o">.</span><span class="n">GLUT_UP</span><span class="p">,</span>
                           <span class="n">OpenGL</span><span class="o">.</span><span class="n">GLUT</span><span class="o">.</span><span class="n">GLUT_MIDDLE_BUTTON</span><span class="p">:</span> <span class="n">OpenGL</span><span class="o">.</span><span class="n">GLUT</span><span class="o">.</span><span class="n">GLUT_UP</span><span class="p">,</span>
                           <span class="n">OpenGL</span><span class="o">.</span><span class="n">GLUT</span><span class="o">.</span><span class="n">GLUT_RIGHT_BUTTON</span><span class="p">:</span> <span class="n">OpenGL</span><span class="o">.</span><span class="n">GLUT</span><span class="o">.</span><span class="n">GLUT_UP</span><span class="p">,</span>
                           <span class="s1">&#39;3&#39;</span><span class="p">:</span> <span class="n">OpenGL</span><span class="o">.</span><span class="n">GLUT</span><span class="o">.</span><span class="n">GLUT_UP</span><span class="p">,</span> <span class="s1">&#39;4&#39;</span><span class="p">:</span> <span class="n">OpenGL</span><span class="o">.</span><span class="n">GLUT</span><span class="o">.</span><span class="n">GLUT_UP</span><span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pressedTime</span> <span class="o">=</span> <span class="p">{</span><span class="n">OpenGL</span><span class="o">.</span><span class="n">GLUT</span><span class="o">.</span><span class="n">GLUT_LEFT_BUTTON</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
                            <span class="n">OpenGL</span><span class="o">.</span><span class="n">GLUT</span><span class="o">.</span><span class="n">GLUT_MIDDLE_BUTTON</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
                            <span class="n">OpenGL</span><span class="o">.</span><span class="n">GLUT</span><span class="o">.</span><span class="n">GLUT_RIGHT_BUTTON</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
                            <span class="mi">3</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">4</span><span class="p">:</span> <span class="mi">0</span><span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pressedTimeOld</span> <span class="o">=</span> <span class="p">{</span><span class="n">OpenGL</span><span class="o">.</span><span class="n">GLUT</span><span class="o">.</span><span class="n">GLUT_LEFT_BUTTON</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
                               <span class="n">OpenGL</span><span class="o">.</span><span class="n">GLUT</span><span class="o">.</span><span class="n">GLUT_MIDDLE_BUTTON</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
                               <span class="n">OpenGL</span><span class="o">.</span><span class="n">GLUT</span><span class="o">.</span><span class="n">GLUT_RIGHT_BUTTON</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">4</span><span class="p">:</span> <span class="mi">0</span><span class="p">}</span>

<div class="viewcode-block" id="MouseManager.register_button"><a class="viewcode-back" href="../../espressomd.html#espressomd.visualization.MouseManager.register_button">[docs]</a>    <span class="k">def</span> <span class="nf">register_button</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mouseEvent</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Register mouse input callbacks.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">mouseEvent</span><span class="o">.</span><span class="n">fireEvent</span> <span class="o">==</span> <span class="n">MouseFireEvent</span><span class="o">.</span><span class="n">ButtonPressed</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mouseEventsPressed</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">mouseEvent</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">mouseEvent</span><span class="o">.</span><span class="n">fireEvent</span> <span class="o">==</span> <span class="n">MouseFireEvent</span><span class="o">.</span><span class="n">ButtonReleased</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mouseEventsReleased</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">mouseEvent</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">mouseEvent</span><span class="o">.</span><span class="n">fireEvent</span> <span class="o">==</span> <span class="n">MouseFireEvent</span><span class="o">.</span><span class="n">FreeMotion</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mouseEventsFreeMotion</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">mouseEvent</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">mouseEvent</span><span class="o">.</span><span class="n">fireEvent</span> <span class="o">==</span> <span class="n">MouseFireEvent</span><span class="o">.</span><span class="n">ButtonMotion</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mouseEventsButtonMotion</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">mouseEvent</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">mouseEvent</span><span class="o">.</span><span class="n">fireEvent</span> <span class="o">==</span> <span class="n">MouseFireEvent</span><span class="o">.</span><span class="n">DoubleClick</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mouseEventsDoubleClick</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">mouseEvent</span><span class="p">)</span></div>

<div class="viewcode-block" id="MouseManager.mouse_click"><a class="viewcode-back" href="../../espressomd.html#espressomd.visualization.MouseManager.mouse_click">[docs]</a>    <span class="k">def</span> <span class="nf">mouse_click</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">button</span><span class="p">,</span> <span class="n">state</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mousePosOld</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mousePos</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mousePos</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">])</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">mouseState</span><span class="p">[</span><span class="n">button</span><span class="p">]</span> <span class="o">=</span> <span class="n">state</span>

        <span class="k">for</span> <span class="n">me</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">mouseEventsPressed</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">me</span><span class="o">.</span><span class="n">button</span> <span class="o">==</span> <span class="n">button</span> <span class="ow">and</span> <span class="n">state</span> <span class="o">==</span> <span class="n">OpenGL</span><span class="o">.</span><span class="n">GLUT</span><span class="o">.</span><span class="n">GLUT_DOWN</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">me</span><span class="o">.</span><span class="n">positional</span><span class="p">:</span>
                    <span class="n">me</span><span class="o">.</span><span class="n">callback</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mousePos</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mousePosOld</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">me</span><span class="o">.</span><span class="n">callback</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">me</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">mouseEventsReleased</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">me</span><span class="o">.</span><span class="n">button</span> <span class="o">==</span> <span class="n">button</span> <span class="ow">and</span> <span class="n">state</span> <span class="o">==</span> <span class="n">OpenGL</span><span class="o">.</span><span class="n">GLUT</span><span class="o">.</span><span class="n">GLUT_UP</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">me</span><span class="o">.</span><span class="n">positional</span><span class="p">:</span>
                    <span class="n">me</span><span class="o">.</span><span class="n">callback</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mousePos</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mousePosOld</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">me</span><span class="o">.</span><span class="n">callback</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">state</span> <span class="o">==</span> <span class="n">OpenGL</span><span class="o">.</span><span class="n">GLUT</span><span class="o">.</span><span class="n">GLUT_DOWN</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pressedTimeOld</span><span class="p">[</span><span class="n">button</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pressedTime</span><span class="p">[</span><span class="n">button</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pressedTime</span><span class="p">[</span><span class="n">button</span><span class="p">]</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>

        <span class="k">for</span> <span class="n">me</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">mouseEventsDoubleClick</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">me</span><span class="o">.</span><span class="n">button</span> <span class="o">==</span> <span class="n">button</span> <span class="ow">and</span> <span class="n">state</span> <span class="o">==</span> <span class="n">OpenGL</span><span class="o">.</span><span class="n">GLUT</span><span class="o">.</span><span class="n">GLUT_DOWN</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">pressedTime</span><span class="p">[</span>
                    <span class="n">button</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">pressedTimeOld</span><span class="p">[</span><span class="n">button</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mf">0.25</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">me</span><span class="o">.</span><span class="n">positional</span><span class="p">:</span>
                    <span class="n">me</span><span class="o">.</span><span class="n">callback</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mousePos</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mousePosOld</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">me</span><span class="o">.</span><span class="n">callback</span><span class="p">()</span></div>

<div class="viewcode-block" id="MouseManager.mouse_move"><a class="viewcode-back" href="../../espressomd.html#espressomd.visualization.MouseManager.mouse_move">[docs]</a>    <span class="k">def</span> <span class="nf">mouse_move</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mousePosOld</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mousePos</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mousePos</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">])</span>

        <span class="k">for</span> <span class="n">me</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">mouseEventsFreeMotion</span><span class="p">:</span>
            <span class="n">me</span><span class="o">.</span><span class="n">callback</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mousePos</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mousePosOld</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mouseState</span><span class="p">)</span></div></div>


<span class="c1"># KEYBOARD EVENT MANAGER</span>

<div class="viewcode-block" id="KeyboardFireEvent"><a class="viewcode-back" href="../../espressomd.html#espressomd.visualization.KeyboardFireEvent">[docs]</a><span class="k">class</span> <span class="nc">KeyboardFireEvent</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Event type of button used for keyboard callbacks.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">Pressed</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">Hold</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">Released</span> <span class="o">=</span> <span class="mi">2</span></div>


<div class="viewcode-block" id="KeyboardButtonEvent"><a class="viewcode-back" href="../../espressomd.html#espressomd.visualization.KeyboardButtonEvent">[docs]</a><span class="k">class</span> <span class="nc">KeyboardButtonEvent</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Keyboard event used for keyboard callbacks. Stores button, event type and callback.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">button</span><span class="p">,</span> <span class="n">fireEvent</span><span class="p">,</span> <span class="n">callback</span><span class="p">,</span> <span class="n">internal</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">button</span> <span class="o">=</span> <span class="n">button</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fireEvent</span> <span class="o">=</span> <span class="n">fireEvent</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">callback</span> <span class="o">=</span> <span class="n">callback</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">internal</span> <span class="o">=</span> <span class="n">internal</span></div>


<div class="viewcode-block" id="KeyboardManager"><a class="viewcode-back" href="../../espressomd.html#espressomd.visualization.KeyboardManager">[docs]</a><span class="k">class</span> <span class="nc">KeyboardManager</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Handles keyboard callbacks.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pressedKeys</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">keyStateOld</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">keyState</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">buttonEventsPressed</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">buttonEventsHold</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">buttonEventsReleased</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">userCallbackStack</span> <span class="o">=</span> <span class="p">[]</span>

<div class="viewcode-block" id="KeyboardManager.register_button"><a class="viewcode-back" href="../../espressomd.html#espressomd.visualization.KeyboardManager.register_button">[docs]</a>    <span class="k">def</span> <span class="nf">register_button</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">buttonEvent</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Register keyboard input callbacks.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">buttonEvent</span><span class="o">.</span><span class="n">fireEvent</span> <span class="o">==</span> <span class="n">KeyboardFireEvent</span><span class="o">.</span><span class="n">Pressed</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">buttonEventsPressed</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">buttonEvent</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">buttonEvent</span><span class="o">.</span><span class="n">fireEvent</span> <span class="o">==</span> <span class="n">KeyboardFireEvent</span><span class="o">.</span><span class="n">Hold</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">buttonEventsHold</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">buttonEvent</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">buttonEvent</span><span class="o">.</span><span class="n">fireEvent</span> <span class="o">==</span> <span class="n">KeyboardFireEvent</span><span class="o">.</span><span class="n">Released</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">buttonEventsReleased</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">buttonEvent</span><span class="p">)</span></div>

<div class="viewcode-block" id="KeyboardManager.callback_on_button"><a class="viewcode-back" href="../../espressomd.html#espressomd.visualization.KeyboardManager.callback_on_button">[docs]</a>    <span class="k">def</span> <span class="nf">callback_on_button</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">be</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">be</span><span class="o">.</span><span class="n">button</span> <span class="o">==</span> <span class="n">b</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">be</span><span class="o">.</span><span class="n">internal</span><span class="p">:</span>
                <span class="n">be</span><span class="o">.</span><span class="n">callback</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">userCallbackStack</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">be</span><span class="o">.</span><span class="n">callback</span><span class="p">)</span></div>

<div class="viewcode-block" id="KeyboardManager.handle_input"><a class="viewcode-back" href="../../espressomd.html#espressomd.visualization.KeyboardManager.handle_input">[docs]</a>    <span class="k">def</span> <span class="nf">handle_input</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">removeKeys</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([])</span>
        <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">pressedKeys</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">keyStateOld</span><span class="p">[</span><span class="n">b</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">keyState</span><span class="p">[</span><span class="n">b</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">be</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">buttonEventsPressed</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">callback_on_button</span><span class="p">(</span><span class="n">be</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">be</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">buttonEventsHold</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">callback_on_button</span><span class="p">(</span><span class="n">be</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>

            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">keyStateOld</span><span class="p">[</span><span class="n">b</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">keyState</span><span class="p">[</span><span class="n">b</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">be</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">buttonEventsHold</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">callback_on_button</span><span class="p">(</span><span class="n">be</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>

            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">keyStateOld</span><span class="p">[</span><span class="n">b</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">keyState</span><span class="p">[</span><span class="n">b</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">be</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">buttonEventsReleased</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">callback_on_button</span><span class="p">(</span><span class="n">be</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>
                <span class="n">removeKeys</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">keyStateOld</span><span class="p">[</span><span class="n">b</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">keyState</span><span class="p">[</span><span class="n">b</span><span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">pressedKeys</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pressedKeys</span><span class="o">.</span><span class="n">difference</span><span class="p">(</span><span class="n">removeKeys</span><span class="p">)</span></div>

<div class="viewcode-block" id="KeyboardManager.keyboard_up"><a class="viewcode-back" href="../../espressomd.html#espressomd.visualization.KeyboardManager.keyboard_up">[docs]</a>    <span class="k">def</span> <span class="nf">keyboard_up</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">button</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">keyState</span><span class="p">[</span><span class="n">button</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1"># Key up</span></div>

<div class="viewcode-block" id="KeyboardManager.keyboard_down"><a class="viewcode-back" href="../../espressomd.html#espressomd.visualization.KeyboardManager.keyboard_down">[docs]</a>    <span class="k">def</span> <span class="nf">keyboard_down</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">button</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pressedKeys</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">button</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">keyState</span><span class="p">[</span><span class="n">button</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>  <span class="c1"># Key down</span>
        <span class="k">if</span> <span class="n">button</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">keyStateOld</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">keyStateOld</span><span class="p">[</span><span class="n">button</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span></div></div>


<span class="c1"># CAMERA</span>

<div class="viewcode-block" id="Camera"><a class="viewcode-back" href="../../espressomd.html#espressomd.visualization.Camera">[docs]</a><span class="k">class</span> <span class="nc">Camera</span><span class="p">:</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cam_pos</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]),</span> <span class="n">cam_target</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]),</span>
                 <span class="n">cam_right</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">]),</span> <span class="n">move_speed</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
                 <span class="n">global_rot_speed</span><span class="o">=</span><span class="mf">3.0</span><span class="p">,</span> <span class="n">center</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">])):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cam_pos</span> <span class="o">=</span> <span class="n">cam_pos</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">move_speed</span> <span class="o">=</span> <span class="n">move_speed</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">global_rot_speed</span> <span class="o">=</span> <span class="n">global_rot_speed</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">center</span> <span class="o">=</span> <span class="n">center</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">modelview</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">identity</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>

        <span class="n">t</span> <span class="o">=</span> <span class="n">cam_pos</span> <span class="o">-</span> <span class="n">cam_target</span>
        <span class="n">r</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">state_target</span> <span class="o">=</span> <span class="o">-</span><span class="n">t</span> <span class="o">/</span> <span class="n">r</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">state_right</span> <span class="o">=</span> <span class="n">cam_right</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">cam_right</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">state_up</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cross</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">state_right</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">state_target</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">state_pos</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">r</span><span class="p">])</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">update_modelview</span><span class="p">()</span>

<div class="viewcode-block" id="Camera.move_forward"><a class="viewcode-back" href="../../espressomd.html#espressomd.visualization.Camera.move_forward">[docs]</a>    <span class="k">def</span> <span class="nf">move_forward</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">state_pos</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">move_speed</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_modelview</span><span class="p">()</span></div>

<div class="viewcode-block" id="Camera.move_backward"><a class="viewcode-back" href="../../espressomd.html#espressomd.visualization.Camera.move_backward">[docs]</a>    <span class="k">def</span> <span class="nf">move_backward</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">state_pos</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">-=</span> <span class="bp">self</span><span class="o">.</span><span class="n">move_speed</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_modelview</span><span class="p">()</span></div>

<div class="viewcode-block" id="Camera.move_up"><a class="viewcode-back" href="../../espressomd.html#espressomd.visualization.Camera.move_up">[docs]</a>    <span class="k">def</span> <span class="nf">move_up</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">state_pos</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">move_speed</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_modelview</span><span class="p">()</span></div>

<div class="viewcode-block" id="Camera.move_down"><a class="viewcode-back" href="../../espressomd.html#espressomd.visualization.Camera.move_down">[docs]</a>    <span class="k">def</span> <span class="nf">move_down</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">state_pos</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-=</span> <span class="bp">self</span><span class="o">.</span><span class="n">move_speed</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_modelview</span><span class="p">()</span></div>

<div class="viewcode-block" id="Camera.move_left"><a class="viewcode-back" href="../../espressomd.html#espressomd.visualization.Camera.move_left">[docs]</a>    <span class="k">def</span> <span class="nf">move_left</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">state_pos</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-=</span> <span class="bp">self</span><span class="o">.</span><span class="n">move_speed</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_modelview</span><span class="p">()</span></div>

<div class="viewcode-block" id="Camera.move_right"><a class="viewcode-back" href="../../espressomd.html#espressomd.visualization.Camera.move_right">[docs]</a>    <span class="k">def</span> <span class="nf">move_right</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">state_pos</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">move_speed</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_modelview</span><span class="p">()</span></div>

<div class="viewcode-block" id="Camera.rotate_system_XL"><a class="viewcode-back" href="../../espressomd.html#espressomd.visualization.Camera.rotate_system_XL">[docs]</a>    <span class="k">def</span> <span class="nf">rotate_system_XL</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rotate_system_y</span><span class="p">(</span><span class="mf">0.01</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">global_rot_speed</span><span class="p">)</span></div>

<div class="viewcode-block" id="Camera.rotate_system_XR"><a class="viewcode-back" href="../../espressomd.html#espressomd.visualization.Camera.rotate_system_XR">[docs]</a>    <span class="k">def</span> <span class="nf">rotate_system_XR</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rotate_system_y</span><span class="p">(</span><span class="o">-</span><span class="mf">0.01</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">global_rot_speed</span><span class="p">)</span></div>

<div class="viewcode-block" id="Camera.rotate_system_YL"><a class="viewcode-back" href="../../espressomd.html#espressomd.visualization.Camera.rotate_system_YL">[docs]</a>    <span class="k">def</span> <span class="nf">rotate_system_YL</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rotate_system_z</span><span class="p">(</span><span class="mf">0.01</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">global_rot_speed</span><span class="p">)</span></div>

<div class="viewcode-block" id="Camera.rotate_system_YR"><a class="viewcode-back" href="../../espressomd.html#espressomd.visualization.Camera.rotate_system_YR">[docs]</a>    <span class="k">def</span> <span class="nf">rotate_system_YR</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rotate_system_z</span><span class="p">(</span><span class="o">-</span><span class="mf">0.01</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">global_rot_speed</span><span class="p">)</span></div>

<div class="viewcode-block" id="Camera.rotate_system_ZL"><a class="viewcode-back" href="../../espressomd.html#espressomd.visualization.Camera.rotate_system_ZL">[docs]</a>    <span class="k">def</span> <span class="nf">rotate_system_ZL</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rotate_system_x</span><span class="p">(</span><span class="mf">0.01</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">global_rot_speed</span><span class="p">)</span></div>

<div class="viewcode-block" id="Camera.rotate_system_ZR"><a class="viewcode-back" href="../../espressomd.html#espressomd.visualization.Camera.rotate_system_ZR">[docs]</a>    <span class="k">def</span> <span class="nf">rotate_system_ZR</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rotate_system_x</span><span class="p">(</span><span class="o">-</span><span class="mf">0.01</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">global_rot_speed</span><span class="p">)</span></div>

<div class="viewcode-block" id="Camera.rotate_camera"><a class="viewcode-back" href="../../espressomd.html#espressomd.visualization.Camera.rotate_camera">[docs]</a>    <span class="k">def</span> <span class="nf">rotate_camera</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mouse_pos</span><span class="p">,</span> <span class="n">mouse_pos_old</span><span class="p">,</span> <span class="n">mouse_button_state</span><span class="p">):</span>
        <span class="n">dm</span> <span class="o">=</span> <span class="n">mouse_pos</span> <span class="o">-</span> <span class="n">mouse_pos_old</span>

        <span class="k">if</span> <span class="n">mouse_button_state</span><span class="p">[</span><span class="n">OpenGL</span><span class="o">.</span><span class="n">GLUT</span><span class="o">.</span><span class="n">GLUT_LEFT_BUTTON</span><span class="p">]</span> <span class="o">==</span> <span class="n">OpenGL</span><span class="o">.</span><span class="n">GLUT</span><span class="o">.</span><span class="n">GLUT_DOWN</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">dm</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">rotate_system_y</span><span class="p">(</span><span class="o">-</span><span class="mf">0.001</span> <span class="o">*</span> <span class="n">dm</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">global_rot_speed</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">dm</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">rotate_system_x</span><span class="p">(</span><span class="o">-</span><span class="mf">0.001</span> <span class="o">*</span> <span class="n">dm</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">global_rot_speed</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">mouse_button_state</span><span class="p">[</span><span class="n">OpenGL</span><span class="o">.</span><span class="n">GLUT</span><span class="o">.</span><span class="n">GLUT_RIGHT_BUTTON</span><span class="p">]</span> <span class="o">==</span> <span class="n">OpenGL</span><span class="o">.</span><span class="n">GLUT</span><span class="o">.</span><span class="n">GLUT_DOWN</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">state_pos</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-=</span> <span class="mf">0.05</span> <span class="o">*</span> <span class="n">dm</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">move_speed</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">state_pos</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+=</span> <span class="mf">0.05</span> <span class="o">*</span> <span class="n">dm</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">move_speed</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">update_modelview</span><span class="p">()</span>
        <span class="k">elif</span> <span class="n">mouse_button_state</span><span class="p">[</span><span class="n">OpenGL</span><span class="o">.</span><span class="n">GLUT</span><span class="o">.</span><span class="n">GLUT_MIDDLE_BUTTON</span><span class="p">]</span> <span class="o">==</span> <span class="n">OpenGL</span><span class="o">.</span><span class="n">GLUT</span><span class="o">.</span><span class="n">GLUT_DOWN</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">state_pos</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">+=</span> <span class="mf">0.05</span> <span class="o">*</span> <span class="n">dm</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">move_speed</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rotate_system_z</span><span class="p">(</span><span class="n">dm</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="mf">0.001</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">global_rot_speed</span><span class="p">)</span></div>

<div class="viewcode-block" id="Camera.get_camera_rotation_matrix"><a class="viewcode-back" href="../../espressomd.html#espressomd.visualization.Camera.get_camera_rotation_matrix">[docs]</a>    <span class="k">def</span> <span class="nf">get_camera_rotation_matrix</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">target_vec</span><span class="p">,</span> <span class="n">up_vec</span><span class="p">):</span>
        <span class="n">normalized_target_vec</span> <span class="o">=</span> <span class="n">target_vec</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">target_vec</span><span class="p">)</span>
        <span class="n">normalized_up_vec</span> <span class="o">=</span> <span class="n">up_vec</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">up_vec</span><span class="p">)</span>
        <span class="n">perpendicular_normal</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cross</span><span class="p">(</span><span class="n">normalized_up_vec</span><span class="p">,</span> <span class="n">target_vec</span><span class="p">)</span>

        <span class="n">rotation_matrix</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">identity</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
        <span class="n">rotation_matrix</span><span class="p">[:</span><span class="mi">3</span><span class="p">,</span> <span class="p">:</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
            <span class="p">[</span><span class="n">perpendicular_normal</span><span class="p">,</span>
             <span class="n">np</span><span class="o">.</span><span class="n">cross</span><span class="p">(</span><span class="n">normalized_target_vec</span><span class="p">,</span> <span class="n">perpendicular_normal</span><span class="p">),</span>
             <span class="n">normalized_target_vec</span><span class="p">])</span><span class="o">.</span><span class="n">T</span>

        <span class="k">return</span> <span class="n">rotation_matrix</span></div>

<div class="viewcode-block" id="Camera.rotate_vector"><a class="viewcode-back" href="../../espressomd.html#espressomd.visualization.Camera.rotate_vector">[docs]</a>    <span class="k">def</span> <span class="nf">rotate_vector</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">vector</span><span class="p">,</span> <span class="n">phi</span><span class="p">,</span> <span class="n">axis</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Rotate vector around (unit vector) axis by angle phi.</span>
<span class="sd">        Uses Rodrigues&#39; rotation formula.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">rotated</span> <span class="o">=</span> <span class="n">vector</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">phi</span><span class="p">)</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">cross</span><span class="p">(</span><span class="n">axis</span><span class="p">,</span> <span class="n">vector</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">phi</span><span class="p">)</span> \
            <span class="o">+</span> <span class="n">axis</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">axis</span><span class="p">,</span> <span class="n">vector</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">phi</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">rotated</span></div>

<div class="viewcode-block" id="Camera.rotate_system_x"><a class="viewcode-back" href="../../espressomd.html#espressomd.visualization.Camera.rotate_system_x">[docs]</a>    <span class="k">def</span> <span class="nf">rotate_system_x</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">angle</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">state_target</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rotate_vector</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">state_target</span><span class="p">,</span>
                                               <span class="n">angle</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">state_right</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">state_up</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cross</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">state_right</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">state_target</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_modelview</span><span class="p">()</span></div>

<div class="viewcode-block" id="Camera.rotate_system_y"><a class="viewcode-back" href="../../espressomd.html#espressomd.visualization.Camera.rotate_system_y">[docs]</a>    <span class="k">def</span> <span class="nf">rotate_system_y</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">angle</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">state_target</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rotate_vector</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">state_target</span><span class="p">,</span>
                                               <span class="n">angle</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">state_up</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">state_right</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cross</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">state_target</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">state_up</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_modelview</span><span class="p">()</span></div>

<div class="viewcode-block" id="Camera.rotate_system_z"><a class="viewcode-back" href="../../espressomd.html#espressomd.visualization.Camera.rotate_system_z">[docs]</a>    <span class="k">def</span> <span class="nf">rotate_system_z</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">angle</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">state_right</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rotate_vector</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">state_right</span><span class="p">,</span>
                                              <span class="n">angle</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">state_target</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">state_up</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rotate_vector</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">state_up</span><span class="p">,</span>
                                           <span class="n">angle</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">state_target</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_modelview</span><span class="p">()</span></div>

<div class="viewcode-block" id="Camera.update_modelview"><a class="viewcode-back" href="../../espressomd.html#espressomd.visualization.Camera.update_modelview">[docs]</a>    <span class="k">def</span> <span class="nf">update_modelview</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">state_up</span> <span class="o">/=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">state_up</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">state_right</span> <span class="o">/=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">state_right</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">state_target</span> <span class="o">/=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">state_target</span><span class="p">)</span>

        <span class="c1"># Center Box</span>
        <span class="n">trans</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">identity</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
        <span class="n">trans</span><span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="p">:</span><span class="mi">3</span><span class="p">]</span> <span class="o">-=</span> <span class="bp">self</span><span class="o">.</span><span class="n">center</span>

        <span class="c1"># Camera rotation</span>
        <span class="n">rotate_cam</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_camera_rotation_matrix</span><span class="p">(</span>
            <span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">state_target</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">state_up</span><span class="p">)</span>

        <span class="c1"># System translation</span>
        <span class="n">trans_cam</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">identity</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
        <span class="n">trans_cam</span><span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="p">:</span><span class="mi">3</span><span class="p">]</span> <span class="o">-=</span> <span class="bp">self</span><span class="o">.</span><span class="n">state_pos</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">modelview</span> <span class="o">=</span> <span class="n">trans</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">rotate_cam</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">trans_cam</span><span class="p">))</span>

        <span class="n">c_xyz</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">mat</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">modelview</span><span class="p">[:</span><span class="mi">3</span><span class="p">,</span> <span class="p">:</span><span class="mi">3</span><span class="p">])</span> <span class="o">*</span> \
            <span class="n">np</span><span class="o">.</span><span class="n">mat</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">modelview</span><span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="p">:</span><span class="mi">3</span><span class="p">])</span><span class="o">.</span><span class="n">T</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cam_pos</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">c_xyz</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">c_xyz</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">c_xyz</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">]])</span></div></div>
</pre></div>

          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2018-2023, The ESPResSo project.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 4.2.0</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
    </div>

    

    
  </body>
</html>