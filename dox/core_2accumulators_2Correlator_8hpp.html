<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>ESPResSo: Correlator.hpp File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  extensions: ["tex2jax.js", "TeX/AMSmath.js"],
  jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<script type="text/javascript" async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen_extra.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectlogo"><img alt="Logo" src="logo_100x100.png"/></td>
  <td id="projectalign">
   <div id="projectname">ESPResSo
   </div>
   <div id="projectbrief">Extensible Simulation Package for Research on Soft Matter Systems</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.8 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('core_2accumulators_2Correlator_8hpp.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div class="header">
  <div class="summary">
<a href="#nested-classes">Classes</a> &#124;
<a href="#namespaces">Namespaces</a>  </div>
  <div class="headertitle"><div class="title">Correlator.hpp File Reference</div></div>
</div><!--header-->
<div class="contents">

<p>This module computes correlations (and other two time averages) on the fly and from files.  
<a href="#details">More...</a></p>
<div class="textblock"><code>#include &quot;<a class="el" href="core_2accumulators_2AccumulatorBase_8hpp_source.html">AccumulatorBase.hpp</a>&quot;</code><br />
<code>#include &quot;observables/Observable.hpp&quot;</code><br />
<code>#include &quot;system/System.hpp&quot;</code><br />
<code>#include &lt;<a class="el" href="Vector_8hpp_source.html">utils/Vector.hpp</a>&gt;</code><br />
<code>#include &lt;boost/multi_array.hpp&gt;</code><br />
<code>#include &lt;boost/serialization/access.hpp&gt;</code><br />
<code>#include &lt;cstddef&gt;</code><br />
<code>#include &lt;memory&gt;</code><br />
<code>#include &lt;string&gt;</code><br />
<code>#include &lt;utility&gt;</code><br />
<code>#include &lt;vector&gt;</code><br />
</div><div class="textblock"><div id="dynsection-0" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-0-trigger" src="closed.png" alt="+"/> Include dependency graph for core/accumulators/Correlator.hpp:</div>
<div id="dynsection-0-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-0-content" class="dyncontent" style="display:none;">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="core_2accumulators_2Correlator_8hpp__incl.svg" width="100%" height="569"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div></div>
</div>
</div><div class="textblock"><div id="dynsection-1" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-1-trigger" src="closed.png" alt="+"/> This graph shows which files directly or indirectly include this file:</div>
<div id="dynsection-1-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-1-content" class="dyncontent" style="display:none;">
<div class="center"><iframe scrolling="no" frameborder="0" src="core_2accumulators_2Correlator_8hpp__dep__incl.svg" width="264" height="183"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div>
<p><a href="core_2accumulators_2Correlator_8hpp_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="nested-classes" name="nested-classes"></a>
Classes</h2></td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classAccumulators_1_1Correlator.html">Accumulators::Correlator</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">The main correlator class.  <a href="classAccumulators_1_1Correlator.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="namespaces" name="namespaces"></a>
Namespaces</h2></td></tr>
<tr class="memitem:namespaceAccumulators" id="r_namespaceAccumulators"><td class="memItemLeft" align="right" valign="top">namespace &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespaceAccumulators.html">Accumulators</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>This module computes correlations (and other two time averages) on the fly and from files. </p>
<p>The basic idea is that the user can write arbitrary functions A and B that can depend on e.g. particle coordinates or whatever state of the MD box. These functions can be vector-valued, always indicated by dim_A and dim_B.</p>
<p>The way they can be correlated is can be formulated as a (vector-valued) operation on A and B. One example would be to calculate the product component by component, and if A and B are both the particle velocities, then one would obtain  </p><p class="formulaDsp">
\[ &lt;v_1^x v_1^x(t)&gt;, &lt;v_1^y v_1^y(t)&gt;, &lt;v_1^z v_1^z(t)&gt;,
    &lt;v_2^x v_2^x(t)&gt;, &lt;v_2^y v_2^y(t)&gt;, &lt;v_2^z v_2^z(t)&gt;, \ldots \]
</p>
<p>The idea of the algorithm is to not keep all As and Bs in memory, but feed the algorithm (or the container object) successively by new As and Bs and new correlation estimates are calculated on the fly. Those As and Bs which have exceeded a certain age are first compressed (see below) and then discarded.</p>
<p>To save memory, increase statistics and make the calculation possible for many orders of magnitude in time, the order-<em>n</em> blocking algorithm in <a class="el" href="citelist.html#CITEREF_frenkel02b">[20]</a> (algorithm 9, section 4.4.2 p. 95) is used. Thus not all As and Bs of the whole "past" are stored but some of them are blocked. In this implementation, a blocking based on 2 is always applied: all As and Bs not older than a certain <code>tau_lin</code> are stored as they were, those which are older are stored as average values. All As and Bs older than <code>2*tau_lin</code> are compressed in blocks of four, etc.</p>
<p>This leads to a hierarchical "history": on level 0 the last <code>tau_lin</code> values are stored. This is done in a cyclic array: the newest is always appended at the end of the array, and if the array length is reached, values are appended at the beginning, overwriting older values. We therefore have to carry the index <code>newest[0]</code> which tells, what is the index of the newest value of A and B.</p>
<p>As soon as the first row of As and Bs is full, two of them are compressed by calculating the arithmetic mean, and stored in the first element on level 1. Then we can overwrite these two values on level 0, because we have saved them. If necessary, we produce space on level 0 by compressing to level 1. On level 1 an array with <code>tau_lin</code> entries is available to store the level-1-compressed values. It is successively filled and also cyclic. When it is filled, the values are stored on level 2 and so on.</p>
<p>This allows to have a "history" over many orders of magnitude in time, without the full memory effort.</p>
<p>Correlations are only calculated on each level. For <code>tau=1,2,..,tau_lin</code> the values are taken from level 1. For <code>tau=tau_lin, tau_lin+2, .., 2*tau_lin</code> we take the values from level 2. On level 2 we also have values for <code>0,..tau_lin-2</code>, but these are discarded as we have "better" estimates on level 1.</p>
<p>The functions A and B can get extra arguments. This can e.g. be an integer describing the "type" of the particles to be considered, or in case of files, it is a file_data_source pointer, which tells the function from where to read. These arguments have to be a single pointer to an object that carries all relevant information to obtain A and B (from the MD Box or somewhere else).</p>
<p>The correlation has to be initialized with all necessary information, i.e. all function pointers, the dimensions of A and B and their dimensions, etc.</p>
<p>TODO: There is a lot of stuff to do:</p><ul>
<li>Expand the file_data_source so that one can specify which columns of the file are to be processed</li>
<li>calculate an estimate of average values. This might be even necessary to calculate \(\left&lt;\left(A(\tau)-\left&lt;A\right&gt;\right)\left(B(\tau)-\left&lt;B\right&gt;\right)\right&gt;\), which is often probably what people want</li>
<li>Use the A_args to calculate As and Bs only for particular particle types (especially and example, so that other people can follow)</li>
<li>Use the A_args to calculate molecular stuff in combination with the topology concept</li>
<li>Write a destructor </li>
</ul>

<p class="definition">Definition in file <a class="el" href="core_2accumulators_2Correlator_8hpp_source.html">core/accumulators/Correlator.hpp</a>.</p>
</div></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="dir_68267d1309a1af8e8297ef4c3efbcdba.html">src</a></li><li class="navelem"><a class="el" href="dir_aebb8dcc11953d78e620bbef0b9e2183.html">core</a></li><li class="navelem"><a class="el" href="dir_2ce008f9b4dcc60cf4ebd33e46020b80.html">accumulators</a></li><li class="navelem"><a class="el" href="core_2accumulators_2Correlator_8hpp.html">Correlator.hpp</a></li>
    <li class="footer">Generated on Sat Nov 1 2025 02:27:00 for ESPResSo by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.8 </li>
  </ul>
</div>
</body>
</html>
