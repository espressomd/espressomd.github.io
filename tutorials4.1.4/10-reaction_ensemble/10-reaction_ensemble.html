<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"  
  "http://www.w3.org/TR/html4/loose.dtd">  
<html > 
<head><title>Tutorial 10: Reaction Ensemble and Constant pH ensemble</title> 
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta charset="utf-8" />
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1"> 
<meta name="generator" content="TeX4ht (http://www.tug.org/tex4ht/)"> 
<meta name="originator" content="TeX4ht (http://www.tug.org/tex4ht/)"> 
<!-- html --> 
<meta name="src" content="10-reaction_ensemble.tex"> 
<link rel="stylesheet" type="text/css" href="10-reaction_ensemble.css"> 
  <style type="text/css">
div.container {
width: 1140px;
padding: 15px;
padding-left: 80px;
padding-right: 80px;
box-shadow: 0px 0px 12px 1px rgba(87, 87, 87, 0.2);
margin-left:auto;
margin-right:auto;
font-family: "Helvetica Neue", Helvetica, Arial, sans-serif;
}
div.verbatim {
border: 1px solid #cfcfcf;
border-radius: 2px;
background: #f7f7f7;
line-height: 1.21429em;
padding: 0.4em;
}
  </style>
</head><body>

<div class="container">
  <div class="maketitle">
                                                                                
                                                                                
                                                                                
                                                                                

<h2 class="titleHead">Tutorial 10: Reaction Ensemble and
Constant pH ensemble</h2>
<div class="author" ><span 
class="cmr-12x-x-120">Andrea Tagliabue, Jonas Landsgesell</span></div><br />
<div class="date" ><span 
class="cmr-12x-x-120">April 23, 2021</span></div>
  </div>
  <h3 class="likesectionHead"><a 
 id="x1-1000"></a>Contents</h3>
  <div class="tableofcontents">
  <span class="sectionToc" >1 <a 
href="#x1-20001" id="QQ2-1-2">Introduction</a></span>
<br />  <span class="sectionToc" >2 <a 
href="#x1-30002" id="QQ2-1-3">Theoretical Background</a></span>
<br />  &#x00A0;<span class="subsectionToc" >2.1 <a 
href="#x1-40002.1" id="QQ2-1-4">Constant pH method</a></span>
<br />  &#x00A0;<span class="subsectionToc" >2.2 <a 
href="#x1-50002.2" id="QQ2-1-5">Reaction Ensemble method</a></span>
<br />  <span class="sectionToc" >3 <a 
href="#x1-60003" id="QQ2-1-6">Example one: homogeneous aqueous solution of acidic species</a></span>
<br />  &#x00A0;<span class="subsectionToc" >3.1 <a 
href="#x1-70003.1" id="QQ2-1-7">System Setup</a></span>
<br />  &#x00A0;<span class="subsectionToc" >3.2 <a 
href="#x1-80003.2" id="QQ2-1-8">Dissociation degree versus concentration</a></span>
<br />  <span class="sectionToc" >4 <a 
href="#x1-90004" id="QQ2-1-10">Example two: linear weak polyelectrolytes</a></span>
<br />  &#x00A0;<span class="subsectionToc" >4.1 <a 
href="#x1-100004.1" id="QQ2-1-11">System setup</a></span>
<br />  &#x00A0;<span class="subsectionToc" >4.2 <a 
href="#x1-110004.2" id="QQ2-1-12">Titration curves</a></span>
<br />  <span class="sectionToc" >5 <a 
href="#x1-120005" id="QQ2-1-14">Charge distribution along the chain</a></span>
  </div>
<!--l. 47--><p class="noindent" >
  <h3 class="sectionHead"><span class="titlemark">1 </span> <a 
 id="x1-20001"></a>Introduction</h3>
                                                                                
                                                                                
<!--l. 49--><p class="noindent" >This tutorial introduces the basic features for simulating titratable systems via two different
methods, the Constant pH method and the Reaction Ensemble method, pointing out
differences and similarities between these two approaches and explaining the reasons to prefer
the latter in some particular cases. The first part (example one) of this tutorial will consider a
homogeneous aqueous solution of a titratable acidic species HA that can dissociate as
follows
  <table 
class="equation"><tr><td><a 
 id="x1-2001r1"></a>
  <center class="math-display" >
<img 
src="figures/10-reaction_ensemble0x.png" class="math-display" ></center></td><td class="equation-label">(1)</td></tr></table>
<!--l. 53--><p class="nopar" >
while the second part (example two) will consider a polyelectrolyte chain formed by a series of
titratable monomers bonded together.
<!--l. 56--><p class="noindent" >Both constant pH and Reaction Ensemble methods are implemented via a Monte Carlo
algorithm with the classical Metropolis-Hastings acceptation rule. Here we compare both
methods based on the paper published by Landsgesell et al.<span class="cite">[<a 
href="#Xlandsgesell2017simulation">1</a>]</span>.
<!--l. 58--><p class="noindent" >
  <h3 class="sectionHead"><span class="titlemark">2 </span> <a 
 id="x1-30002"></a>Theoretical Background</h3>
<!--l. 60--><p class="noindent" >In this tutorial we deal with chemical reactions of the following kind:
  <table 
class="equation"><tr><td><a 
 id="x1-3001r2"></a>
  <center class="math-display" >
<img 
src="figures/10-reaction_ensemble1x.png" class="math-display" ></center></td><td class="equation-label">(2)</td></tr></table>
                                                                                
                                                                                
<!--l. 63--><p class="nopar" >
If <span 
class="cmmi-10x-x-109">N</span><sub><span 
class="cmr-8">0</span></sub> = <span 
class="cmmi-10x-x-109">N</span><sub>HA</sub> + <span 
class="cmmi-10x-x-109">N</span><sub>A<sup><span 
class="cmsy-6">-</span></sup></sub> is the number of titratable groups in solution, a degree of dissociation <span 
class="cmmi-10x-x-109">&#x03B1;</span>
can be defined:
  <table 
class="equation"><tr><td><a 
 id="x1-3002r3"></a>
  <center class="math-display" >
<img 
src="figures/10-reaction_ensemble2x.png" class="math-display" ></center></td><td class="equation-label">(3)</td></tr></table>
<!--l. 67--><p class="nopar" >
Another observable is the degree of association which is given by:
  <table 
class="equation-star"><tr><td>
  <center class="math-display" >
<img 
src="figures/10-reaction_ensemble3x.png" class="math-display" ></center></td></tr></table>
<!--l. 71--><p class="nopar" >
The equilibrium concentration of each species is defined by the equilibrium reaction
constant
  <table 
class="equation"><tr><td><a 
 id="x1-3003r4"></a>
  <center class="math-display" >
<img 
src="figures/10-reaction_ensemble4x.png" class="math-display" ></center></td><td class="equation-label">(4)</td></tr></table>
<!--l. 75--><p class="nopar" >
for each species <span 
class="cmmi-10x-x-109">i a</span>(<span 
class="cmmi-10x-x-109">i</span>) = <span 
class="cmmi-10x-x-109">e</span><sup><span 
class="cmmi-8">&#x03B2;</span><span 
class="cmr-8">(</span><span 
class="cmmi-8">&#x03BC;</span><sub><span 
class="cmmi-6">i</span></sub><span 
class="cmsy-8">-</span><span 
class="cmmi-8">&#x03BC;</span><sub><span 
class="cmmi-6">i</span></sub><sup><span 
class="cmr-6">0</span></sup><span 
class="cmr-8">)</span></sup> = (<span 
class="cmmi-10x-x-109">c</span><sub><span 
class="cmmi-8">i</span></sub><span 
class="cmmi-10x-x-109">&#x2215;c</span><sub><span 
class="cmmi-8">i</span></sub><sup><span 
class="cmr-8">0</span></sup>)<span 
class="cmmi-10x-x-109">&#x03B3;</span><sub><span 
class="cmmi-8">i</span></sub> denotes the relative activity, <span 
class="cmmi-10x-x-109">&#x03BC;</span><sub><span 
class="cmmi-8">i</span></sub> is the chemical
potential, <span 
class="cmmi-10x-x-109">&#x03BC;</span><sub><span 
class="cmmi-8">i</span></sub><sup><span 
class="cmr-8">0</span></sup> is the chemical potential under some standard reference conditions, <span 
class="cmmi-10x-x-109">&#x03BD;</span><sub><span 
class="cmmi-8">i</span></sub> is the
stoichiometric coefficient, <span 
class="cmmi-10x-x-109">&#x03B3;</span><sub><span 
class="cmmi-8">i</span></sub> is the activity coefficient, <span 
class="cmmi-10x-x-109">c</span><sub><span 
class="cmmi-8">i</span></sub> and <span 
class="cmmi-10x-x-109">c</span><sub><span 
class="cmmi-8">i</span></sub><sup><span 
class="cmr-8">0</span></sup> are the concentration of the
species <span 
class="cmmi-10x-x-109">i </span>and its standard concentration, respectively. In the case of non-interacting
particles (ideal gas) or very dilute solutions (<span 
class="cmmi-10x-x-109">&#x03B3;</span><sub><span 
class="cmmi-8">i</span></sub> <span 
class="cmsy-10x-x-109">&#x2248; </span>1) activities are equal to <span 
class="cmmi-10x-x-109">c</span><sub><span 
class="cmmi-8">i</span></sub><span 
class="cmmi-10x-x-109">&#x2215;c</span><sub><span 
class="cmmi-8">i</span></sub><sup><span 
class="cmr-8">0</span></sup>.
In chemical equilibrium, which is defined by &#x0394;<span 
class="cmmi-10x-x-109">G </span>= <span 
class="cmex-10x-x-109">&#x2211;</span>
  <sub><span 
class="cmmi-8">i</span></sub><span 
class="cmmi-10x-x-109">&#x03BD;</span><sub><span 
class="cmmi-8">i</span></sub><span 
class="cmmi-10x-x-109">&#x03BC;</span><sub><span 
class="cmmi-8">i</span></sub> = 0, we obtain that
<span 
class="cmmi-10x-x-109">K </span>= exp(<span 
class="cmmi-10x-x-109">&#x03B2;</span>&#x0394;(<span 
class="cmmi-10x-x-109">G </span><span 
class="cmsy-10x-x-109">- </span><span 
class="cmmi-10x-x-109">G</span><sup><span 
class="cmr-8">0</span></sup>)) = exp(<span 
class="cmsy-10x-x-109">-</span><span 
class="cmmi-10x-x-109">&#x03B2;</span> <span 
class="cmex-10x-x-109">&#x2211;</span>
  <sub><span 
class="cmmi-8">i</span></sub><span 
class="cmmi-10x-x-109">&#x03BD;</span><sub><span 
class="cmmi-8">i</span></sub><span 
class="cmmi-10x-x-109">&#x03BC;</span><sub><span 
class="cmmi-8">i</span></sub><sup><span 
class="cmr-8">0</span></sup>). Therefore we have (in the case of no
interactions):
  <table 
class="equation"><tr><td><a 
 id="x1-3004r5"></a>
  <center class="math-display" >
<img 
src="figures/10-reaction_ensemble5x.png" class="math-display" ></center></td><td class="equation-label">(5)</td></tr></table>
<!--l. 82--><p class="nopar" >
Equivalently, for reaction (<a 
href="#x1-3001r2">2<!--tex4ht:ref: disso --></a>) and in case of a dilute solutions (<span 
class="cmmi-10x-x-109">&#x03B3;</span><sub><span 
class="cmmi-8">i</span></sub> <span 
class="cmsy-10x-x-109">&#x2248; </span>1), equation (<a 
href="#x1-3004r5">5<!--tex4ht:ref: (eq5) --></a>) can be
approximated as follows:
  <table 
class="equation"><tr><td><a 
 id="x1-3005r6"></a>
  <center class="math-display" >
<img 
src="figures/10-reaction_ensemble6x.png" class="math-display" ></center></td><td class="equation-label">(6)</td></tr></table>
<!--l. 86--><p class="nopar" >
where <span 
class="cmmi-10x-x-109">K</span><sub>c</sub> carries the dimension 1/volume.
                                                                                
                                                                                
<!--l. 90--><p class="noindent" >
  <h4 class="subsectionHead"><span class="titlemark">2.1 </span> <a 
 id="x1-40002.1"></a>Constant pH method</h4>
<!--l. 92--><p class="noindent" >In the constant pH method, the acceptance probability for a reaction is
  <table 
class="equation"><tr><td><a 
 id="x1-4001r7"></a>
  <center class="math-display" >
<img 
src="figures/10-reaction_ensemble7x.png" class="math-display" ></center></td><td class="equation-label">(7)</td></tr></table>
<!--l. 96--><p class="nopar" >
and the acceptance probability of a reaction is <span 
class="cmmi-10x-x-109">P</span><sub>acc</sub> = <img 
src="figures/10-reaction_ensemble8x.png" class="frac" align="middle"> for a dissociation and <span 
class="cmmi-10x-x-109">P</span><sub>acc</sub> = <img 
src="figures/10-reaction_ensemble9x.png" class="frac" align="middle">
for an association reaction <span class="cite">[<a 
href="#Xlandsgesell2017simulation">1</a>]</span>. Here &#x0394;<span 
class="cmmi-10x-x-109">E</span><sub>pot</sub> is the potential energy change due to the reaction,
while pH - p<span 
class="cmmi-10x-x-109">K</span><sub>a</sub> is an input parameter composed by two terms, pH and -p<span 
class="cmmi-10x-x-109">K</span><sub>a</sub>, that represent,
respectively, the concentration of H<sup>+</sup> ions in the solution and the logarithm in base 10 of the
thermodynamic dissociation constant for HA when the system is approximated as a dilute
solution (<span 
class="cmmi-10x-x-109">&#x03B3;</span><sub><span 
class="cmmi-8">i</span></sub> <span 
class="cmsy-10x-x-109">&#x2248; </span>1):
  <table 
class="equation"><tr><td><a 
 id="x1-4002r8"></a>
  <center class="math-display" >
<img 
src="figures/10-reaction_ensemble10x.png" class="math-display" ></center></td><td class="equation-label">(8)</td></tr></table>
<!--l. 100--><p class="nopar" >
  <table 
class="equation"><tr><td><a 
 id="x1-4003r9"></a>
                                                                                
                                                                                
  <center class="math-display" >
<img 
src="figures/10-reaction_ensemble11x.png" class="math-display" ></center></td><td class="equation-label">(9)</td></tr></table>
<!--l. 103--><p class="nopar" >
The chemical prefactor <span 
class="cmsy-10x-x-109">&pm;</span>1 defines the direction of the reaction (+1 dissociation, -1
association). When a dissociation move is attempted, the titratable molecule HA is charged
and a counterion H<sup>+</sup> is randomly placed into the simulation box, while when an association
move is attempted, a A<sup>&#8211;</sup>  is neutralized and a random counterion H<sup>+</sup> is removed from the
cell.
<!--l. 108--><p class="noindent" >
  <h4 class="subsectionHead"><span class="titlemark">2.2 </span> <a 
 id="x1-50002.2"></a>Reaction Ensemble method</h4>
<!--l. 109--><p class="noindent" >A chemical reaction involving <span 
class="cmmi-10x-x-109">n </span>species of type <span 
class="cmmi-10x-x-109">s</span><sub><span 
class="cmmi-8">i</span></sub> and with stoichiometric coefficients <span 
class="cmmi-10x-x-109">&#x03BD;</span><sub><span 
class="cmmi-8">i</span></sub> can
be written as
  <table 
class="equation"><tr><td><a 
 id="x1-5001r10"></a>
  <center class="math-display" >
<img 
src="figures/10-reaction_ensemble12x.png" class="math-display" ></center></td><td class="equation-label">(10)</td></tr></table>
<!--l. 112--><p class="nopar" >
For such a general reaction, the acceptance probability in the Reaction Ensemble method is
defined as
  <table 
class="equation"><tr><td><a 
 id="x1-5002r11"></a>
                                                                                
                                                                                
  <center class="math-display" >
<img 
src="figures/10-reaction_ensemble13x.png" class="math-display" ></center></td><td class="equation-label">(11)</td></tr></table>
<!--l. 116--><p class="nopar" >
Here <span 
class="cmmi-10x-x-109">K</span><sub><span 
class="cmmi-8">c</span></sub> is the ideal reacting gas quantity introduced above, <span 
class="cmmi-10x-x-109">V </span>the volume, <span class="bar-css"><span 
class="cmmi-10x-x-109">&#x03BD;</span></span> the total change
in the number of particles, <span 
class="cmmi-10x-x-109">N</span><sub><span 
class="cmr-8">0</span></sub><sup><span 
class="cmmi-8">i</span></sup> the number of particles prior to the reaction and <span 
class="cmmi-10x-x-109">&#x03BE; </span>is the
extent of the reaction, which could assume value +1 (forward reaction) or -1 (backward
reaction). Each reaction is proposed with uniform probability.
<!--l. 119--><p class="noindent" >For reaction (<a 
href="#x1-3001r2">2<!--tex4ht:ref: disso --></a>) eq. (<a 
href="#x1-5002r11">11<!--tex4ht:ref: RE --></a>) can be simplified:
  <table 
class="equation"><tr><td><a 
 id="x1-5003r12"></a>
  <center class="math-display" >
<img 
src="figures/10-reaction_ensemble14x.png" class="math-display" ></center></td><td class="equation-label">(12)</td></tr></table>
<!--l. 122--><p class="nopar" >
Notice that in this case you can also define <span 
class="cmmi-10x-x-109">K</span><sub>a</sub> = <span 
class="cmmi-10x-x-109">K</span><sub><span 
class="cmmi-8">c</span></sub><span 
class="cmmi-10x-x-109">&#x2215;c</span><sub><span 
class="cmr-8">0</span></sub> .
<!--l. 125--><p class="indent" >  The main difference in the two methods consists in the fact that in the Reaction Ensemble
the system pH is determined via the actual proton concentration in the simulation box, while
in Constant pH method it represents an input parameter which remains constant during all
the simulation.
<!--l. 128--><p class="noindent" >
  <h3 class="sectionHead"><span class="titlemark">3 </span> <a 
 id="x1-60003"></a>Example one: homogeneous aqueous solution of acidic species</h3>
<!--l. 130--><p class="noindent" >Compile Espresso with the following features in your <span 
class="cmtt-10x-x-109">myconfig.hpp </span>to be set throughout the
whole tutorial:
                                                                                
                                                                                
  <div class="verbatim" id="verbatim-1">
#&#x00A0;define&#x00A0;LENNARD_JONES
&#x00A0;<br />#&#x00A0;define&#x00A0;ELECTROSTATICS
</div>
<!--l. 136--><p class="nopar" >
<!--l. 138--><p class="noindent" >
  <h4 class="subsectionHead"><span class="titlemark">3.1 </span> <a 
 id="x1-70003.1"></a>System Setup</h4>
<!--l. 140--><p class="noindent" >We start by defining some important input parameters and setting the particles randomly
inside the box:
                                                                                
                                                                                
  <div class="verbatim" id="verbatim-2">
import&#x00A0;espressomd
&#x00A0;<br />from&#x00A0;espressomd&#x00A0;import&#x00A0;reaction_ensemble
&#x00A0;<br />
&#x00A0;<br />box_l&#x00A0;=&#x00A0;15&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;#side&#x00A0;length&#x00A0;of&#x00A0;our&#x00A0;cubic&#x00A0;simul&#x00A0;box
&#x00A0;<br />system&#x00A0;=&#x00A0;espressomd.System(box_l=[box_l]*3)
&#x00A0;<br />
&#x00A0;<br />system.set_random_state_PRNG()
&#x00A0;<br />np.random.seed(seed=system.seed)
&#x00A0;<br />
&#x00A0;<br />
&#x00A0;<br />#&#x00A0;Particle&#x00A0;setup
&#x00A0;<br />#############################################################
&#x00A0;<br />#&#x00A0;type&#x00A0;0&#x00A0;=&#x00A0;HA
&#x00A0;<br />#&#x00A0;type&#x00A0;1&#x00A0;=&#x00A0;A-
&#x00A0;<br />#&#x00A0;type&#x00A0;2&#x00A0;=&#x00A0;H+
&#x00A0;<br />
&#x00A0;<br />N0&#x00A0;=&#x00A0;50&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;#number&#x00A0;of&#x00A0;titratable&#x00A0;particles
&#x00A0;<br />K_diss&#x00A0;=&#x00A0;8.3**(-4)&#x00A0;&#x00A0;#dissociation&#x00A0;costant
&#x00A0;<br />
&#x00A0;<br />#&#x00A0;titratable&#x00A0;particles&#x00A0;(HA)
&#x00A0;<br />for&#x00A0;i&#x00A0;in&#x00A0;range(N0):
&#x00A0;<br />&#x00A0;&#x00A0;&#x00A0;&#x00A0;system.part.add(id=i,&#x00A0;pos=np.random.random(3)&#x00A0;*&#x00A0;system.box_l,&#x00A0;type=1)
&#x00A0;<br />#&#x00A0;counterions&#x00A0;(H+)
&#x00A0;<br />for&#x00A0;i&#x00A0;in&#x00A0;range(N0,&#x00A0;2&#x00A0;*&#x00A0;N0):
&#x00A0;<br />&#x00A0;&#x00A0;&#x00A0;&#x00A0;system.part.add(id=i,&#x00A0;pos=np.random.random(3)&#x00A0;*&#x00A0;system.box_l,&#x00A0;type=2)
</div>
<!--l. 167--><p class="nopar" >
<!--l. 169--><p class="indent" >  For each negatively charged A<sup>&#8211;</sup>  particle (type = 1) we put in the simulation box the
respective counterion H<sup>+</sup> (type = 2) in order to maintain the electroneutrality of the
system. Notice that the implementation in Espresso requires that the dimension of the
equilibrium constant is consistent with its internal unit of volume; rules for a correct
conversion of <span 
class="cmmi-10x-x-109">K</span><sub><span 
class="cmmi-8">a</span></sub> (experimental) to <span 
class="cmmi-10x-x-109">K</span><sub><span 
class="cmmi-8">c</span></sub> (in internal units) are explained in the user guide:
<a 
href="https://espressomd.github.io/doc4.1.4/advanced_methods.html" class="url" ><span 
class="cmtt-10x-x-109">https://espressomd.github.io/doc4.1.4/advanced_methods.html</span></a>. The next step is to define the
reaction system and seed the pseudo random number generator which is used for the Monte
Carlo steps:
                                                                                
                                                                                
  <div class="verbatim" id="verbatim-3">
mode="reaction_ensemble"
&#x00A0;<br />#mode="constant_pH_ensemble"
&#x00A0;<br />
&#x00A0;<br />RE=None
&#x00A0;<br />mode=="reaction_ensemble"
&#x00A0;<br />if(mode=="reaction_ensemble"):
&#x00A0;<br />&#x00A0;&#x00A0;&#x00A0;&#x00A0;RE&#x00A0;=&#x00A0;reaction_ensemble.ReactionEnsemble(temperature=1,&#x00A0;exclusion_radius=1,&#x00A0;seed=42)
&#x00A0;<br />elif(mode=="constant_pH_ensemble"):
&#x00A0;<br />&#x00A0;&#x00A0;&#x00A0;&#x00A0;RE&#x00A0;=&#x00A0;reaction_ensemble.ConstantpHEnsemble(temperature=1,&#x00A0;exclusion_radius=1,&#x00A0;seed=42)
&#x00A0;<br />&#x00A0;&#x00A0;&#x00A0;&#x00A0;RE.constant_pH=7
&#x00A0;<br />
&#x00A0;<br />RE.add_reaction(gamma=K_diss,&#x00A0;reactant_types=[0],&#x00A0;reactant_coefficients=[1],
&#x00A0;<br />product_types=[1,&#x00A0;2],&#x00A0;product_coefficients=[1,&#x00A0;1],&#x00A0;default_charges=
&#x00A0;<br />{0:&#x00A0;0,&#x00A0;1:&#x00A0;-1,&#x00A0;2:&#x00A0;+1})
&#x00A0;<br />
&#x00A0;<br />system.setup_type_map([0,&#x00A0;1,&#x00A0;2])
</div>
<!--l. 189--><p class="nopar" > You can switch from one method to the other simply by changing the <span 
class="cmtt-10x-x-109">mode </span>parameter from
<span 
class="cmtt-10x-x-109">"reaction</span><span 
class="cmtt-10x-x-109">_ensemble" </span>to <span 
class="cmtt-10x-x-109">"constant</span><span 
class="cmtt-10x-x-109">_pH</span><span 
class="cmtt-10x-x-109">_ensemble"</span>. Now the system is ready to be
simulated.
                                                                                
                                                                                
  <div class="verbatim" id="verbatim-4">
Nreac&#x00A0;=&#x00A0;10**4&#x00A0;#number&#x00A0;of&#x00A0;association/dissociation&#x00A0;attempt&#x00A0;to&#x00A0;be&#x00A0;performed
&#x00A0;<br />for&#x00A0;i&#x00A0;in&#x00A0;range(Nreac):
&#x00A0;<br />&#x00A0;&#x00A0;&#x00A0;&#x00A0;RE.reaction()
</div>
<!--l. 196--><p class="nopar" > Notice that, at this level, we&#8217;re not taking into account electrostatic interactions
between charged species. Therefore, if you compare the input equilibrium constant
<span 
class="cmmi-10x-x-109">K</span><sub><span 
class="cmmi-8">c</span></sub> and the effective one which can be calculated at the end of a simulation run
<span 
class="cmmi-10x-x-109">K</span><sub><span 
class="cmmi-8">c</span></sub><sup>(eff)</sup> = <img 
src="figures/10-reaction_ensemble15x.png" class="frac" align="middle"> you will obtain <span 
class="cmmi-10x-x-109">K</span><sub><span 
class="cmmi-8">c</span></sub> <span 
class="cmsy-10x-x-109">&#x2243; </span><span 
class="cmmi-10x-x-109">K</span><sub><span 
class="cmmi-8">c</span></sub><sup>(eff)</sup>. This is not true when e.g. electrostatic
interactions are enabled due to the fact the latter introduces an excess chemical
potential.
<!--l. 200--><p class="noindent" >
  <h4 class="subsectionHead"><span class="titlemark">3.2 </span> <a 
 id="x1-80003.2"></a>Dissociation degree versus concentration</h4>
<!--l. 202--><p class="noindent" >Performing several simulations with constant <span 
class="cmmi-10x-x-109">N</span><sub><span 
class="cmr-8">0</span></sub> but varying the dimension of the simulation
box it is possible to obtain the dissociation degree <span 
class="cmmi-10x-x-109">&#x03B1; </span>(eq. <a 
href="#x1-3002r3">3<!--tex4ht:ref: alpha --></a>) as a function of the concentration
of titratable units. Results are shown in figure <a 
href="#x1-80011">1<!--tex4ht:ref: alpha_vs_C --></a>. <hr class="figure"><div class="figure" 
>
                                                                                
                                                                                
<a 
 id="x1-80011"></a>
                                                                                
                                                                                
<!--l. 205--><p class="noindent" ><center><img 
src="figures/alpha_vs_C.png"
width="401" height="401" ></center>
<br /> <div class="caption" 
><span class="id">Figure&#x00A0;1: </span><span  
class="content">Dissociation degree <span 
class="cmmi-10x-x-109">&#x03B1; </span>as function of the concentration of titratable groups.
Yellow squares: Constant pH method; light blue triangles: Reaction Ensemble method;
blue solid line: ideal behavior.</span></div><!--tex4ht:label?: x1-80011 -->
                                                                                
                                                                                
<!--l. 208--><p class="indent" >  </div><hr class="endfigure">
<!--l. 209--><p class="indent" >  As you can see, only the curve obtained with the Reaction Ensemble method fits the ideal
behavior described by the dilution law
  <table 
class="equation"><tr><td><a 
 id="x1-8002r13"></a>
  <center class="math-display" >
<img 
src="figures/10-reaction_ensemble16x.png" class="math-display" ></center></td><td class="equation-label">(13)</td></tr></table>
<!--l. 212--><p class="nopar" >
where <span 
class="cmmi-10x-x-109">c</span><sub>titr</sub> is the concentration of titratable units in the solution, and this is due to the fact
that the acceptance rule in Constant pH method does not depend on the volume of
the system. As <span 
class="cmmi-10x-x-109">&#x03B1; </span>differs, so will the number of counterions in the cell. This could
have a strong impact on screening effects when electrostatic interactions are taken
into account. Moreover, in the Constant pH method the real chemical nature of
counterions is unknown. In fact, when a HA molecule dissociates at high pH value, the
generated H<sup>+</sup> would react instantaneously with an OH<sup>&#8211;</sup>  ions, so the positively
charged ions that remains in solution must represent a different species (e.g. a Na<sup>+</sup>
cation).
  <h3 class="sectionHead"><span class="titlemark">4 </span> <a 
 id="x1-90004"></a>Example two: linear weak polyelectrolytes</h3>
<!--l. 219--><p class="noindent" >Weak polyelectrolytes are a family of responsive materials whose application spans the range
from flocculation-induced water purification to tissue targeted drug delivery of expensive or
cytotoxic medicines. Their properties, however, depend on their specific chemical environment,
with details such as pH, salt concentration and valency, and their topology markedly
modifying the chemical behavior of their ionizing groups. Here we&#8217;re going to study the
titration curves of a linear weak polyelectrolyte composed by 50 titratable units
with both Reaction Ensemble and Constant pH methods. In this case, we&#8217;ll enable
electrostatic interactions between charged species in order to correctly describe their
properties.
<!--l. 222--><p class="noindent" >
  <h4 class="subsectionHead"><span class="titlemark">4.1 </span> <a 
 id="x1-100004.1"></a>System setup</h4>
                                                                                
                                                                                
<!--l. 224--><p class="noindent" >First of all, we start to define some important variables and create a dictionary containing the
type and the charge for all the species in solution (this could be very useful when you have to
handle with a lot of different species in your simulations):
                                                                                
                                                                                
  <div class="verbatim" id="verbatim-5">
#&#x00A0;system&#x00A0;parameters
&#x00A0;<br />box_l&#x00A0;=&#x00A0;56.134
&#x00A0;<br />l_bjerrum&#x00A0;=&#x00A0;2.0
&#x00A0;<br />temperature&#x00A0;=&#x00A0;1.0
&#x00A0;<br />
&#x00A0;<br />system&#x00A0;=&#x00A0;espressomd.System(box_l=[box_l]*3)
&#x00A0;<br />
&#x00A0;<br />#&#x00A0;particle&#x00A0;setup
&#x00A0;<br />N_P&#x00A0;=&#x00A0;1&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;#number&#x00A0;of&#x00A0;chains
&#x00A0;<br />MPC&#x00A0;=&#x00A0;50&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;#monomers&#x00A0;per&#x00A0;chain
&#x00A0;<br />N0&#x00A0;=&#x00A0;N_P*MPC&#x00A0;&#x00A0;#total&#x00A0;number&#x00A0;of&#x00A0;monomers
&#x00A0;<br />nNaOH&#x00A0;=&#x00A0;0&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;#number&#x00A0;of&#x00A0;initial&#x00A0;Na+OH-
&#x00A0;<br />nHCl&#x00A0;=&#x00A0;0&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;#number&#x00A0;of&#x00A0;initial&#x00A0;H+Cl-&#x00A0;(additional&#x00A0;H+&#8217;s)
&#x00A0;<br />
&#x00A0;<br />type_HA&#x00A0;=&#x00A0;0&#x00A0;&#x00A0;&#x00A0;#&#x00A0;type&#x00A0;0&#x00A0;=&#x00A0;HA
&#x00A0;<br />type_A&#x00A0;&#x00A0;=&#x00A0;1&#x00A0;&#x00A0;&#x00A0;#&#x00A0;type&#x00A0;1&#x00A0;=&#x00A0;A-
&#x00A0;<br />type_H&#x00A0;&#x00A0;=&#x00A0;2&#x00A0;&#x00A0;&#x00A0;#&#x00A0;type&#x00A0;2&#x00A0;=&#x00A0;H+
&#x00A0;<br />type_OH&#x00A0;=&#x00A0;3&#x00A0;&#x00A0;&#x00A0;#&#x00A0;type&#x00A0;3&#x00A0;=&#x00A0;OH-
&#x00A0;<br />type_Na&#x00A0;=&#x00A0;4&#x00A0;&#x00A0;&#x00A0;#&#x00A0;type&#x00A0;4&#x00A0;=&#x00A0;Na+
&#x00A0;<br />type_Cl&#x00A0;=&#x00A0;5&#x00A0;&#x00A0;&#x00A0;#&#x00A0;type&#x00A0;5&#x00A0;=&#x00A0;Cl-
&#x00A0;<br />
&#x00A0;<br />charges={}
&#x00A0;<br />charges[type_HA]&#x00A0;=&#x00A0;&#x00A0;0
&#x00A0;<br />charges[type_A]&#x00A0;&#x00A0;=&#x00A0;-1
&#x00A0;<br />charges[type_H]&#x00A0;&#x00A0;=&#x00A0;&#x00A0;1
&#x00A0;<br />charges[type_OH]&#x00A0;=&#x00A0;-1
&#x00A0;<br />charges[type_Na]&#x00A0;=&#x00A0;&#x00A0;1
&#x00A0;<br />charges[type_Cl]&#x00A0;=&#x00A0;-1
</div>
<!--l. 254--><p class="nopar" > Here, we&#8217;ve defined the type and the charge of polymer titratable units (HA = A<sup>&#8211;</sup> + H<sup>+</sup> ),
counterions H<sup>+</sup>, and additional ionic species (Na<sup>+</sup>OH<sup>&#8211;</sup> and H<sup>+</sup>Cl<sup>&#8211;</sup> ) that can be inserted
inside the simulation box. Now we have to set up all these particles and to define all the
interactions.
                                                                                
                                                                                
  <div class="verbatim" id="verbatim-6">
#&#x00A0;bonding&#x00A0;interactions
&#x00A0;<br />bond_l&#x00A0;=&#x00A0;1.2&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;#bond&#x00A0;length
&#x00A0;<br />kbond&#x00A0;=&#x00A0;100&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;#force&#x00A0;constant&#x00A0;for&#x00A0;harmonic&#x00A0;bond
&#x00A0;<br />harmonic_bond&#x00A0;=&#x00A0;interactions.HarmonicBond(k=kbond,&#x00A0;r_0=bond_l)
&#x00A0;<br />system.bonded_inter.add(harmonic_bond)
&#x00A0;<br />
&#x00A0;<br />#&#x00A0;non-bonding&#x00A0;interactions&#x00A0;parameters
&#x00A0;<br />lj_eps&#x00A0;&#x00A0;&#x00A0;=&#x00A0;1.0
&#x00A0;<br />lj_sig&#x00A0;&#x00A0;&#x00A0;=&#x00A0;1.0
&#x00A0;<br />lj_cut&#x00A0;&#x00A0;&#x00A0;=&#x00A0;1.12246
&#x00A0;<br />lj_shift&#x00A0;=&#x00A0;0.0
&#x00A0;<br />
&#x00A0;<br />#&#x00A0;setting&#x00A0;up&#x00A0;the&#x00A0;polymer
&#x00A0;<br />positions&#x00A0;=&#x00A0;polymer.positions(
&#x00A0;<br />&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;n_polymers=N_P,&#x00A0;beads_per_chain=MPC,&#x00A0;bond_length=bond_l,&#x00A0;seed=13)
&#x00A0;<br />for&#x00A0;polymer&#x00A0;in&#x00A0;positions:
&#x00A0;<br />&#x00A0;&#x00A0;&#x00A0;&#x00A0;for&#x00A0;i,&#x00A0;pos&#x00A0;in&#x00A0;enumerate(polymer):
&#x00A0;<br />&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;id&#x00A0;=&#x00A0;len(system.part)
&#x00A0;<br />&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;system.part.add(id=id,&#x00A0;pos=pos,&#x00A0;type=type_A,&#x00A0;q=charges[type_A])
&#x00A0;<br />&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;if&#x00A0;i&#x00A0;&#x003E;&#x00A0;0:
&#x00A0;<br />&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;system.part[id].add_bond((harmonic_bond,&#x00A0;id&#x00A0;-&#x00A0;1))
&#x00A0;<br />
&#x00A0;<br />#&#x00A0;setting&#x00A0;up&#x00A0;counterions
&#x00A0;<br />for&#x00A0;i&#x00A0;in&#x00A0;range(N0):
&#x00A0;<br />&#x00A0;&#x00A0;&#x00A0;&#x00A0;system.part.add(pos=np.random.random(3)&#x00A0;*&#x00A0;system.box_l,&#x00A0;type=type_H,
&#x00A0;<br />&#x00A0;&#x00A0;&#x00A0;&#x00A0;q=charges[type_H])
&#x00A0;<br />
&#x00A0;<br />#&#x00A0;setting&#x00A0;up&#x00A0;other&#x00A0;background&#x00A0;ions
&#x00A0;<br />#&#x00A0;-&#x00A0;Na+&#x00A0;and&#x00A0;OH-
&#x00A0;<br />for&#x00A0;i&#x00A0;in&#x00A0;range(nNaOH):
&#x00A0;<br />&#x00A0;&#x00A0;&#x00A0;&#x00A0;system.part.add(pos=np.random.random(3)&#x00A0;*&#x00A0;system.box_l,&#x00A0;type=type_OH,
&#x00A0;<br />&#x00A0;&#x00A0;&#x00A0;&#x00A0;q=charges[type_OH])
&#x00A0;<br />for&#x00A0;i&#x00A0;in&#x00A0;range(nNaOH):
&#x00A0;<br />&#x00A0;&#x00A0;&#x00A0;&#x00A0;system.part.add(pos=np.random.random(3)&#x00A0;*&#x00A0;system.box_l,&#x00A0;type=type_Na,
&#x00A0;<br />&#x00A0;&#x00A0;&#x00A0;&#x00A0;q=charges[type_Na])
&#x00A0;<br />#&#x00A0;-&#x00A0;(additional)&#x00A0;H+&#x00A0;and&#x00A0;Cl-
&#x00A0;<br />for&#x00A0;i&#x00A0;in&#x00A0;range(nHCl):
&#x00A0;<br />&#x00A0;&#x00A0;&#x00A0;&#x00A0;system.part.add(pos=np.random.random(3)&#x00A0;*&#x00A0;system.box_l,&#x00A0;type=type_H,
&#x00A0;<br />&#x00A0;&#x00A0;&#x00A0;&#x00A0;q=charges[type_H])
&#x00A0;<br />for&#x00A0;i&#x00A0;in&#x00A0;range(nHCl):
                                                                                
                                                                                
&#x00A0;<br />&#x00A0;&#x00A0;&#x00A0;&#x00A0;system.part.add(pos=np.random.random(3)&#x00A0;*&#x00A0;system.box_l,&#x00A0;type=type_Cl,
&#x00A0;<br />&#x00A0;&#x00A0;&#x00A0;&#x00A0;q=charges[type_Cl])
</div>
<!--l. 299--><p class="nopar" > As already explained, we need to enable electrostatic interactions to correctly simulate the
physics of this type of system.
                                                                                
                                                                                
  <div class="verbatim" id="verbatim-7">
#&#x00A0;setting&#x00A0;up&#x00A0;electrostatics
&#x00A0;<br />from&#x00A0;espressomd&#x00A0;import&#x00A0;electrostatics
&#x00A0;<br />p3m&#x00A0;=&#x00A0;electrostatics.P3M(prefactor&#x00A0;=&#x00A0;l_bjerrum*temperature,&#x00A0;accuracy=1e-3)
&#x00A0;<br />system.actors.add(p3m)
</div>
<!--l. 306--><p class="nopar" > To titrate a weak polyelectrolytic chain, which is composed by <span 
class="cmmi-10x-x-109">N</span><sub><span 
class="cmr-8">0</span></sub> titratable units with a
certain p<span 
class="cmmi-10x-x-109">K</span><sub><span 
class="cmmi-8">a</span></sub>, in the Reaction Ensemble, we need to modulate the pH of the environment. To
do this, we have to add additional H<sup>+</sup> ions, increasing the pH, or OH<sup>&#8211;</sup>  ions, to
decrease it. We have also to introduce the respective counterions (Cl<sup>&#8211;</sup>  or Na<sup>+</sup>) to
preserve the electroneutrality of the system. Finally, we have to take into account also
the autoprotolysis of water (H<sub>2</sub>O = H<sup>+</sup> + OH<sup>&#8211;</sup> ) beside the main dissociation
reaction.
                                                                                
                                                                                
  <div class="verbatim" id="verbatim-8">
K_diss&#x00A0;=&#x00A0;1.0*0.002694&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;#eq&#x00A0;constant&#x00A0;HA&#x00A0;&#x003C;--&#x003E;&#x00A0;A-&#x00A0;+&#x00A0;H+
&#x00A0;<br />#&#x00A0;0.00269&#x00A0;is&#x00A0;the&#x00A0;conversion&#x00A0;constant&#x00A0;from&#x00A0;mol/L&#x00A0;to&#x00A0;internal&#x00A0;units
&#x00A0;<br />#&#x00A0;when&#x00A0;sigma&#x00A0;is&#x00A0;3.55&#x00A0;angstrom
&#x00A0;<br />
&#x00A0;<br />K_w&#x00A0;=&#x00A0;10.0**(-14)*0.02694**2&#x00A0;&#x00A0;#eq&#x00A0;constant&#x00A0;for&#x00A0;autoprotolysis
&#x00A0;<br />#&#x00A0;notice&#x00A0;that&#x00A0;here&#x00A0;we&#x00A0;converted&#x00A0;the&#x00A0;value&#x00A0;from&#x00A0;(mol/L)^2&#x00A0;to
&#x00A0;<br />#&#x00A0;internal&#x00A0;units
&#x00A0;<br />
&#x00A0;<br />#HA&#x00A0;&#x003C;--&#x003E;&#x00A0;A-&#x00A0;+&#x00A0;H+
&#x00A0;<br />RE.add_reaction(gamma=K_diss,&#x00A0;reactant_types=[type_HA],
&#x00A0;<br />&#x00A0;&#x00A0;&#x00A0;&#x00A0;reactant_coefficients=[1],&#x00A0;&#x00A0;&#x00A0;&#x00A0;product_types=[type_A,&#x00A0;type_H],
&#x00A0;<br />&#x00A0;&#x00A0;&#x00A0;&#x00A0;product_coefficients=[1,1],&#x00A0;default_charges={type_HA:&#x00A0;charges[type_HA],
&#x00A0;<br />&#x00A0;&#x00A0;&#x00A0;&#x00A0;type_A:&#x00A0;charges[type_A],&#x00A0;type_H:&#x00A0;charges[type_H]})
&#x00A0;<br />
&#x00A0;<br />#H2O&#x00A0;autoprotolysis
&#x00A0;<br />RE.add_reaction(gamma=(1/K_w),&#x00A0;reactant_types=[type_H,&#x00A0;type_OH],
&#x00A0;<br />reactant_coefficients=[1,1],&#x00A0;product_types=[],&#x00A0;&#x00A0;&#x00A0;&#x00A0;product_coefficients=[],
&#x00A0;<br />default_charges={type_H:&#x00A0;charges[type_H],&#x00A0;type_OH:&#x00A0;charges[type_OH]})
</div>
<!--l. 328--><p class="nopar" > Please notice that the order in which the species are written in reactants and products lists is
very important because, when a reaction is performed, the first species in the reactants list is
replaced by the first species in the product lists, the second reactant species is replaced by the
second product species, and so on. Moreover, if the reactant list has more species than the
products list, reactant molecules in excess are deleted from the system, while if the
products list has more species than the reactants list, product molecules in excess are
created and randomly placed inside the simulation box. For example, reversing the
order of products in our reaction (i.e. from <span class="obeylines-h"><span class="verb"><span 
class="cmtt-10x-x-109">product_types=[type_H,</span><span 
class="cmtt-10x-x-109">&#x00A0;type_A]</span></span></span>
to <span class="obeylines-h"><span class="verb"><span 
class="cmtt-10x-x-109">product_types=[type_A,</span><span 
class="cmtt-10x-x-109">&#x00A0;type_H]</span></span></span>), a neutral monomer would be positively
charged and a negative monovalent counterion would be randomly placed inside the
cell.
<!--l. 331--><p class="indent" >  Due to the fact that, at a certain pH, the ionization degree of a weak polyelectrolytes
depends on its spatial conformation, in order to obtain correctly averaged values we have also
to couple the reaction algorithm with MD simulations.
                                                                                
                                                                                
  <div class="verbatim" id="verbatim-9">
#&#x00A0;Integration&#x00A0;parameters
&#x00A0;<br />system.time_step&#x00A0;=&#x00A0;0.01
&#x00A0;<br />system.cell_system.skin&#x00A0;=&#x00A0;10.&#x00A0;#only&#x00A0;for&#x00A0;tutorial&#x00A0;purposes
&#x00A0;<br />system.cell_system.max_num_cells&#x00A0;=&#x00A0;2744
&#x00A0;<br />system.thermostat.set_langevin(kT=temperature,&#x00A0;gamma=1.0,&#x00A0;seed=42)
</div>
<!--l. 338--><p class="nopar" > Finally, we are ready to run the simulation!
                                                                                
                                                                                
  <div class="verbatim" id="verbatim-10">
for&#x00A0;i&#x00A0;in&#x00A0;range(12000):
&#x00A0;<br />&#x00A0;&#x00A0;&#x00A0;&#x00A0;RE.reaction(50)
&#x00A0;<br />&#x00A0;&#x00A0;&#x00A0;&#x00A0;system.integrator.run(500)
&#x00A0;<br />&#x00A0;&#x00A0;&#x00A0;&#x00A0;print(i,")&#x00A0;HA",&#x00A0;system.number_of_particles(type=type_HA),&#x00A0;"A-",
&#x00A0;<br />&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;system.number_of_particles(type=type_A),&#x00A0;"H+",
&#x00A0;<br />&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;system.number_of_particles(type=type_H),&#x00A0;&#8217;OH-&#8217;,
&#x00A0;<br />&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;system.number_of_particles(type=type_OH),&#x00A0;&#8217;Cl-&#8217;,
&#x00A0;<br />&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;system.number_of_particles(type=type_Cl),&#x00A0;&#8217;NA+&#8217;,
&#x00A0;<br />&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;system.number_of_particles(type=type_Na))
</div>
<!--l. 350--><p class="nopar" >
<!--l. 354--><p class="noindent" >
  <h4 class="subsectionHead"><span class="titlemark">4.2 </span> <a 
 id="x1-110004.2"></a>Titration curves</h4>
<!--l. 356--><p class="noindent" ><hr class="figure"><div class="figure" 
>
                                                                                
                                                                                
<a 
 id="x1-110012"></a>
                                                                                
                                                                                
<!--l. 358--><p class="noindent" ><center><img 
src="figures/titration.png"
width="401" height="401" ></center>
<br /> <div class="caption" 
><span class="id">Figure&#x00A0;2: </span><span  
class="content">Titration curves for a linear weak polyelectrolyte chain composed by <span 
class="cmmi-10x-x-109">N</span><sub><span 
class="cmr-8">0</span></sub> = 50
titratable monomers. Yellow squares: Constant pH method; light blue triangles: Reaction
Ensemble method; blue solid line: ideal behavior.</span></div><!--tex4ht:label?: x1-110012 -->
                                                                                
                                                                                
<!--l. 361--><p class="noindent" ></div><hr class="endfigure">
<!--l. 362--><p class="indent" >  For a solution of weak acidic molecules with a certain p<span 
class="cmmi-10x-x-109">K</span><sub>a</sub> = <span 
class="cmsy-10x-x-109">-</span>log <sub><span 
class="cmr-8">10</span></sub>(<span 
class="cmmi-10x-x-109">K</span><sub><span 
class="cmmi-8">c</span></sub><span 
class="cmmi-10x-x-109">&#x2215;c</span><sup><span 
class="cmr-8">0</span></sup>), the trend of <span 
class="cmmi-10x-x-109">&#x03B1;</span>
as function of pH is described by the Henderson-Hasselbalch equation:
  <table 
class="equation"><tr><td><a 
 id="x1-11002r14"></a>
  <center class="math-display" >
<img 
src="figures/10-reaction_ensemble17x.png" class="math-display" ></center></td><td class="equation-label">(14)</td></tr></table>
<!--l. 365--><p class="nopar" >
However, when titratable units are bonded together in a polyelectrolyte chain their effective
p<span 
class="cmmi-10x-x-109">K</span><sub>a</sub><sup>(eff)</sup> differs from the ideal one (p<span 
class="cmmi-10x-x-109">K</span><sub>a</sub>); this can be explained by the fact that the charge
carried by a dissociated monomer tends to partially inhibit the dissociation of its neighbors,
and this results into a lower total degree of dissociation with respect to the non-bonded acidic
units case. Anyway, this effect can be partially compensated by the presence of counterions,
which are able to screen repulsive interactions between dissociated monomers. As you can
observe in figure <a 
href="#x1-110012">2<!--tex4ht:ref: titration --></a>, Constant pH and Reaction Ensemble method results are very similar at
high pH values, but they show very pronounced differences at low pH values. More
in details, p<span 
class="cmmi-10x-x-109">K</span><sub>a</sub><sup>(eff)</sup> tends to the ideal one when the concentration of H<sup>+</sup> is high.
This depends on the fact that with Reaction Ensemble method we have to inject a
strong acid (H<sup>+</sup>Cl<sup>&#8211;</sup> ) in order to titrate the polymer, and this results in a more salty
solution with a strong screening power. This behavior would be reversed in case of a
weak poly-base, with superimposable curves at low pH values and the Reaction
Ensemble one approaching the ideal one when the amount of OH<sup>&#8211;</sup>  ions becomes
relevant.
  <h3 class="sectionHead"><span class="titlemark">5 </span> <a 
 id="x1-120005"></a>Charge distribution along the chain</h3>
<!--l. 371--><p class="noindent" ><hr class="figure"><div class="figure" 
>
                                                                                
                                                                                
<a 
 id="x1-120013"></a>
                                                                                
                                                                                
<!--l. 373--><p class="noindent" ><center><img 
src="figures/qdistrib.png"
width="401" height="401" ></center>
<br /> <div class="caption" 
><span class="id">Figure&#x00A0;3: </span><span  
class="content">Mean charges of monomers as function of their position along the chain
(calculated via Reaction Ensemble method) at <span 
class="cmmi-10x-x-109">&#x03B1; </span><span 
class="cmsy-10x-x-109">&#x2243; </span>0<span 
class="cmmi-10x-x-109">.</span>4 Notice that the curve is noisy
because of the short duration of the simulation. Make sure to perform longer simulations
to achieve a better convergence.</span></div><!--tex4ht:label?: x1-120013 -->
                                                                                
                                                                                
<!--l. 376--><p class="noindent" ></div><hr class="endfigure">
<!--l. 377--><p class="indent" >  Figure <a 
href="#x1-120013">3<!--tex4ht:ref: qdistrib --></a> shows the mean charge assumed by each monomer during the simulation as a
function of its position along the chain. As you can observe, monomers lying at the extremities
tend to be more charged than those lying in the innermost regions. This could be easily
explained thinking that the ends of the chain can better arrange in space in order to
minimize repulsive interactions between charges. This results do not depend on the
method, i.e. the shape of the curve at a certain dissociation degree would be te same
also with the Constant pH; however, as previously discussed, at a certain value
pH - p<span 
class="cmmi-10x-x-109">K</span><sub>a</sub>, the total dissociation degree is method-dependent, so the Constant pH
curve would be shifted to lower mean charge values for a weak poly-acid at high pH
values.
  <h3 class="likesectionHead"><a 
 id="x1-130005"></a>References</h3>
<!--l. 1--><p class="noindent" >
   <div class="thebibliography">
   <p class="bibitem" ><span class="biblabel">
 [1]<span class="bibsp">&#x00A0;&#x00A0;&#x00A0;</span></span><a 
 id="Xlandsgesell2017simulation"></a>Jonas  Landsgesell,  Christian  Holm,  and  Jens  Smiatek.   Simulation  of  weak
   polyelectrolytes: a comparison between the constant ph and the reaction ensemble
   method. <span 
class="cmti-10x-x-109">The European Physical Journal Special Topics</span>, 226(4):725&#8211;736, 2017.
</p>
   </div>
   </div>
</body></html> 

                                                                                


